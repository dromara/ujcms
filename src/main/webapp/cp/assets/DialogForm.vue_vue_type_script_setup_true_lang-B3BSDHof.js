import{d as ye,A as pe,u as ge,r as $,ar as k,bH as x,o as he,B as G,t as H,b as m,c as D,w as d,e as ee,P as I,m as Ve,k as E,aW as $e,b5 as J,v as p,x as r,g as C,aC as A,h as S,aZ as Ee,ba as Se,aH as we,aO as ke,y as Be,E as Ce,ay as Fe,n as qe,z as De}from"./index-B_1EBDED.js";import{E as Ie}from"./el-switch-Dz1XCM2P.js";import{E as Ne}from"./el-popover-BPV9oilb.js";const Oe={key:0},Pe={key:0},Te={key:1},Ue={class:"space-x-2"},je={key:0},ae="ujcms_continuous_settings",Ge=ye({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},values:{type:Object,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(n,{expose:le,emit:te}){function L(){const e=localStorage.getItem(ae);return e?JSON.parse(e):{}}function ue(e){localStorage.setItem(ae,JSON.stringify(e))}function ne(e){var u;return(u=L()[e])!=null?u:!1}function se(e,l){const u=L();u[e]=l,ue(u)}const a=n,t=te,{name:N,beanId:R,beanIds:ie,focus:F,values:i,action:oe,modelValue:Z}=pe(a),{t:q}=ge(),O=$(!1),c=$(!1),f=$(ne(N.value)),g=$(),v=$(a.initValues()),P=$(),o=$(),b=$([]),s=k(()=>o.value!=null&&oe.value==="edit"),M=k(()=>!O.value&&!x.isEqual(P.value,i.value)),h=k(()=>{var e,l;return(l=(e=a.disableEdit)==null?void 0:e.call(a,v.value))!=null?l:!1}),de=k(()=>"".concat(N.value," - ").concat(s.value?"".concat(q(h.value?"detail":"edit")," (ID: ").concat(o.value,")"):"".concat(q("add")))),T=async()=>{var e;O.value=!0;try{v.value=o.value!=null?await a.queryBean(o.value):a.initValues(i.value,s.value),P.value=o.value!=null?a.toValues(v.value):v.value,t("update:values",x.cloneDeep(P.value)),t("beanChange",v.value),(e=g.value)==null||e.resetFields()}finally{O.value=!1}};he(()=>t("update:values",a.initValues())),G(Z,()=>{Z.value&&(b.value=ie.value,o.value!==R.value?o.value=R.value:T())}),G(o,()=>{T()}),G(f,()=>se(N.value,f.value));const V=k(()=>b.value.indexOf(o.value)),U=k(()=>V.value>0),j=k(()=>V.value<b.value.length-1),W=()=>{U.value&&(o.value=b.value[V.value-1])},_=()=>{j.value&&(o.value=b.value[V.value+1])},ve=()=>{var e,l;(l=(e=F.value)==null?void 0:e.focus)==null||l.call(e),o.value=void 0},re=()=>{t("update:modelValue",!1)},K=async()=>{c.value=!0;try{await a.deleteBean([o.value]),f.value||t("update:modelValue",!1),j.value?(_(),b.value.splice(V.value-1,1)):U.value?(W(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),H.success(q("success")),t("finished")}finally{c.value=!1}},Q=()=>{P.value=a.toValues(i.value)},X=async()=>{var e;await((e=a.beforeValidate)==null?void 0:e.call(a,i.value)),g.value.validate(async l=>{var u,w,B,z;if(l){c.value=!0;try{if((w=await((u=a.preventSubmit)==null?void 0:u.call(a,i.value)))!=null&&w)return;t("beforeSubmit",i.value),s.value?(await a.updateBean(i.value),Q()):(await a.createBean(i.value),(z=(B=F.value)==null?void 0:B.focus)==null||z.call(B),t("update:values",a.initValues(i.value,s.value)),g.value.resetFields()),H.success(q("success")),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})};return le({form:g,submit:e=>{g.value.validate(async l=>{var u,w;if(l){c.value=!0;try{if((w=await((u=a.preventSubmit)==null?void 0:u.call(a,i.value)))!=null&&w)return;t("beforeSubmit",i.value),await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:F.value,loadBean:T,resetOrigValues:Q,emit:t}),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})},remove:async e=>{c.value=!0;try{await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:F.value,loadBean:T,emit:t}),f.value||t("update:modelValue",!1),j.value?(_(),b.value.splice(V.value-1,1)):U.value?(W(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),H.success(q("success")),t("finished")}finally{c.value=!1}}}),(e,l)=>{const u=Ve,w=Ne,B=Se,z=Ie,ce=we,fe=ke,me=Ce,be=De,Y=Be;return m(),D(be,{title:de.value,"close-on-click-modal":!M.value,"model-value":n.modelValue,width:n.large?"98%":"768px",top:n.large?"16px":"8vh","onUpdate:modelValue":l[3]||(l[3]=y=>e.$emit("update:modelValue",y)),onOpened:l[4]||(l[4]=()=>{var y;return!s.value&&((y=E(F))==null?void 0:y.focus())})},{header:d(()=>[p(r(E(N))+" - ",1),s.value?(m(),I("span",Oe,[p(r(e.$t(h.value?"detail":"edit"))+" ",1),n.showId?(m(),I("span",Pe,"(ID: "+r(o.value)+")",1)):C("",!0)])):(m(),I("span",Te,r(e.$t("add")),1))]),default:d(()=>[ee((m(),I("div",Ue,[s.value&&n.addable?(m(),D(u,{key:0,disabled:E(J)("".concat(n.perms,":create")),type:"primary",icon:E($e),onClick:ve},{default:d(()=>[p(r(e.$t("add")),1)]),_:1},8,["disabled","icon"])):C("",!0),A(e.$slots,"header-action",{bean:v.value,isEdit:s.value,disabled:h.value,unsaved:M.value,disableDelete:n.disableDelete,handleDelete:K},()=>[s.value?(m(),D(w,{key:0,title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>K())},{reference:d(()=>{var y;return[S(u,{disabled:((y=n.disableDelete)==null?void 0:y.call(n,v.value))||E(J)("".concat(n.perms,":delete")),icon:E(Ee)},{default:d(()=>[p(r(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]}),_:1},8,["title"])):C("",!0)]),s.value?(m(),D(B,{key:1},{default:d(()=>[S(u,{disabled:!U.value,onClick:W},{default:d(()=>[p(r(e.$t("form.prev")),1)]),_:1},8,["disabled"]),S(u,{disabled:!j.value,onClick:_},{default:d(()=>[p(r(e.$t("form.next")),1)]),_:1},8,["disabled"])]),_:1})):C("",!0),S(u,{type:"primary",onClick:re},{default:d(()=>[p(r(e.$t("back")),1)]),_:1}),S(ce,{content:e.$t("form.continuous"),placement:"top"},{default:d(()=>[S(z,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=y=>f.value=y),size:"small"},null,8,["modelValue"])]),_:1},8,["content"]),M.value?(m(),D(fe,{key:2,type:"danger"},{default:d(()=>[p(r(e.$t("form.unsaved")),1)]),_:1})):C("",!0),A(e.$slots,"header-status",{bean:v.value,isEdit:s.value,disabled:h.value})])),[[Y,O.value||c.value]]),S(me,{ref_key:"form",ref:g,class:Fe(["mt-5","pr-5"]),model:E(i),disabled:h.value,"label-width":n.labelWidth,"label-position":n.labelPosition,"scroll-to-error":""},{default:d(()=>[A(e.$slots,"default",{bean:v.value,isEdit:s.value,disabled:h.value}),h.value?C("",!0):ee((m(),I("div",je,[A(e.$slots,"footer-action",{bean:v.value,isEdit:s.value,disabled:h.value,handleSubmit:X},()=>[S(u,{disabled:E(J)(s.value?"".concat(n.perms,":update"):"".concat(n.perms,":create")),type:"primary","native-type":"submit",onClick:l[2]||(l[2]=qe(()=>X(),["prevent"]))},{default:d(()=>[p(r(e.$t("save")),1)]),_:1},8,["disabled"])])])),[[Y,c.value]])]),_:3},8,["model","disabled","label-width","label-position"])]),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}});export{Ge as _};
