import{d as j,r as d,b as p,e as w,f as R,w as o,i as a,ao as Y,K as Q,a7 as W,a8 as oe,j as u,p as te,u as X,aa as Z,V as S,v as ne,o as x,k as C,n as $,t as k,E as ee,h as le,aA as ue,c as ie,aI as de,ae as re,aq as q,ai as me,aY as pe,g as ce}from"./index-B6OoDg6B.js";import{J as ae,K as ve,L as fe,M as se,N as be,O as ye,d as ge,P as _e}from"./user-DGHrS2p0.js";import{a as J,_ as Ve,b as $e,c as ke}from"./QueryItem.vue_vue_type_script_setup_true_lang-Tf1Ym-Zs.js";import{_ as he}from"./ListMove.vue_vue_type_script_setup_true_lang-CJvXK2TJ.js";import{_ as Pe}from"./DialogForm.vue_vue_type_script_setup_true_lang-BCAZsuC3.js";import{t as Ce}from"./tree-CFBn_SXc.js";import{d as we}from"./content-2hwtLvQa.js";const Ae=j({name:"GroupForm",__name:"GroupForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(P){const A=d(),r=d({});return(m,t)=>{const _=p("el-input"),g=p("el-form-item"),h=p("el-switch"),V=p("el-option"),b=p("el-select");return w(),R(Pe,{values:r.value,"onUpdate:values":t[4]||(t[4]=s=>r.value=s),name:m.$t("menu.user.group"),"query-bean":u(se),"create-bean":u(fe),"update-bean":u(ve),"delete-bean":u(ae),"bean-id":P.beanId,"bean-ids":P.beanIds,focus:A.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":s=>({...s}),"disable-delete":s=>s.id<=10,perms:"group","model-value":P.modelValue,"onUpdate:modelValue":t[5]||(t[5]=s=>m.$emit("update:modelValue",s)),onFinished:t[6]||(t[6]=()=>m.$emit("finished"))},{default:o(({})=>[a(g,{prop:"name",label:m.$t("group.name"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:o(()=>[a(_,{ref_key:"focus",ref:A,modelValue:r.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(g,{prop:"description",label:m.$t("group.description")},{default:o(()=>[a(_,{modelValue:r.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.description=s),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),a(g,{prop:"allAccessPermission"},{label:o(()=>[a(Y,{message:"group.allAccessPermission"})]),default:o(()=>[a(h,{modelValue:r.value.allAccessPermission,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.allAccessPermission=s)},null,8,["modelValue"])]),_:1}),a(g,{prop:"type",label:m.$t("group.type"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:o(()=>[a(b,{modelValue:r.value.type,"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.type=s),disabled:r.value.type===1},{default:o(()=>[(w(),Q(W,null,oe([1,2],s=>a(V,{key:s,disabled:s===1,label:m.$t("group.type.".concat(s)),value:s},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),Ge={class:"border-t"},qe={class:"flex items-center justify-between"},Ue=j({name:"GroupPermissionForm",__name:"GroupPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null}},emits:{"update:modelValue":null,finished:null},setup(P,{emit:A}){const r=P,m=A,{beanId:t,modelValue:_}=te(r),{t:g}=X(),h=d(),V=d({}),b=d({}),s=d(!1),F=d(!0),U=d(!1),v=d(),G=d([]),B=Z(()=>S.rank>V.value.rank),T=async()=>{(t==null?void 0:t.value)!=null&&(V.value=await se(t.value),b.value={...V.value})},z=async()=>{G.value=Ce(await we())},E=async()=>{var e;if((t==null?void 0:t.value)!=null){const l=await be(t.value);(e=v.value)==null||e.setCheckedKeys([]),l.forEach(i=>{var c;(c=v.value)==null||c.setChecked(i,!0,!1)})}};ne(_,()=>{_.value&&(T(),E())}),x(()=>{z()});const I=(e,l,i,c)=>{i.forEach(f=>{f.children&&(l.getNode(f[c]).expanded=e,I(e,l,f.children,c))})},D=(e,l,i,c)=>{l.setCheckedKeys(e?i.map(f=>f[c]):[])},L=()=>{h.value.validate(async e=>{if(e){s.value=!0;try{await ye(b.value),m("finished"),m("update:modelValue",!1),ee.success(g("success"))}finally{s.value=!1}}})},N=()=>{v.value!=null&&(b.value.accessPermissions=[...v.value.getCheckedNodes(),...v.value.getHalfCheckedNodes()].map(e=>e.id))};return(e,l)=>{const i=p("el-switch"),c=p("el-form-item"),f=p("el-checkbox"),K=p("el-tree"),M=p("el-form"),O=p("el-tag"),n=p("el-button"),H=p("el-drawer");return w(),R(H,{title:e.$t("permissionSettings"),"model-value":P.modelValue,size:414,"onUpdate:modelValue":l[8]||(l[8]=y=>e.$emit("update:modelValue",y))},{default:o(()=>[a(M,{ref_key:"form",ref:h,model:b.value,disabled:B.value,"label-width":"150px"},{default:o(()=>[a(c,{prop:"allAccessPermission"},{label:o(()=>[a(Y,{message:"group.allAccessPermission",help:""})]),default:o(()=>[a(i,{modelValue:b.value.allAccessPermission,"onUpdate:modelValue":l[0]||(l[0]=y=>b.value.allAccessPermission=y)},null,8,["modelValue"])]),_:1}),b.value.allAccessPermission?le("",!0):(w(),Q(W,{key:0},[C("div",Ge,[a(f,{modelValue:F.value,"onUpdate:modelValue":l[1]||(l[1]=y=>F.value=y),label:e.$t("expand/collapse"),onChange:l[2]||(l[2]=y=>I(y,v.value,G.value,"id"))},null,8,["modelValue","label"]),a(f,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=y=>U.value=y),label:e.$t("checkAll/uncheckAll"),onChange:l[4]||(l[4]=y=>{D(y,v.value,G.value,"id"),N()})},null,8,["modelValue","label"])]),a(K,{ref_key:"accessPermissionTree",ref:v,data:G.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:l[5]||(l[5]=()=>N())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:o(()=>[C("div",qe,[C("div",null,[a(O,null,{default:o(()=>{var y;return[$(k((y=b.value)==null?void 0:y.name),1)]}),_:1})]),C("div",null,[a(n,{onClick:l[6]||(l[6]=()=>e.$emit("update:modelValue",!1))},{default:o(()=>[$(k(e.$t("cancel")),1)]),_:1}),a(n,{type:"primary",loading:s.value,disabled:B.value,onClick:l[7]||(l[7]=()=>L())},{default:o(()=>[$(k(e.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),De={class:"mb-3"},Se={class:"mt-3 app-block"},Te=j({name:"GroupList",__name:"GroupList",setup(P){const{t:A}=X(),r=d({}),m=d(),t=d(),_=d([]),g=d([]),h=d(!1),V=d(!1),b=d(!1),s=d(),F=Z(()=>_.value.map(e=>e.id)),U=d(!1),v=async()=>{h.value=!0;try{_.value=await ge({...ue(r.value),Q_OrderBy:m.value}),U.value=Object.values(r.value).filter(e=>e!==void 0&&e!=="").length>0||m.value!==void 0}finally{h.value=!1}};x(v);const G=({column:e,prop:l,order:i})=>{var c;l&&i?m.value=((c=e.sortBy)!=null?c:l)+(i==="descending"?"_desc":""):m.value=void 0,v()},B=()=>v(),T=()=>{t.value.clearSort(),de(r.value),m.value=void 0,v()},z=()=>{s.value=void 0,V.value=!0},E=e=>{s.value=e,V.value=!0},I=e=>{s.value=e,b.value=!0},D=e=>e>10,L=async e=>{const l=e.filter(i=>D(i));l.length>0&&(await ae(l),v(),ee.success(A("success")))},N=async(e,l)=>{const i=pe(e,_.value,l);await _e(i.map(c=>c.id))};return(e,l)=>{const i=p("el-button"),c=p("el-popconfirm"),f=p("el-table-column"),K=p("el-tag"),M=p("el-table"),O=ie("loading");return w(),Q("div",null,[C("div",De,[a(u(Ve),{params:r.value,onSearch:B,onReset:T},{default:o(()=>[a(u(J),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),a(u(J),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),C("div",null,[a(i,{type:"primary",disabled:u(q)("group:create"),icon:u(re),onClick:z},{default:o(()=>[$(k(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(c,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>L(g.value.map(n=>n.id)))},{reference:o(()=>[a(i,{disabled:g.value.filter(n=>D(n.id)).length<=0||u(q)("group:delete"),icon:u(me)},{default:o(()=>[$(k(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(he,{class:"ml-2",disabled:g.value.length<=0||U.value||u(q)("org:update"),onMove:l[1]||(l[1]=n=>N(g.value,n))},null,8,["disabled"]),a(u($e),{name:"group",class:"ml-2"})]),C("div",Se,[ce((w(),R(M,{ref_key:"table",ref:t,data:_.value,onSelectionChange:l[2]||(l[2]=n=>g.value=n),onRowDblclick:l[3]||(l[3]=n=>E(n.id)),onSortChange:G},{default:o(()=>[a(u(ke),{name:"group"},{default:o(()=>[a(f,{type:"selection",width:"50"}),a(f,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(f,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(f,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(f,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:o(({row:n})=>[a(K,{type:n.allAccessPermission?"success":"info",size:"small"},{default:o(()=>[$(k(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(f,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t("group.type.".concat(n.type))},null,8,["label","formatter"]),a(f,{label:e.$t("table.action")},{default:o(({row:n})=>[a(i,{type:"primary",disabled:u(q)("group:update"),size:"small",link:"",onClick:H=>E(n.id)},{default:o(()=>[$(k(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),u(S).epRank>0||u(S).epDisplay?(w(),R(i,{key:0,type:"primary",disabled:u(q)("group:updatePermission")||u(S).epRank<=0,title:u(S).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:"",onClick:()=>I(n.id)},{default:o(()=>[$(k(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","title","onClick"])):le("",!0),a(c,{title:e.$t("confirmDelete"),onConfirm:()=>L([n.id])},{reference:o(()=>[a(i,{type:"primary",disabled:!D(n.id)||u(q)("group:delete"),size:"small",link:""},{default:o(()=>[$(k(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[O,h.value]])]),a(Ae,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=n=>V.value=n),"bean-id":s.value,"bean-ids":F.value,onFinished:v},null,8,["modelValue","bean-id","bean-ids"]),a(Ue,{modelValue:b.value,"onUpdate:modelValue":l[5]||(l[5]=n=>b.value=n),"bean-id":s.value,onFinished:v},null,8,["modelValue","bean-id"])])}}});export{Te as default};
