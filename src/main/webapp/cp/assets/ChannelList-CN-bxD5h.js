import{d as Te,p as cl,r as p,aa as me,V as de,v as be,b as h,e as v,f as _,w as l,i as e,j as c,ao as se,n as z,t as U,h as M,K as Q,a7 as J,a8 as ae,k as A,a5 as ul,u as Le,c as Pe,g as ve,E as pe,a9 as rl,o as ml,aJ as pl,aA as vl,aB as hl,aK as fl,aL as el,U as Se,ae as yl,aq as le,ai as bl,aM as gl,aN as _l,aO as kl,aP as Vl,af as wl,aD as Cl,aI as $l}from"./index-B6OoDg6B.js";import{S as Tl}from"./sortable.esm-DEaZq8gs.js";import{c as ql,d as Ml,t as ie,f as Ul}from"./tree-CFBn_SXc.js";import{H as dl,I as Kl,e as Il,J as Dl,d as ge,K as il,L as Sl,M as Ll,N as Pl,O as El,P as Fl,Q as ll,R as Bl,S as Rl}from"./content-2hwtLvQa.js";import{e as Nl,f as zl}from"./system-DEylFcMw.js";import{_ as jl,a as al,b as Al,c as Ol}from"./QueryItem.vue_vue_type_script_setup_true_lang-Tf1Ym-Zs.js";import{q as tl,b as Ql}from"./config-DiPdhBV1.js";import{a as nl,m as ol,g as sl}from"./data-BgduHdtJ.js";import{_ as Jl}from"./FieldItem.vue_vue_type_script_setup_true_lang-BdcYOY4E.js";import{_ as Hl}from"./DialogForm.vue_vue_type_script_setup_true_lang-BCAZsuC3.js";import{T as Wl}from"./Tinymce-B_tUWdg4.js";import{T as Gl}from"./TuiEditor-B6ufQpc_.js";import{a as Xl}from"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-DTCj5vvC.js";import"./vuedraggable.umd-BHO2ywuu.js";/* empty css                                                                   */import"./BaseUpload-B0NBMb5L.js";import"./index-Vcq4gwWv.js";const Yl={class:"w-full"},Zl=Te({name:"ChannelForm",__name:"ChannelForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parent:{type:Object,default:null}},emits:{"update:modelValue":null,finished:null},setup(te,{emit:D}){const F=te,K=D,{modelValue:H,parent:k}=cl(F),B=p(),t=p({}),T=p([]),S=p([]),O=p([]),R=p([]),W=p([]),Y=p([]),g=p([]),i=p([]),m=p(),$=me(()=>R.value.find(n=>n.id===m.value)),u=me(()=>{var n;return nl(ol(sl().channel.mains,(n=$.value)==null?void 0:n.mains,"channel"))}),w=me(()=>{var n;return nl(ol(sl().channel.asides,(n=$.value)==null?void 0:n.asides,"channel"))}),L=me(()=>{var n;return JSON.parse(((n=$.value)==null?void 0:n.customs)||"[]")}),ne=me(()=>{const n=ql(O.value,t.value.id);return de.allChannelPermission?n:Ml(n,Y.value)}),G=async()=>{O.value=ie(await ge())},Z=async()=>{de.epRank>0&&(T.value=await Nl({category:"sys_article",deployed:!0}))},ce=async()=>{de.epRank>=3&&(S.value=await Ql())},x=async()=>{await G(),K("finished")},P=async()=>{R.value=await tl({type:"channel"}),m.value==null&&R.value.length>0&&(m.value=R.value[0].id)},qe=async()=>{W.value=await tl({type:"article"})},_e=async()=>{g.value=await Kl()},he=async()=>{i.value=await Il()},Me=async()=>{Y.value=await dl()};be(H,()=>{var n,o,X;H.value&&(m.value=(X=(n=k.value)==null?void 0:n.articleModelId)!=null?X:(o=R.value[0])==null?void 0:o.id,Me(),P(),qe(),_e(),he(),Z(),ce())}),be(L,()=>{Ue(t.value.customs)});const Ue=n=>(L.value.forEach(o=>{n[o.code]==null&&(n[o.code]=o.defaultValue,o.defaultValueKey!=null&&(n[o.code+"Key"]=o.defaultValueKey))}),n);return(n,o)=>{const X=h("el-input"),V=h("el-form-item"),C=h("el-col"),Ke=h("el-checkbox"),ee=h("el-option"),oe=h("el-select"),fe=h("el-switch"),Ie=h("el-radio"),De=h("el-radio-group"),ke=h("el-row"),r=h("el-tree-select"),f=h("el-input-number"),E=h("el-tab-pane"),I=h("el-tabs");return v(),_(Hl,{values:t.value,"onUpdate:values":o[26]||(o[26]=d=>t.value=d),name:n.$t("menu.content.channel"),"query-bean":c(Pl),"create-bean":c(Ll),"update-bean":c(Sl),"delete-bean":c(il),"bean-id":te.beanId,"bean-ids":te.beanIds,focus:B.value,"init-values":(d,N)=>{var a,s,q,ue,re,y,Ve,we,Ce,ye,b,j,$e,Ee,Fe,Be,Re,Ne,ze,je,Ae,Oe,Qe,Je,He,We,Ge,Xe,Ye,Ze,xe;return{parentId:N?d==null?void 0:d.parentId:(s=(a=c(k))==null?void 0:a.id)!=null?s:d==null?void 0:d.parentId,type:1,channelModelId:(y=(ue=d==null?void 0:d.channelModelId)!=null?ue:(q=c(k))==null?void 0:q.channelModelId)!=null?y:(re=R.value[0])==null?void 0:re.id,articleModelId:(ye=(we=d==null?void 0:d.articleModelId)!=null?we:(Ve=c(k))==null?void 0:Ve.articleModelId)!=null?ye:(Ce=W.value[0])==null?void 0:Ce.id,nav:($e=(j=d==null?void 0:d.nav)!=null?j:(b=c(k))==null?void 0:b.nav)!=null?$e:!0,channelTemplate:(Be=(Fe=d==null?void 0:d.channelTemplate)!=null?Fe:(Ee=c(k))==null?void 0:Ee.channelTemplate)!=null?Be:g.value[0],articleTemplate:(ze=(Ne=d==null?void 0:d.articleTemplate)!=null?Ne:(Re=c(k))==null?void 0:Re.articleTemplate)!=null?ze:i.value[0],pageSize:20,allowComment:(Oe=(Ae=d==null?void 0:d.allowComment)!=null?Ae:(je=c(k))==null?void 0:je.allowComment)!=null?Oe:!0,allowContribute:(He=(Je=d==null?void 0:d.allowContribute)!=null?Je:(Qe=c(k))==null?void 0:Qe.allowContribute)!=null?He:!0,allowSearch:(Xe=(Ge=d==null?void 0:d.allowSearch)!=null?Ge:(We=c(k))==null?void 0:We.allowSearch)!=null?Xe:!0,orderDesc:(xe=(Ze=d==null?void 0:d.orderDesc)!=null?Ze:(Ye=c(k))==null?void 0:Ye.orderDesc)!=null?xe:!0,customs:{}}},"to-values":d=>({...d}),perms:"channel","model-value":te.modelValue,"disable-edit":d=>!c(de).allChannelPermission&&d.id!=null&&!Y.value.includes(d.id),"label-width":"120px",large:"","onUpdate:modelValue":o[27]||(o[27]=d=>n.$emit("update:modelValue",d)),onFinished:x,onBeanChange:o[28]||(o[28]=async d=>{var N,a,s,q;m.value=(q=(a=d==null?void 0:d.channelModelId)!=null?a:(N=c(k))==null?void 0:N.channelModelId)!=null?q:(s=W.value[0])==null?void 0:s.id,await G()})},{default:l(({bean:d,isEdit:N})=>[e(ke,null,{default:l(()=>[e(C,{span:18},{default:l(()=>[e(ke,null,{default:l(()=>[e(C,{span:u.value.name.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"name",label:(a=u.value.name.name)!=null?a:n.$t("channel.name"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(X,{ref_key:"focus",ref:B,modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"]),e(C,{span:u.value.alias.double?12:24},{default:l(()=>[e(V,{prop:"alias",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^[\w-]*$/,message:()=>n.$t("channel.error.aliasPattern")},{asyncValidator:async(a,s,q)=>{if(s!==d.alias&&await c(Dl)(s)){q(n.$t("channel.error.aliasExist"));return}q()}}]},{label:l(()=>{var a;return[e(se,{label:(a=u.value.alias.name)!=null?a:n.$t("channel.alias"),message:"channel.alias",help:""},null,8,["label"])]}),default:l(()=>[e(X,{modelValue:t.value.alias,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.alias=a),maxlength:"50"},null,8,["modelValue"])]),_:2},1032,["rules"])]),_:2},1032,["span"]),t.value.type===3?(v(),_(C,{key:0,span:u.value.linkUrl.double?12:24},{default:l(()=>[e(V,{prop:"linkUrl",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>n.$t("channel.error.linkUrl")}]},{label:l(()=>{var a;return[e(se,{label:(a=u.value.linkUrl.name)!=null?a:n.$t("channel.linkUrl"),message:"channel.linkUrl",help:""},null,8,["label"])]}),default:l(()=>[e(X,{modelValue:t.value.linkUrl,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.linkUrl=a),maxlength:"255"},{append:l(()=>[e(Ke,{modelValue:t.value.targetBlank,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.targetBlank=a)},{default:l(()=>[z(U(n.$t("channel.targetBlank")),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),t.value.type<3?(v(),Q(J,{key:1},[u.value.seoTitle.show?(v(),_(C,{key:0,span:u.value.seoTitle.double?12:24},{default:l(()=>[e(V,{prop:"seoTitle",rules:u.value.seoTitle.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(se,{label:(a=u.value.seoTitle.name)!=null?a:n.$t("channel.seoTitle"),message:"channel.seoTitle",help:""},null,8,["label"])]}),default:l(()=>[e(X,{modelValue:t.value.seoTitle,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.seoTitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.seoKeywords.show?(v(),_(C,{key:1,span:u.value.seoKeywords.double?12:24},{default:l(()=>[e(V,{prop:"seoKeywords",rules:u.value.seoKeywords.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(se,{label:(a=u.value.seoKeywords.name)!=null?a:n.$t("channel.seoKeywords"),message:"channel.seoKeywords",help:""},null,8,["label"])]}),default:l(()=>[e(X,{modelValue:t.value.seoKeywords,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.seoKeywords=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.seoDescription.show?(v(),_(C,{key:2,span:u.value.seoDescription.double?12:24},{default:l(()=>[e(V,{prop:"seoDescription",rules:u.value.seoDescription.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(se,{label:(a=u.value.seoDescription.name)!=null?a:n.$t("channel.seoDescription"),message:"channel.seoDescription",help:""},null,8,["label"])]}),default:l(()=>[e(X,{modelValue:t.value.seoDescription,"onUpdate:modelValue":o[6]||(o[6]=a=>t.value.seoDescription=a),maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0)],64)):M("",!0),u.value.image.show?(v(),_(C,{key:2,span:u.value.image.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"image",label:(a=u.value.image.name)!=null?a:n.$t("channel.image"),rules:u.value.image.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(c(Xl),{modelValue:t.value.image,"onUpdate:modelValue":o[7]||(o[7]=s=>t.value.image=s),height:u.value.image.imageHeight,width:u.value.image.imageWidth,mode:u.value.image.imageMode},null,8,["modelValue","height","width","mode"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.channelModel.show?(v(),_(C,{key:3,span:u.value.channelModel.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"channelModelId",label:(a=u.value.channelModel.name)!=null?a:n.$t("channel.channelModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(oe,{modelValue:t.value.channelModelId,"onUpdate:modelValue":o[8]||(o[8]=s=>t.value.channelModelId=s),class:"w-full",onChange:o[9]||(o[9]=s=>{m.value=s})},{default:l(()=>[(v(!0),Q(J,null,ae(R.value,s=>(v(),_(ee,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.articleModel.show?(v(),_(C,{key:4,span:u.value.articleModel.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"articleModelId",label:(a=u.value.articleModel.name)!=null?a:n.$t("channel.articleModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(oe,{modelValue:t.value.articleModelId,"onUpdate:modelValue":o[10]||(o[10]=s=>t.value.articleModelId=s),class:"w-full"},{default:l(()=>[(v(!0),Q(J,null,ae(W.value,s=>(v(),_(ee,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),[3,4,5].includes(t.value.type)?M("",!0):(v(),Q(J,{key:5},[u.value.channelTemplate.show?(v(),_(C,{key:0,span:u.value.channelTemplate.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"channelTemplate",label:(a=u.value.channelTemplate.name)!=null?a:n.$t("channel.channelTemplate"),rules:u.value.channelTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(oe,{modelValue:t.value.channelTemplate,"onUpdate:modelValue":o[11]||(o[11]=s=>t.value.channelTemplate=s),class:"w-full"},{default:l(()=>[(v(!0),Q(J,null,ae(g.value,s=>(v(),_(ee,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.articleTemplate.show?(v(),_(C,{key:1,span:u.value.articleTemplate.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"articleTemplate",label:(a=u.value.articleTemplate.name)!=null?a:n.$t("channel.articleTemplate"),rules:u.value.articleTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(oe,{modelValue:t.value.articleTemplate,"onUpdate:modelValue":o[12]||(o[12]=s=>t.value.articleTemplate=s),class:"w-full"},{default:l(()=>[(v(!0),Q(J,null,ae(i.value,s=>(v(),_(ee,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0)],64)),u.value.nav.show?(v(),_(C,{key:6,span:u.value.nav.double?12:24},{default:l(()=>[e(V,{prop:"nav",rules:u.value.nav.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(se,{label:(a=u.value.nav.name)!=null?a:n.$t("channel.nav"),message:"channel.nav",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.nav,"onUpdate:modelValue":o[13]||(o[13]=a=>t.value.nav=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.allowSearch.show?(v(),_(C,{key:7,span:u.value.allowSearch.double?12:24},{default:l(()=>[e(V,{prop:"allowSearch",rules:u.value.allowSearch.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(se,{label:(a=u.value.allowSearch.name)!=null?a:n.$t("channel.allowSearch"),message:"channel.allowSearch",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.allowSearch,"onUpdate:modelValue":o[14]||(o[14]=a=>t.value.allowSearch=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),(v(!0),Q(J,null,ae(L.value,a=>(v(),_(C,{key:a.code,span:a.double?12:24},{default:l(()=>[e(V,{prop:"customs.".concat(a.code),rules:a.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>[e(se,{label:a.name},null,8,["label"])]),default:l(()=>[e(Jl,{modelValue:t.value.customs[a.code],"onUpdate:modelValue":s=>t.value.customs[a.code]=s,"model-key":t.value.customs[a.code+"Key"],"onUpdate:modelKey":s=>t.value.customs[a.code+"Key"]=s,field:a},null,8,["modelValue","onUpdate:modelValue","model-key","onUpdate:modelKey","field"])]),_:2},1032,["prop","rules"])]),_:2},1032,["span"]))),128)),t.value.type===2?(v(),_(C,{key:8,span:u.value.text.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"text",label:(a=u.value.text.name)!=null?a:n.$t("channel.text"),rules:u.value.text.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[A("div",Yl,[u.value.text.editorSwitch?(v(),_(De,{key:0,modelValue:t.value.editorType,"onUpdate:modelValue":o[15]||(o[15]=s=>t.value.editorType=s),class:"mr-6",onChange:o[16]||(o[16]=()=>t.value.markdown="")},{default:l(()=>[(v(),Q(J,null,ae([1,2],s=>e(Ie,{key:s,value:s},{default:l(()=>[z(U(n.$t("model.field.editorType.".concat(s))),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])):M("",!0),t.value.editorType===2?(v(),_(c(Gl),{key:1,modelValue:t.value.markdown,"onUpdate:modelValue":o[17]||(o[17]=s=>t.value.markdown=s),html:t.value.text,"onUpdate:html":o[18]||(o[18]=s=>t.value.text=s),class:"leading-6"},null,8,["modelValue","html"])):(v(),_(c(Wl),{key:2,ref:"tinyText",modelValue:t.value.text,"onUpdate:modelValue":o[19]||(o[19]=s=>t.value.text=s)},null,8,["modelValue"]))])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0)]),_:2},1024)]),_:2},1024),e(C,{span:6},{default:l(()=>[e(I,{type:"border-card",class:"ml-5"},{default:l(()=>[e(E,{label:n.$t("channel.tabs.setting")},{default:l(()=>{var a,s,q,ue,re;return[e(V,{prop:"parentId",label:(a=w.value.parent.name)!=null?a:n.$t("channel.parent"),"label-position":"top"},{default:l(()=>[e(r,{modelValue:t.value.parentId,"onUpdate:modelValue":o[20]||(o[20]=y=>t.value.parentId=y),data:ne.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"render-after-expand":!1,disabled:N,placeholder:"","check-strictly":"",clearable:"",class:"w-full"},null,8,["modelValue","data","disabled"])]),_:2},1032,["label"]),e(V,{prop:"type",label:(s=w.value.type.name)!=null?s:n.$t("channel.type"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(oe,{modelValue:t.value.type,"onUpdate:modelValue":o[21]||(o[21]=y=>t.value.type=y),class:"w-full"},{default:l(()=>[(v(),Q(J,null,ae([1,2,3,4],y=>e(ee,{key:y,label:n.$t("channel.type.".concat(y)),value:y},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(V,{prop:"processKey",label:(q=w.value.processKey.name)!=null?q:n.$t("channel.processKey"),rules:w.value.processKey.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(oe,{modelValue:t.value.processKey,"onUpdate:modelValue":o[22]||(o[22]=y=>t.value.processKey=y),clearable:"",class:"w-full"},{default:l(()=>[(v(!0),Q(J,null,ae(T.value,y=>(v(),_(ee,{key:y.key,label:y.name,value:y.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),c(de).epRank>=3&&w.value.performanceType.show?(v(),_(V,{key:0,prop:"performanceType",label:(ue=w.value.performanceType.name)!=null?ue:n.$t("channel.performanceType"),rules:w.value.performanceType.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(oe,{modelValue:t.value.performanceTypeId,"onUpdate:modelValue":o[23]||(o[23]=y=>t.value.performanceTypeId=y),clearable:"",class:"w-full"},{default:l(()=>[(v(!0),Q(J,null,ae(S.value,y=>(v(),_(ee,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])):M("",!0),e(V,{prop:"pageSize",label:(re=w.value.pageSize.name)!=null?re:n.$t("channel.pageSize"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(f,{modelValue:t.value.pageSize,"onUpdate:modelValue":o[24]||(o[24]=y=>t.value.pageSize=y),min:1,max:200},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(V,{prop:"orderDesc",rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{label:l(()=>{var y;return[e(se,{label:(y=w.value.orderDesc.name)!=null?y:n.$t("channel.orderDesc"),message:"channel.orderDesc",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.orderDesc,"onUpdate:modelValue":o[25]||(o[25]=y=>t.value.orderDesc=y)},null,8,["modelValue"])]),_:1},8,["rules"])]}),_:2},1032,["label"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","model-value","disable-edit"])}}}),xl={class:"text-lg text-center"},ea={class:"flex items-center justify-center"},la={class:"text-lg text-center"},aa={class:"mt-5"},ta=Te({name:"ChannelMoveForm",__name:"ChannelMoveForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:rl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(te){const D=ul(te,"modelValue"),{t:F}=Le(),K=p(!1),H=p([]),k=p([]),B=p(),t=p(),T=p("inner"),S=p(),O=async()=>{K.value=!0;try{const i=await ge(),m=[];i.forEach($=>{m.push({...$})}),H.value=ie(i),k.value=ie(m)}finally{K.value=!1}};be(D,async()=>{D.value&&O()});const R=(i,m,$)=>{var u;m=m||$.includes(i.id),i.disabled=m,(u=i.children)==null||u.forEach(w=>{R(w,m,$)})},W=()=>{S.value=void 0;const i=B.value.getCheckedKeys();i.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),k.value.forEach(m=>{R(m,!1,i)})},Y=(i,m)=>{S.value=void 0,m.checkedKeys.length>1&&t.value.setCheckedKeys([i.id])},g=async()=>{const i=B.value.getCheckedKeys();if(i.length<=0){S.value=F("channel.error.srcChannelRequired");return}const m=t.value.getCheckedKeys()[0];if(m==null){S.value=F("channel.error.moveToChannelRequired");return}await El(i,m,T.value),O(),pe.success(F("success"))};return(i,m)=>{const $=h("el-tree"),u=h("el-col"),w=h("el-option"),L=h("el-select"),ne=h("el-row"),G=h("el-alert"),Z=h("el-button"),ce=h("el-dialog"),x=Pe("loading");return v(),_(ce,{modelValue:D.value,"onUpdate:modelValue":m[2]||(m[2]=P=>D.value=P),title:i.$t("channel.op.batchMove"),width:"768",top:"5vh",onClose:m[3]||(m[3]=P=>i.$emit("finished"))},{default:l(()=>[e(ne,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[A("div",xl,U(i.$t("channel.batchMove.srcChannel")),1),ve(e($,{ref_key:"srcTree",ref:B,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[x,K.value]])]),_:1}),e(u,{span:12},{default:l(()=>[A("div",ea,[A("div",la,U(i.$t("channel.batchMove.moveTo")),1),e(L,{modelValue:T.value,"onUpdate:modelValue":m[0]||(m[0]=P=>T.value=P),class:"w-32 ml-2"},{default:l(()=>[(v(),Q(J,null,ae(["inner","before","after"],P=>e(w,{key:P,label:i.$t("channel.batchMove.moveTo.".concat(P)),value:P},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),ve(e($,{ref_key:"targetTree",ref:t,data:k.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:Y},null,8,["data"]),[[x,K.value]])]),_:1})]),_:1}),A("div",aa,[S.value?(v(),_(G,{key:0,title:S.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):M("",!0),e(Z,{type:"primary",onClick:m[1]||(m[1]=()=>g())},{default:l(()=>[z(U(i.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),na={class:"text-lg text-center"},oa={class:"flex items-center justify-center"},sa={class:"text-lg text-center"},ua={class:"mt-5"},ra=Te({name:"ChannelMergeForm",__name:"ChannelMergeForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:rl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(te){const D=ul(te,"modelValue"),{t:F}=Le(),K=p(!1),H=p([]),k=p([]),B=p(),t=p(),T=p(),S=async()=>{K.value=!0;try{const g=await ge(),i=[];g.forEach(m=>{i.push({...m})}),H.value=ie(g),k.value=ie(i)}finally{K.value=!1}};be(D,async()=>{D.value&&S()});const O=(g,i,m)=>{var $;i=i||m.includes(g.id),g.disabled=i,($=g.children)==null||$.forEach(u=>{O(u,i,m)})},R=()=>{T.value=void 0;const g=B.value.getCheckedKeys();g.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),k.value.forEach(i=>{O(i,!1,g)})},W=(g,i)=>{T.value=void 0,i.checkedKeys.length>1&&t.value.setCheckedKeys([g.id])},Y=async()=>{const g=B.value.getCheckedKeys();if(g.length<=0){T.value=F("channel.error.srcChannelRequired");return}const i=t.value.getCheckedKeys()[0];if(i==null){T.value=F("channel.error.moveToChannelRequired");return}await Fl(g,i),S(),pe.success(F("success"))};return(g,i)=>{const m=h("el-tree"),$=h("el-col"),u=h("el-row"),w=h("el-alert"),L=h("el-button"),ne=h("el-dialog"),G=Pe("loading");return v(),_(ne,{modelValue:D.value,"onUpdate:modelValue":i[1]||(i[1]=Z=>D.value=Z),title:g.$t("channel.op.batchMerge"),width:"768",top:"5vh",onClose:i[2]||(i[2]=Z=>g.$emit("finished"))},{default:l(()=>[e(u,{gutter:20},{default:l(()=>[e($,{span:12},{default:l(()=>[A("div",na,U(g.$t("channel.batchMerge.srcChannel")),1),ve(e(m,{ref_key:"srcTree",ref:B,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"",onCheck:R},null,8,["data"]),[[G,K.value]])]),_:1}),e($,{span:12},{default:l(()=>[A("div",oa,[A("div",sa,U(g.$t("channel.batchMerge.mergeTo")),1)]),ve(e(m,{ref_key:"targetTree",ref:t,data:k.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[G,K.value]])]),_:1})]),_:1}),A("div",ua,[T.value?(v(),_(w,{key:0,title:T.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):M("",!0),e(L,{type:"primary",onClick:i[0]||(i[0]=()=>Y())},{default:l(()=>[z(U(g.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),da={class:"flex justify-between mx-2 mt-1"},ia={class:"mb-3"},ca={class:"mt-3 app-block"},Ua=Te({name:"ChannelList",__name:"ChannelList",setup(te){const{t:D}=Le(),F=p({}),K=p(),H=p(),k=p([]),B=p([]),t=p(!1),T=p(!1),S=p(),O=p(),R=me(()=>Ul(k.value).map(r=>r.id)),W=p([]),Y=p([]),g=p(!1),i=p(!1),m=p(),$=p([]),u=p(!1),w=p(),L=p(),ne=p(!1),G=p(!1),Z=r=>de.allChannelPermission||W.value.includes(r.id);be(w,r=>{m.value.filter(r)});const ce=async()=>{u.value=!0;try{$.value=ie(await ge()),pl(()=>{var r;w.value!=null&&m.value.filter(w.value),m.value.setCurrentKey((r=L.value)==null?void 0:r.id)})}finally{u.value=!1}},x=async()=>{var r;t.value=!0;try{g.value=K.value!==void 0;const f=Object.values(F.value).filter(E=>E!==void 0&&E!=="").length>0;k.value=await ge({...vl(F.value),parentId:(r=L.value)==null?void 0:r.id,isIncludeSelf:!0,isIncludeChildren:f,Q_OrderBy:K.value}),!f&&!g.value&&(k.value=ie(k.value))}finally{t.value=!1}},P=()=>{ce(),x()},qe=async()=>{de.epRank>0&&(Y.value=await zl({category:"sys_article",latestVersion:!0}))},_e=async()=>{W.value=await dl()};let he;const Me=()=>{const r=document.querySelector("#dataTable .el-table__body-wrapper tbody");he=Tl.create(r,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(f){var d;const{oldIndex:E,newIndex:I}=f;if(E!==I){let N=E,a=I,s=k.value;const q=(d=s[0])==null?void 0:d.children;(q==null?void 0:q.length)>0&&(s=q,N-=1,a-=1),await ll(s[N].id,s[a].id,N>a?"before":"after"),ce(),s.splice(a,0,s.splice(N,1)[0]),pe.success(D("success"))}}})};ml(()=>{P(),qe(),_e(),Me()}),hl(()=>{he!==void 0&&he.destroy()});const Ue=({column:r,prop:f,order:E})=>{var I;f&&E?K.value=((I=r.sortBy)!=null?I:f)+(E==="descending"?"_desc":""):K.value=void 0,P()},n=()=>{P(),_e()},o=()=>x(),X=()=>{H.value.clearSort(),$l(F.value),K.value=void 0,x()},V=r=>{O.value=void 0,S.value=r!=null?r:L.value,T.value=!0},C=r=>{Se("channel:update")&&(O.value=r,S.value=null,T.value=!0)},Ke=(r,f)=>{Se("channel:update")&&(Rl(r,f),pe.success(D("success")))},ee=async r=>{await il(r),P(),pe.success(D("success"))},oe=async(r,f,E)=>{E!=="none"&&(await ll(r.data.id,f.data.id,E),x())},fe=async()=>{await Bl(),P(),pe.success(D("success"))},Ie=async r=>{i.value?(L.value!=r.parent&&(L.value=r.parent,await x()),C(r.id)):(L.value=r,o())},De=(r,f)=>r?f.name.includes(r):!0,ke=()=>{m.value.setCurrentKey(null),L.value=void 0,o()};return(r,f)=>{const E=h("el-input"),I=h("el-button"),d=h("el-switch"),N=h("el-tooltip"),a=h("el-tree"),s=h("el-scrollbar"),q=h("el-aside"),ue=h("el-popconfirm"),re=h("el-icon"),y=h("el-table-column"),Ve=h("el-table"),we=h("el-main"),Ce=h("el-container"),ye=Pe("loading");return v(),_(Ce,null,{default:l(()=>[e(q,{width:"220px",class:"pr-3"},{default:l(()=>[e(s,{class:"p-2 bg-white rounded-sm"},{default:l(()=>[e(E,{modelValue:w.value,"onUpdate:modelValue":f[0]||(f[0]=b=>w.value=b),"suffix-icon":c(fl),size:"small"},null,8,["modelValue","suffix-icon"]),A("div",da,[e(I,{type:L.value==null?"primary":void 0,link:"",onClick:ke},{default:l(()=>[z(U(r.$t("channel.root")),1)]),_:1},8,["type"]),e(N,{content:r.$t("editMode"),placement:"top"},{default:l(()=>[e(d,{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=b=>i.value=b),"active-action-icon":c(el),"inactive-action-icon":c(el)},null,8,["modelValue","active-action-icon","inactive-action-icon"])]),_:1},8,["content"])]),ve(e(a,{ref_key:"channelTree",ref:m,data:$.value,props:{label:"name"},"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:c(Se)("channel:update"),"filter-node-method":De,onNodeClick:Ie,onNodeDragEnd:oe},null,8,["data","draggable"]),[[ye,u.value]])]),_:1})]),_:1}),e(we,{class:"p-0"},{default:l(()=>[A("div",ia,[e(c(jl),{params:F.value,onSearch:o,onReset:X},{default:l(()=>[e(c(al),{label:r.$t("channel.name"),name:"Q_Contains_name"},null,8,["label"]),e(c(al),{label:r.$t("channel.alias"),name:"Q_Contains_alias"},null,8,["label"])]),_:1},8,["params"])]),A("div",null,[e(I,{type:"primary",disabled:c(le)("channel:create"),icon:c(yl),onClick:f[2]||(f[2]=()=>V(void 0))},{default:l(()=>[z(U(r.$t("add")),1)]),_:1},8,["disabled","icon"]),e(ue,{title:r.$t("confirmDelete"),onConfirm:f[3]||(f[3]=()=>ee(B.value.map(b=>b.id)))},{reference:l(()=>[e(I,{disabled:B.value.length<=0||c(le)("channel:delete"),icon:c(bl)},{default:l(()=>[z(U(r.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(I,{disabled:c(le)("channel:update"),icon:c(gl),onClick:f[4]||(f[4]=()=>ne.value=!0)},{default:l(()=>[z(U(r.$t("channel.op.batchMove")),1)]),_:1},8,["disabled","icon"]),e(I,{disabled:c(le)("channel:update"),icon:c(_l),onClick:f[5]||(f[5]=()=>G.value=!0)},{default:l(()=>[z(U(r.$t("channel.op.batchMerge")),1)]),_:1},8,["disabled","icon"]),e(I,{disabled:c(le)("channel:tidyTree"),icon:c(kl),onClick:f[6]||(f[6]=()=>fe())},{default:l(()=>[z(U(r.$t("tidyTree")),1)]),_:1},8,["disabled","icon"]),e(N,{placement:"top",content:r.$t("tidyTree.tooltip")},{default:l(()=>[e(re,{class:"ml-1 text-base align-text-bottom"},{default:l(()=>[e(c(Vl))]),_:1})]),_:1},8,["content"]),e(c(Al),{name:"channel",class:"ml-2"})]),A("div",ca,[ve((v(),_(Ve,{id:"dataTable",ref_key:"table",ref:H,"row-key":"id","default-expand-all":"",data:k.value,"row-class-name":({row:b})=>{var j;return((j=b.children)==null?void 0:j.length)>0?void 0:"drag-draggable"},onSelectionChange:f[7]||(f[7]=b=>B.value=b),onRowDblclick:f[8]||(f[8]=b=>C(b.id)),onSortChange:Ue},{default:l(()=>[e(c(Ol),{name:"channel"},{default:l(()=>[e(y,{type:"selection",selectable:Z,width:"45"}),e(y,{property:"name",label:r.$t("channel.name"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(y,{property:"alias",label:r.$t("channel.alias"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(y,{property:"channelModel.name",label:r.$t("channel.channelModel"),"sort-by":"channelModel@model-name",display:"none",sortable:"custom","min-width":"60"},null,8,["label"]),e(y,{property:"articleModel.name",label:r.$t("channel.articleModel"),"sort-by":"articleModel@model-name",sortable:"custom","min-width":"60"},null,8,["label"]),e(y,{property:"processKey",label:r.$t("channel.processKey"),"min-width":"60",sortable:"custom","show-overflow-tooltip":""},{default:l(({row:b})=>{var j;return[z(U(b.processKey!=null?(j=Y.value.find($e=>$e.key===b.processKey))==null?void 0:j.name:void 0),1)]}),_:1},8,["label"]),e(y,{property:"nav",label:r.$t("channel.nav"),"min-width":"50"},{default:l(({row:b})=>[e(d,{modelValue:b.nav,"onUpdate:modelValue":j=>b.nav=j,size:"small",disabled:c(le)("channel:update"),onClick:()=>Ke(b.id,b.nav)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])]),_:1},8,["label"]),e(y,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(y,{width:"42"},{default:l(({row:b})=>{var j;return[e(re,{class:wl(["text-lg align-middle",g.value||c(le)("channel:update")||((j=b.children)==null?void 0:j.length)>0?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:l(()=>[e(c(Cl))]),_:2},1032,["class"])]}),_:1}),e(y,{label:r.$t("table.action")},{default:l(({row:b})=>[e(I,{type:"primary",disabled:c(le)("channel:create")||!Z(b),size:"small",link:"",onClick:()=>V(b)},{default:l(()=>[z(U(r.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),e(I,{type:"primary",disabled:c(le)("channel:update"),size:"small",link:"",onClick:()=>C(b.id)},{default:l(()=>[z(U(r.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(ue,{title:r.$t("confirmDelete"),onConfirm:()=>ee([b.id])},{reference:l(()=>[e(I,{type:"primary",disabled:c(le)("channel:delete")||!Z(b),size:"small",link:""},{default:l(()=>[z(U(r.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data","row-class-name"])),[[ye,t.value]])]),e(Zl,{modelValue:T.value,"onUpdate:modelValue":f[9]||(f[9]=b=>T.value=b),"bean-id":O.value,"bean-ids":R.value,parent:S.value,onFinished:n},null,8,["modelValue","bean-id","bean-ids","parent"]),e(ta,{modelValue:ne.value,"onUpdate:modelValue":f[10]||(f[10]=b=>ne.value=b),onFinished:n},null,8,["modelValue"]),e(ra,{modelValue:G.value,"onUpdate:modelValue":f[11]||(f[11]=b=>G.value=b),onFinished:n},null,8,["modelValue"])]),_:1})]),_:1})}}});export{Ua as default};
