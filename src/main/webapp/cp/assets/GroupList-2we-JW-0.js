import{d as Q,r,b as C,c as L,w as o,h as a,i as J,j as ue,b3 as W,P as j,aF as Z,aG as ie,k as u,A as re,u as X,ar as Y,$ as U,B as de,o as x,l as h,aO as ee,v as $,x as V,m as le,t as ae,E as me,b6 as pe,g as se,bi as ce,bs as ve,aW as fe,b5 as A,aZ as be,bI as ye,e as ge,y as _e,aQ as $e,aP as Ve}from"./index-__TSAjOL.js";import{E as ke}from"./el-popover-B2t_MYt0.js";import{J as oe,K as Pe,L as he,M as te,N as Ce,O as Ee,d as we,P as Ae}from"./user-Cc_GcFRq.js";import{E as Ge,a as H,_ as Se,b as Ue,c as qe}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";import{_ as De}from"./ListMove.vue_vue_type_script_setup_true_lang-Dnx-NEui.js";import{E as Fe,a as Be}from"./el-select-CPBsiljt.js";import{E as ne}from"./el-switch-Cg-m0Y0i.js";import{_ as Ie}from"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";import{E as Te}from"./el-tree-CZELDHk3.js";import{t as Le}from"./tree-CFBn_SXc.js";import{d as Ne}from"./content-BqI55UAh.js";const Re=Q({name:"GroupForm",__name:"GroupForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(P){const E=r(),d=r({});return(m,t)=>{const g=ue,y=J,k=ne,_=Be,f=Fe;return C(),L(Ie,{values:d.value,"onUpdate:values":t[4]||(t[4]=s=>d.value=s),name:m.$t("menu.user.group"),"query-bean":u(te),"create-bean":u(he),"update-bean":u(Pe),"delete-bean":u(oe),"bean-id":P.beanId,"bean-ids":P.beanIds,focus:E.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":s=>({...s}),"disable-delete":s=>s.id<=10,perms:"group","model-value":P.modelValue,"onUpdate:modelValue":t[5]||(t[5]=s=>m.$emit("update:modelValue",s)),onFinished:t[6]||(t[6]=()=>m.$emit("finished"))},{default:o(({})=>[a(y,{prop:"name",label:m.$t("group.name"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:o(()=>[a(g,{ref_key:"focus",ref:E,modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(y,{prop:"description",label:m.$t("group.description")},{default:o(()=>[a(g,{modelValue:d.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>d.value.description=s),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),a(y,{prop:"allAccessPermission"},{label:o(()=>[a(W,{message:"group.allAccessPermission"})]),default:o(()=>[a(k,{modelValue:d.value.allAccessPermission,"onUpdate:modelValue":t[2]||(t[2]=s=>d.value.allAccessPermission=s)},null,8,["modelValue"])]),_:1}),a(y,{prop:"type",label:m.$t("group.type"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:o(()=>[a(f,{modelValue:d.value.type,"onUpdate:modelValue":t[3]||(t[3]=s=>d.value.type=s),disabled:d.value.type===1},{default:o(()=>[(C(),j(Z,null,ie([1,2],s=>a(_,{key:s,disabled:s===1,label:m.$t("group.type.".concat(s)),value:s},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),Oe={class:"border-t"},ze={class:"flex items-center justify-between"},Me=Q({name:"GroupPermissionForm",__name:"GroupPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null}},emits:{"update:modelValue":null,finished:null},setup(P,{emit:E}){const d=P,m=E,{beanId:t,modelValue:g}=re(d),{t:y}=X(),k=r(),_=r({}),f=r({}),s=r(!1),q=r(!0),G=r(!1),c=r(),w=r([]),D=Y(()=>U.rank>_.value.rank),N=async()=>{(t==null?void 0:t.value)!=null&&(_.value=await te(t.value),f.value={..._.value})},R=async()=>{w.value=Le(await Ne())},F=async()=>{var e;if((t==null?void 0:t.value)!=null){const l=await Ce(t.value);(e=c.value)==null||e.setCheckedKeys([]),l.forEach(i=>{var p;(p=c.value)==null||p.setChecked(i,!0,!1)})}};de(g,()=>{g.value&&(N(),F())}),x(()=>{R()});const B=(e,l,i,p)=>{i.forEach(v=>{v.children&&(l.getNode(v[p]).expanded=e,B(e,l,v.children,p))})},S=(e,l,i,p)=>{l.setCheckedKeys(e?i.map(v=>v[p]):[])},I=()=>{k.value.validate(async e=>{if(e){s.value=!0;try{await Ee(f.value),m("finished"),m("update:modelValue",!1),ae.success(y("success"))}finally{s.value=!1}}})},T=()=>{c.value!=null&&(f.value.accessPermissions=[...c.value.getCheckedNodes(),...c.value.getHalfCheckedNodes()].map(e=>e.id))};return(e,l)=>{const i=ne,p=J,v=pe,O=Te,z=me,M=ee,n=le,K=Ge;return C(),L(K,{title:e.$t("permissionSettings"),"model-value":P.modelValue,size:414,"onUpdate:modelValue":l[8]||(l[8]=b=>e.$emit("update:modelValue",b))},{default:o(()=>[a(z,{ref_key:"form",ref:k,model:f.value,disabled:D.value,"label-width":"150px"},{default:o(()=>[a(p,{prop:"allAccessPermission"},{label:o(()=>[a(W,{message:"group.allAccessPermission",help:""})]),default:o(()=>[a(i,{modelValue:f.value.allAccessPermission,"onUpdate:modelValue":l[0]||(l[0]=b=>f.value.allAccessPermission=b)},null,8,["modelValue"])]),_:1}),f.value.allAccessPermission?se("",!0):(C(),j(Z,{key:0},[h("div",Oe,[a(v,{modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=b=>q.value=b),label:e.$t("expand/collapse"),onChange:l[2]||(l[2]=b=>B(b,c.value,w.value,"id"))},null,8,["modelValue","label"]),a(v,{modelValue:G.value,"onUpdate:modelValue":l[3]||(l[3]=b=>G.value=b),label:e.$t("checkAll/uncheckAll"),onChange:l[4]||(l[4]=b=>{S(b,c.value,w.value,"id"),T()})},null,8,["modelValue","label"])]),a(O,{ref_key:"accessPermissionTree",ref:c,data:w.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:l[5]||(l[5]=()=>T())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:o(()=>[h("div",ze,[h("div",null,[a(M,null,{default:o(()=>{var b;return[$(V((b=f.value)==null?void 0:b.name),1)]}),_:1})]),h("div",null,[a(n,{onClick:l[6]||(l[6]=()=>e.$emit("update:modelValue",!1))},{default:o(()=>[$(V(e.$t("cancel")),1)]),_:1}),a(n,{type:"primary",loading:s.value,disabled:D.value,onClick:l[7]||(l[7]=()=>I())},{default:o(()=>[$(V(e.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),Qe={class:"mb-3"},je={class:"mt-3 app-block"},sl=Q({name:"GroupList",__name:"GroupList",setup(P){const{t:E}=X(),d=r({}),m=r(),t=r(),g=r([]),y=r([]),k=r(!1),_=r(!1),f=r(!1),s=r(),q=Y(()=>g.value.map(e=>e.id)),G=r(!1),c=async()=>{k.value=!0;try{g.value=await we({...ce(d.value),Q_OrderBy:m.value}),G.value=Object.values(d.value).filter(e=>e!==void 0&&e!=="").length>0||m.value!==void 0}finally{k.value=!1}};x(c);const w=({column:e,prop:l,order:i})=>{var p;l&&i?m.value=((p=e.sortBy)!=null?p:l)+(i==="descending"?"_desc":""):m.value=void 0,c()},D=()=>c(),N=()=>{t.value.clearSort(),ve(d.value),m.value=void 0,c()},R=()=>{s.value=void 0,_.value=!0},F=e=>{s.value=e,_.value=!0},B=e=>{s.value=e,f.value=!0},S=e=>Number(e)>10,I=async e=>{const l=e.filter(i=>S(i));l.length>0&&(await oe(l),c(),ae.success(E("success")))},T=async(e,l)=>{const i=ye(e,g.value,l);await Ae(i.map(p=>p.id))};return(e,l)=>{const i=le,p=ke,v=$e,O=ee,z=Ve,M=_e;return C(),j("div",null,[h("div",Qe,[a(u(Se),{params:d.value,onSearch:D,onReset:N},{default:o(()=>[a(u(H),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),a(u(H),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),h("div",null,[a(i,{type:"primary",disabled:u(A)("group:create"),icon:u(fe),onClick:R},{default:o(()=>[$(V(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(p,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>I(y.value.map(n=>n.id)))},{reference:o(()=>[a(i,{disabled:y.value.filter(n=>S(n.id)).length<=0||u(A)("group:delete"),icon:u(be)},{default:o(()=>[$(V(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(De,{class:"ml-2",disabled:y.value.length<=0||G.value||u(A)("org:update"),onMove:l[1]||(l[1]=n=>T(y.value,n))},null,8,["disabled"]),a(u(Ue),{name:"group",class:"ml-2"})]),h("div",je,[ge((C(),L(z,{ref_key:"table",ref:t,data:g.value,onSelectionChange:l[2]||(l[2]=n=>y.value=n),onRowDblclick:l[3]||(l[3]=n=>F(n.id)),onSortChange:w},{default:o(()=>[a(u(qe),{name:"group"},{default:o(()=>[a(v,{type:"selection",width:"50"}),a(v,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(v,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:o(({row:n})=>[a(O,{type:n.allAccessPermission?"success":"info",size:"small"},{default:o(()=>[$(V(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(v,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t("group.type.".concat(n.type))},null,8,["label","formatter"]),a(v,{label:e.$t("table.action")},{default:o(({row:n})=>[a(i,{type:"primary",disabled:u(A)("group:update"),size:"small",link:"",onClick:K=>F(n.id)},{default:o(()=>[$(V(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),u(U).epRank>0||u(U).epDisplay?(C(),L(i,{key:0,type:"primary",disabled:u(A)("group:updatePermission")||u(U).epRank<=0,title:u(U).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:"",onClick:()=>B(n.id)},{default:o(()=>[$(V(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","title","onClick"])):se("",!0),a(p,{title:e.$t("confirmDelete"),onConfirm:()=>I([n.id])},{reference:o(()=>[a(i,{type:"primary",disabled:!S(n.id)||u(A)("group:delete"),size:"small",link:""},{default:o(()=>[$(V(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[M,k.value]])]),a(Re,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=n=>_.value=n),"bean-id":s.value,"bean-ids":q.value,onFinished:c},null,8,["modelValue","bean-id","bean-ids"]),a(Me,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=n=>f.value=n),"bean-id":s.value,onFinished:c},null,8,["modelValue","bean-id"])])}}});export{sl as default};
