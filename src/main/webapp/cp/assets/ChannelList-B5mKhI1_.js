import{d as qe,A as $l,r as f,ar as pe,$ as de,B as ye,b as h,c as b,w as l,h as e,a6 as Pe,a2 as Le,i as Cl,j as pl,k as m,b3 as Q,b6 as wl,v as D,x as q,g as T,P as Z,aF as X,aG as ae,l as N,b8 as Tl,b9 as ql,aM as vl,u as Re,e as ve,y as Fe,f as hl,m as Be,t as ie,z as fl,aR as yl,o as Ml,bt as Ul,bi as Sl,aw as El,aD as Il,bu as Kl,aH as Dl,bv as sl,Z as Te,aW as Pl,b5 as J,aZ as Ll,bw as Rl,bx as Fl,by as Bl,a3 as zl,bz as Nl,aP as Al,aQ as jl,a5 as Ol,ay as Ql,bk as Hl,bs as Wl}from"./index-__TSAjOL.js";import{E as Gl,a as Jl,b as Zl}from"./el-main-CxOwtB5j.js";import{E as Xl}from"./el-popover-B2t_MYt0.js";import{E as ze}from"./el-tree-CZELDHk3.js";import{E as bl}from"./el-switch-Cg-m0Y0i.js";import{S as Yl}from"./sortable.esm-DEaZq8gs.js";import{c as xl,d as ea,t as me,f as la}from"./tree-CFBn_SXc.js";import{H as gl,I as aa,e as ta,J as na,d as be,K as kl,L as oa,M as sa,N as ua,O as ra,P as da,Q as ul,R as ia,S as ma,T as ca}from"./content-BqI55UAh.js";import{e as pa,f as va}from"./system--Gl2DLOU.js";import{_ as ha,a as rl,b as fa,c as ya}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";import{E as Vl,a as _l,c as ba}from"./el-select-CPBsiljt.js";import{E as ga}from"./el-tree-select-BM45XKJE.js";import{E as ka,a as Va}from"./el-radio-group-B2Xrve8Z.js";/* empty css                 */import{q as dl,b as _a}from"./config-BS48XX7b.js";import{a as il,m as ml,g as cl}from"./data-CRNvglzJ.js";import{_ as $a}from"./FieldItem.vue_vue_type_script_setup_true_lang-B_vgS7r5.js";import{_ as Ca}from"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";import{T as wa}from"./Tinymce-DiWOJB96.js";import{T as Ta}from"./TuiEditor-CwuUv08M.js";import{a as qa}from"./FileListUpload.vue_vue_type_style_index_0_scoped_b3a09e2e_lang-BDXrjCRY.js";import"./BaseUpload.vue_vue_type_style_index_0_scoped_248c0508_lang-XLXSgCOW.js";import"./vuedraggable.umd-BWOm6k_s.js";/* empty css                          *//* empty css                        */import"./BaseUpload-DtBZbJkV.js";import"./position-BrJTBGCI.js";import"./index-Vcq4gwWv.js";const Ma={class:"w-full"},Ua=qe({name:"ChannelForm",__name:"ChannelForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parent:{type:Object,default:null}},emits:{"update:modelValue":null,finished:null},setup(te,{emit:U}){const R=te,S=U,{modelValue:H,parent:k}=$l(R),F=f(),t=f({}),M=f([]),E=f([]),A=f([]),B=f([]),W=f([]),Y=f([]),g=f([]),i=f([]),p=f(),C=pe(()=>B.value.find(n=>n.id===p.value)),s=pe(()=>{var n;return il(ml(cl().channel.mains,(n=C.value)==null?void 0:n.mains,"channel"))}),_=pe(()=>{var n;return il(ml(cl().channel.asides,(n=C.value)==null?void 0:n.asides,"channel"))}),I=pe(()=>{var n;return JSON.parse(((n=C.value)==null?void 0:n.customs)||"[]")}),ne=pe(()=>{const n=xl(A.value,t.value.id);return de.allChannelPermission?n:ea(n,Y.value)}),G=async()=>{A.value=me(await be())},x=async()=>{de.epRank>0&&(M.value=await pa({category:"sys_article",deployed:!0}))},ce=async()=>{de.epRank>=3&&(E.value=await _a())},ee=async()=>{await G(),S("finished")},K=async()=>{B.value=await dl({type:"channel"}),p.value==null&&B.value.length>0&&(p.value=B.value[0].id)},Me=async()=>{W.value=await dl({type:"article"})},ge=async()=>{g.value=await aa()},he=async()=>{i.value=await ta()},Ue=async()=>{Y.value=await gl()};ye(H,()=>{var n,o,j;H.value&&(p.value=(j=(n=k.value)==null?void 0:n.articleModelId)!=null?j:(o=B.value[0])==null?void 0:o.id,Ue(),K(),Me(),ge(),he(),x(),ce())}),ye(I,()=>{Se(t.value.customs)});const Se=n=>(I.value.forEach(o=>{n[o.code]==null&&(n[o.code]=o.defaultValue,o.defaultValueKey!=null&&(n[o.code+"Key"]=o.defaultValueKey))}),n);return(n,o)=>{const j=pl,V=Cl,$=Le,Ee=wl,oe=_l,le=Vl,re=bl,Ie=Va,Ke=ka,ke=Pe,De=ga,d=ba,y=ql,P=Tl;return h(),b(Ca,{values:t.value,"onUpdate:values":o[29]||(o[29]=u=>t.value=u),name:n.$t("menu.content.channel"),"query-bean":m(ua),"create-bean":m(sa),"update-bean":m(oa),"delete-bean":m(kl),"bean-id":te.beanId,"bean-ids":te.beanIds,focus:F.value,"init-values":(u,z)=>{var a,r,w,O,se,ue,c,Ve,_e,$e,Ce,fe,v,L,we,Ne,Ae,je,Oe,Qe,He,We,Ge,Je,Ze,Xe,Ye,xe,el,ll,al,tl,nl,ol;return{parentId:z?u==null?void 0:u.parentId:(r=(a=m(k))==null?void 0:a.id)!=null?r:u==null?void 0:u.parentId,type:1,channelModelId:(ue=(O=u==null?void 0:u.channelModelId)!=null?O:(w=m(k))==null?void 0:w.channelModelId)!=null?ue:(se=B.value[0])==null?void 0:se.id,articleModelId:($e=(Ve=u==null?void 0:u.articleModelId)!=null?Ve:(c=m(k))==null?void 0:c.articleModelId)!=null?$e:(_e=W.value[0])==null?void 0:_e.id,nav:(v=(fe=u==null?void 0:u.nav)!=null?fe:(Ce=m(k))==null?void 0:Ce.nav)!=null?v:!0,book:!1,real:(Ne=(we=u==null?void 0:u.real)!=null?we:(L=m(k))==null?void 0:L.real)!=null?Ne:!0,channelTemplate:(Oe=(je=u==null?void 0:u.channelTemplate)!=null?je:(Ae=m(k))==null?void 0:Ae.channelTemplate)!=null?Oe:g.value[0],articleTemplate:(We=(He=u==null?void 0:u.articleTemplate)!=null?He:(Qe=m(k))==null?void 0:Qe.articleTemplate)!=null?We:i.value[0],pageSize:10,allowComment:(Ze=(Je=u==null?void 0:u.allowComment)!=null?Je:(Ge=m(k))==null?void 0:Ge.allowComment)!=null?Ze:!0,allowContribute:(xe=(Ye=u==null?void 0:u.allowContribute)!=null?Ye:(Xe=m(k))==null?void 0:Xe.allowContribute)!=null?xe:!0,allowSearch:(al=(ll=u==null?void 0:u.allowSearch)!=null?ll:(el=m(k))==null?void 0:el.allowSearch)!=null?al:!0,orderDesc:(ol=(nl=u==null?void 0:u.orderDesc)!=null?nl:(tl=m(k))==null?void 0:tl.orderDesc)!=null?ol:!0,customs:{}}},"to-values":u=>({...u}),perms:"channel","model-value":te.modelValue,"disable-edit":u=>!m(de).allChannelPermission&&u.id!=null&&!Y.value.includes(u.id),"label-width":"120px",large:"","onUpdate:modelValue":o[30]||(o[30]=u=>n.$emit("update:modelValue",u)),onFinished:ee,onBeanChange:o[31]||(o[31]=async u=>{var z,a,r,w;p.value=(w=(a=u==null?void 0:u.channelModelId)!=null?a:(z=m(k))==null?void 0:z.channelModelId)!=null?w:(r=W.value[0])==null?void 0:r.id,await G()})},{default:l(({bean:u,isEdit:z})=>[e(ke,null,{default:l(()=>[e($,{span:18},{default:l(()=>[e(ke,null,{default:l(()=>[e($,{span:s.value.name.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"name",label:(a=s.value.name.name)!=null?a:n.$t("channel.name"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(j,{ref_key:"focus",ref:F,modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.name=r),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"]),e($,{span:s.value.alias.double?12:24},{default:l(()=>[e(V,{prop:"alias",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^[\w-]*$/,message:()=>n.$t("channel.error.aliasPattern")},{asyncValidator:async(a,r,w)=>{if(r!==u.alias&&await m(na)(r)){w(n.$t("channel.error.aliasExist"));return}w()}}]},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.alias.name)!=null?a:n.$t("channel.alias"),message:"channel.alias",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.alias,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.alias=a),maxlength:"50"},null,8,["modelValue"])]),_:2},1032,["rules"])]),_:2},1032,["span"]),t.value.type===3?(h(),b($,{key:0,span:s.value.linkUrl.double?12:24},{default:l(()=>[e(V,{prop:"linkUrl",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>n.$t("channel.error.linkUrl")}]},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.linkUrl.name)!=null?a:n.$t("channel.linkUrl"),message:"channel.linkUrl",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.linkUrl,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.linkUrl=a),maxlength:"255"},{append:l(()=>[e(Ee,{modelValue:t.value.targetBlank,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.targetBlank=a)},{default:l(()=>[D(q(n.$t("channel.targetBlank")),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),t.value.type<3?(h(),Z(X,{key:1},[s.value.seoTitle.show?(h(),b($,{key:0,span:s.value.seoTitle.double?12:24},{default:l(()=>[e(V,{prop:"seoTitle",rules:s.value.seoTitle.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.seoTitle.name)!=null?a:n.$t("channel.seoTitle"),message:"channel.seoTitle",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.seoTitle,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.seoTitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),s.value.seoKeywords.show?(h(),b($,{key:1,span:s.value.seoKeywords.double?12:24},{default:l(()=>[e(V,{prop:"seoKeywords",rules:s.value.seoKeywords.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.seoKeywords.name)!=null?a:n.$t("channel.seoKeywords"),message:"channel.seoKeywords",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.seoKeywords,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.seoKeywords=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),s.value.seoDescription.show?(h(),b($,{key:2,span:s.value.seoDescription.double?12:24},{default:l(()=>[e(V,{prop:"seoDescription",rules:s.value.seoDescription.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.seoDescription.name)!=null?a:n.$t("channel.seoDescription"),message:"channel.seoDescription",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.seoDescription,"onUpdate:modelValue":o[6]||(o[6]=a=>t.value.seoDescription=a),maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0)],64)):T("",!0),s.value.image.show?(h(),b($,{key:2,span:s.value.image.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"image",label:(a=s.value.image.name)!=null?a:n.$t("channel.image"),rules:s.value.image.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(m(qa),{modelValue:t.value.image,"onUpdate:modelValue":o[7]||(o[7]=r=>t.value.image=r),height:s.value.image.imageHeight,width:s.value.image.imageWidth,mode:s.value.image.imageMode},null,8,["modelValue","height","width","mode"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0),s.value.channelModel.show?(h(),b($,{key:3,span:s.value.channelModel.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"channelModelId",label:(a=s.value.channelModel.name)!=null?a:n.$t("channel.channelModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(le,{modelValue:t.value.channelModelId,"onUpdate:modelValue":o[8]||(o[8]=r=>t.value.channelModelId=r),class:"w-full",onChange:o[9]||(o[9]=r=>{p.value=r})},{default:l(()=>[(h(!0),Z(X,null,ae(B.value,r=>(h(),b(oe,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0),s.value.articleModel.show?(h(),b($,{key:4,span:s.value.articleModel.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"articleModelId",label:(a=s.value.articleModel.name)!=null?a:n.$t("channel.articleModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(le,{modelValue:t.value.articleModelId,"onUpdate:modelValue":o[10]||(o[10]=r=>t.value.articleModelId=r),class:"w-full"},{default:l(()=>[(h(!0),Z(X,null,ae(W.value,r=>(h(),b(oe,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0),s.value.channelTemplate.show?(h(),b($,{key:5,span:s.value.channelTemplate.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"channelTemplate",label:(a=s.value.channelTemplate.name)!=null?a:n.$t("channel.channelTemplate"),rules:s.value.channelTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(le,{modelValue:t.value.channelTemplate,"onUpdate:modelValue":o[11]||(o[11]=r=>t.value.channelTemplate=r),class:"w-full"},{default:l(()=>[(h(!0),Z(X,null,ae(g.value,r=>(h(),b(oe,{key:r,label:r+".html",value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0),s.value.articleTemplate.show?(h(),b($,{key:6,span:s.value.articleTemplate.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"articleTemplate",label:(a=s.value.articleTemplate.name)!=null?a:n.$t("channel.articleTemplate"),rules:s.value.articleTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(le,{modelValue:t.value.articleTemplate,"onUpdate:modelValue":o[12]||(o[12]=r=>t.value.articleTemplate=r),class:"w-full"},{default:l(()=>[(h(!0),Z(X,null,ae(i.value,r=>(h(),b(oe,{key:r,label:r+".html",value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0),s.value.nav.show?(h(),b($,{key:7,span:s.value.nav.double?12:24},{default:l(()=>[e(V,{prop:"nav",rules:s.value.nav.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.nav.name)!=null?a:n.$t("channel.nav"),message:"channel.nav",help:""},null,8,["label"])]}),default:l(()=>[e(re,{modelValue:t.value.nav,"onUpdate:modelValue":o[13]||(o[13]=a=>t.value.nav=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),s.value.real.show?(h(),b($,{key:8,span:s.value.real.double?12:24},{default:l(()=>[e(V,{prop:"real",rules:s.value.real.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.real.name)!=null?a:n.$t("channel.real"),message:"channel.real",help:""},null,8,["label"])]}),default:l(()=>[e(re,{modelValue:t.value.real,"onUpdate:modelValue":o[14]||(o[14]=a=>t.value.real=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),s.value.allowSearch.show?(h(),b($,{key:9,span:s.value.allowSearch.double?12:24},{default:l(()=>[e(V,{prop:"allowSearch",rules:s.value.allowSearch.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.allowSearch.name)!=null?a:n.$t("channel.allowSearch"),message:"channel.allowSearch",help:""},null,8,["label"])]}),default:l(()=>[e(re,{modelValue:t.value.allowSearch,"onUpdate:modelValue":o[15]||(o[15]=a=>t.value.allowSearch=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),s.value.book.show?(h(),b($,{key:10,span:s.value.book.double?12:24},{default:l(()=>[e(V,{prop:"book",rules:s.value.book.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(Q,{label:(a=s.value.book.name)!=null?a:n.$t("channel.book"),message:"channel.book",help:""},null,8,["label"])]}),default:l(()=>[e(re,{modelValue:t.value.book,"onUpdate:modelValue":o[16]||(o[16]=a=>t.value.book=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):T("",!0),(h(!0),Z(X,null,ae(I.value,a=>(h(),b($,{key:a.code,span:a.double?12:24},{default:l(()=>[e(V,{prop:"customs.".concat(a.code),rules:a.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>[e(Q,{label:a.name},null,8,["label"])]),default:l(()=>[e($a,{modelValue:t.value.customs[a.code],"onUpdate:modelValue":r=>t.value.customs[a.code]=r,"model-key":t.value.customs[a.code+"Key"],"onUpdate:modelKey":r=>t.value.customs[a.code+"Key"]=r,field:a},null,8,["modelValue","onUpdate:modelValue","model-key","onUpdate:modelKey","field"])]),_:2},1032,["prop","rules"])]),_:2},1032,["span"]))),128)),t.value.type===2?(h(),b($,{key:11,span:s.value.text.double?12:24},{default:l(()=>{var a;return[e(V,{prop:"text",label:(a=s.value.text.name)!=null?a:n.$t("channel.text"),rules:s.value.text.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[N("div",Ma,[s.value.text.editorSwitch?(h(),b(Ke,{key:0,modelValue:t.value.editorType,"onUpdate:modelValue":o[17]||(o[17]=r=>t.value.editorType=r),class:"mr-6",onChange:o[18]||(o[18]=()=>t.value.markdown="")},{default:l(()=>[(h(),Z(X,null,ae([1,2],r=>e(Ie,{key:r,value:r},{default:l(()=>[D(q(n.$t("model.field.editorType.".concat(r))),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])):T("",!0),t.value.editorType===2?(h(),b(m(Ta),{key:1,modelValue:t.value.markdown,"onUpdate:modelValue":o[19]||(o[19]=r=>t.value.markdown=r),html:t.value.text,"onUpdate:html":o[20]||(o[20]=r=>t.value.text=r),class:"leading-6"},null,8,["modelValue","html"])):(h(),b(m(wa),{key:2,ref:"tinyText",modelValue:t.value.text,"onUpdate:modelValue":o[21]||(o[21]=r=>t.value.text=r)},null,8,["modelValue"]))])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):T("",!0)]),_:2},1024)]),_:2},1024),e($,{span:6},{default:l(()=>[e(P,{type:"border-card",class:"ml-5"},{default:l(()=>[e(y,{label:n.$t("channel.tabs.setting")},{default:l(()=>{var a,r,w,O,se,ue;return[e(V,{prop:"parentId",label:(a=_.value.parent.name)!=null?a:n.$t("channel.parent"),"label-position":"top"},{default:l(()=>[e(De,{modelValue:t.value.parentId,"onUpdate:modelValue":o[22]||(o[22]=c=>t.value.parentId=c),data:ne.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"render-after-expand":!1,disabled:z,placeholder:"","check-strictly":"",clearable:"",class:"w-full"},null,8,["modelValue","data","disabled"])]),_:2},1032,["label"]),e(V,{prop:"type",label:(r=_.value.type.name)!=null?r:n.$t("channel.type"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(le,{modelValue:t.value.type,"onUpdate:modelValue":o[23]||(o[23]=c=>t.value.type=c),class:"w-full"},{default:l(()=>[(h(),Z(X,null,ae([1,2,3,4],c=>e(oe,{key:c,label:n.$t("channel.type.".concat(c)),value:c},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(V,{prop:"processKey",label:(w=_.value.processKey.name)!=null?w:n.$t("channel.processKey"),rules:_.value.processKey.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(le,{modelValue:t.value.processKey,"onUpdate:modelValue":o[24]||(o[24]=c=>t.value.processKey=c),clearable:"",class:"w-full"},{default:l(()=>[(h(!0),Z(X,null,ae(M.value,c=>(h(),b(oe,{key:c.key,label:c.name,value:c.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),m(de).epRank>=3&&_.value.performanceType.show?(h(),b(V,{key:0,prop:"performanceType",label:(O=_.value.performanceType.name)!=null?O:n.$t("channel.performanceType"),rules:_.value.performanceType.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(le,{modelValue:t.value.performanceTypeId,"onUpdate:modelValue":o[25]||(o[25]=c=>t.value.performanceTypeId=c),clearable:"",class:"w-full"},{default:l(()=>[(h(!0),Z(X,null,ae(E.value,c=>(h(),b(oe,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])):T("",!0),_.value.channelStaticPath.show?(h(),b(V,{key:1,prop:"channelStaticPath",label:(se=_.value.channelStaticPath.name)!=null?se:n.$t("channel.channelStaticPath"),rules:_.value.channelStaticPath.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{label:l(()=>{var c;return[e(Q,{label:(c=_.value.channelStaticPath.name)!=null?c:n.$t("channel.channelStaticPath"),message:"channel.channelStaticPath",help:""},null,8,["label"])]}),default:l(()=>[e(j,{modelValue:t.value.channelStaticPath,"onUpdate:modelValue":o[26]||(o[26]=c=>t.value.channelStaticPath=c),maxlength:"100"},{append:l(()=>o[32]||(o[32]=[D(".html")])),_:1},8,["modelValue"])]),_:1},8,["label","rules"])):T("",!0),e(V,{prop:"pageSize",label:(ue=_.value.pageSize.name)!=null?ue:n.$t("channel.pageSize"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(d,{modelValue:t.value.pageSize,"onUpdate:modelValue":o[27]||(o[27]=c=>t.value.pageSize=c),min:1,max:200},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(V,{prop:"orderDesc",rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{label:l(()=>{var c;return[e(Q,{label:(c=_.value.orderDesc.name)!=null?c:n.$t("channel.orderDesc"),message:"channel.orderDesc",help:""},null,8,["label"])]}),default:l(()=>[e(re,{modelValue:t.value.orderDesc,"onUpdate:modelValue":o[28]||(o[28]=c=>t.value.orderDesc=c)},null,8,["modelValue"])]),_:1},8,["rules"])]}),_:2},1032,["label"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","model-value","disable-edit"])}}}),Sa={class:"text-lg text-center"},Ea={class:"flex items-center justify-center"},Ia={class:"text-lg text-center"},Ka={class:"mt-5"},Da=qe({name:"ChannelMoveForm",__name:"ChannelMoveForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:yl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(te){const U=vl(te,"modelValue"),{t:R}=Re(),S=f(!1),H=f([]),k=f([]),F=f(),t=f(),M=f("inner"),E=f(),A=async()=>{S.value=!0;try{const i=await be(),p=[];i.forEach(C=>{p.push({...C})}),H.value=me(i),k.value=me(p)}finally{S.value=!1}};ye(U,async()=>{U.value&&A()});const B=(i,p,C)=>{var s;p=p||C.includes(i.id),i.disabled=p,(s=i.children)==null||s.forEach(_=>{B(_,p,C)})},W=()=>{E.value=void 0;const i=F.value.getCheckedKeys();i.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),k.value.forEach(p=>{B(p,!1,i)})},Y=(i,p)=>{E.value=void 0,p.checkedKeys.length>1&&t.value.setCheckedKeys([i.id])},g=async()=>{const i=F.value.getCheckedKeys();if(i.length<=0){E.value=R("channel.error.srcChannelRequired");return}const p=t.value.getCheckedKeys()[0];if(p==null){E.value=R("channel.error.moveToChannelRequired");return}await ra(i,p,M.value),A(),ie.success(R("success"))};return(i,p)=>{const C=ze,s=Le,_=_l,I=Vl,ne=Pe,G=hl,x=Be,ce=fl,ee=Fe;return h(),b(ce,{modelValue:U.value,"onUpdate:modelValue":p[2]||(p[2]=K=>U.value=K),title:i.$t("channel.op.batchMove"),width:"768",top:"5vh",onClose:p[3]||(p[3]=K=>i.$emit("finished"))},{default:l(()=>[e(ne,{gutter:20},{default:l(()=>[e(s,{span:12},{default:l(()=>[N("div",Sa,q(i.$t("channel.batchMove.srcChannel")),1),ve(e(C,{ref_key:"srcTree",ref:F,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[ee,S.value]])]),_:1}),e(s,{span:12},{default:l(()=>[N("div",Ea,[N("div",Ia,q(i.$t("channel.batchMove.moveTo")),1),e(I,{modelValue:M.value,"onUpdate:modelValue":p[0]||(p[0]=K=>M.value=K),class:"w-32 ml-2"},{default:l(()=>[(h(),Z(X,null,ae(["inner","before","after"],K=>e(_,{key:K,label:i.$t("channel.batchMove.moveTo.".concat(K)),value:K},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),ve(e(C,{ref_key:"targetTree",ref:t,data:k.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:Y},null,8,["data"]),[[ee,S.value]])]),_:1})]),_:1}),N("div",Ka,[E.value?(h(),b(G,{key:0,title:E.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):T("",!0),e(x,{type:"primary",onClick:p[1]||(p[1]=()=>g())},{default:l(()=>[D(q(i.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),Pa={class:"text-lg text-center"},La={class:"flex items-center justify-center"},Ra={class:"text-lg text-center"},Fa={class:"mt-5"},Ba=qe({name:"ChannelMergeForm",__name:"ChannelMergeForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:yl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(te){const U=vl(te,"modelValue"),{t:R}=Re(),S=f(!1),H=f([]),k=f([]),F=f(),t=f(),M=f(),E=async()=>{S.value=!0;try{const g=await be(),i=[];g.forEach(p=>{i.push({...p})}),H.value=me(g),k.value=me(i)}finally{S.value=!1}};ye(U,async()=>{U.value&&E()});const A=(g,i,p)=>{var C;i=i||p.includes(g.id),g.disabled=i,(C=g.children)==null||C.forEach(s=>{A(s,i,p)})},B=()=>{M.value=void 0;const g=F.value.getCheckedKeys();g.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),k.value.forEach(i=>{A(i,!1,g)})},W=(g,i)=>{M.value=void 0,i.checkedKeys.length>1&&t.value.setCheckedKeys([g.id])},Y=async()=>{const g=F.value.getCheckedKeys();if(g.length<=0){M.value=R("channel.error.srcChannelRequired");return}const i=t.value.getCheckedKeys()[0];if(i==null){M.value=R("channel.error.moveToChannelRequired");return}await da(g,i),E(),ie.success(R("success"))};return(g,i)=>{const p=ze,C=Le,s=Pe,_=hl,I=Be,ne=fl,G=Fe;return h(),b(ne,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=x=>U.value=x),title:g.$t("channel.op.batchMerge"),width:"768",top:"5vh",onClose:i[2]||(i[2]=x=>g.$emit("finished"))},{default:l(()=>[e(s,{gutter:20},{default:l(()=>[e(C,{span:12},{default:l(()=>[N("div",Pa,q(g.$t("channel.batchMerge.srcChannel")),1),ve(e(p,{ref_key:"srcTree",ref:F,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"",onCheck:B},null,8,["data"]),[[G,S.value]])]),_:1}),e(C,{span:12},{default:l(()=>[N("div",La,[N("div",Ra,q(g.$t("channel.batchMerge.mergeTo")),1)]),ve(e(p,{ref_key:"targetTree",ref:t,data:k.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[G,S.value]])]),_:1})]),_:1}),N("div",Fa,[M.value?(h(),b(_,{key:0,title:M.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):T("",!0),e(I,{type:"primary",onClick:i[0]||(i[0]=()=>Y())},{default:l(()=>[D(q(g.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),za={class:"flex justify-between mx-2 mt-1"},Na={class:"mb-3"},Aa={class:"mt-3 app-block"},yt=qe({name:"ChannelList",__name:"ChannelList",setup(te){const{t:U}=Re(),R=f({}),S=f(),H=f(),k=f([]),F=f([]),t=f(!1),M=f(!1),E=f(),A=f(),B=pe(()=>la(k.value).map(d=>d.id)),W=f([]),Y=f([]),g=f(!1),i=f(!1),p=f(),C=f([]),s=f(!1),_=f(),I=f(),ne=f(!1),G=f(!1),x=d=>de.allChannelPermission||W.value.includes(d.id);ye(_,d=>{p.value.filter(d)});const ce=async()=>{s.value=!0;try{C.value=me(await be()),Ul(()=>{var d;_.value!=null&&p.value.filter(_.value),p.value.setCurrentKey((d=I.value)==null?void 0:d.id)})}finally{s.value=!1}},ee=async()=>{var d;t.value=!0;try{g.value=S.value!==void 0;const y=Object.values(R.value).filter(P=>P!==void 0&&P!=="").length>0;k.value=await be({...Sl(R.value),parentId:(d=I.value)==null?void 0:d.id,isIncludeSelf:!0,isIncludeChildren:y,Q_OrderBy:S.value}),!y&&!g.value&&(k.value=me(k.value))}finally{t.value=!1}},K=()=>{ce(),ee()},Me=async()=>{de.epRank>0&&(Y.value=await va({category:"sys_article",latestVersion:!0}))},ge=async()=>{W.value=await gl()};let he;const Ue=()=>{const d=document.querySelector("#dataTable .el-table__body-wrapper tbody");he=Yl.create(d,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(y){var z;const{oldIndex:P,newIndex:u}=y;if(P!==u){let a=P,r=u,w=k.value;const O=(z=w[0])==null?void 0:z.children;(O==null?void 0:O.length)>0&&(w=O,a-=1,r-=1),await ul(w[a].id,w[r].id,a>r?"before":"after"),ce(),w.splice(r,0,w.splice(a,1)[0]),ie.success(U("success"))}}})};Ml(()=>{K(),Me(),ge(),Ue()}),El(()=>{he!==void 0&&he.destroy()});const Se=({column:d,prop:y,order:P})=>{var u;y&&P?S.value=((u=d.sortBy)!=null?u:y)+(P==="descending"?"_desc":""):S.value=void 0,K()},n=()=>{K(),ge()},o=()=>ee(),j=()=>{H.value.clearSort(),Wl(R.value),S.value=void 0,ee()},V=d=>{A.value=void 0,E.value=d!=null?d:I.value,M.value=!0},$=d=>{Te("channel:update")&&(A.value=d,E.value=null,M.value=!0)},Ee=(d,y)=>{Te("channel:update")&&(ma(d,y),ie.success(U("success")))},oe=(d,y)=>{Te("channel:update")&&(ca(d,y),ie.success(U("success")))},le=async d=>{await kl(d),K(),ie.success(U("success"))},re=async(d,y,P)=>{P!=="none"&&(await ul(d.data.id,y.data.id,P),ee())},Ie=async()=>{await ia(),K(),ie.success(U("success"))},Ke=async d=>{i.value?(I.value!=d.parent&&(I.value=d.parent,await ee()),$(d.id)):(I.value=d,o())},ke=(d,y)=>d?y.name.includes(d):!0,De=()=>{p.value.setCurrentKey(null),I.value=void 0,o()};return(d,y)=>{const P=pl,u=Be,z=bl,a=Dl,r=ze,w=Il,O=Gl,se=Xl,ue=zl,c=jl,Ve=Ol,_e=Al,$e=Jl,Ce=Zl,fe=Fe;return h(),b(Ce,null,{default:l(()=>[e(O,{width:"220px",class:"pr-3"},{default:l(()=>[e(w,{class:"p-2 bg-white rounded-sm"},{default:l(()=>[e(P,{modelValue:_.value,"onUpdate:modelValue":y[0]||(y[0]=v=>_.value=v),"suffix-icon":m(Kl),size:"small"},null,8,["modelValue","suffix-icon"]),N("div",za,[e(u,{type:I.value==null?"primary":void 0,link:"",onClick:De},{default:l(()=>[D(q(d.$t("channel.root")),1)]),_:1},8,["type"]),e(a,{content:d.$t("editMode"),placement:"top"},{default:l(()=>[e(z,{modelValue:i.value,"onUpdate:modelValue":y[1]||(y[1]=v=>i.value=v),"active-action-icon":m(sl),"inactive-action-icon":m(sl)},null,8,["modelValue","active-action-icon","inactive-action-icon"])]),_:1},8,["content"])]),ve(e(r,{ref_key:"channelTree",ref:p,data:C.value,props:{label:"name"},"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:m(Te)("channel:update"),"filter-node-method":ke,onNodeClick:Ke,onNodeDragEnd:re},null,8,["data","draggable"]),[[fe,s.value]])]),_:1})]),_:1}),e($e,{class:"p-0"},{default:l(()=>[N("div",Na,[e(m(ha),{params:R.value,onSearch:o,onReset:j},{default:l(()=>[e(m(rl),{label:d.$t("channel.name"),name:"Q_Contains_name"},null,8,["label"]),e(m(rl),{label:d.$t("channel.alias"),name:"Q_Contains_alias"},null,8,["label"])]),_:1},8,["params"])]),N("div",null,[e(u,{type:"primary",disabled:m(J)("channel:create"),icon:m(Pl),onClick:y[2]||(y[2]=()=>V(void 0))},{default:l(()=>[D(q(d.$t("add")),1)]),_:1},8,["disabled","icon"]),e(se,{title:d.$t("confirmDelete"),onConfirm:y[3]||(y[3]=()=>le(F.value.map(v=>v.id)))},{reference:l(()=>[e(u,{disabled:F.value.length<=0||m(J)("channel:delete"),icon:m(Ll)},{default:l(()=>[D(q(d.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(u,{disabled:m(J)("channel:update"),icon:m(Rl),onClick:y[4]||(y[4]=()=>ne.value=!0)},{default:l(()=>[D(q(d.$t("channel.op.batchMove")),1)]),_:1},8,["disabled","icon"]),e(u,{disabled:m(J)("channel:update"),icon:m(Fl),onClick:y[5]||(y[5]=()=>G.value=!0)},{default:l(()=>[D(q(d.$t("channel.op.batchMerge")),1)]),_:1},8,["disabled","icon"]),e(u,{disabled:m(J)("channel:tidyTree"),icon:m(Bl),onClick:y[6]||(y[6]=()=>Ie())},{default:l(()=>[D(q(d.$t("tidyTree")),1)]),_:1},8,["disabled","icon"]),e(a,{placement:"top",content:d.$t("tidyTree.tooltip")},{default:l(()=>[e(ue,{class:"ml-1 text-base align-text-bottom"},{default:l(()=>[e(m(Nl))]),_:1})]),_:1},8,["content"]),e(m(fa),{name:"channel",class:"ml-2"})]),N("div",Aa,[ve((h(),b(_e,{id:"dataTable",ref_key:"table",ref:H,"row-key":"id","default-expand-all":"",data:k.value,"row-class-name":({row:v})=>{var L;return((L=v.children)==null?void 0:L.length)>0?void 0:"drag-draggable"},onSelectionChange:y[7]||(y[7]=v=>F.value=v),onRowDblclick:y[8]||(y[8]=v=>$(v.id)),onSortChange:Se},{default:l(()=>[e(m(ya),{name:"channel"},{default:l(()=>[e(c,{type:"selection",selectable:x,width:"45"}),e(c,{property:"name",label:d.$t("channel.name"),"min-width":"80",sortable:"custom"},{default:l(({row:v})=>[e(Ve,{href:v.url,target:"_blank",type:"primary"},{default:l(()=>[D(q(v.name),1)]),_:2},1032,["href"])]),_:1},8,["label"]),e(c,{property:"alias",label:d.$t("channel.alias"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(c,{property:"channelModel.name",label:d.$t("channel.channelModel"),"sort-by":"channelModel@model-name",display:"none",sortable:"custom","min-width":"60"},null,8,["label"]),e(c,{property:"articleModel.name",label:d.$t("channel.articleModel"),"sort-by":"articleModel@model-name",sortable:"custom","min-width":"60"},null,8,["label"]),e(c,{property:"processKey",label:d.$t("channel.processKey"),"min-width":"60",sortable:"custom","show-overflow-tooltip":""},{default:l(({row:v})=>{var L;return[D(q(v.processKey!=null?(L=Y.value.find(we=>we.key===v.processKey))==null?void 0:L.name:void 0),1)]}),_:1},8,["label"]),e(c,{property:"nav",label:d.$t("channel.nav"),"min-width":"50"},{default:l(({row:v})=>[e(z,{modelValue:v.nav,"onUpdate:modelValue":L=>v.nav=L,size:"small",disabled:m(J)("channel:update"),onClick:()=>Ee(v.id,v.nav)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])]),_:1},8,["label"]),e(c,{property:"real",label:d.$t("channel.real"),"min-width":"50"},{default:l(({row:v})=>[e(z,{modelValue:v.real,"onUpdate:modelValue":L=>v.real=L,size:"small",disabled:m(J)("channel:update"),onClick:()=>oe(v.id,v.real)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])]),_:1},8,["label"]),e(c,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(c,{width:"42"},{default:l(({row:v})=>{var L;return[e(ue,{class:Ql(["text-lg align-middle",g.value||m(J)("channel:update")||((L=v.children)==null?void 0:L.length)>0?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:l(()=>[e(m(Hl))]),_:2},1032,["class"])]}),_:1}),e(c,{label:d.$t("table.action")},{default:l(({row:v})=>[e(u,{type:"primary",disabled:m(J)("channel:create")||!x(v),size:"small",link:"",onClick:()=>V(v)},{default:l(()=>[D(q(d.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),e(u,{type:"primary",disabled:m(J)("channel:update"),size:"small",link:"",onClick:()=>$(v.id)},{default:l(()=>[D(q(d.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(se,{title:d.$t("confirmDelete"),onConfirm:()=>le([v.id])},{reference:l(()=>[e(u,{type:"primary",disabled:m(J)("channel:delete")||!x(v),size:"small",link:""},{default:l(()=>[D(q(d.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data","row-class-name"])),[[fe,t.value]])]),e(Ua,{modelValue:M.value,"onUpdate:modelValue":y[9]||(y[9]=v=>M.value=v),"bean-id":A.value,"bean-ids":B.value,parent:E.value,onFinished:n},null,8,["modelValue","bean-id","bean-ids","parent"]),e(Da,{modelValue:ne.value,"onUpdate:modelValue":y[10]||(y[10]=v=>ne.value=v),onFinished:n},null,8,["modelValue"]),e(Ba,{modelValue:G.value,"onUpdate:modelValue":y[11]||(y[11]=v=>G.value=v),onFinished:n},null,8,["modelValue"])]),_:1})]),_:1})}}});export{yt as default};
