import{d as se,u as ie,r as s,ac as B,v as de,o as ce,aC as re,b as i,c as ue,e as k,f as g,w as t,i as a,I as me,aa as be,a9 as pe,k as E,j as n,as as _,ak as ve,l as C,t as V,ah as _e,g as fe,ae as ke,aE as ge,h as x,aJ as ye,E as N,aK as Ie,_ as he}from"./index-BgkR3Um2.js";import{S as we}from"./sortable.esm-BmjBFecF.js";import{a as Be}from"./config-DJA2wLsE.js";import{P as Ce,Q as Ve,R as $e,G as Se}from"./content-D9cimwRS.js";import{_ as De,a as Le,b as Ue,c as Ee}from"./QueryItem.vue_vue_type_script_setup_true_lang-SYpjwARX.js";import{a as Ne}from"./BlockItemForm.vue_vue_type_script_setup_true_lang-JMBnGXYx.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-wtbBfkW1.js";import"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-CYFJM6Lm.js";import"./vuedraggable.umd-C-c0fYvw.js";import"./BaseUpload-DnjvaBl9.js";/* empty css                                                                   */const Pe={class:"mb-3"},Re={class:"mt-3 app-block"},Te=se({name:"BlockItemList",__name:"BlockItemList",setup(qe){const{t:$}=ie(),y=s({}),f=s(),P=s(),c=s([]),S=s([]),D=s(!1),I=s(!1),L=s(),F=B(()=>c.value.map(e=>e.id)),M=s(!1),h=s([]),p=s(),A=B(()=>h.value.find(e=>e.id===p.value)),G=B(()=>c.value.map(e=>e.image)),J=B(()=>c.value.map(e=>e.mobileImage)),R=s(!1),v=async()=>{D.value=!0;try{c.value=await Ce({...ye(y.value),blockId:p.value,Q_OrderBy:f.value}),M.value=Object.values(y.value).filter(e=>e!==void 0&&e!=="").length>0||f.value!==void 0,R.value=f.value!==void 0}finally{D.value=!1}},K=async()=>{h.value=await Be(),p.value=String(h.value[0].id)};let U;const H=()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");U=we.create(e,{handle:".drag-handle",onEnd:async function(o){const{oldIndex:u,newIndex:m}=o;u!==m&&(await Ve(c.value[u].id,c.value[m].id),c.value.splice(m,0,c.value.splice(u,1)[0]),N.success($("success")))}})};de(p,()=>v()),ce(async()=>{await K(),H()}),re(()=>{U!==void 0&&U.destroy()});const W=({column:e,prop:o,order:u})=>{var m;o&&u?f.value=((m=e.sortBy)!=null?m:o)+(u==="descending"?"_desc":""):f.value=void 0,v()},X=()=>v(),Y=()=>{P.value.clearSort(),Ie(y.value),f.value=void 0,v()},Z=()=>{L.value=void 0,I.value=!0},T=e=>{L.value=e,I.value=!0},q=async e=>{await $e(e),v(),N.success($("success"))},z=async e=>{await Se(e),v(),N.success($("success"))};return(e,o)=>{const u=i("el-tab-pane"),m=i("el-tabs"),ee=i("el-aside"),w=i("el-button"),O=i("el-popconfirm"),r=i("el-table-column"),ae=i("el-icon"),Q=i("el-image"),j=i("el-switch"),le=i("el-table"),te=i("el-main"),oe=i("el-container"),ne=ue("loading");return k(),g(oe,null,{default:t(()=>[a(ee,{width:"180px",class:"pr-3"},{default:t(()=>[a(m,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),"tab-position":"left",stretch:"",class:"bg-white"},{default:t(()=>[(k(!0),me(pe,null,be(h.value,b=>(k(),g(u,{key:b.id,name:String(b.id),label:b.name},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(te,{class:"p-0"},{default:t(()=>{var b;return[E("div",Pe,[a(n(De),{params:y.value,onSearch:X,onReset:Y},{default:t(()=>[a(n(Le),{label:e.$t("blockItem.title"),name:"Q_Contains_title"},null,8,["label"])]),_:1},8,["params"])]),E("div",null,[a(w,{type:"primary",disabled:!((b=A.value)!=null&&b.enabled)||n(_)("blockItem:create"),icon:n(ve),onClick:o[1]||(o[1]=()=>Z())},{default:t(()=>[C(V(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(O,{title:e.$t("confirmDelete"),onConfirm:o[2]||(o[2]=()=>z(S.value.map(l=>l.id)))},{reference:t(()=>[a(w,{disabled:S.value.length<=0||n(_)("blockItem:delete"),icon:n(_e)},{default:t(()=>[C(V(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(n(Ue),{name:"blockItem",class:"ml-2"})]),E("div",Re,[fe((k(),g(le,{id:"dataTable",ref_key:"table",ref:P,"row-key":"id",data:c.value,onSelectionChange:o[3]||(o[3]=l=>S.value=l),onRowDblclick:o[4]||(o[4]=l=>T(l.id)),onSortChange:W},{default:t(()=>[a(n(Ee),{name:"blockItem"},{default:t(()=>[a(r,{type:"selection",width:"38"}),a(r,{width:"42"},{default:t(()=>[a(ae,{class:ke(["text-lg align-middle",R.value||n(_)("blockItem:update")?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]]),disalbed:""},{default:t(()=>[a(n(ge))]),_:1},8,["class"])]),_:1}),a(r,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(r,{property:"title",label:e.$t("blockItem.title"),sortable:"custom","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(r,{property:"image",label:e.$t("blockItem.image")},{default:t(({row:l,$index:d})=>[l.image?(k(),g(Q,{key:0,src:l.image,fit:"contain","preview-src-list":G.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):x("",!0)]),_:1},8,["label"]),a(r,{property:"mobileImage",label:e.$t("blockItem.mobileImage"),display:"none"},{default:t(({row:l,$index:d})=>[l.mobileImage?(k(),g(Q,{key:0,src:l.mobileImage,fit:"contain","preview-src-list":J.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):x("",!0)]),_:1},8,["label"]),a(r,{property:"targetBlank",label:e.$t("blockItem.targetBlank"),sortable:"custom",width:"120"},{default:t(({row:l})=>[a(j,{modelValue:l.targetBlank,"onUpdate:modelValue":d=>l.targetBlank=d,disabled:n(_)("blockItem:update"),onChange:d=>q({...l,targetBlank:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(r,{property:"enabled",label:e.$t("enable"),sortable:"custom",width:"100"},{default:t(({row:l})=>[a(j,{modelValue:l.enabled,"onUpdate:modelValue":d=>l.enabled=d,disabled:n(_)("blockItem:update"),onChange:d=>q({...l,enabled:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(r,{label:e.$t("table.action")},{default:t(({row:l})=>[a(w,{type:"primary",disabled:n(_)("blockItem:update"),size:"small",link:"",onClick:()=>T(l.id)},{default:t(()=>[C(V(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(O,{title:e.$t("confirmDelete"),onConfirm:()=>z([l.id])},{reference:t(()=>[a(w,{type:"primary",disabled:n(_)("blockItem:delete"),size:"small",link:""},{default:t(()=>[C(V(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[ne,D.value]])]),a(Ne,{modelValue:I.value,"onUpdate:modelValue":o[5]||(o[5]=l=>I.value=l),"bean-id":L.value,"bean-ids":F.value,"block-id":p.value,onFinished:v},null,8,["modelValue","bean-id","bean-ids","block-id"])]}),_:1})]),_:1})}}}),He=he(Te,[["__scopeId","data-v-656e86ab"]]);export{He as default};
