var Y=Object.defineProperty,Z=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var R=(m,u,n)=>u in m?Y(m,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[u]=n,O=(m,u)=>{for(var n in u||(u={}))ee.call(u,n)&&R(m,n,u[n]);if(z)for(var n of z(u))ae.call(u,n)&&R(m,n,u[n]);return m},T=(m,u)=>Z(m,x(u));import{j as le,t as te,p as q,d as oe,E as ne,r as se,m as de}from"./index.e8481b3d.js";import{g as M,D as p,L as A,m as V,o as U,j,w as d,n as a,v as re,k as s,u as ue,i as ie,q as me,x as S,ac as pe,aj as ce,K as fe,ai as be,J as C,y as k,ab as ve}from"./vendor.831f9fe0.js";import{v as ge,w as he,x as _e,y as F,a as P,z as ye}from"./user.d144c096.js";import{_ as Ve,b as $e,a as D,c as Ie}from"./QueryItem.1f679edc.js";import{_ as we}from"./ListMove.244b8340.js";import{_ as Ce}from"./DialogForm.5bf7230d.js";const ke=M({props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0}},emits:{"update:modelValue":null,finished:null},setup(m,{emit:u}){const n=p(),g=p([]),h=async t=>{g.value=le(te(await P()),t==null?void 0:t.id)},c=async t=>{await h(t),u("finished")};return A(()=>{h()}),(t,$)=>{const I=V("el-cascader"),f=V("el-form-item"),w=V("el-input");return U(),j(Ce,{name:t.$t("menu.user.org"),queryBean:s(ge),createBean:s(he),updateBean:s(_e),deleteBean:s(F),beanId:m.beanId,beanIds:m.beanIds,focus:n.value,initValues:l=>{var _;return{parentId:(_=l==null?void 0:l.parentId)!=null?_:m.parentId}},toValues:l=>O({},l),disableDelete:l=>l.id<=1,perms:"org","model-value":m.modelValue,"onUpdate:modelValue":$[0]||($[0]=l=>t.$emit("update:modelValue",l)),onFinished:c,onBeanChange:h},{default:d(({values:l,isEdit:_})=>[!_||l.id>1?(U(),j(f,{key:0,prop:"parentId",label:t.$t("org.parent"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[a(I,{modelValue:l.parentId,"onUpdate:modelValue":o=>l.parentId=o,options:g.value,props:{value:"id",label:"name",checkStrictly:!0},onChange:o=>l.parentId=o[o.length-1],class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:2},1032,["label","rules"])):re("",!0),a(f,{prop:"name",label:t.$t("org.name"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[a(w,{modelValue:l.name,"onUpdate:modelValue":o=>l.name=o,ref_key:"focus",ref:n,maxlength:"50"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","rules"]),a(f,{prop:"address",label:t.$t("org.address")},{default:d(()=>[a(w,{modelValue:l.address,"onUpdate:modelValue":o=>l.address=o,maxlength:"255"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),a(f,{prop:"phone",label:t.$t("org.phone")},{default:d(()=>[a(w,{modelValue:l.phone,"onUpdate:modelValue":o=>l.phone=o,maxlength:"100"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),a(f,{prop:"contacts",label:t.$t("org.contacts")},{default:d(()=>[a(w,{modelValue:l.contacts,"onUpdate:modelValue":o=>l.contacts=o,maxlength:"100"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","model-value"])}}}),Be={class:"mb-3"},qe={class:"app-block mt-3"},Ne=M({setup(m){const{t:u}=ue(),n=p({}),g=p(),h=p(),c=p([]),t=p([]),$=p(!1),I=p(!1),f=p(),w=ie(()=>c.value.map(e=>e.id)),l=p(!1),_=p(1),o=async()=>{$.value=!0;try{c.value=await P(T(O({},oe(n.value)),{Q_OrderBy:g.value})),l.value=Object.values(n.value).filter(e=>e!==void 0&&e!=="").length>0||g.value!==void 0,l.value||(c.value=ne(c.value))}finally{$.value=!1}};A(o);const J=({column:e,prop:r,order:b})=>{var y;r?g.value=((y=e.sortBy)!=null?y:r)+(b==="descending"?"_desc":""):g.value=void 0,o()},K=()=>o(),G=()=>{h.value.clearSort(),se(n.value),g.value=void 0,o()},E=e=>{f.value=void 0,_.value=e!=null?e:1,I.value=!0},L=e=>{f.value=e,I.value=!0},N=async e=>{await F(e),o(),fe.success(u("success"))},Q=e=>e.id>1,H=async(e,r)=>{const b=de(e,c.value,r);await ye(b),await o(),e.forEach(y=>{h.value.toggleRowSelection(c.value.find(v=>v.id===y.id))})};return(e,r)=>{const b=V("el-button"),y=V("el-popconfirm"),v=V("el-table-column"),W=V("el-table"),X=be("loading");return U(),me("div",null,[S("div",Be,[a(s(Ve),{params:n.value,onSearch:K,onReset:G},{default:d(()=>[a(s(D),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),a(s(D),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),a(s(D),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),a(s(D),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),S("div",null,[a(b,{type:"primary",icon:s(pe),onClick:r[0]||(r[0]=i=>E())},{default:d(()=>[C(k(e.$t("add")),1)]),_:1},8,["icon"]),a(y,{title:e.$t("confirmDelete"),onConfirm:r[1]||(r[1]=i=>N(t.value.map(B=>B.id)))},{reference:d(()=>[a(b,{disabled:t.value.length<=0,icon:s(ve)},{default:d(()=>[C(k(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(we,{class:"ml-2",disabled:t.value.length<=0||l.value||s(q)("org:update"),onMove:r[2]||(r[2]=i=>H(t.value,i))},null,8,["disabled"]),a(s($e),{name:"org",class:"ml-2"})]),S("div",qe,[ce((U(),j(W,{ref_key:"table",ref:h,"row-key":"id",data:c.value,onSelectionChange:r[3]||(r[3]=i=>t.value=i),onRowDblclick:r[4]||(r[4]=i=>L(i.id)),onSortChange:J},{default:d(()=>[a(s(Ie),{name:"org"},{default:d(()=>[a(v,{type:"selection",selectable:Q,width:"45"}),a(v,{property:"id",label:"ID",width:"64",sortable:"custom"}),a(v,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:d(({row:i})=>[C(k(i.names.join(" / ")),1)]),_:1},8,["label"]),a(v,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(v,{label:e.$t("table.action")},{default:d(({row:i})=>[a(b,{type:"text",disabled:s(q)("org:create"),onClick:B=>E(i.id),size:"small"},{default:d(()=>[C(k(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),a(b,{type:"text",disabled:s(q)("org:update"),onClick:B=>L(i.id),size:"small"},{default:d(()=>[C(k(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(y,{title:e.$t("confirmDelete"),onConfirm:B=>N([i.id])},{reference:d(()=>[a(b,{type:"text",disabled:!Q(i)||s(q)("org:delete"),size:"small"},{default:d(()=>[C(k(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[X,$.value]])]),a(ke,{modelValue:I.value,"onUpdate:modelValue":r[5]||(r[5]=i=>I.value=i),beanId:f.value,beanIds:s(w),onFinished:o,parentId:_.value},null,8,["modelValue","beanId","beanIds","parentId"])])}}});export{Ne as default};
