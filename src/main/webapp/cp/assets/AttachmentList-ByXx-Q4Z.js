import{d as Q,u as R,r as n,o as j,bi as q,b as f,P as w,l as $,h as a,w as o,k as r,bs as F,m as H,aZ as O,b5 as k,v as c,x as u,t as U,e as G,y as X,c as Z,aQ as J,X as K,aF as W,aG as x,aO as ee,aP as te,bq as ae,br as le}from"./index-__TSAjOL.js";import{E as oe}from"./el-pagination-BCmSIrki.js";import"./el-select-CPBsiljt.js";import{E as se}from"./el-popover-B2t_MYt0.js";import{g as ne,h as re}from"./system--Gl2DLOU.js";import{a as ie,_ as ue,b as me,c as de}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";const ce={class:"mb-3"},pe={class:"mt-3 app-block"},we=Q({name:"AttachmentList",__name:"AttachmentList",setup(be){const{t:D}=R(),v=n({}),p=n(),h=n(1),g=n(10),z=n(0),C=n(),E=n([]),y=n([]),_=n(!1),P=n(!1),B=n(),i=async()=>{_.value=!0;try{const{content:e,totalElements:l}=await ne({...q(v.value),Q_OrderBy:p.value,page:h.value,pageSize:g.value});E.value=e,z.value=Number(l)}finally{_.value=!1}};j(i);const L=({column:e,prop:l,order:m})=>{var d;l&&m?p.value=((d=e.sortBy)!=null?d:l)+(m==="descending"?"_desc":""):p.value=void 0,i()},T=()=>i(),I=()=>{C.value.clearSort(),F(v.value),p.value=void 0,i()},A=e=>{B.value=e,P.value=!0},S=async e=>{await re(e),i(),U.success(D("success"))};return(e,l)=>{const m=H,d=se,s=J,M=ee,N=te,V=oe,Y=X;return f(),w("div",null,[$("div",ce,[a(r(ue),{params:v.value,onSearch:T,onReset:I},{default:o(()=>[a(r(ie),{label:e.$t("attachment.name"),name:"Q_Contains_name"},null,8,["label"])]),_:1},8,["params"])]),$("div",null,[a(d,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>S(y.value.map(t=>t.id)))},{reference:o(()=>[a(m,{disabled:y.value.length<=0||r(k)("attachment:delete"),icon:r(O)},{default:o(()=>[c(u(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(r(me),{name:"attachment",class:"ml-2"})]),$("div",pe,[G((f(),Z(N,{ref_key:"table",ref:C,data:E.value,onSelectionChange:l[1]||(l[1]=t=>y.value=t),onRowDblclick:l[2]||(l[2]=t=>A(t.id)),onSortChange:L},{default:o(()=>[a(r(de),{name:"attachment"},{default:o(()=>[a(s,{type:"selection",selectable:t=>!t.used,width:"45"},null,8,["selectable"]),a(s,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(s,{property:"name",label:e.$t("attachment.name"),sortable:"custom","min-width":"130","show-overflow-tooltip":""},null,8,["label"]),a(s,{property:"path",label:e.$t("attachment.path"),sortable:"custom","min-width":"200",display:"none","show-overflow-tooltip":""},null,8,["label"]),a(s,{property:"url",label:e.$t("attachment.url"),sortable:"custom","min-width":"350",display:"none","show-overflow-tooltip":""},null,8,["label"]),a(s,{property:"length",label:e.$t("attachment.length"),sortable:"custom",align:"right","show-overflow-tooltip":""},{default:o(({row:t})=>[c(u(t.size),1)]),_:1},8,["label"]),a(s,{property:"created",label:e.$t("attachment.created"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:o(({row:t})=>[c(u(r(K)(t.created).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label"]),a(s,{property:"user.username",label:e.$t("attachment.user"),"sort-by":"user-username",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(s,{label:e.$t("attachment.refer"),"show-overflow-tooltip":""},{default:o(({row:t})=>[(f(!0),w(W,null,x(t.referList,b=>(f(),w("div",{key:"".concat(b.referType,"-").concat(b.referId)},u("".concat(b.referType,"-").concat(b.referId)),1))),128))]),_:1},8,["label"]),a(s,{property:"used",label:e.$t("attachment.used"),sortable:"custom","show-overflow-tooltip":""},{default:o(({row:t})=>[a(M,{type:t.used?"success":"info",size:"small"},{default:o(()=>[c(u(e.$t(t.used?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(s,{label:e.$t("table.action")},{default:o(({row:t})=>[a(d,{title:e.$t("confirmDelete"),onConfirm:()=>S([t.id])},{reference:o(()=>[a(m,{type:"primary",disabled:t.used||r(k)("attachment:delete"),size:"small",link:""},{default:o(()=>[c(u(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[Y,_.value]]),a(V,{"current-page":h.value,"onUpdate:currentPage":l[3]||(l[3]=t=>h.value=t),"page-size":g.value,"onUpdate:pageSize":l[4]||(l[4]=t=>g.value=t),total:z.value,"page-sizes":r(le),layout:r(ae),size:"small",background:"",class:"justify-end px-3 py-2",onSizeChange:l[5]||(l[5]=()=>i()),onCurrentChange:l[6]||(l[6]=()=>i())},null,8,["current-page","page-size","total","page-sizes","layout"])])])}}});export{we as default};
