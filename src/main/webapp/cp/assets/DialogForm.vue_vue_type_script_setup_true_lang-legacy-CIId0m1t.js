System.register(["./index-legacy-Dn378GZk.js","./el-switch-legacy-CJu_GaeZ.js","./el-popover-legacy-DS1ey-DB.js"],(function(e,a){"use strict";var l,u,t,i,d,n,s,v,o,r,c,p,f,m,y,b,V,g,h,$,S,k,_,w,B,q,F,E,x,D,I,C,O,j;return{setters:[e=>{l=e.d,u=e.A,t=e.u,i=e.r,d=e.ar,n=e.bH,s=e.o,v=e.B,o=e.t,r=e.b,c=e.c,p=e.w,f=e.e,m=e.P,y=e.m,b=e.k,V=e.aW,g=e.b5,h=e.v,$=e.x,S=e.g,k=e.aC,_=e.h,w=e.aZ,B=e.ba,q=e.aH,F=e.aO,E=e.y,x=e.E,D=e.ay,I=e.n,C=e.z},e=>{O=e.E},e=>{j=e.E}],execute:function(){const a={key:0},J={key:0},N={key:1},P={class:"space-x-2"},W={key:0},z="ujcms_continuous_settings";e("_",l({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},values:{type:Object,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(e,{expose:l,emit:A}){function H(){const e=localStorage.getItem(z);return e?JSON.parse(e):{}}function U(e,a){const l=H();l[e]=a,function(e){localStorage.setItem(z,JSON.stringify(e))}(l)}const Z=e,G=A,{name:K,beanId:L,beanIds:M,focus:Q,values:R,action:T,modelValue:X}=u(Z),{t:Y}=t(),ee=i(!1),ae=i(!1),le=i((ue=K.value,H()[ue]??!1));var ue;const te=i(),ie=i(Z.initValues()),de=i(),ne=i(),se=i([]),ve=d((()=>null!=ne.value&&"edit"===T.value)),oe=d((()=>!ee.value&&!n.isEqual(de.value,R.value))),re=d((()=>Z.disableEdit?.(ie.value)??!1)),ce=d((()=>`${K.value} - ${ve.value?`${Y(re.value?"detail":"edit")} (ID: ${ne.value})`:`${Y("add")}`}`)),pe=async()=>{ee.value=!0;try{ie.value=null!=ne.value?await Z.queryBean(ne.value):Z.initValues(R.value,ve.value),de.value=null!=ne.value?Z.toValues(ie.value):ie.value,G("update:values",n.cloneDeep(de.value)),G("beanChange",ie.value),te.value?.resetFields()}finally{ee.value=!1}};s((()=>G("update:values",Z.initValues()))),v(X,(()=>{X.value&&(se.value=M.value,ne.value!==L.value?ne.value=L.value:pe())})),v(ne,(()=>{pe()})),v(le,(()=>U(K.value,le.value)));const fe=d((()=>se.value.indexOf(ne.value))),me=d((()=>fe.value>0)),ye=d((()=>fe.value<se.value.length-1)),be=()=>{me.value&&(ne.value=se.value[fe.value-1])},Ve=()=>{ye.value&&(ne.value=se.value[fe.value+1])},ge=()=>{Q.value?.focus?.(),ne.value=void 0},he=()=>{G("update:modelValue",!1)},$e=async()=>{ae.value=!0;try{await Z.deleteBean([ne.value]),le.value||G("update:modelValue",!1),ye.value?(Ve(),se.value.splice(fe.value-1,1)):me.value?(be(),se.value.splice(fe.value+1,1)):G("update:modelValue",!1),o.success(Y("success")),G("finished")}finally{ae.value=!1}},Se=()=>{de.value=Z.toValues(R.value)},ke=async(e=!1)=>{await(Z.beforeValidate?.(R.value)),te.value.validate((async a=>{if(a){ae.value=!0;try{if(await(Z.preventSubmit?.(R.value)))return;G("beforeSubmit",R.value),ve.value?(await Z.updateBean(R.value),Se()):(await Z.createBean(R.value),Q.value?.focus?.(),G("update:values",Z.initValues(R.value,ve.value)),te.value.resetFields()),o.success(Y("success")),le.value||e||G("update:modelValue",!1),G("finished",ie.value)}finally{ae.value=!1}}}))};return l({form:te,submit:e=>{te.value.validate((async a=>{if(a){ae.value=!0;try{if(await(Z.preventSubmit?.(R.value)))return;G("beforeSubmit",R.value);const a=await e(R.value,{isEdit:ve.value,continuous:le.value,form:te.value,props:Z,focus:Q.value,loadBean:pe,resetOrigValues:Se,emit:G});le.value||a||G("update:modelValue",!1),G("finished",ie.value)}finally{ae.value=!1}}}))},remove:async e=>{ae.value=!0;try{await e(R.value,{isEdit:ve.value,continuous:le.value,form:te.value,props:Z,focus:Q.value,loadBean:pe,emit:G}),le.value||G("update:modelValue",!1),ye.value?(Ve(),se.value.splice(fe.value-1,1)):me.value?(be(),se.value.splice(fe.value+1,1)):G("update:modelValue",!1),o.success(Y("success")),G("finished")}finally{ae.value=!1}},defaultSubmit:ke}),(l,u)=>{const t=y,i=j,d=B,n=O,s=q,v=F,o=x,z=C,A=E;return r(),c(z,{title:ce.value,"close-on-click-modal":!oe.value,"model-value":e.modelValue,width:e.large?"98%":"768px",top:e.large?"16px":"8vh","onUpdate:modelValue":u[3]||(u[3]=e=>l.$emit("update:modelValue",e)),onOpened:u[4]||(u[4]=()=>!ve.value&&b(Q)?.focus())},{header:p((()=>[h($(b(K))+" - ",1),ve.value?(r(),m("span",a,[h($(l.$t(re.value?"detail":"edit"))+" ",1),e.showId?(r(),m("span",J,"(ID: "+$(ne.value)+")",1)):S("",!0)])):(r(),m("span",N,$(l.$t("add")),1))])),default:p((()=>[f((r(),m("div",P,[ve.value&&e.addable?(r(),c(t,{key:0,disabled:b(g)(`${e.perms}:create`),type:"primary",icon:b(V),onClick:ge},{default:p((()=>[h($(l.$t("add")),1)])),_:1},8,["disabled","icon"])):S("",!0),k(l.$slots,"header-action",{bean:ie.value,isEdit:ve.value,disabled:re.value,unsaved:oe.value,disableDelete:e.disableDelete,handleDelete:$e},(()=>[ve.value?(r(),c(i,{key:0,title:l.$t("confirmDelete"),onConfirm:u[0]||(u[0]=()=>$e())},{reference:p((()=>[_(t,{disabled:e.disableDelete?.(ie.value)||b(g)(`${e.perms}:delete`),icon:b(w)},{default:p((()=>[h($(l.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"])):S("",!0)])),ve.value?(r(),c(d,{key:1},{default:p((()=>[_(t,{disabled:!me.value,onClick:be},{default:p((()=>[h($(l.$t("form.prev")),1)])),_:1},8,["disabled"]),_(t,{disabled:!ye.value,onClick:Ve},{default:p((()=>[h($(l.$t("form.next")),1)])),_:1},8,["disabled"])])),_:1})):S("",!0),_(t,{type:"primary",onClick:he},{default:p((()=>[h($(l.$t("back")),1)])),_:1}),_(s,{content:l.$t("form.continuous"),placement:"top"},{default:p((()=>[_(n,{modelValue:le.value,"onUpdate:modelValue":u[1]||(u[1]=e=>le.value=e),size:"small"},null,8,["modelValue"])])),_:1},8,["content"]),oe.value?(r(),c(v,{key:2,type:"danger"},{default:p((()=>[h($(l.$t("form.unsaved")),1)])),_:1})):S("",!0),k(l.$slots,"header-status",{bean:ie.value,isEdit:ve.value,disabled:re.value})])),[[A,ee.value||ae.value]]),_(o,{ref_key:"form",ref:te,class:D(["mt-5","pr-5"]),model:b(R),disabled:re.value,"label-width":e.labelWidth,"label-position":e.labelPosition,"scroll-to-error":""},{default:p((()=>[k(l.$slots,"default",{bean:ie.value,isEdit:ve.value,disabled:re.value}),re.value?S("",!0):f((r(),m("div",W,[k(l.$slots,"footer-action",{bean:ie.value,isEdit:ve.value,disabled:re.value,handleSubmit:ke},(()=>[_(t,{disabled:b(g)(ve.value?`${e.perms}:update`:`${e.perms}:create`),type:"primary","native-type":"submit",onClick:u[2]||(u[2]=I((()=>ke()),["prevent"]))},{default:p((()=>[h($(l.$t("save")),1)])),_:1},8,["disabled"])]))])),[[A,ae.value]])])),_:3},8,["model","disabled","label-width","label-position"])])),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}}))}}}));
