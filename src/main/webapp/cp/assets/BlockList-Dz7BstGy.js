import{d as z,r as $,b as f,c as V,w as l,h as e,a6 as O,a2 as T,i as Q,j,k as m,P as C,aF as G,aG as Z,v,x as p,g as M,b3 as X,u as Y,ar as J,o as K,bi as x,l as W,bs as ee,aW as le,b5 as S,m as ae,aZ as te,t as ue,bI as oe,e as ie,y as se,aQ as de,aO as re,aP as ne}from"./index-__TSAjOL.js";import{E as me}from"./el-popover-B2t_MYt0.js";import{W as be,X as pe,Y as F,Z as fe,_ as ve,$ as ge,a as $e,a0 as ke}from"./config-BS48XX7b.js";import{a as Ve,_ as qe,b as ye,c as ce}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";import{_ as we}from"./ListMove.vue_vue_type_script_setup_true_lang-Dnx-NEui.js";import{c as Ie}from"./el-select-CPBsiljt.js";import{E as he}from"./el-switch-Cg-m0Y0i.js";import{E as Re,a as Ue}from"./el-radio-group-B2Xrve8Z.js";/* empty css                 */import{_ as _e}from"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";const Ee=z({name:"BlockForm",__name:"BlockForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(B){const D=$(),a=$({});return(t,u)=>{const w=j,d=Q,r=T,U=Ue,E=Re,b=he,I=Ie,y=O;return f(),V(_e,{values:a.value,"onUpdate:values":u[21]||(u[21]=k=>a.value=k),name:t.$t("menu.config.block"),"query-bean":m(ge),"create-bean":m(ve),"update-bean":m(fe),"delete-bean":m(F),"bean-id":B.beanId,"bean-ids":B.beanIds,focus:D.value,"init-values":()=>({scope:0,withLinkUrl:!0,linkUrlRequired:!0,withSubtitle:!1,subtitleRequired:!1,withDescription:!1,descriptionRequired:!1,withImage:!1,imageRequired:!1,imageWidth:300,imageHeight:200,withMobileImage:!1,mobileImageRequired:!1,mobileImageWidth:300,mobileImageHeight:200,withVideo:!1,videoRequired:!1,enabled:!0,recommendable:!0}),"to-values":k=>({...k}),perms:"block","model-value":B.modelValue,"onUpdate:modelValue":u[22]||(u[22]=k=>t.$emit("update:modelValue",k)),onFinished:u[23]||(u[23]=()=>t.$emit("finished"))},{default:l(({bean:k})=>[e(y,null,{default:l(()=>[e(r,{span:24},{default:l(()=>[e(d,{prop:"name",label:t.$t("block.name"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(w,{ref_key:"focus",ref:D,modelValue:a.value.name,"onUpdate:modelValue":u[0]||(u[0]=o=>a.value.name=o),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:24},{default:l(()=>[e(d,{prop:"alias",label:t.$t("block.alias"),rules:[{required:!0,message:()=>t.$t("v.required")},{pattern:/^[\u4E00-\u9FA5\w-]*$/,message:()=>t.$t("block.error.aliasPattern")},{asyncValidator:async(o,_,h)=>{if(_!==k.alias&&await m(be)(_,a.value.scope)){h(t.$t("block.error.aliasExist"));return}h()}}]},{default:l(()=>[e(w,{modelValue:a.value.alias,"onUpdate:modelValue":u[1]||(u[1]=o=>a.value.alias=o),maxlength:"50"},null,8,["modelValue"])]),_:2},1032,["label","rules"])]),_:2},1024),e(r,{span:24},{default:l(()=>[e(d,{prop:"scope",label:t.$t("block.scope"),rules:[{required:!0,message:()=>t.$t("v.required")},{asyncValidator:async(o,_,h)=>{if(_!==k.scope&&await m(pe)(a.value.scope,a.value.id)){h(t.$t("block.error.scopeNotAllowd"));return}h()}}]},{default:l(()=>[e(E,{modelValue:a.value.scope,"onUpdate:modelValue":u[2]||(u[2]=o=>a.value.scope=o)},{default:l(()=>[(f(),C(G,null,Z([0,2],o=>e(U,{key:o,value:o},{default:l(()=>[v(p(t.$t("block.scope.".concat(o))),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:2},1032,["label","rules"])]),_:2},1024),e(r,{span:12},{default:l(()=>[e(d,{prop:"withLinkUrl",label:t.$t("block.withLinkUrl"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withLinkUrl,"onUpdate:modelValue":u[3]||(u[3]=o=>a.value.withLinkUrl=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"linkUrlRequired",label:t.$t("block.linkUrlRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.linkUrlRequired,"onUpdate:modelValue":u[4]||(u[4]=o=>a.value.linkUrlRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"withSubtitle",label:t.$t("block.withSubtitle"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withSubtitle,"onUpdate:modelValue":u[5]||(u[5]=o=>a.value.withSubtitle=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"subtitleRequired",label:t.$t("block.subtitleRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.subtitleRequired,"onUpdate:modelValue":u[6]||(u[6]=o=>a.value.subtitleRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"withDescription",label:t.$t("block.withDescription"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withDescription,"onUpdate:modelValue":u[7]||(u[7]=o=>a.value.withDescription=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"descriptionRequired",label:t.$t("block.descriptionRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.descriptionRequired,"onUpdate:modelValue":u[8]||(u[8]=o=>a.value.descriptionRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"withImage",label:t.$t("block.withImage"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withImage,"onUpdate:modelValue":u[9]||(u[9]=o=>a.value.withImage=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"imageRequired",label:t.$t("block.imageRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.imageRequired,"onUpdate:modelValue":u[10]||(u[10]=o=>a.value.imageRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),a.value.withImage?(f(),V(r,{key:0,span:12},{default:l(()=>[e(d,{prop:"imageWidth",label:t.$t("block.imageWidth"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(I,{modelValue:a.value.imageWidth,"onUpdate:modelValue":u[11]||(u[11]=o=>a.value.imageWidth=o),min:0,max:65535},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})):M("",!0),a.value.withImage?(f(),V(r,{key:1,span:12},{default:l(()=>[e(d,{prop:"imageHeight",label:t.$t("block.imageHeight"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(I,{modelValue:a.value.imageHeight,"onUpdate:modelValue":u[12]||(u[12]=o=>a.value.imageHeight=o),min:0,max:65535},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})):M("",!0),e(r,{span:12},{default:l(()=>[e(d,{prop:"withMobileImage",label:t.$t("block.withMobileImage"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withMobileImage,"onUpdate:modelValue":u[13]||(u[13]=o=>a.value.withMobileImage=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"mobileImageRequired",label:t.$t("block.mobileImageRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.mobileImageRequired,"onUpdate:modelValue":u[14]||(u[14]=o=>a.value.mobileImageRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),a.value.withMobileImage?(f(),V(r,{key:2,span:12},{default:l(()=>[e(d,{prop:"mobileImageWidth",label:t.$t("block.mobileImageWidth"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(I,{modelValue:a.value.mobileImageWidth,"onUpdate:modelValue":u[15]||(u[15]=o=>a.value.mobileImageWidth=o),min:16,max:65535},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})):M("",!0),a.value.withMobileImage?(f(),V(r,{key:3,span:12},{default:l(()=>[e(d,{prop:"mobileImageHeight",label:t.$t("block.mobileImageHeight"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(I,{modelValue:a.value.mobileImageHeight,"onUpdate:modelValue":u[16]||(u[16]=o=>a.value.mobileImageHeight=o),min:16,max:65535},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})):M("",!0),e(r,{span:12},{default:l(()=>[e(d,{prop:"withVideo",label:t.$t("block.withVideo"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.withVideo,"onUpdate:modelValue":u[17]||(u[17]=o=>a.value.withVideo=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"videoRequired",label:t.$t("block.videoRequired"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.videoRequired,"onUpdate:modelValue":u[18]||(u[18]=o=>a.value.videoRequired=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"enabled",label:t.$t("block.enabled"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:l(()=>[e(b,{modelValue:a.value.enabled,"onUpdate:modelValue":u[19]||(u[19]=o=>a.value.enabled=o)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1}),e(r,{span:12},{default:l(()=>[e(d,{prop:"recommendable",rules:{required:!0,message:()=>t.$t("v.required")}},{label:l(()=>[e(X,{message:"block.recommendable"})]),default:l(()=>[e(b,{modelValue:a.value.recommendable,"onUpdate:modelValue":u[20]||(u[20]=o=>a.value.recommendable=o)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1})]),_:2},1024)]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","model-value"])}}}),Se={class:"mb-3"},Be={class:"mt-3 app-block"},De={key:1},Me={key:1},Te=z({name:"BlockList",__name:"BlockList",setup(B){const{t:D}=Y(),a=$({}),t=$(),u=$(),w=$([]),d=$([]),r=$(!1),U=$(!1),E=$(),b=J(()=>w.value.map(s=>s.id)),I=$(!1),y=async()=>{r.value=!0;try{w.value=await $e({...x(a.value),Q_OrderBy:t.value}),I.value=Object.values(a.value).filter(s=>s!==void 0&&s!=="").length>0||t.value!==void 0}finally{r.value=!1}};K(y);const k=({column:s,prop:n,order:q})=>{var R;n&&q?t.value=((R=s.sortBy)!=null?R:n)+(q==="descending"?"_desc":""):t.value=void 0,y()},o=()=>y(),_=()=>{u.value.clearSort(),ee(a.value),t.value=void 0,y()},h=()=>{E.value=void 0,U.value=!0},H=s=>{E.value=s,U.value=!0},L=async s=>{await F(s),y(),ue.success(D("success"))},N=async(s,n)=>{const q=oe(s,w.value,n);await ke(q.map(R=>R.id))};return(s,n)=>{const q=ae,R=me,g=de,c=re,A=ne,P=se;return f(),C("div",null,[W("div",Se,[e(m(qe),{params:a.value,onSearch:o,onReset:_},{default:l(()=>[e(m(Ve),{label:s.$t("block.name"),name:"Q_Contains_name"},null,8,["label"])]),_:1},8,["params"])]),W("div",null,[e(q,{type:"primary",disabled:m(S)("block:create"),icon:m(le),onClick:n[0]||(n[0]=()=>h())},{default:l(()=>[v(p(s.$t("add")),1)]),_:1},8,["disabled","icon"]),e(R,{title:s.$t("confirmDelete"),onConfirm:n[1]||(n[1]=()=>L(d.value.map(i=>i.id)))},{reference:l(()=>[e(q,{disabled:d.value.length<=0||m(S)("block:delete"),icon:m(te)},{default:l(()=>[v(p(s.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(we,{disabled:d.value.length<=0||I.value||m(S)("org:update"),class:"ml-2",onMove:n[2]||(n[2]=i=>N(d.value,i))},null,8,["disabled"]),e(m(ye),{name:"block",class:"ml-2"})]),W("div",Be,[ie((f(),V(A,{ref_key:"table",ref:u,data:w.value,onSelectionChange:n[3]||(n[3]=i=>d.value=i),onRowDblclick:n[4]||(n[4]=i=>H(i.id)),onSortChange:k},{default:l(()=>[e(m(ce),{name:"block"},{default:l(()=>[e(g,{type:"selection",width:"38"}),e(g,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(g,{property:"name",label:s.$t("block.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(g,{property:"alias",label:s.$t("block.alias"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(g,{property:"scope",label:s.$t("block.scope"),sortable:"custom",formatter:i=>s.$t("block.scope.".concat(i.scope))},{default:l(({row:i})=>[i.scope===2?(f(),V(c,{key:0,type:"success",size:"small"},{default:l(()=>[v(p(s.$t("block.scope.".concat(i.scope))),1)]),_:2},1024)):(f(),V(c,{key:1,type:"info",size:"small"},{default:l(()=>[v(p(s.$t("block.scope.".concat(i.scope))),1)]),_:2},1024))]),_:1},8,["label","formatter"]),e(g,{property:"withSubtitle",label:s.$t("block.withSubtitle"),sortable:"custom",display:"none"},{default:l(({row:i})=>[e(c,{type:i.withSubtitle?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.withSubtitle?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(g,{property:"withDescription",label:s.$t("block.withDescription"),display:"none",sortable:"custom"},{default:l(({row:i})=>[e(c,{type:i.withDescription?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.withDescription?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(g,{property:"withImage",label:s.$t("block.withImage"),sortable:"custom"},{default:l(({row:i})=>[i.withImage?(f(),C("span",De,p("".concat(i.imageWidth," * ").concat(i.imageHeight)),1)):(f(),V(c,{key:0,type:i.withImage?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.withImage?"yes":"no")),1)]),_:2},1032,["type"]))]),_:1},8,["label"]),e(g,{property:"withMobileImage",label:s.$t("block.withMobileImage"),sortable:"custom","min-width":"120",display:"none"},{default:l(({row:i})=>[i.withMobileImage?(f(),C("span",Me,p("".concat(i.mobileImageWidth," * ").concat(i.mobileImageHeight)),1)):(f(),V(c,{key:0,type:i.withMobileImage?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.withMobileImage?"yes":"no")),1)]),_:2},1032,["type"]))]),_:1},8,["label"]),e(g,{property:"recommendable",label:s.$t("block.recommendable"),sortable:"custom"},{default:l(({row:i})=>[e(c,{type:i.recommendable?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.recommendable?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(g,{property:"enabled",label:s.$t("block.enabled"),sortable:"custom"},{default:l(({row:i})=>[e(c,{type:i.enabled?"success":"info",size:"small"},{default:l(()=>[v(p(s.$t(i.enabled?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(g,{label:s.$t("table.action")},{default:l(({row:i})=>[e(q,{type:"primary",disabled:m(S)("block:update"),size:"small",link:"",onClick:()=>H(i.id)},{default:l(()=>[v(p(s.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(R,{title:s.$t("confirmDelete"),onConfirm:()=>L([i.id])},{reference:l(()=>[e(q,{type:"primary",disabled:m(S)("block:delete"),size:"small",link:""},{default:l(()=>[v(p(s.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[P,r.value]])]),e(Ee,{modelValue:U.value,"onUpdate:modelValue":n[5]||(n[5]=i=>U.value=i),"bean-id":E.value,"bean-ids":b.value,onFinished:y},null,8,["modelValue","bean-id","bean-ids"])])}}});export{Te as default};
