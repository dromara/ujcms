System.register(["./index-legacy-DywSgIaj.js","./sortable.esm-legacy-xUcotENm.js","./tree-legacy-D1Cv8xKE.js","./content-legacy-C0HQ2q9C.js","./system-legacy-nwegyeWm.js","./QueryItem.vue_vue_type_script_setup_true_lang-legacy-Byo3duh5.js","./config-legacy-DGGA2fzV.js","./data-legacy-BFsWLfCW.js","./FieldItem.vue_vue_type_script_setup_true_lang-legacy-BJUSlODe.js","./DialogForm.vue_vue_type_script_setup_true_lang-legacy-C3VGk7HF.js","./Tinymce-legacy-oURtVhhA.js","./TuiEditor-legacy-BjwgwAur.js","./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-legacy-DM1CTgFT.js","./vuedraggable.umd-legacy-Cf7q6G-3.js","./BaseUpload.vue_vue_type_style_index_0_scoped_bf818630_lang-legacy-DiuVfy3G.js","./BaseUpload-legacy-J8SCtRkN.js","./index-legacy-CDx1Huws.js"],(function(e,l){"use strict";var a,n,t,u,d,o,s,r,i,c,v,m,p,h,b,y,f,g,_,w,V,k,$,C,q,T,x,U,M,K,I,S,D,j,E,F,B,R,z,O,P,L,N,Q,J,A,H,G,W,X,Y,Z,ee,le,ae,ne,te,ue,de,oe,se,re,ie,ce,ve,me,pe,he,be,ye,fe,ge,_e,we,Ve,ke,$e,Ce;return{setters:[e=>{a=e.d,n=e.p,t=e.r,u=e.aa,d=e.V,o=e.v,s=e.b,r=e.e,i=e.f,c=e.w,v=e.i,m=e.j,p=e.ao,h=e.n,b=e.t,y=e.h,f=e.K,g=e.a7,_=e.a8,w=e.k,V=e.a5,k=e.u,$=e.c,C=e.g,q=e.E,T=e.a9,x=e.o,U=e.aJ,M=e.aA,K=e.aB,I=e.aK,S=e.aL,D=e.U,j=e.ae,E=e.aq,F=e.ai,B=e.aM,R=e.aN,z=e.aO,O=e.aP,P=e.af,L=e.aD,N=e.aI},e=>{Q=e.S},e=>{J=e.c,A=e.d,H=e.t,G=e.f},e=>{W=e.H,X=e.I,Y=e.e,Z=e.J,ee=e.d,le=e.K,ae=e.L,ne=e.M,te=e.N,ue=e.O,de=e.P,oe=e.Q,se=e.R,re=e.S},e=>{ie=e.e,ce=e.f},e=>{ve=e._,me=e.a,pe=e.b,he=e.c},e=>{be=e.q,ye=e.b},e=>{fe=e.a,ge=e.m,_e=e.g},e=>{we=e._},e=>{Ve=e._},e=>{ke=e.T},e=>{$e=e.T},e=>{Ce=e.a},null,null,null,null],execute:function(){var l=document.createElement("style");l.textContent=".sortable-chosen td{border-top-width:2px;--tw-border-opacity: 1;border-top-color:rgb(243 209 158 / var(--tw-border-opacity, 1))}\n/*$vite$:1*/",document.head.appendChild(l);const qe={class:"w-full"},Te=a({name:"ChannelForm",__name:"ChannelForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parent:{type:Object,default:null}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){const a=e,V=l,{modelValue:k,parent:$}=n(a),C=t(),q=t({}),T=t([]),x=t([]),U=t([]),M=t([]),K=t([]),I=t([]),S=t([]),D=t([]),j=t(),E=u((()=>M.value.find((e=>e.id===j.value)))),F=u((()=>fe(ge(_e().channel.mains,E.value?.mains,"channel")))),B=u((()=>fe(ge(_e().channel.asides,E.value?.asides,"channel")))),R=u((()=>JSON.parse(E.value?.customs||"[]"))),z=u((()=>{const e=J(U.value,q.value.id);return d.allChannelPermission?e:A(e,I.value)})),O=async()=>{U.value=H(await ee())},P=async()=>{await O(),V("finished")};o(k,(()=>{k.value&&(j.value=$.value?.articleModelId??M.value[0]?.id,(async()=>{I.value=await W()})(),(async()=>{M.value=await be({type:"channel"}),null==j.value&&M.value.length>0&&(j.value=M.value[0].id)})(),(async()=>{K.value=await be({type:"article"})})(),(async()=>{S.value=await X()})(),(async()=>{D.value=await Y()})(),(async()=>{d.epRank>0&&(T.value=await ie({category:"sys_article",deployed:!0}))})(),(async()=>{d.epRank>=3&&(x.value=await ye())})())})),o(R,(()=>{L(q.value.customs)}));const L=e=>(R.value.forEach((l=>{null==e[l.code]&&(e[l.code]=l.defaultValue,null!=l.defaultValueKey&&(e[l.code+"Key"]=l.defaultValueKey))})),e);return(l,a)=>{const n=s("el-input"),t=s("el-form-item"),u=s("el-col"),o=s("el-checkbox"),V=s("el-option"),k=s("el-select"),U=s("el-switch"),E=s("el-radio"),L=s("el-radio-group"),N=s("el-row"),Q=s("el-tree-select"),J=s("el-input-number"),A=s("el-tab-pane"),H=s("el-tabs");return r(),i(Ve,{values:q.value,"onUpdate:values":a[26]||(a[26]=e=>q.value=e),name:l.$t("menu.content.channel"),"query-bean":m(te),"create-bean":m(ne),"update-bean":m(ae),"delete-bean":m(le),"bean-id":e.beanId,"bean-ids":e.beanIds,focus:C.value,"init-values":(e,l)=>({parentId:l?e?.parentId:m($)?.id??e?.parentId,type:1,channelModelId:e?.channelModelId??m($)?.channelModelId??M.value[0]?.id,articleModelId:e?.articleModelId??m($)?.articleModelId??K.value[0]?.id,nav:e?.nav??m($)?.nav??!0,channelTemplate:e?.channelTemplate??m($)?.channelTemplate??S.value[0],articleTemplate:e?.articleTemplate??m($)?.articleTemplate??D.value[0],pageSize:20,allowComment:e?.allowComment??m($)?.allowComment??!0,allowContribute:e?.allowContribute??m($)?.allowContribute??!0,allowSearch:e?.allowSearch??m($)?.allowSearch??!0,orderDesc:e?.orderDesc??m($)?.orderDesc??!0,customs:{}}),"to-values":e=>({...e}),perms:"channel","model-value":e.modelValue,"disable-edit":e=>!m(d).allChannelPermission&&null!=e.id&&!I.value.includes(e.id),"label-width":"120px",large:"","onUpdate:modelValue":a[27]||(a[27]=e=>l.$emit("update:modelValue",e)),onFinished:P,onBeanChange:a[28]||(a[28]=async e=>{j.value=e?.channelModelId??m($)?.channelModelId??K.value[0]?.id,await O()})},{default:c((({bean:e,isEdit:s})=>[v(N,null,{default:c((()=>[v(u,{span:18},{default:c((()=>[v(N,null,{default:c((()=>[v(u,{span:F.value.name.double?12:24},{default:c((()=>[v(t,{prop:"name",label:F.value.name.name??l.$t("channel.name"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:c((()=>[v(n,{ref_key:"focus",ref:C,modelValue:q.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.name=e),maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["span"]),v(u,{span:F.value.alias.double?12:24},{default:c((()=>[v(t,{prop:"alias",rules:[{required:!0,message:()=>l.$t("v.required")},{pattern:/^[\w-]*$/,message:()=>l.$t("channel.error.aliasPattern")},{asyncValidator:async(a,n,t)=>{n!==e.alias&&await m(Z)(n)?t(l.$t("channel.error.aliasExist")):t()}}]},{label:c((()=>[v(p,{label:F.value.alias.name??l.$t("channel.alias"),message:"channel.alias",help:""},null,8,["label"])])),default:c((()=>[v(n,{modelValue:q.value.alias,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.alias=e),maxlength:"50"},null,8,["modelValue"])])),_:2},1032,["rules"])])),_:2},1032,["span"]),3===q.value.type?(r(),i(u,{key:0,span:F.value.linkUrl.double?12:24},{default:c((()=>[v(t,{prop:"linkUrl",rules:[{required:!0,message:()=>l.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>l.$t("channel.error.linkUrl")}]},{label:c((()=>[v(p,{label:F.value.linkUrl.name??l.$t("channel.linkUrl"),message:"channel.linkUrl",help:""},null,8,["label"])])),default:c((()=>[v(n,{modelValue:q.value.linkUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value.linkUrl=e),maxlength:"255"},{append:c((()=>[v(o,{modelValue:q.value.targetBlank,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.targetBlank=e)},{default:c((()=>[h(b(l.$t("channel.targetBlank")),1)])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0),q.value.type<3?(r(),f(g,{key:1},[F.value.seoTitle.show?(r(),i(u,{key:0,span:F.value.seoTitle.double?12:24},{default:c((()=>[v(t,{prop:"seoTitle",rules:F.value.seoTitle.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:F.value.seoTitle.name??l.$t("channel.seoTitle"),message:"channel.seoTitle",help:""},null,8,["label"])])),default:c((()=>[v(n,{modelValue:q.value.seoTitle,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value.seoTitle=e),maxlength:"150"},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0),F.value.seoKeywords.show?(r(),i(u,{key:1,span:F.value.seoKeywords.double?12:24},{default:c((()=>[v(t,{prop:"seoKeywords",rules:F.value.seoKeywords.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:F.value.seoKeywords.name??l.$t("channel.seoKeywords"),message:"channel.seoKeywords",help:""},null,8,["label"])])),default:c((()=>[v(n,{modelValue:q.value.seoKeywords,"onUpdate:modelValue":a[5]||(a[5]=e=>q.value.seoKeywords=e),maxlength:"150"},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0),F.value.seoDescription.show?(r(),i(u,{key:2,span:F.value.seoDescription.double?12:24},{default:c((()=>[v(t,{prop:"seoDescription",rules:F.value.seoDescription.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:F.value.seoDescription.name??l.$t("channel.seoDescription"),message:"channel.seoDescription",help:""},null,8,["label"])])),default:c((()=>[v(n,{modelValue:q.value.seoDescription,"onUpdate:modelValue":a[6]||(a[6]=e=>q.value.seoDescription=e),maxlength:"1000"},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0)],64)):y("",!0),F.value.image.show?(r(),i(u,{key:2,span:F.value.image.double?12:24},{default:c((()=>[v(t,{prop:"image",label:F.value.image.name??l.$t("channel.image"),rules:F.value.image.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{default:c((()=>[v(m(Ce),{modelValue:q.value.image,"onUpdate:modelValue":a[7]||(a[7]=e=>q.value.image=e),height:F.value.image.imageHeight,width:F.value.image.imageWidth,mode:F.value.image.imageMode},null,8,["modelValue","height","width","mode"])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0),F.value.channelModel.show?(r(),i(u,{key:3,span:F.value.channelModel.double?12:24},{default:c((()=>[v(t,{prop:"channelModelId",label:F.value.channelModel.name??l.$t("channel.channelModel"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:c((()=>[v(k,{modelValue:q.value.channelModelId,"onUpdate:modelValue":a[8]||(a[8]=e=>q.value.channelModelId=e),class:"w-full",onChange:a[9]||(a[9]=e=>{j.value=e})},{default:c((()=>[(r(!0),f(g,null,_(M.value,(e=>(r(),i(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0),F.value.articleModel.show?(r(),i(u,{key:4,span:F.value.articleModel.double?12:24},{default:c((()=>[v(t,{prop:"articleModelId",label:F.value.articleModel.name??l.$t("channel.articleModel"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:c((()=>[v(k,{modelValue:q.value.articleModelId,"onUpdate:modelValue":a[10]||(a[10]=e=>q.value.articleModelId=e),class:"w-full"},{default:c((()=>[(r(!0),f(g,null,_(K.value,(e=>(r(),i(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0),[3,4,5].includes(q.value.type)?y("",!0):(r(),f(g,{key:5},[F.value.channelTemplate.show?(r(),i(u,{key:0,span:F.value.channelTemplate.double?12:24},{default:c((()=>[v(t,{prop:"channelTemplate",label:F.value.channelTemplate.name??l.$t("channel.channelTemplate"),rules:F.value.channelTemplate.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{default:c((()=>[v(k,{modelValue:q.value.channelTemplate,"onUpdate:modelValue":a[11]||(a[11]=e=>q.value.channelTemplate=e),class:"w-full"},{default:c((()=>[(r(!0),f(g,null,_(S.value,(e=>(r(),i(V,{key:e,label:e+".html",value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0),F.value.articleTemplate.show?(r(),i(u,{key:1,span:F.value.articleTemplate.double?12:24},{default:c((()=>[v(t,{prop:"articleTemplate",label:F.value.articleTemplate.name??l.$t("channel.articleTemplate"),rules:F.value.articleTemplate.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{default:c((()=>[v(k,{modelValue:q.value.articleTemplate,"onUpdate:modelValue":a[12]||(a[12]=e=>q.value.articleTemplate=e),class:"w-full"},{default:c((()=>[(r(!0),f(g,null,_(D.value,(e=>(r(),i(V,{key:e,label:e+".html",value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0)],64)),F.value.nav.show?(r(),i(u,{key:6,span:F.value.nav.double?12:24},{default:c((()=>[v(t,{prop:"nav",rules:F.value.nav.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:F.value.nav.name??l.$t("channel.nav"),message:"channel.nav",help:""},null,8,["label"])])),default:c((()=>[v(U,{modelValue:q.value.nav,"onUpdate:modelValue":a[13]||(a[13]=e=>q.value.nav=e)},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0),F.value.allowSearch.show?(r(),i(u,{key:7,span:F.value.allowSearch.double?12:24},{default:c((()=>[v(t,{prop:"allowSearch",rules:F.value.allowSearch.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:F.value.allowSearch.name??l.$t("channel.allowSearch"),message:"channel.allowSearch",help:""},null,8,["label"])])),default:c((()=>[v(U,{modelValue:q.value.allowSearch,"onUpdate:modelValue":a[14]||(a[14]=e=>q.value.allowSearch=e)},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["span"])):y("",!0),(r(!0),f(g,null,_(R.value,(e=>(r(),i(u,{key:e.code,span:e.double?12:24},{default:c((()=>[v(t,{prop:`customs.${e.code}`,rules:e.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{label:c((()=>[v(p,{label:e.name},null,8,["label"])])),default:c((()=>[v(we,{modelValue:q.value.customs[e.code],"onUpdate:modelValue":l=>q.value.customs[e.code]=l,"model-key":q.value.customs[e.code+"Key"],"onUpdate:modelKey":l=>q.value.customs[e.code+"Key"]=l,field:e},null,8,["modelValue","onUpdate:modelValue","model-key","onUpdate:modelKey","field"])])),_:2},1032,["prop","rules"])])),_:2},1032,["span"])))),128)),2===q.value.type?(r(),i(u,{key:8,span:F.value.text.double?12:24},{default:c((()=>[v(t,{prop:"text",label:F.value.text.name??l.$t("channel.text"),rules:F.value.text.required?{required:!0,message:()=>l.$t("v.required")}:void 0},{default:c((()=>[w("div",qe,[F.value.text.editorSwitch?(r(),i(L,{key:0,modelValue:q.value.editorType,"onUpdate:modelValue":a[15]||(a[15]=e=>q.value.editorType=e),class:"mr-6",onChange:a[16]||(a[16]=()=>q.value.markdown="")},{default:c((()=>[(r(),f(g,null,_([1,2],(e=>v(E,{key:e,value:e},{default:c((()=>[h(b(l.$t(`model.field.editorType.${e}`)),1)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])):y("",!0),2===q.value.editorType?(r(),i(m($e),{key:1,modelValue:q.value.markdown,"onUpdate:modelValue":a[17]||(a[17]=e=>q.value.markdown=e),html:q.value.text,"onUpdate:html":a[18]||(a[18]=e=>q.value.text=e),class:"leading-6"},null,8,["modelValue","html"])):(r(),i(m(ke),{key:2,ref:"tinyText",modelValue:q.value.text,"onUpdate:modelValue":a[19]||(a[19]=e=>q.value.text=e)},null,8,["modelValue"]))])])),_:1},8,["label","rules"])])),_:1},8,["span"])):y("",!0)])),_:2},1024)])),_:2},1024),v(u,{span:6},{default:c((()=>[v(H,{type:"border-card",class:"ml-5"},{default:c((()=>[v(A,{label:l.$t("channel.tabs.setting")},{default:c((()=>[v(t,{prop:"parentId",label:B.value.parent.name??l.$t("channel.parent"),"label-position":"top"},{default:c((()=>[v(Q,{modelValue:q.value.parentId,"onUpdate:modelValue":a[20]||(a[20]=e=>q.value.parentId=e),data:z.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"render-after-expand":!1,disabled:s,placeholder:"","check-strictly":"",clearable:"",class:"w-full"},null,8,["modelValue","data","disabled"])])),_:2},1032,["label"]),v(t,{prop:"type",label:B.value.type.name??l.$t("channel.type"),rules:{required:!0,message:()=>l.$t("v.required")},"label-position":"top"},{default:c((()=>[v(k,{modelValue:q.value.type,"onUpdate:modelValue":a[21]||(a[21]=e=>q.value.type=e),class:"w-full"},{default:c((()=>[(r(),f(g,null,_([1,2,3,4],(e=>v(V,{key:e,label:l.$t(`channel.type.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"]),v(t,{prop:"processKey",label:B.value.processKey.name??l.$t("channel.processKey"),rules:B.value.processKey.required?{required:!0,message:()=>l.$t("v.required")}:void 0,"label-position":"top"},{default:c((()=>[v(k,{modelValue:q.value.processKey,"onUpdate:modelValue":a[22]||(a[22]=e=>q.value.processKey=e),clearable:"",class:"w-full"},{default:c((()=>[(r(!0),f(g,null,_(T.value,(e=>(r(),i(V,{key:e.key,label:e.name,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"]),m(d).epRank>=3&&B.value.performanceType.show?(r(),i(t,{key:0,prop:"performanceType",label:B.value.performanceType.name??l.$t("channel.performanceType"),rules:B.value.performanceType.required?{required:!0,message:()=>l.$t("v.required")}:void 0,"label-position":"top"},{default:c((()=>[v(k,{modelValue:q.value.performanceTypeId,"onUpdate:modelValue":a[23]||(a[23]=e=>q.value.performanceTypeId=e),clearable:"",class:"w-full"},{default:c((()=>[(r(!0),f(g,null,_(x.value,(e=>(r(),i(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label","rules"])):y("",!0),v(t,{prop:"pageSize",label:B.value.pageSize.name??l.$t("channel.pageSize"),rules:{required:!0,message:()=>l.$t("v.required")},"label-position":"top"},{default:c((()=>[v(J,{modelValue:q.value.pageSize,"onUpdate:modelValue":a[24]||(a[24]=e=>q.value.pageSize=e),min:1,max:200},null,8,["modelValue"])])),_:1},8,["label","rules"]),v(t,{prop:"orderDesc",rules:{required:!0,message:()=>l.$t("v.required")},"label-position":"top"},{label:c((()=>[v(p,{label:B.value.orderDesc.name??l.$t("channel.orderDesc"),message:"channel.orderDesc",help:""},null,8,["label"])])),default:c((()=>[v(U,{modelValue:q.value.orderDesc,"onUpdate:modelValue":a[25]||(a[25]=e=>q.value.orderDesc=e)},null,8,["modelValue"])])),_:1},8,["rules"])])),_:2},1032,["label"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","model-value","disable-edit"])}}}),xe={class:"text-lg text-center"},Ue={class:"flex items-center justify-center"},Me={class:"text-lg text-center"},Ke={class:"mt-5"},Ie=a({name:"ChannelMoveForm",__name:"ChannelMoveForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:T({"update:modelValue":null,finished:null},["update:modelValue"]),setup(e){const l=V(e,"modelValue"),{t:a}=k(),n=t(!1),u=t([]),d=t([]),m=t(),p=t(),T=t("inner"),x=t(),U=async()=>{n.value=!0;try{const e=await ee(),l=[];e.forEach((e=>{l.push({...e})})),u.value=H(e),d.value=H(l)}finally{n.value=!1}};o(l,(async()=>{l.value&&U()}));const M=(e,l,a)=>{l=l||a.includes(e.id),e.disabled=l,e.children?.forEach((e=>{M(e,l,a)}))},K=()=>{x.value=void 0;const e=m.value.getCheckedKeys();e.includes(p.value.getCheckedKeys()[0])&&p.value.setCheckedKeys([]),d.value.forEach((l=>{M(l,!1,e)}))},I=(e,l)=>{x.value=void 0,l.checkedKeys.length>1&&p.value.setCheckedKeys([e.id])};return(e,t)=>{const o=s("el-tree"),V=s("el-col"),k=s("el-option"),M=s("el-select"),S=s("el-row"),D=s("el-alert"),j=s("el-button"),E=s("el-dialog"),F=$("loading");return r(),i(E,{modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value=e),title:e.$t("channel.op.batchMove"),width:"768",top:"5vh",onClose:t[3]||(t[3]=l=>e.$emit("finished"))},{default:c((()=>[v(S,{gutter:20},{default:c((()=>[v(V,{span:12},{default:c((()=>[w("div",xe,b(e.$t("channel.batchMove.srcChannel")),1),C(v(o,{ref_key:"srcTree",ref:m,data:u.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:K},null,8,["data"]),[[F,n.value]])])),_:1}),v(V,{span:12},{default:c((()=>[w("div",Ue,[w("div",Me,b(e.$t("channel.batchMove.moveTo")),1),v(M,{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value=e),class:"w-32 ml-2"},{default:c((()=>[(r(),f(g,null,_(["inner","before","after"],(l=>v(k,{key:l,label:e.$t(`channel.batchMove.moveTo.${l}`),value:l},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),C(v(o,{ref_key:"targetTree",ref:p,data:d.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:I},null,8,["data"]),[[F,n.value]])])),_:1})])),_:1}),w("div",Ke,[x.value?(r(),i(D,{key:0,title:x.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):y("",!0),v(j,{type:"primary",onClick:t[1]||(t[1]=()=>(async()=>{const e=m.value.getCheckedKeys();if(e.length<=0)return void(x.value=a("channel.error.srcChannelRequired"));const l=p.value.getCheckedKeys()[0];null!=l?(await ue(e,l,T.value),U(),q.success(a("success"))):x.value=a("channel.error.moveToChannelRequired")})())},{default:c((()=>[h(b(e.$t("submit")),1)])),_:1})])])),_:1},8,["modelValue","title"])}}}),Se={class:"text-lg text-center"},De={class:"flex items-center justify-center"},je={class:"text-lg text-center"},Ee={class:"mt-5"},Fe=a({name:"ChannelMergeForm",__name:"ChannelMergeForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:T({"update:modelValue":null,finished:null},["update:modelValue"]),setup(e){const l=V(e,"modelValue"),{t:a}=k(),n=t(!1),u=t([]),d=t([]),m=t(),p=t(),f=t(),g=async()=>{n.value=!0;try{const e=await ee(),l=[];e.forEach((e=>{l.push({...e})})),u.value=H(e),d.value=H(l)}finally{n.value=!1}};o(l,(async()=>{l.value&&g()}));const _=(e,l,a)=>{l=l||a.includes(e.id),e.disabled=l,e.children?.forEach((e=>{_(e,l,a)}))},T=()=>{f.value=void 0;const e=m.value.getCheckedKeys();e.includes(p.value.getCheckedKeys()[0])&&p.value.setCheckedKeys([]),d.value.forEach((l=>{_(l,!1,e)}))},x=(e,l)=>{f.value=void 0,l.checkedKeys.length>1&&p.value.setCheckedKeys([e.id])};return(e,t)=>{const o=s("el-tree"),_=s("el-col"),V=s("el-row"),k=s("el-alert"),U=s("el-button"),M=s("el-dialog"),K=$("loading");return r(),i(M,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),title:e.$t("channel.op.batchMerge"),width:"768",top:"5vh",onClose:t[2]||(t[2]=l=>e.$emit("finished"))},{default:c((()=>[v(V,{gutter:20},{default:c((()=>[v(_,{span:12},{default:c((()=>[w("div",Se,b(e.$t("channel.batchMerge.srcChannel")),1),C(v(o,{ref_key:"srcTree",ref:m,data:u.value,props:{label:"name"},"node-key":"id","show-checkbox":"",onCheck:T},null,8,["data"]),[[K,n.value]])])),_:1}),v(_,{span:12},{default:c((()=>[w("div",De,[w("div",je,b(e.$t("channel.batchMerge.mergeTo")),1)]),C(v(o,{ref_key:"targetTree",ref:p,data:d.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:x},null,8,["data"]),[[K,n.value]])])),_:1})])),_:1}),w("div",Ee,[f.value?(r(),i(k,{key:0,title:f.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):y("",!0),v(U,{type:"primary",onClick:t[0]||(t[0]=()=>(async()=>{const e=m.value.getCheckedKeys();if(e.length<=0)return void(f.value=a("channel.error.srcChannelRequired"));const l=p.value.getCheckedKeys()[0];null!=l?(await de(e,l),g(),q.success(a("success"))):f.value=a("channel.error.moveToChannelRequired")})())},{default:c((()=>[h(b(e.$t("submit")),1)])),_:1})])])),_:1},8,["modelValue","title"])}}}),Be={class:"flex justify-between mx-2 mt-1"},Re={class:"mb-3"},ze={class:"mt-3 app-block"};e("default",a({name:"ChannelList",__name:"ChannelList",setup(e){const{t:l}=k(),a=t({}),n=t(),p=t(),y=t([]),f=t([]),g=t(!1),_=t(!1),V=t(),T=t(),J=u((()=>G(y.value).map((e=>e.id)))),A=t([]),X=t([]),Y=t(!1),Z=t(!1),ae=t(),ne=t([]),te=t(!1),ue=t(),de=t(),ie=t(!1),be=t(!1),ye=e=>d.allChannelPermission||A.value.includes(e.id);o(ue,(e=>{ae.value.filter(e)}));const fe=async()=>{te.value=!0;try{ne.value=H(await ee()),U((()=>{null!=ue.value&&ae.value.filter(ue.value),ae.value.setCurrentKey(de.value?.id)}))}finally{te.value=!1}},ge=async()=>{g.value=!0;try{Y.value=void 0!==n.value;const e=Object.values(a.value).filter((e=>void 0!==e&&""!==e)).length>0;y.value=await ee({...M(a.value),parentId:de.value?.id,isIncludeSelf:!0,isIncludeChildren:e,Q_OrderBy:n.value}),e||Y.value||(y.value=H(y.value))}finally{g.value=!1}},_e=()=>{fe(),ge()},we=async()=>{A.value=await W()};let Ve;x((()=>{_e(),(async()=>{d.epRank>0&&(X.value=await ce({category:"sys_article",latestVersion:!0}))})(),we(),(()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");Ve=Q.create(e,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(e){const{oldIndex:a,newIndex:n}=e;if(a!==n){let e=a,t=n,u=y.value;const d=u[0]?.children;d?.length>0&&(u=d,e-=1,t-=1),await oe(u[e].id,u[t].id,e>t?"before":"after"),fe(),u.splice(t,0,u.splice(e,1)[0]),q.success(l("success"))}}})})()})),K((()=>{void 0!==Ve&&Ve.destroy()}));const ke=({column:e,prop:l,order:a})=>{n.value=l&&a?(e.sortBy??l)+("descending"===a?"_desc":""):void 0,_e()},$e=()=>{_e(),we()},Ce=()=>ge(),qe=()=>{p.value.clearSort(),N(a.value),n.value=void 0,ge()},xe=e=>{T.value=void 0,V.value=e??de.value,_.value=!0},Ue=e=>{D("channel:update")&&(T.value=e,V.value=null,_.value=!0)},Me=async e=>{await le(e),_e(),q.success(l("success"))},Ke=async(e,l,a)=>{"none"!==a&&(await oe(e.data.id,l.data.id,a),ge())},Se=async e=>{Z.value?(de.value!=e.parent&&(de.value=e.parent,await ge()),Ue(e.id)):(de.value=e,Ce())},De=(e,l)=>!e||l.name.includes(e),je=()=>{ae.value.setCurrentKey(null),de.value=void 0,Ce()};return(e,n)=>{const t=s("el-input"),u=s("el-button"),d=s("el-switch"),o=s("el-tooltip"),k=s("el-tree"),x=s("el-scrollbar"),U=s("el-aside"),M=s("el-popconfirm"),K=s("el-icon"),N=s("el-table-column"),Q=s("el-table"),A=s("el-main"),H=s("el-container"),G=$("loading");return r(),i(H,null,{default:c((()=>[v(U,{width:"220px",class:"pr-3"},{default:c((()=>[v(x,{class:"p-2 bg-white rounded-sm"},{default:c((()=>[v(t,{modelValue:ue.value,"onUpdate:modelValue":n[0]||(n[0]=e=>ue.value=e),"suffix-icon":m(I),size:"small"},null,8,["modelValue","suffix-icon"]),w("div",Be,[v(u,{type:null==de.value?"primary":void 0,link:"",onClick:je},{default:c((()=>[h(b(e.$t("channel.root")),1)])),_:1},8,["type"]),v(o,{content:e.$t("editMode"),placement:"top"},{default:c((()=>[v(d,{modelValue:Z.value,"onUpdate:modelValue":n[1]||(n[1]=e=>Z.value=e),"active-action-icon":m(S),"inactive-action-icon":m(S)},null,8,["modelValue","active-action-icon","inactive-action-icon"])])),_:1},8,["content"])]),C(v(k,{ref_key:"channelTree",ref:ae,data:ne.value,props:{label:"name"},"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:m(D)("channel:update"),"filter-node-method":De,onNodeClick:Se,onNodeDragEnd:Ke},null,8,["data","draggable"]),[[G,te.value]])])),_:1})])),_:1}),v(A,{class:"p-0"},{default:c((()=>[w("div",Re,[v(m(ve),{params:a.value,onSearch:Ce,onReset:qe},{default:c((()=>[v(m(me),{label:e.$t("channel.name"),name:"Q_Contains_name"},null,8,["label"]),v(m(me),{label:e.$t("channel.alias"),name:"Q_Contains_alias"},null,8,["label"])])),_:1},8,["params"])]),w("div",null,[v(u,{type:"primary",disabled:m(E)("channel:create"),icon:m(j),onClick:n[2]||(n[2]=()=>xe(void 0))},{default:c((()=>[h(b(e.$t("add")),1)])),_:1},8,["disabled","icon"]),v(M,{title:e.$t("confirmDelete"),onConfirm:n[3]||(n[3]=()=>Me(f.value.map((e=>e.id))))},{reference:c((()=>[v(u,{disabled:f.value.length<=0||m(E)("channel:delete"),icon:m(F)},{default:c((()=>[h(b(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),v(u,{disabled:m(E)("channel:update"),icon:m(B),onClick:n[4]||(n[4]=()=>ie.value=!0)},{default:c((()=>[h(b(e.$t("channel.op.batchMove")),1)])),_:1},8,["disabled","icon"]),v(u,{disabled:m(E)("channel:update"),icon:m(R),onClick:n[5]||(n[5]=()=>be.value=!0)},{default:c((()=>[h(b(e.$t("channel.op.batchMerge")),1)])),_:1},8,["disabled","icon"]),v(u,{disabled:m(E)("channel:tidyTree"),icon:m(z),onClick:n[6]||(n[6]=()=>(async()=>{await se(),_e(),q.success(l("success"))})())},{default:c((()=>[h(b(e.$t("tidyTree")),1)])),_:1},8,["disabled","icon"]),v(o,{placement:"top",content:e.$t("tidyTree.tooltip")},{default:c((()=>[v(K,{class:"ml-1 text-base align-text-bottom"},{default:c((()=>[v(m(O))])),_:1})])),_:1},8,["content"]),v(m(pe),{name:"channel",class:"ml-2"})]),w("div",ze,[C((r(),i(Q,{id:"dataTable",ref_key:"table",ref:p,"row-key":"id","default-expand-all":"",data:y.value,"row-class-name":({row:e})=>e.children?.length>0?void 0:"drag-draggable",onSelectionChange:n[7]||(n[7]=e=>f.value=e),onRowDblclick:n[8]||(n[8]=e=>Ue(e.id)),onSortChange:ke},{default:c((()=>[v(m(he),{name:"channel"},{default:c((()=>[v(N,{type:"selection",selectable:ye,width:"45"}),v(N,{property:"name",label:e.$t("channel.name"),"min-width":"80",sortable:"custom"},null,8,["label"]),v(N,{property:"alias",label:e.$t("channel.alias"),"min-width":"80",sortable:"custom"},null,8,["label"]),v(N,{property:"channelModel.name",label:e.$t("channel.channelModel"),"sort-by":"channelModel@model-name",display:"none",sortable:"custom","min-width":"60"},null,8,["label"]),v(N,{property:"articleModel.name",label:e.$t("channel.articleModel"),"sort-by":"articleModel@model-name",sortable:"custom","min-width":"60"},null,8,["label"]),v(N,{property:"processKey",label:e.$t("channel.processKey"),"min-width":"60",sortable:"custom","show-overflow-tooltip":""},{default:c((({row:e})=>[h(b(null!=e.processKey?X.value.find((l=>l.key===e.processKey))?.name:void 0),1)])),_:1},8,["label"]),v(N,{property:"nav",label:e.$t("channel.nav"),"min-width":"50"},{default:c((({row:e})=>[v(d,{modelValue:e.nav,"onUpdate:modelValue":l=>e.nav=l,size:"small",disabled:m(E)("channel:update"),onClick:()=>{return a=e.id,n=e.nav,void(D("channel:update")&&(re(a,n),q.success(l("success"))));var a,n}},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])])),_:1},8,["label"]),v(N,{property:"id",label:"ID",width:"170",sortable:"custom"}),v(N,{width:"42"},{default:c((({row:e})=>[v(K,{class:P(["text-lg align-middle",Y.value||m(E)("channel:update")||e.children?.length>0?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:c((()=>[v(m(L))])),_:2},1032,["class"])])),_:1}),v(N,{label:e.$t("table.action")},{default:c((({row:l})=>[v(u,{type:"primary",disabled:m(E)("channel:create")||!ye(l),size:"small",link:"",onClick:()=>xe(l)},{default:c((()=>[h(b(e.$t("addChild")),1)])),_:2},1032,["disabled","onClick"]),v(u,{type:"primary",disabled:m(E)("channel:update"),size:"small",link:"",onClick:()=>Ue(l.id)},{default:c((()=>[h(b(e.$t("edit")),1)])),_:2},1032,["disabled","onClick"]),v(M,{title:e.$t("confirmDelete"),onConfirm:()=>Me([l.id])},{reference:c((()=>[v(u,{type:"primary",disabled:m(E)("channel:delete")||!ye(l),size:"small",link:""},{default:c((()=>[h(b(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data","row-class-name"])),[[G,g.value]])]),v(Te,{modelValue:_.value,"onUpdate:modelValue":n[9]||(n[9]=e=>_.value=e),"bean-id":T.value,"bean-ids":J.value,parent:V.value,onFinished:$e},null,8,["modelValue","bean-id","bean-ids","parent"]),v(Ie,{modelValue:ie.value,"onUpdate:modelValue":n[10]||(n[10]=e=>ie.value=e),onFinished:$e},null,8,["modelValue"]),v(Fe,{modelValue:be.value,"onUpdate:modelValue":n[11]||(n[11]=e=>be.value=e),onFinished:$e},null,8,["modelValue"])])),_:1})])),_:1})}}}))}}}));
