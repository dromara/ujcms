import{d as O,r as v,b as r,e as Q,f as A,w as l,i as e,ao as _,K as G,a7 as le,a8 as ae,k as b,t as y,j as u,aD as R,ae as K,a$ as te,u as oe,aa as ne,o as se,aA as de,E as P,aB as ue,c as ie,aI as re,n as w,aq as E,ai as me,g as pe,af as ve,S as j,aG as be,aH as fe}from"./index-B6OoDg6B.js";import{S as ce}from"./sortable.esm-DEaZq8gs.js";import{f as J,g as _e,h as ge,i as ye,j as Ve,k as $e}from"./interaction-BCiQ8biV.js";import{a as L,_ as we,b as De,c as ke}from"./QueryItem.vue_vue_type_script_setup_true_lang-Tf1Ym-Zs.js";import{d as he}from"./vuedraggable.umd-BHO2ywuu.js";import{_ as Ce}from"./DialogForm.vue_vue_type_script_setup_true_lang-BCAZsuC3.js";const Se={class:"w-full table-auto border-slate-400"},Ue={class:""},qe={class:"w-40"},ze={class:"p-2"},Ie={class:"p-2"},Ee={class:"p-2"},Be=O({name:"VoteForm",__name:"VoteForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(B){const q=v(),o=v({});let $=-1;const z=m=>{$-=1,o.value.options.splice(m,0,{id:$,count:0})};return(m,n)=>{const h=r("el-input"),i=r("el-form-item"),p=r("el-col"),D=r("el-date-picker"),C=r("el-option"),I=r("el-select"),T=r("el-switch"),S=r("el-input-number"),g=r("el-icon"),U=r("el-button"),M=r("el-row");return Q(),A(Ce,{values:o.value,"onUpdate:values":n[10]||(n[10]=a=>o.value=a),name:m.$t("menu.interaction.vote"),"query-bean":u(ye),"create-bean":u(ge),"update-bean":u(_e),"delete-bean":u(J),"bean-id":B.beanId,"bean-ids":B.beanIds,focus:q.value,"init-values":()=>({maxChoice:0,mode:1,interval:0,total:0,enabled:!0,options:[{id:-1,count:0}]}),"to-values":a=>({...a}),"model-value":B.modelValue,perms:"vote",large:"","onUpdate:modelValue":n[11]||(n[11]=a=>m.$emit("update:modelValue",a)),onFinished:n[12]||(n[12]=()=>m.$emit("finished"))},{default:l(({})=>[e(M,null,{default:l(()=>[e(p,{span:24},{default:l(()=>[e(i,{prop:"title",rules:{required:!0,message:()=>m.$t("v.required")}},{label:l(()=>[e(_,{message:"vote.title"})]),default:l(()=>[e(h,{ref_key:"focus",ref:q,modelValue:o.value.title,"onUpdate:modelValue":n[0]||(n[0]=a=>o.value.title=a),maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(p,{span:24},{default:l(()=>[e(i,{prop:"description"},{label:l(()=>[e(_,{message:"vote.description"})]),default:l(()=>[e(h,{modelValue:o.value.description,"onUpdate:modelValue":n[1]||(n[1]=a=>o.value.description=a),type:"textarea",rows:3,maxlength:"1000"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"beginDate"},{label:l(()=>[e(_,{message:"vote.beginDate",help:""})]),default:l(()=>[e(D,{modelValue:o.value.beginDate,"onUpdate:modelValue":n[2]||(n[2]=a=>o.value.beginDate=a),type:"datetime",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"endDate"},{label:l(()=>[e(_,{message:"vote.endDate",help:""})]),default:l(()=>[e(D,{modelValue:o.value.endDate,"onUpdate:modelValue":n[3]||(n[3]=a=>o.value.endDate=a),type:"datetime",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"mode",rules:{required:!0,message:()=>m.$t("v.required")}},{label:l(()=>[e(_,{message:"vote.mode",help:""})]),default:l(()=>[e(I,{modelValue:o.value.mode,"onUpdate:modelValue":n[4]||(n[4]=a=>o.value.mode=a),class:"w-full"},{default:l(()=>[(Q(),G(le,null,ae([1,2,3],a=>e(C,{key:a,value:a,label:m.$t("vote.mode.".concat(a))},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"created"},{label:l(()=>[e(_,{message:"vote.created"})]),default:l(()=>[e(D,{modelValue:o.value.created,"onUpdate:modelValue":n[5]||(n[5]=a=>o.value.created=a),type:"datetime",class:"w-full",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"multiple"},{label:l(()=>[e(_,{message:"vote.multiple",help:""})]),default:l(()=>[e(T,{modelValue:o.value.multiple,"onUpdate:modelValue":n[6]||(n[6]=a=>o.value.multiple=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"interval",rules:{required:!0,message:()=>m.$t("v.required")}},{label:l(()=>[e(_,{message:"vote.interval",help:""})]),default:l(()=>[e(S,{modelValue:o.value.interval,"onUpdate:modelValue":n[7]||(n[7]=a=>o.value.interval=a),min:0,max:32767,class:"w-48"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"enabled"},{label:l(()=>[e(_,{message:"vote.enabled"})]),default:l(()=>[e(T,{modelValue:o.value.enabled,"onUpdate:modelValue":n[8]||(n[8]=a=>o.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(i,{prop:"times"},{label:l(()=>[e(_,{message:"vote.times"})]),default:l(()=>[e(S,{"model-value":o.value.times,disabled:"",class:"w-48"},null,8,["model-value"])]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(i,null,{label:l(()=>[e(_,{message:"vote.options"})]),default:l(()=>[b("table",Se,[b("thead",null,[b("tr",null,[n[13]||(n[13]=b("th",{class:"w-32"},null,-1)),b("th",Ue,y(m.$t("voteOption.title")),1),b("th",qe,y(m.$t("voteOption.count")),1)])]),e(u(he),{modelValue:o.value.options,"onUpdate:modelValue":n[9]||(n[9]=a=>o.value.options=a),animation:250,tag:"tbody",handle:".draggable-handle","item-key":"id"},{item:l(({element:a,index:Y})=>[b("tr",null,[b("td",ze,[e(g,{class:"text-2xl align-middle cursor-move draggable-handle"},{default:l(()=>[e(u(R))]),_:1}),e(U,{class:"ml-3",icon:u(K),circle:"",onClick:()=>z(Y+1)},null,8,["icon","onClick"]),e(U,{disabled:o.value.options.length<=1,icon:u(te),circle:"",onClick:()=>o.value.options=o.value.options.filter(k=>k.id!==a.id)},null,8,["disabled","icon","onClick"])]),b("td",Ie,[e(i,{prop:"options.".concat(Y,".title"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:l(()=>[e(h,{modelValue:a.title,"onUpdate:modelValue":k=>a.title=k,maxlength:"1000"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),b("td",Ee,[e(S,{modelValue:a.count,"onUpdate:modelValue":k=>a.count=k,min:0,max:2147483647,class:"w-48"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","model-value"])}}}),Te={class:"mb-3"},Ye={class:"mt-3 app-block"},Pe=O({name:"VoteList",__name:"VoteList",setup(B){const{t:q}=oe(),o=v({}),$=v(),z=v(1),m=v(10),n=v(0),h=v(),i=v([]),p=v([]),D=v(!1),C=v(!1),I=v(),T=ne(()=>i.value.map(t=>t.id)),S=v(!1),g=async()=>{D.value=!0;try{const{content:t,totalElements:d}=await Ve({...de(o.value),Q_OrderBy:$.value,page:z.value,pageSize:m.value});i.value=t,n.value=Number(d),S.value=$.value!==void 0}finally{D.value=!1}};let U;const M=()=>{const t=document.querySelector("#dataTable .el-table__body-wrapper tbody");U=ce.create(t,{handle:".drag-handle",animation:200,chosenClass:"sortable-chosen",onEnd:async function(d){const{oldIndex:f,newIndex:V}=d;f!==V&&(await $e(i.value[f].id,i.value[V].id),i.value.splice(V,0,i.value.splice(f,1)[0]),P.success(q("success")))}})};se(()=>{g(),M()}),ue(()=>{U!==void 0&&U.destroy()});const a=({column:t,prop:d,order:f})=>{var V;d&&f?$.value=((V=t.sortBy)!=null?V:d)+(f==="descending"?"_desc":""):$.value=void 0,g()},Y=()=>g(),k=()=>{h.value.clearSort(),re(o.value),$.value=void 0,g()},W=()=>{I.value=void 0,C.value=!0},F=t=>{I.value=t,C.value=!0},H=async t=>{await J(t),g(),P.success(q("success"))};return(t,d)=>{const f=r("el-button"),V=r("el-popconfirm"),c=r("el-table-column"),X=r("el-icon"),N=r("el-tag"),Z=r("el-table"),x=r("el-pagination"),ee=ie("loading");return Q(),G("div",null,[b("div",Te,[e(u(we),{params:o.value,onSearch:Y,onReset:d[0]||(d[0]=()=>k())},{default:l(()=>[e(u(L),{label:t.$t("vote.title"),name:"Q_Contains_title"},null,8,["label"]),e(u(L),{label:t.$t("vote.beginDate"),name:"Q_GE_beginDate_DateTime,Q_LE_beginDate_DateTime",type:"datetime"},null,8,["label"]),e(u(L),{label:t.$t("vote.endDate"),name:"Q_GE_endDate_DateTime,Q_LE_endDate_DateTime",type:"datetime"},null,8,["label"]),e(u(L),{label:t.$t("vote.mode"),name:"Q_In_mode_Short",options:[1,2,3].map(s=>({label:t.$t("vote.mode.".concat(s)),value:s}))},null,8,["label","options"])]),_:1},8,["params"])]),b("div",null,[e(f,{type:"primary",disabled:u(E)("vote:create"),icon:u(K),onClick:d[1]||(d[1]=()=>W())},{default:l(()=>[w(y(t.$t("add")),1)]),_:1},8,["disabled","icon"]),e(V,{title:t.$t("confirmDelete"),onConfirm:d[2]||(d[2]=()=>H(p.value.map(s=>s.id)))},{reference:l(()=>[e(f,{disabled:p.value.length<=0||u(E)("vote:delete"),icon:u(me)},{default:l(()=>[w(y(t.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(u(De),{name:"vote",class:"ml-2"})]),b("div",Ye,[pe((Q(),A(Z,{id:"dataTable",ref_key:"table",ref:h,"row-key":"id",data:i.value,onSelectionChange:d[3]||(d[3]=s=>p.value=s),onRowDblclick:d[4]||(d[4]=s=>F(s.id)),onSortChange:a},{default:l(()=>[e(u(ke),{name:"vote"},{default:l(()=>[e(c,{type:"selection",width:"38"}),e(c,{width:"42"},{default:l(()=>[e(X,{class:ve(["text-lg align-middle",S.value||u(E)("vote:update")?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]]),disalbed:""},{default:l(()=>[e(u(R))]),_:1},8,["class"])]),_:1}),e(c,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(c,{property:"title",label:t.$t("vote.title"),"min-width":"280",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(c,{property:"beginDate",label:t.$t("vote.beginDate"),"min-width":"120",sortable:"custom",display:"none","show-overflow-tooltip":""},{default:l(({row:s})=>[w(y(s.beginDate!=null?u(j)(s.beginDate).format("YYYY-MM-DD HH:mm"):""),1)]),_:1},8,["label"]),e(c,{property:"endDate",label:t.$t("vote.endDate"),"min-width":"120",sortable:"custom",display:"none","show-overflow-tooltip":""},{default:l(({row:s})=>[w(y(s.endDate!=null?u(j)(s.endDate).format("YYYY-MM-DD HH:mm"):""),1)]),_:1},8,["label"]),e(c,{property:"times",label:t.$t("vote.times"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(c,{property:"mode",label:t.$t("vote.mode"),sortable:"custom","show-overflow-tooltip":"",formatter:s=>t.$t("vote.mode.".concat(s.mode))},null,8,["label","formatter"]),e(c,{property:"multiple",label:t.$t("vote.multiple"),sortable:"custom","show-overflow-tooltip":""},{default:l(({row:s})=>[e(N,{type:s.multiple?"success":"info",size:"small"},{default:l(()=>[w(y(t.$t(s.multiple?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(c,{property:"enabled",label:t.$t("vote.enabled"),"min-width":"100",sortable:"custom","show-overflow-tooltip":""},{default:l(({row:s})=>[e(N,{type:s.enabled?"success":"info",size:"small"},{default:l(()=>[w(y(t.$t(s.enabled?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(c,{label:t.$t("table.action")},{default:l(({row:s})=>[e(f,{type:"primary",disabled:u(E)("vote:update"),size:"small",link:"",onClick:()=>F(s.id)},{default:l(()=>[w(y(t.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(V,{title:t.$t("confirmDelete"),onConfirm:()=>H([s.id])},{reference:l(()=>[e(f,{type:"primary",disabled:u(E)("vote:delete"),size:"small",link:""},{default:l(()=>[w(y(t.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[ee,D.value]]),e(x,{"current-page":z.value,"onUpdate:currentPage":d[5]||(d[5]=s=>z.value=s),pageSize:m.value,"onUpdate:pageSize":d[6]||(d[6]=s=>m.value=s),total:n.value,"page-sizes":u(fe),layout:u(be),class:"justify-end px-3 py-2",small:"",background:"",onSizeChange:d[7]||(d[7]=()=>g()),onCurrentChange:d[8]||(d[8]=()=>g())},null,8,["current-page","pageSize","total","page-sizes","layout"])]),e(Be,{modelValue:C.value,"onUpdate:modelValue":d[9]||(d[9]=s=>C.value=s),"bean-id":I.value,"bean-ids":T.value,onFinished:g},null,8,["modelValue","bean-id","bean-ids"])])}}});export{Pe as default};
