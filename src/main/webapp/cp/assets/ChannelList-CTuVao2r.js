import{d as Te,A as _l,r as p,ar as ce,$ as re,B as ye,b as v,c as g,w as l,h as e,a6 as De,a2 as Le,i as kl,j as il,k as c,b3 as oe,b6 as Vl,v as P,x as $,g as M,P as O,aF as Q,aG as le,l as A,b8 as wl,b9 as Cl,aM as cl,u as Pe,e as pe,y as Fe,f as ml,m as Re,t as me,z as pl,aR as vl,o as $l,bt as Tl,bi as ql,aw as Ml,aD as El,bu as Ul,aH as Il,bv as tl,Z as Ke,aW as Sl,b5 as ee,aZ as Kl,bw as Dl,bx as Ll,by as Pl,a3 as Fl,bz as Rl,aP as Bl,aQ as zl,a5 as Nl,ay as Al,bk as jl,bs as Ol}from"./index-B_1EBDED.js";import{E as Ql,a as Hl,b as Wl}from"./el-main-BWaKeUmA.js";import{E as Gl}from"./el-popover-BPV9oilb.js";import{E as Be}from"./el-tree-C1BojIYi.js";import{E as fl}from"./el-switch-Dz1XCM2P.js";import{S as Jl}from"./sortable.esm-DEaZq8gs.js";import{c as Zl,d as Xl,t as de,f as Yl}from"./tree-CFBn_SXc.js";import{H as hl,I as xl,e as ea,J as la,d as be,K as yl,L as aa,M as ta,N as na,O as oa,P as sa,Q as nl,R as ua,S as ra}from"./content-BAV5UQMQ.js";import{e as da,f as ia}from"./system-CH-nDeDO.js";import{_ as ca,a as ol,b as ma,c as pa}from"./QueryItem.vue_vue_type_script_setup_true_lang-DvrrNKEc.js";import{E as bl,a as gl,c as va}from"./el-select-C46euWiD.js";import{E as fa}from"./el-tree-select-Gj8qefZq.js";import{E as ha,a as ya}from"./el-radio-group-CsyrtihM.js";/* empty css                 */import{q as sl,b as ba}from"./config-BqSwhr2s.js";import{a as ul,m as rl,g as dl}from"./data-De8R3DQH.js";import{_ as ga}from"./FieldItem.vue_vue_type_script_setup_true_lang-5Rnj3Bs-.js";import{_ as _a}from"./DialogForm.vue_vue_type_script_setup_true_lang-B3BSDHof.js";import{T as ka}from"./Tinymce-DwkXQ6by.js";import{T as Va}from"./TuiEditor-BSWjqJnJ.js";import{a as wa}from"./FileListUpload.vue_vue_type_style_index_0_scoped_b3a09e2e_lang-D6qex1Ks.js";import"./BaseUpload.vue_vue_type_style_index_0_scoped_248c0508_lang-ChzpL2ir.js";import"./vuedraggable.umd-DsKFJ5cW.js";/* empty css                          *//* empty css                        */import"./BaseUpload-n9vZc6H3.js";import"./position-B7mUaqBz.js";import"./index-Vcq4gwWv.js";const Ca={class:"w-full"},$a=Te({name:"ChannelForm",__name:"ChannelForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parent:{type:Object,default:null}},emits:{"update:modelValue":null,finished:null},setup(ae,{emit:I}){const F=ae,E=I,{modelValue:H,parent:_}=_l(F),R=p(),t=p({}),T=p([]),S=p([]),j=p([]),B=p([]),W=p([]),Z=p([]),b=p([]),i=p([]),m=p(),C=ce(()=>B.value.find(n=>n.id===m.value)),u=ce(()=>{var n;return ul(rl(dl().channel.mains,(n=C.value)==null?void 0:n.mains,"channel"))}),V=ce(()=>{var n;return ul(rl(dl().channel.asides,(n=C.value)==null?void 0:n.asides,"channel"))}),K=ce(()=>{var n;return JSON.parse(((n=C.value)==null?void 0:n.customs)||"[]")}),te=ce(()=>{const n=Zl(j.value,t.value.id);return re.allChannelPermission?n:Xl(n,Z.value)}),G=async()=>{j.value=de(await be())},X=async()=>{re.epRank>0&&(T.value=await da({category:"sys_article",deployed:!0}))},ie=async()=>{re.epRank>=3&&(S.value=await ba())},Y=async()=>{await G(),E("finished")},D=async()=>{B.value=await sl({type:"channel"}),m.value==null&&B.value.length>0&&(m.value=B.value[0].id)},qe=async()=>{W.value=await sl({type:"article"})},ge=async()=>{b.value=await xl()},ve=async()=>{i.value=await ea()},Me=async()=>{Z.value=await hl()};ye(H,()=>{var n,o,J;H.value&&(m.value=(J=(n=_.value)==null?void 0:n.articleModelId)!=null?J:(o=B.value[0])==null?void 0:o.id,Me(),D(),qe(),ge(),ve(),X(),ie())}),ye(K,()=>{Ee(t.value.customs)});const Ee=n=>(K.value.forEach(o=>{n[o.code]==null&&(n[o.code]=o.defaultValue,o.defaultValueKey!=null&&(n[o.code+"Key"]=o.defaultValueKey))}),n);return(n,o)=>{const J=il,k=kl,w=Le,Ue=Vl,x=gl,ne=bl,fe=fl,Ie=ya,Se=ha,_e=De,r=fa,f=va,L=Cl,U=wl;return v(),g(_a,{values:t.value,"onUpdate:values":o[26]||(o[26]=d=>t.value=d),name:n.$t("menu.content.channel"),"query-bean":c(na),"create-bean":c(ta),"update-bean":c(aa),"delete-bean":c(yl),"bean-id":ae.beanId,"bean-ids":ae.beanIds,focus:R.value,"init-values":(d,z)=>{var a,s,q,se,ue,h,ke,Ve,we,Ce,he,y,N,$e,ze,Ne,Ae,je,Oe,Qe,He,We,Ge,Je,Ze,Xe,Ye,xe,el,ll,al;return{parentId:z?d==null?void 0:d.parentId:(s=(a=c(_))==null?void 0:a.id)!=null?s:d==null?void 0:d.parentId,type:1,channelModelId:(h=(se=d==null?void 0:d.channelModelId)!=null?se:(q=c(_))==null?void 0:q.channelModelId)!=null?h:(ue=B.value[0])==null?void 0:ue.id,articleModelId:(Ce=(Ve=d==null?void 0:d.articleModelId)!=null?Ve:(ke=c(_))==null?void 0:ke.articleModelId)!=null?Ce:(we=W.value[0])==null?void 0:we.id,nav:(N=(y=d==null?void 0:d.nav)!=null?y:(he=c(_))==null?void 0:he.nav)!=null?N:!0,channelTemplate:(Ne=(ze=d==null?void 0:d.channelTemplate)!=null?ze:($e=c(_))==null?void 0:$e.channelTemplate)!=null?Ne:b.value[0],articleTemplate:(Oe=(je=d==null?void 0:d.articleTemplate)!=null?je:(Ae=c(_))==null?void 0:Ae.articleTemplate)!=null?Oe:i.value[0],pageSize:20,allowComment:(We=(He=d==null?void 0:d.allowComment)!=null?He:(Qe=c(_))==null?void 0:Qe.allowComment)!=null?We:!0,allowContribute:(Ze=(Je=d==null?void 0:d.allowContribute)!=null?Je:(Ge=c(_))==null?void 0:Ge.allowContribute)!=null?Ze:!0,allowSearch:(xe=(Ye=d==null?void 0:d.allowSearch)!=null?Ye:(Xe=c(_))==null?void 0:Xe.allowSearch)!=null?xe:!0,orderDesc:(al=(ll=d==null?void 0:d.orderDesc)!=null?ll:(el=c(_))==null?void 0:el.orderDesc)!=null?al:!0,customs:{}}},"to-values":d=>({...d}),perms:"channel","model-value":ae.modelValue,"disable-edit":d=>!c(re).allChannelPermission&&d.id!=null&&!Z.value.includes(d.id),"label-width":"120px",large:"","onUpdate:modelValue":o[27]||(o[27]=d=>n.$emit("update:modelValue",d)),onFinished:Y,onBeanChange:o[28]||(o[28]=async d=>{var z,a,s,q;m.value=(q=(a=d==null?void 0:d.channelModelId)!=null?a:(z=c(_))==null?void 0:z.channelModelId)!=null?q:(s=W.value[0])==null?void 0:s.id,await G()})},{default:l(({bean:d,isEdit:z})=>[e(_e,null,{default:l(()=>[e(w,{span:18},{default:l(()=>[e(_e,null,{default:l(()=>[e(w,{span:u.value.name.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"name",label:(a=u.value.name.name)!=null?a:n.$t("channel.name"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(J,{ref_key:"focus",ref:R,modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"]),e(w,{span:u.value.alias.double?12:24},{default:l(()=>[e(k,{prop:"alias",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^[\w-]*$/,message:()=>n.$t("channel.error.aliasPattern")},{asyncValidator:async(a,s,q)=>{if(s!==d.alias&&await c(la)(s)){q(n.$t("channel.error.aliasExist"));return}q()}}]},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.alias.name)!=null?a:n.$t("channel.alias"),message:"channel.alias",help:""},null,8,["label"])]}),default:l(()=>[e(J,{modelValue:t.value.alias,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.alias=a),maxlength:"50"},null,8,["modelValue"])]),_:2},1032,["rules"])]),_:2},1032,["span"]),t.value.type===3?(v(),g(w,{key:0,span:u.value.linkUrl.double?12:24},{default:l(()=>[e(k,{prop:"linkUrl",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>n.$t("channel.error.linkUrl")}]},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.linkUrl.name)!=null?a:n.$t("channel.linkUrl"),message:"channel.linkUrl",help:""},null,8,["label"])]}),default:l(()=>[e(J,{modelValue:t.value.linkUrl,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.linkUrl=a),maxlength:"255"},{append:l(()=>[e(Ue,{modelValue:t.value.targetBlank,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.targetBlank=a)},{default:l(()=>[P($(n.$t("channel.targetBlank")),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),t.value.type<3?(v(),O(Q,{key:1},[u.value.seoTitle.show?(v(),g(w,{key:0,span:u.value.seoTitle.double?12:24},{default:l(()=>[e(k,{prop:"seoTitle",rules:u.value.seoTitle.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.seoTitle.name)!=null?a:n.$t("channel.seoTitle"),message:"channel.seoTitle",help:""},null,8,["label"])]}),default:l(()=>[e(J,{modelValue:t.value.seoTitle,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.seoTitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.seoKeywords.show?(v(),g(w,{key:1,span:u.value.seoKeywords.double?12:24},{default:l(()=>[e(k,{prop:"seoKeywords",rules:u.value.seoKeywords.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.seoKeywords.name)!=null?a:n.$t("channel.seoKeywords"),message:"channel.seoKeywords",help:""},null,8,["label"])]}),default:l(()=>[e(J,{modelValue:t.value.seoKeywords,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.seoKeywords=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.seoDescription.show?(v(),g(w,{key:2,span:u.value.seoDescription.double?12:24},{default:l(()=>[e(k,{prop:"seoDescription",rules:u.value.seoDescription.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.seoDescription.name)!=null?a:n.$t("channel.seoDescription"),message:"channel.seoDescription",help:""},null,8,["label"])]}),default:l(()=>[e(J,{modelValue:t.value.seoDescription,"onUpdate:modelValue":o[6]||(o[6]=a=>t.value.seoDescription=a),maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0)],64)):M("",!0),u.value.image.show?(v(),g(w,{key:2,span:u.value.image.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"image",label:(a=u.value.image.name)!=null?a:n.$t("channel.image"),rules:u.value.image.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(c(wa),{modelValue:t.value.image,"onUpdate:modelValue":o[7]||(o[7]=s=>t.value.image=s),height:u.value.image.imageHeight,width:u.value.image.imageWidth,mode:u.value.image.imageMode},null,8,["modelValue","height","width","mode"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.channelModel.show?(v(),g(w,{key:3,span:u.value.channelModel.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"channelModelId",label:(a=u.value.channelModel.name)!=null?a:n.$t("channel.channelModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(ne,{modelValue:t.value.channelModelId,"onUpdate:modelValue":o[8]||(o[8]=s=>t.value.channelModelId=s),class:"w-full",onChange:o[9]||(o[9]=s=>{m.value=s})},{default:l(()=>[(v(!0),O(Q,null,le(B.value,s=>(v(),g(x,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.articleModel.show?(v(),g(w,{key:4,span:u.value.articleModel.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"articleModelId",label:(a=u.value.articleModel.name)!=null?a:n.$t("channel.articleModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(ne,{modelValue:t.value.articleModelId,"onUpdate:modelValue":o[10]||(o[10]=s=>t.value.articleModelId=s),class:"w-full"},{default:l(()=>[(v(!0),O(Q,null,le(W.value,s=>(v(),g(x,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),[3,4,5].includes(t.value.type)?M("",!0):(v(),O(Q,{key:5},[u.value.channelTemplate.show?(v(),g(w,{key:0,span:u.value.channelTemplate.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"channelTemplate",label:(a=u.value.channelTemplate.name)!=null?a:n.$t("channel.channelTemplate"),rules:u.value.channelTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(ne,{modelValue:t.value.channelTemplate,"onUpdate:modelValue":o[11]||(o[11]=s=>t.value.channelTemplate=s),class:"w-full"},{default:l(()=>[(v(!0),O(Q,null,le(b.value,s=>(v(),g(x,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0),u.value.articleTemplate.show?(v(),g(w,{key:1,span:u.value.articleTemplate.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"articleTemplate",label:(a=u.value.articleTemplate.name)!=null?a:n.$t("channel.articleTemplate"),rules:u.value.articleTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(ne,{modelValue:t.value.articleTemplate,"onUpdate:modelValue":o[12]||(o[12]=s=>t.value.articleTemplate=s),class:"w-full"},{default:l(()=>[(v(!0),O(Q,null,le(i.value,s=>(v(),g(x,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0)],64)),u.value.nav.show?(v(),g(w,{key:6,span:u.value.nav.double?12:24},{default:l(()=>[e(k,{prop:"nav",rules:u.value.nav.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.nav.name)!=null?a:n.$t("channel.nav"),message:"channel.nav",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.nav,"onUpdate:modelValue":o[13]||(o[13]=a=>t.value.nav=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),u.value.allowSearch.show?(v(),g(w,{key:7,span:u.value.allowSearch.double?12:24},{default:l(()=>[e(k,{prop:"allowSearch",rules:u.value.allowSearch.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(oe,{label:(a=u.value.allowSearch.name)!=null?a:n.$t("channel.allowSearch"),message:"channel.allowSearch",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.allowSearch,"onUpdate:modelValue":o[14]||(o[14]=a=>t.value.allowSearch=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):M("",!0),(v(!0),O(Q,null,le(K.value,a=>(v(),g(w,{key:a.code,span:a.double?12:24},{default:l(()=>[e(k,{prop:"customs.".concat(a.code),rules:a.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>[e(oe,{label:a.name},null,8,["label"])]),default:l(()=>[e(ga,{modelValue:t.value.customs[a.code],"onUpdate:modelValue":s=>t.value.customs[a.code]=s,"model-key":t.value.customs[a.code+"Key"],"onUpdate:modelKey":s=>t.value.customs[a.code+"Key"]=s,field:a},null,8,["modelValue","onUpdate:modelValue","model-key","onUpdate:modelKey","field"])]),_:2},1032,["prop","rules"])]),_:2},1032,["span"]))),128)),t.value.type===2?(v(),g(w,{key:8,span:u.value.text.double?12:24},{default:l(()=>{var a;return[e(k,{prop:"text",label:(a=u.value.text.name)!=null?a:n.$t("channel.text"),rules:u.value.text.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[A("div",Ca,[u.value.text.editorSwitch?(v(),g(Se,{key:0,modelValue:t.value.editorType,"onUpdate:modelValue":o[15]||(o[15]=s=>t.value.editorType=s),class:"mr-6",onChange:o[16]||(o[16]=()=>t.value.markdown="")},{default:l(()=>[(v(),O(Q,null,le([1,2],s=>e(Ie,{key:s,value:s},{default:l(()=>[P($(n.$t("model.field.editorType.".concat(s))),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])):M("",!0),t.value.editorType===2?(v(),g(c(Va),{key:1,modelValue:t.value.markdown,"onUpdate:modelValue":o[17]||(o[17]=s=>t.value.markdown=s),html:t.value.text,"onUpdate:html":o[18]||(o[18]=s=>t.value.text=s),class:"leading-6"},null,8,["modelValue","html"])):(v(),g(c(ka),{key:2,ref:"tinyText",modelValue:t.value.text,"onUpdate:modelValue":o[19]||(o[19]=s=>t.value.text=s)},null,8,["modelValue"]))])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):M("",!0)]),_:2},1024)]),_:2},1024),e(w,{span:6},{default:l(()=>[e(U,{type:"border-card",class:"ml-5"},{default:l(()=>[e(L,{label:n.$t("channel.tabs.setting")},{default:l(()=>{var a,s,q,se,ue;return[e(k,{prop:"parentId",label:(a=V.value.parent.name)!=null?a:n.$t("channel.parent"),"label-position":"top"},{default:l(()=>[e(r,{modelValue:t.value.parentId,"onUpdate:modelValue":o[20]||(o[20]=h=>t.value.parentId=h),data:te.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"render-after-expand":!1,disabled:z,placeholder:"","check-strictly":"",clearable:"",class:"w-full"},null,8,["modelValue","data","disabled"])]),_:2},1032,["label"]),e(k,{prop:"type",label:(s=V.value.type.name)!=null?s:n.$t("channel.type"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(ne,{modelValue:t.value.type,"onUpdate:modelValue":o[21]||(o[21]=h=>t.value.type=h),class:"w-full"},{default:l(()=>[(v(),O(Q,null,le([1,2,3,4],h=>e(x,{key:h,label:n.$t("channel.type.".concat(h)),value:h},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(k,{prop:"processKey",label:(q=V.value.processKey.name)!=null?q:n.$t("channel.processKey"),rules:V.value.processKey.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(ne,{modelValue:t.value.processKey,"onUpdate:modelValue":o[22]||(o[22]=h=>t.value.processKey=h),clearable:"",class:"w-full"},{default:l(()=>[(v(!0),O(Q,null,le(T.value,h=>(v(),g(x,{key:h.key,label:h.name,value:h.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),c(re).epRank>=3&&V.value.performanceType.show?(v(),g(k,{key:0,prop:"performanceType",label:(se=V.value.performanceType.name)!=null?se:n.$t("channel.performanceType"),rules:V.value.performanceType.required?{required:!0,message:()=>n.$t("v.required")}:void 0,"label-position":"top"},{default:l(()=>[e(ne,{modelValue:t.value.performanceTypeId,"onUpdate:modelValue":o[23]||(o[23]=h=>t.value.performanceTypeId=h),clearable:"",class:"w-full"},{default:l(()=>[(v(!0),O(Q,null,le(S.value,h=>(v(),g(x,{key:h.id,label:h.name,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])):M("",!0),e(k,{prop:"pageSize",label:(ue=V.value.pageSize.name)!=null?ue:n.$t("channel.pageSize"),rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{default:l(()=>[e(f,{modelValue:t.value.pageSize,"onUpdate:modelValue":o[24]||(o[24]=h=>t.value.pageSize=h),min:1,max:200},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(k,{prop:"orderDesc",rules:{required:!0,message:()=>n.$t("v.required")},"label-position":"top"},{label:l(()=>{var h;return[e(oe,{label:(h=V.value.orderDesc.name)!=null?h:n.$t("channel.orderDesc"),message:"channel.orderDesc",help:""},null,8,["label"])]}),default:l(()=>[e(fe,{modelValue:t.value.orderDesc,"onUpdate:modelValue":o[25]||(o[25]=h=>t.value.orderDesc=h)},null,8,["modelValue"])]),_:1},8,["rules"])]}),_:2},1032,["label"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","model-value","disable-edit"])}}}),Ta={class:"text-lg text-center"},qa={class:"flex items-center justify-center"},Ma={class:"text-lg text-center"},Ea={class:"mt-5"},Ua=Te({name:"ChannelMoveForm",__name:"ChannelMoveForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:vl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(ae){const I=cl(ae,"modelValue"),{t:F}=Pe(),E=p(!1),H=p([]),_=p([]),R=p(),t=p(),T=p("inner"),S=p(),j=async()=>{E.value=!0;try{const i=await be(),m=[];i.forEach(C=>{m.push({...C})}),H.value=de(i),_.value=de(m)}finally{E.value=!1}};ye(I,async()=>{I.value&&j()});const B=(i,m,C)=>{var u;m=m||C.includes(i.id),i.disabled=m,(u=i.children)==null||u.forEach(V=>{B(V,m,C)})},W=()=>{S.value=void 0;const i=R.value.getCheckedKeys();i.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),_.value.forEach(m=>{B(m,!1,i)})},Z=(i,m)=>{S.value=void 0,m.checkedKeys.length>1&&t.value.setCheckedKeys([i.id])},b=async()=>{const i=R.value.getCheckedKeys();if(i.length<=0){S.value=F("channel.error.srcChannelRequired");return}const m=t.value.getCheckedKeys()[0];if(m==null){S.value=F("channel.error.moveToChannelRequired");return}await oa(i,m,T.value),j(),me.success(F("success"))};return(i,m)=>{const C=Be,u=Le,V=gl,K=bl,te=De,G=ml,X=Re,ie=pl,Y=Fe;return v(),g(ie,{modelValue:I.value,"onUpdate:modelValue":m[2]||(m[2]=D=>I.value=D),title:i.$t("channel.op.batchMove"),width:"768",top:"5vh",onClose:m[3]||(m[3]=D=>i.$emit("finished"))},{default:l(()=>[e(te,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[A("div",Ta,$(i.$t("channel.batchMove.srcChannel")),1),pe(e(C,{ref_key:"srcTree",ref:R,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[Y,E.value]])]),_:1}),e(u,{span:12},{default:l(()=>[A("div",qa,[A("div",Ma,$(i.$t("channel.batchMove.moveTo")),1),e(K,{modelValue:T.value,"onUpdate:modelValue":m[0]||(m[0]=D=>T.value=D),class:"w-32 ml-2"},{default:l(()=>[(v(),O(Q,null,le(["inner","before","after"],D=>e(V,{key:D,label:i.$t("channel.batchMove.moveTo.".concat(D)),value:D},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),pe(e(C,{ref_key:"targetTree",ref:t,data:_.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:Z},null,8,["data"]),[[Y,E.value]])]),_:1})]),_:1}),A("div",Ea,[S.value?(v(),g(G,{key:0,title:S.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):M("",!0),e(X,{type:"primary",onClick:m[1]||(m[1]=()=>b())},{default:l(()=>[P($(i.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),Ia={class:"text-lg text-center"},Sa={class:"flex items-center justify-center"},Ka={class:"text-lg text-center"},Da={class:"mt-5"},La=Te({name:"ChannelMergeForm",__name:"ChannelMergeForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:vl({"update:modelValue":null,finished:null},["update:modelValue"]),setup(ae){const I=cl(ae,"modelValue"),{t:F}=Pe(),E=p(!1),H=p([]),_=p([]),R=p(),t=p(),T=p(),S=async()=>{E.value=!0;try{const b=await be(),i=[];b.forEach(m=>{i.push({...m})}),H.value=de(b),_.value=de(i)}finally{E.value=!1}};ye(I,async()=>{I.value&&S()});const j=(b,i,m)=>{var C;i=i||m.includes(b.id),b.disabled=i,(C=b.children)==null||C.forEach(u=>{j(u,i,m)})},B=()=>{T.value=void 0;const b=R.value.getCheckedKeys();b.includes(t.value.getCheckedKeys()[0])&&t.value.setCheckedKeys([]),_.value.forEach(i=>{j(i,!1,b)})},W=(b,i)=>{T.value=void 0,i.checkedKeys.length>1&&t.value.setCheckedKeys([b.id])},Z=async()=>{const b=R.value.getCheckedKeys();if(b.length<=0){T.value=F("channel.error.srcChannelRequired");return}const i=t.value.getCheckedKeys()[0];if(i==null){T.value=F("channel.error.moveToChannelRequired");return}await sa(b,i),S(),me.success(F("success"))};return(b,i)=>{const m=Be,C=Le,u=De,V=ml,K=Re,te=pl,G=Fe;return v(),g(te,{modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=X=>I.value=X),title:b.$t("channel.op.batchMerge"),width:"768",top:"5vh",onClose:i[2]||(i[2]=X=>b.$emit("finished"))},{default:l(()=>[e(u,{gutter:20},{default:l(()=>[e(C,{span:12},{default:l(()=>[A("div",Ia,$(b.$t("channel.batchMerge.srcChannel")),1),pe(e(m,{ref_key:"srcTree",ref:R,data:H.value,props:{label:"name"},"node-key":"id","show-checkbox":"",onCheck:B},null,8,["data"]),[[G,E.value]])]),_:1}),e(C,{span:12},{default:l(()=>[A("div",Sa,[A("div",Ka,$(b.$t("channel.batchMerge.mergeTo")),1)]),pe(e(m,{ref_key:"targetTree",ref:t,data:_.value,props:{label:"name"},"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:W},null,8,["data"]),[[G,E.value]])]),_:1})]),_:1}),A("div",Da,[T.value?(v(),g(V,{key:0,title:T.value,type:"error",closeable:!1,class:"mb-2"},null,8,["title"])):M("",!0),e(K,{type:"primary",onClick:i[0]||(i[0]=()=>Z())},{default:l(()=>[P($(b.$t("submit")),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),Pa={class:"flex justify-between mx-2 mt-1"},Fa={class:"mb-3"},Ra={class:"mt-3 app-block"},pt=Te({name:"ChannelList",__name:"ChannelList",setup(ae){const{t:I}=Pe(),F=p({}),E=p(),H=p(),_=p([]),R=p([]),t=p(!1),T=p(!1),S=p(),j=p(),B=ce(()=>Yl(_.value).map(r=>r.id)),W=p([]),Z=p([]),b=p(!1),i=p(!1),m=p(),C=p([]),u=p(!1),V=p(),K=p(),te=p(!1),G=p(!1),X=r=>re.allChannelPermission||W.value.includes(r.id);ye(V,r=>{m.value.filter(r)});const ie=async()=>{u.value=!0;try{C.value=de(await be()),Tl(()=>{var r;V.value!=null&&m.value.filter(V.value),m.value.setCurrentKey((r=K.value)==null?void 0:r.id)})}finally{u.value=!1}},Y=async()=>{var r;t.value=!0;try{b.value=E.value!==void 0;const f=Object.values(F.value).filter(L=>L!==void 0&&L!=="").length>0;_.value=await be({...ql(F.value),parentId:(r=K.value)==null?void 0:r.id,isIncludeSelf:!0,isIncludeChildren:f,Q_OrderBy:E.value}),!f&&!b.value&&(_.value=de(_.value))}finally{t.value=!1}},D=()=>{ie(),Y()},qe=async()=>{re.epRank>0&&(Z.value=await ia({category:"sys_article",latestVersion:!0}))},ge=async()=>{W.value=await hl()};let ve;const Me=()=>{const r=document.querySelector("#dataTable .el-table__body-wrapper tbody");ve=Jl.create(r,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(f){var d;const{oldIndex:L,newIndex:U}=f;if(L!==U){let z=L,a=U,s=_.value;const q=(d=s[0])==null?void 0:d.children;(q==null?void 0:q.length)>0&&(s=q,z-=1,a-=1),await nl(s[z].id,s[a].id,z>a?"before":"after"),ie(),s.splice(a,0,s.splice(z,1)[0]),me.success(I("success"))}}})};$l(()=>{D(),qe(),ge(),Me()}),Ml(()=>{ve!==void 0&&ve.destroy()});const Ee=({column:r,prop:f,order:L})=>{var U;f&&L?E.value=((U=r.sortBy)!=null?U:f)+(L==="descending"?"_desc":""):E.value=void 0,D()},n=()=>{D(),ge()},o=()=>Y(),J=()=>{H.value.clearSort(),Ol(F.value),E.value=void 0,Y()},k=r=>{j.value=void 0,S.value=r!=null?r:K.value,T.value=!0},w=r=>{Ke("channel:update")&&(j.value=r,S.value=null,T.value=!0)},Ue=(r,f)=>{Ke("channel:update")&&(ra(r,f),me.success(I("success")))},x=async r=>{await yl(r),D(),me.success(I("success"))},ne=async(r,f,L)=>{L!=="none"&&(await nl(r.data.id,f.data.id,L),Y())},fe=async()=>{await ua(),D(),me.success(I("success"))},Ie=async r=>{i.value?(K.value!=r.parent&&(K.value=r.parent,await Y()),w(r.id)):(K.value=r,o())},Se=(r,f)=>r?f.name.includes(r):!0,_e=()=>{m.value.setCurrentKey(null),K.value=void 0,o()};return(r,f)=>{const L=il,U=Re,d=fl,z=Il,a=Be,s=El,q=Ql,se=Gl,ue=Fl,h=zl,ke=Nl,Ve=Bl,we=Hl,Ce=Wl,he=Fe;return v(),g(Ce,null,{default:l(()=>[e(q,{width:"220px",class:"pr-3"},{default:l(()=>[e(s,{class:"p-2 bg-white rounded-sm"},{default:l(()=>[e(L,{modelValue:V.value,"onUpdate:modelValue":f[0]||(f[0]=y=>V.value=y),"suffix-icon":c(Ul),size:"small"},null,8,["modelValue","suffix-icon"]),A("div",Pa,[e(U,{type:K.value==null?"primary":void 0,link:"",onClick:_e},{default:l(()=>[P($(r.$t("channel.root")),1)]),_:1},8,["type"]),e(z,{content:r.$t("editMode"),placement:"top"},{default:l(()=>[e(d,{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=y=>i.value=y),"active-action-icon":c(tl),"inactive-action-icon":c(tl)},null,8,["modelValue","active-action-icon","inactive-action-icon"])]),_:1},8,["content"])]),pe(e(a,{ref_key:"channelTree",ref:m,data:C.value,props:{label:"name"},"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:c(Ke)("channel:update"),"filter-node-method":Se,onNodeClick:Ie,onNodeDragEnd:ne},null,8,["data","draggable"]),[[he,u.value]])]),_:1})]),_:1}),e(we,{class:"p-0"},{default:l(()=>[A("div",Fa,[e(c(ca),{params:F.value,onSearch:o,onReset:J},{default:l(()=>[e(c(ol),{label:r.$t("channel.name"),name:"Q_Contains_name"},null,8,["label"]),e(c(ol),{label:r.$t("channel.alias"),name:"Q_Contains_alias"},null,8,["label"])]),_:1},8,["params"])]),A("div",null,[e(U,{type:"primary",disabled:c(ee)("channel:create"),icon:c(Sl),onClick:f[2]||(f[2]=()=>k(void 0))},{default:l(()=>[P($(r.$t("add")),1)]),_:1},8,["disabled","icon"]),e(se,{title:r.$t("confirmDelete"),onConfirm:f[3]||(f[3]=()=>x(R.value.map(y=>y.id)))},{reference:l(()=>[e(U,{disabled:R.value.length<=0||c(ee)("channel:delete"),icon:c(Kl)},{default:l(()=>[P($(r.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(U,{disabled:c(ee)("channel:update"),icon:c(Dl),onClick:f[4]||(f[4]=()=>te.value=!0)},{default:l(()=>[P($(r.$t("channel.op.batchMove")),1)]),_:1},8,["disabled","icon"]),e(U,{disabled:c(ee)("channel:update"),icon:c(Ll),onClick:f[5]||(f[5]=()=>G.value=!0)},{default:l(()=>[P($(r.$t("channel.op.batchMerge")),1)]),_:1},8,["disabled","icon"]),e(U,{disabled:c(ee)("channel:tidyTree"),icon:c(Pl),onClick:f[6]||(f[6]=()=>fe())},{default:l(()=>[P($(r.$t("tidyTree")),1)]),_:1},8,["disabled","icon"]),e(z,{placement:"top",content:r.$t("tidyTree.tooltip")},{default:l(()=>[e(ue,{class:"ml-1 text-base align-text-bottom"},{default:l(()=>[e(c(Rl))]),_:1})]),_:1},8,["content"]),e(c(ma),{name:"channel",class:"ml-2"})]),A("div",Ra,[pe((v(),g(Ve,{id:"dataTable",ref_key:"table",ref:H,"row-key":"id","default-expand-all":"",data:_.value,"row-class-name":({row:y})=>{var N;return((N=y.children)==null?void 0:N.length)>0?void 0:"drag-draggable"},onSelectionChange:f[7]||(f[7]=y=>R.value=y),onRowDblclick:f[8]||(f[8]=y=>w(y.id)),onSortChange:Ee},{default:l(()=>[e(c(pa),{name:"channel"},{default:l(()=>[e(h,{type:"selection",selectable:X,width:"45"}),e(h,{property:"name",label:r.$t("channel.name"),"min-width":"80",sortable:"custom"},{default:l(({row:y})=>[e(ke,{href:y.url,target:"_blank",type:"primary"},{default:l(()=>[P($(y.name),1)]),_:2},1032,["href"])]),_:1},8,["label"]),e(h,{property:"alias",label:r.$t("channel.alias"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(h,{property:"channelModel.name",label:r.$t("channel.channelModel"),"sort-by":"channelModel@model-name",display:"none",sortable:"custom","min-width":"60"},null,8,["label"]),e(h,{property:"articleModel.name",label:r.$t("channel.articleModel"),"sort-by":"articleModel@model-name",sortable:"custom","min-width":"60"},null,8,["label"]),e(h,{property:"processKey",label:r.$t("channel.processKey"),"min-width":"60",sortable:"custom","show-overflow-tooltip":""},{default:l(({row:y})=>{var N;return[P($(y.processKey!=null?(N=Z.value.find($e=>$e.key===y.processKey))==null?void 0:N.name:void 0),1)]}),_:1},8,["label"]),e(h,{property:"nav",label:r.$t("channel.nav"),"min-width":"50"},{default:l(({row:y})=>[e(d,{modelValue:y.nav,"onUpdate:modelValue":N=>y.nav=N,size:"small",disabled:c(ee)("channel:update"),onClick:()=>Ue(y.id,y.nav)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])]),_:1},8,["label"]),e(h,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(h,{width:"42"},{default:l(({row:y})=>{var N;return[e(ue,{class:Al(["text-lg align-middle",b.value||c(ee)("channel:update")||((N=y.children)==null?void 0:N.length)>0?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:l(()=>[e(c(jl))]),_:2},1032,["class"])]}),_:1}),e(h,{label:r.$t("table.action")},{default:l(({row:y})=>[e(U,{type:"primary",disabled:c(ee)("channel:create")||!X(y),size:"small",link:"",onClick:()=>k(y)},{default:l(()=>[P($(r.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),e(U,{type:"primary",disabled:c(ee)("channel:update"),size:"small",link:"",onClick:()=>w(y.id)},{default:l(()=>[P($(r.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(se,{title:r.$t("confirmDelete"),onConfirm:()=>x([y.id])},{reference:l(()=>[e(U,{type:"primary",disabled:c(ee)("channel:delete")||!X(y),size:"small",link:""},{default:l(()=>[P($(r.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data","row-class-name"])),[[he,t.value]])]),e($a,{modelValue:T.value,"onUpdate:modelValue":f[9]||(f[9]=y=>T.value=y),"bean-id":j.value,"bean-ids":B.value,parent:S.value,onFinished:n},null,8,["modelValue","bean-id","bean-ids","parent"]),e(Ua,{modelValue:te.value,"onUpdate:modelValue":f[10]||(f[10]=y=>te.value=y),onFinished:n},null,8,["modelValue"]),e(La,{modelValue:G.value,"onUpdate:modelValue":f[11]||(f[11]=y=>G.value=y),onFinished:n},null,8,["modelValue"])]),_:1})]),_:1})}}});export{pt as default};
