import{d as j,r,b as c,e as w,f as R,w as o,i as a,aq as Y,I as Q,aa as oe,a9 as W,j as i,p as te,u as X,ac as Z,a3 as S,v as ne,o as x,k as C,h as ee,l as V,t as k,E as le,c as ue,as as q,ak as ie,ah as de,g as re,aJ as me,aK as pe,aY as ce}from"./index-CzkNR3jj.js";import{J as ae,K as ve,L as fe,M as se,N as be,O as ge,h as ye,P as _e}from"./user-B6e-5cbl.js";import{a as H,_ as $e,b as Ve,c as ke}from"./QueryItem.vue_vue_type_script_setup_true_lang-B0FAQoR4.js";import{_ as he}from"./ListMove.vue_vue_type_script_setup_true_lang-DRwBBp9B.js";import{_ as Pe}from"./DialogForm.vue_vue_type_script_setup_true_lang-CRgQtsrM.js";import{t as Ce}from"./tree-VGRVvCJj.js";import{m as we}from"./content-CrIhVRVS.js";const Ae=j({name:"GroupForm",__name:"GroupForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(P){const A=r(),m=r({});return(p,t)=>{const _=c("el-input"),y=c("el-form-item"),h=c("el-switch"),$=c("el-option"),b=c("el-select");return w(),R(Pe,{values:m.value,"onUpdate:values":t[4]||(t[4]=s=>m.value=s),name:p.$t("menu.user.group"),"query-bean":i(ae),"create-bean":i(ve),"update-bean":i(fe),"delete-bean":i(se),"bean-id":P.beanId,"bean-ids":P.beanIds,focus:A.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":s=>({...s}),"disable-delete":s=>s.id<=10,perms:"group","model-value":P.modelValue,"onUpdate:modelValue":t[5]||(t[5]=s=>p.$emit("update:modelValue",s)),onFinished:t[6]||(t[6]=()=>p.$emit("finished"))},{default:o(({})=>[a(y,{prop:"name",label:p.$t("group.name"),rules:{required:!0,message:()=>p.$t("v.required")}},{default:o(()=>[a(_,{ref_key:"focus",ref:A,modelValue:m.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>m.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(y,{prop:"description",label:p.$t("group.description")},{default:o(()=>[a(_,{modelValue:m.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>m.value.description=s),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),a(y,{prop:"allAccessPermission"},{label:o(()=>[a(Y,{message:"group.allAccessPermission"})]),default:o(()=>[a(h,{modelValue:m.value.allAccessPermission,"onUpdate:modelValue":t[2]||(t[2]=s=>m.value.allAccessPermission=s)},null,8,["modelValue"])]),_:1}),a(y,{prop:"type",label:p.$t("group.type"),rules:{required:!0,message:()=>p.$t("v.required")}},{default:o(()=>[a(b,{modelValue:m.value.type,"onUpdate:modelValue":t[3]||(t[3]=s=>m.value.type=s),disabled:m.value.type===1},{default:o(()=>[(w(),Q(W,null,oe([1,2],s=>a($,{key:s,disabled:s===1,label:p.$t("group.type.".concat(s)),value:s},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),Ge={class:"border-t"},qe={class:"flex items-center justify-between"},Ue=j({name:"GroupPermissionForm",__name:"GroupPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null}},emits:{"update:modelValue":null,finished:null},setup(P,{emit:A}){const m=P,p=A,{beanId:t,modelValue:_}=te(m),{t:y}=X(),h=r(),$=r({}),b=r({}),s=r(!1),F=r(!0),U=r(!1),v=r(),G=r([]),B=Z(()=>S.rank>$.value.rank),T=async()=>{(t==null?void 0:t.value)!=null&&($.value=await ae(t.value),b.value={...$.value})},z=async()=>{G.value=Ce(await we())},E=async()=>{var e;if((t==null?void 0:t.value)!=null){const l=await ge(t.value);(e=v.value)==null||e.setCheckedKeys([]),l.forEach(d=>{var u;(u=v.value)==null||u.setChecked(d,!0,!1)})}};ne(_,()=>{_.value&&(T(),E())}),x(()=>{z()});const I=(e,l,d,u)=>{d.forEach(f=>{f.children&&(l.getNode(f[u!=null?u:"key"]).expanded=e,I(e,l,f.children,u))})},D=(e,l,d,u)=>{l.setCheckedKeys(e?d.map(f=>f[u!=null?u:"key"]):[])},L=()=>{h.value.validate(async e=>{if(e){s.value=!0;try{await be(b.value),p("finished"),p("update:modelValue",!1),le.success(y("success"))}finally{s.value=!1}}})},N=()=>{v.value!=null&&(b.value.accessPermissions=[...v.value.getCheckedNodes(),...v.value.getHalfCheckedNodes()].map(e=>e.id))};return(e,l)=>{const d=c("el-switch"),u=c("el-form-item"),f=c("el-checkbox"),K=c("el-tree"),M=c("el-form"),O=c("el-tag"),n=c("el-button"),J=c("el-drawer");return w(),R(J,{title:e.$t("permissionSettings"),"model-value":P.modelValue,size:414,"onUpdate:modelValue":l[8]||(l[8]=g=>e.$emit("update:modelValue",g))},{default:o(()=>[a(M,{ref_key:"form",ref:h,model:b.value,disabled:B.value,"label-width":"150px"},{default:o(()=>[a(u,{prop:"allAccessPermission"},{label:o(()=>[a(Y,{message:"group.allAccessPermission",help:""})]),default:o(()=>[a(d,{modelValue:b.value.allAccessPermission,"onUpdate:modelValue":l[0]||(l[0]=g=>b.value.allAccessPermission=g)},null,8,["modelValue"])]),_:1}),b.value.allAccessPermission?ee("",!0):(w(),Q(W,{key:0},[C("div",Ge,[a(f,{modelValue:F.value,"onUpdate:modelValue":l[1]||(l[1]=g=>F.value=g),label:e.$t("expand/collapse"),onChange:l[2]||(l[2]=g=>I(g,v.value,G.value,"id"))},null,8,["modelValue","label"]),a(f,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=g=>U.value=g),label:e.$t("checkAll/uncheckAll"),onChange:l[4]||(l[4]=g=>{D(g,v.value,G.value,"id"),N()})},null,8,["modelValue","label"])]),a(K,{ref_key:"accessPermissionTree",ref:v,data:G.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:l[5]||(l[5]=()=>N())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:o(()=>[C("div",qe,[C("div",null,[a(O,null,{default:o(()=>{var g;return[V(k((g=b.value)==null?void 0:g.name),1)]}),_:1})]),C("div",null,[a(n,{onClick:l[6]||(l[6]=()=>e.$emit("update:modelValue",!1))},{default:o(()=>[V(k(e.$t("cancel")),1)]),_:1}),a(n,{type:"primary",loading:s.value,disabled:B.value,onClick:l[7]||(l[7]=()=>L())},{default:o(()=>[V(k(e.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),De={class:"mb-3"},Se={class:"mt-3 app-block"},Te=j({name:"GroupList",__name:"GroupList",setup(P){const{t:A}=X(),m=r({}),p=r(),t=r(),_=r([]),y=r([]),h=r(!1),$=r(!1),b=r(!1),s=r(),F=Z(()=>_.value.map(e=>e.id)),U=r(!1),v=async()=>{h.value=!0;try{_.value=await ye({...me(m.value),Q_OrderBy:p.value}),U.value=Object.values(m.value).filter(e=>e!==void 0&&e!=="").length>0||p.value!==void 0}finally{h.value=!1}};x(v);const G=({column:e,prop:l,order:d})=>{var u;l&&d?p.value=((u=e.sortBy)!=null?u:l)+(d==="descending"?"_desc":""):p.value=void 0,v()},B=()=>v(),T=()=>{t.value.clearSort(),pe(m.value),p.value=void 0,v()},z=()=>{s.value=void 0,$.value=!0},E=e=>{s.value=e,$.value=!0},I=e=>{s.value=e,b.value=!0},D=e=>e>10,L=async e=>{const l=e.filter(d=>D(d));l.length>0&&(await se(l),v(),le.success(A("success")))},N=async(e,l)=>{const d=ce(e,_.value,l);await _e(d.map(u=>u.id))};return(e,l)=>{const d=c("el-button"),u=c("el-popconfirm"),f=c("el-table-column"),K=c("el-tag"),M=c("el-table"),O=ue("loading");return w(),Q("div",null,[C("div",De,[a(i($e),{params:m.value,onSearch:B,onReset:T},{default:o(()=>[a(i(H),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),a(i(H),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),C("div",null,[a(d,{type:"primary",disabled:i(q)("group:create"),icon:i(ie),onClick:z},{default:o(()=>[V(k(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(u,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>L(y.value.map(n=>n.id)))},{reference:o(()=>[a(d,{disabled:y.value.filter(n=>D(n.id)).length<=0||i(q)("group:delete"),icon:i(de)},{default:o(()=>[V(k(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(he,{class:"ml-2",disabled:y.value.length<=0||U.value||i(q)("org:update"),onMove:l[1]||(l[1]=n=>N(y.value,n))},null,8,["disabled"]),a(i(Ve),{name:"group",class:"ml-2"})]),C("div",Se,[re((w(),R(M,{ref_key:"table",ref:t,data:_.value,onSelectionChange:l[2]||(l[2]=n=>y.value=n),onRowDblclick:l[3]||(l[3]=n=>E(n.id)),onSortChange:G},{default:o(()=>[a(i(ke),{name:"group"},{default:o(()=>[a(f,{type:"selection",width:"50"}),a(f,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(f,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(f,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(f,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:o(({row:n})=>[a(K,{type:n.allAccessPermission?"success":"info",size:"small"},{default:o(()=>[V(k(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(f,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t("group.type.".concat(n.type))},null,8,["label","formatter"]),a(f,{label:e.$t("table.action")},{default:o(({row:n})=>[a(d,{type:"primary",disabled:i(q)("group:update"),size:"small",link:"",onClick:J=>E(n.id)},{default:o(()=>[V(k(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),i(S).epRank>0||i(S).epDisplay?(w(),R(d,{key:0,type:"primary",disabled:i(q)("group:updatePermission")||i(S).epRank<=0,title:i(S).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:"",onClick:()=>I(n.id)},{default:o(()=>[V(k(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","title","onClick"])):ee("",!0),a(u,{title:e.$t("confirmDelete"),onConfirm:()=>L([n.id])},{reference:o(()=>[a(d,{type:"primary",disabled:!D(n.id)||i(q)("group:delete"),size:"small",link:""},{default:o(()=>[V(k(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[O,h.value]])]),a(Ae,{modelValue:$.value,"onUpdate:modelValue":l[4]||(l[4]=n=>$.value=n),"bean-id":s.value,"bean-ids":F.value,onFinished:v},null,8,["modelValue","bean-id","bean-ids"]),a(Ue,{modelValue:b.value,"onUpdate:modelValue":l[5]||(l[5]=n=>b.value=n),"bean-id":s.value,onFinished:v},null,8,["modelValue","bean-id"])])}}});export{Te as default};
