import{d as ye,p as ge,u as he,r as $,aa as B,aX as ee,o as Ve,v as G,E as K,b as w,c as $e,e as m,f as I,w as d,g as ae,K as N,j as S,ae as we,aq as L,n as y,t as r,h as E,bb as z,i as k,ai as Se,af as ke,l as Ce}from"./index-B6OoDg6B.js";const Be={key:0},qe={key:0},Ee={key:1},De={class:"space-x-2"},Fe={key:0},le="ujcms_continuous_settings",je=ye({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},values:{type:Object,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(n,{expose:te,emit:ue}){function R(){const e=localStorage.getItem(le);return e?JSON.parse(e):{}}function ne(e){localStorage.setItem(le,JSON.stringify(e))}function se(e){var u;return(u=R()[e])!=null?u:!1}function ie(e,l){const u=R();u[e]=l,ne(u)}const a=n,t=ue,{name:O,beanId:X,beanIds:oe,focus:D,values:i,action:de,modelValue:H}=ge(a),{t:F}=he(),j=$(!1),c=$(!1),f=$(se(O.value)),g=$(),v=$(a.initValues()),P=$(),o=$(),b=$([]),s=B(()=>o.value!=null&&de.value==="edit"),A=B(()=>!j.value&&!ee.isEqual(P.value,i.value)),h=B(()=>{var e,l;return(l=(e=a.disableEdit)==null?void 0:e.call(a,v.value))!=null?l:!1}),ve=B(()=>"".concat(O.value," - ").concat(s.value?"".concat(F(h.value?"detail":"edit")," (ID: ").concat(o.value,")"):"".concat(F("add")))),T=async()=>{var e;j.value=!0;try{v.value=o.value!=null?await a.queryBean(o.value):a.initValues(i.value,s.value),P.value=o.value!=null?a.toValues(v.value):v.value,t("update:values",ee.cloneDeep(P.value)),t("beanChange",v.value),(e=g.value)==null||e.resetFields()}finally{j.value=!1}};Ve(()=>t("update:values",a.initValues())),G(H,()=>{H.value&&(b.value=oe.value,o.value!==X.value?o.value=X.value:T())}),G(o,()=>{T()}),G(f,()=>ie(O.value,f.value));const V=B(()=>b.value.indexOf(o.value)),U=B(()=>V.value>0),M=B(()=>V.value<b.value.length-1),J=()=>{U.value&&(o.value=b.value[V.value-1])},W=()=>{M.value&&(o.value=b.value[V.value+1])},re=()=>{var e,l;(l=(e=D.value)==null?void 0:e.focus)==null||l.call(e),o.value=void 0},ce=()=>{t("update:modelValue",!1)},Q=async()=>{c.value=!0;try{await a.deleteBean([o.value]),f.value||t("update:modelValue",!1),M.value?(W(),b.value.splice(V.value-1,1)):U.value?(J(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),K.success(F("success")),t("finished")}finally{c.value=!1}},Y=()=>{P.value=a.toValues(i.value)},Z=async()=>{var e;await((e=a.beforeValidate)==null?void 0:e.call(a,i.value)),g.value.validate(async l=>{var u,C,q,_;if(l){c.value=!0;try{if((C=await((u=a.preventSubmit)==null?void 0:u.call(a,i.value)))!=null&&C)return;t("beforeSubmit",i.value),s.value?(await a.updateBean(i.value),Y()):(await a.createBean(i.value),(_=(q=D.value)==null?void 0:q.focus)==null||_.call(q),t("update:values",a.initValues(i.value,s.value)),g.value.resetFields()),K.success(F("success")),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})};return te({form:g,submit:e=>{g.value.validate(async l=>{var u,C;if(l){c.value=!0;try{if((C=await((u=a.preventSubmit)==null?void 0:u.call(a,i.value)))!=null&&C)return;t("beforeSubmit",i.value),await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:D.value,loadBean:T,resetOrigValues:Y,emit:t}),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})},remove:async e=>{c.value=!0;try{await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:D.value,loadBean:T,emit:t}),f.value||t("update:modelValue",!1),M.value?(W(),b.value.splice(V.value-1,1)):U.value?(J(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),K.success(F("success")),t("finished")}finally{c.value=!1}}}),(e,l)=>{const u=w("el-button"),C=w("el-popconfirm"),q=w("el-button-group"),_=w("el-switch"),fe=w("el-tooltip"),me=w("el-tag"),be=w("el-form"),pe=w("el-dialog"),x=$e("loading");return m(),I(pe,{title:ve.value,"close-on-click-modal":!A.value,"model-value":n.modelValue,width:n.large?"98%":"768px",top:n.large?"16px":"8vh","onUpdate:modelValue":l[3]||(l[3]=p=>e.$emit("update:modelValue",p)),onOpened:l[4]||(l[4]=()=>{var p;return!s.value&&((p=S(D))==null?void 0:p.focus())})},{header:d(()=>[y(r(S(O))+" - ",1),s.value?(m(),N("span",Be,[y(r(e.$t(h.value?"detail":"edit"))+" ",1),n.showId?(m(),N("span",qe,"(ID: "+r(o.value)+")",1)):E("",!0)])):(m(),N("span",Ee,r(e.$t("add")),1))]),default:d(()=>[ae((m(),N("div",De,[s.value&&n.addable?(m(),I(u,{key:0,disabled:S(L)("".concat(n.perms,":create")),type:"primary",icon:S(we),onClick:re},{default:d(()=>[y(r(e.$t("add")),1)]),_:1},8,["disabled","icon"])):E("",!0),z(e.$slots,"header-action",{bean:v.value,isEdit:s.value,disabled:h.value,unsaved:A.value,disableDelete:n.disableDelete,handleDelete:Q},()=>[s.value?(m(),I(C,{key:0,title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>Q())},{reference:d(()=>{var p;return[k(u,{disabled:((p=n.disableDelete)==null?void 0:p.call(n,v.value))||S(L)("".concat(n.perms,":delete")),icon:S(Se)},{default:d(()=>[y(r(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]}),_:1},8,["title"])):E("",!0)]),s.value?(m(),I(q,{key:1},{default:d(()=>[k(u,{disabled:!U.value,onClick:J},{default:d(()=>[y(r(e.$t("form.prev")),1)]),_:1},8,["disabled"]),k(u,{disabled:!M.value,onClick:W},{default:d(()=>[y(r(e.$t("form.next")),1)]),_:1},8,["disabled"])]),_:1})):E("",!0),k(u,{type:"primary",onClick:ce},{default:d(()=>[y(r(e.$t("back")),1)]),_:1}),k(fe,{content:e.$t("form.continuous"),placement:"top"},{default:d(()=>[k(_,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=p=>f.value=p),size:"small"},null,8,["modelValue"])]),_:1},8,["content"]),A.value?(m(),I(me,{key:2,type:"danger"},{default:d(()=>[y(r(e.$t("form.unsaved")),1)]),_:1})):E("",!0),z(e.$slots,"header-status",{bean:v.value,isEdit:s.value,disabled:h.value})])),[[x,j.value||c.value]]),k(be,{ref_key:"form",ref:g,class:ke(["mt-5","pr-5"]),model:S(i),disabled:h.value,"label-width":n.labelWidth,"label-position":n.labelPosition,"scroll-to-error":""},{default:d(()=>[z(e.$slots,"default",{bean:v.value,isEdit:s.value,disabled:h.value}),h.value?E("",!0):ae((m(),N("div",Fe,[z(e.$slots,"footer-action",{bean:v.value,isEdit:s.value,disabled:h.value,handleSubmit:Z},()=>[k(u,{disabled:S(L)(s.value?"".concat(n.perms,":update"):"".concat(n.perms,":create")),type:"primary","native-type":"submit",onClick:l[2]||(l[2]=Ce(()=>Z(),["prevent"]))},{default:d(()=>[y(r(e.$t("save")),1)]),_:1},8,["disabled"])])])),[[x,c.value]])]),_:3},8,["model","disabled","label-width","label-position"])]),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}});export{je as _};
