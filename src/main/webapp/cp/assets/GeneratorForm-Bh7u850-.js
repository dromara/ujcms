import{d as Z,r as b,b as v,c as g,w as a,h as e,a6 as x,a2 as ee,i as ae,j as le,g as h,aO as te,v as p,x as i,l as $,k as r,u as se,ar as me,o as ne,bi as pe,P as B,bs as fe,m as ue,aZ as ve,b5 as D,t as F,e as Q,y as oe,aQ as be,X,aP as ye,bq as ce,br as ge,Z as K,n as H,bJ as _e,b3 as z,E as ke,aF as $e,aG as he,$ as Ve}from"./index-__TSAjOL.js";import{b as we,E as re,a as de}from"./el-select-CPBsiljt.js";import{E as De}from"./el-switch-Cg-m0Y0i.js";import{d as Se,e as Ce,u as Ee,g as Ue}from"./config-BS48XX7b.js";import{a7 as qe,a8 as Ie,a9 as W,aa as ze,ab as Fe,ac as He,ad as Pe}from"./content-BqI55UAh.js";import{E as Te}from"./el-pagination-BCmSIrki.js";import{E as Le}from"./el-popover-B2t_MYt0.js";import{i as ie,u as Re,j as Ae,k as Be,l as Ye}from"./system--Gl2DLOU.js";import{a as Ge,_ as Me,b as Ne,c as je}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";import{_ as Oe}from"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";const Qe={class:"whitespace-pre-wrap"},Ze=Z({name:"TaskForm",__name:"TaskForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(T){const t=b({});return(s,n)=>{const V=le,d=ae,y=ee,q=we,S=de,C=re,E=te,P=x;return v(),g(Oe,{values:t.value,"onUpdate:values":n[7]||(n[7]=m=>t.value=m),name:s.$t("menu.system.task"),"query-bean":r(Be),"create-bean":r(Ae),"update-bean":r(Re),"delete-bean":r(ie),"bean-id":T.beanId,"bean-ids":T.beanIds,"init-values":()=>({user:{}}),"to-values":m=>({...m}),"disable-edit":()=>!0,addable:!1,perms:"task","model-value":T.modelValue,large:"","onUpdate:modelValue":n[8]||(n[8]=m=>s.$emit("update:modelValue",m)),onFinished:n[9]||(n[9]=()=>s.$emit("finished"))},{default:a(({})=>[e(P,null,{default:a(()=>[e(y,{span:12},{default:a(()=>[e(d,{prop:"name",label:s.$t("task.name")},{default:a(()=>[e(V,{modelValue:t.value.name,"onUpdate:modelValue":n[0]||(n[0]=m=>t.value.name=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"user.username",label:s.$t("task.user")},{default:a(()=>[e(V,{modelValue:t.value.user.username,"onUpdate:modelValue":n[1]||(n[1]=m=>t.value.user.username=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"beginDate",label:s.$t("task.beginDate")},{default:a(()=>[e(q,{modelValue:t.value.beginDate,"onUpdate:modelValue":n[2]||(n[2]=m=>t.value.beginDate=m),type:"datetime"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"endDate",label:s.$t("task.endDate")},{default:a(()=>[e(q,{modelValue:t.value.endDate,"onUpdate:modelValue":n[3]||(n[3]=m=>t.value.endDate=m),type:"datetime"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"current",label:s.$t("task.current")},{default:a(()=>[e(V,{modelValue:t.value.current,"onUpdate:modelValue":n[4]||(n[4]=m=>t.value.current=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"processedIn",label:s.$t("task.processedIn")},{default:a(()=>[e(V,{modelValue:t.value.processedIn,"onUpdate:modelValue":n[5]||(n[5]=m=>t.value.processedIn=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{prop:"type",label:s.$t("task.type")},{default:a(()=>[t.value.type?(v(),g(C,{key:0,modelValue:t.value.type,"onUpdate:modelValue":n[6]||(n[6]=m=>t.value.type=m)},{default:a(()=>[e(S,{value:t.value.type,label:s.$t("task.type.".concat(t.value.type))},null,8,["value","label"])]),_:1},8,["modelValue"])):h("",!0)]),_:1},8,["label"])]),_:1}),e(y,{span:12},{default:a(()=>[e(d,{label:s.$t("task.status")},{default:a(()=>[t.value.status===0?(v(),g(E,{key:0,type:"info"},{default:a(()=>[p(i(s.$t("task.status.".concat(t.value.status))),1)]),_:1})):h("",!0),t.value.status===1?(v(),g(E,{key:1},{default:a(()=>[p(i(s.$t("task.status.".concat(t.value.status))),1)]),_:1})):h("",!0),t.value.status===2?(v(),g(E,{key:2,type:"danger"},{default:a(()=>[p(i(s.$t("task.status.".concat(t.value.status))),1)]),_:1})):h("",!0),t.value.status===3?(v(),g(E,{key:3,type:"warning"},{default:a(()=>[p(i(s.$t("task.status.".concat(t.value.status))),1)]),_:1})):h("",!0),t.value.status===4?(v(),g(E,{key:4,type:"success"},{default:a(()=>[p(i(s.$t("task.status.".concat(t.value.status))),1)]),_:1})):h("",!0)]),_:1},8,["label"])]),_:1}),t.value.errorInfo?(v(),g(y,{key:0,span:24},{default:a(()=>[e(d,{label:s.$t("task.errorInfo")},{default:a(()=>[$("pre",null,[$("code",Qe,i(t.value.errorInfo),1)])]),_:1},8,["label"])]),_:1})):h("",!0)]),_:1})]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","to-values","model-value"])}}}),Je={class:"mb-3"},Xe={class:"mt-3 app-block"},Ke=Z({name:"TaskList",__name:"TaskList",setup(T,{expose:t}){const{t:s}=se(),n=b({}),V=b(),d=b(1),y=b(10),q=b(0),S=b(),C=b([]),E=b([]),P=b(!1),m=b(!1),R=b(),Y=me(()=>C.value.map(l=>l.id)),U=async()=>{P.value=!0;try{const{content:l,totalElements:o}=await Ye({...pe(n.value),Q_OrderBy:V.value,page:d.value,pageSize:y.value});C.value=l,q.value=Number(o)}finally{P.value=!1}};ne(U);const G=({column:l,prop:o,order:_})=>{var I;o&&_?V.value=((I=l.sortBy)!=null?I:o)+(_==="descending"?"_desc":""):V.value=void 0,U()},M=()=>U(),N=()=>{S.value.clearSort(),fe(n.value),V.value=void 0,U()},A=l=>{R.value=l,m.value=!0},f=async l=>{await ie(l),U(),F.success(s("success"))};return t({fetchData:U}),(l,o)=>{const _=ue,I=Le,k=be,w=te,L=ye,j=Te,O=oe;return v(),B("div",null,[$("div",Je,[e(r(Me),{params:n.value,onSearch:M,onReset:N},{default:a(()=>[e(r(Ge),{label:l.$t("task.name"),name:"Q_Contains_name"},null,8,["label"])]),_:1},8,["params"])]),$("div",null,[e(I,{title:l.$t("confirmDelete"),onConfirm:o[0]||(o[0]=()=>f(E.value.map(u=>u.id)))},{reference:a(()=>[e(_,{disabled:E.value.length<=0||r(D)("task:delete"),icon:r(ve)},{default:a(()=>[p(i(l.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(r(Ne),{name:"task",class:"ml-2"})]),$("div",Xe,[Q((v(),g(L,{ref_key:"table",ref:S,data:C.value,onSelectionChange:o[1]||(o[1]=u=>E.value=u),onRowDblclick:o[2]||(o[2]=u=>A(u.id)),onSortChange:G},{default:a(()=>[e(r(je),{name:"task"},{default:a(()=>[e(k,{type:"selection",width:"38"}),e(k,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(k,{property:"name",label:l.$t("task.name"),sortable:"custom","min-width":"150","show-overflow-tooltip":""},null,8,["label"]),e(k,{property:"beginDate",label:l.$t("task.beginDate"),sortable:"custom",width:"170"},{default:a(({row:u})=>[p(i(r(X)(u.beginDate).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),e(k,{property:"endDate",label:l.$t("task.endDate"),sortable:"custom",width:"170",display:"none"},{default:a(({row:u})=>[p(i(r(X)(u.endDate).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),e(k,{property:"current",label:l.$t("task.current"),"min-width":"70",align:"right"},null,8,["label"]),e(k,{property:"processedIn",label:l.$t("task.processedIn"),"min-width":"70",align:"right"},null,8,["label"]),e(k,{property:"user.username",label:l.$t("task.user"),"sort-by":"user-username",sortable:"custom","min-width":"80",align:"right"},null,8,["label"]),e(k,{property:"status",label:l.$t("task.status"),sortable:"custom",width:"80","show-overflow-tooltip":""},{default:a(({row:u})=>[u.status===0?(v(),g(w,{key:0,type:"info",size:"small"},{default:a(()=>[p(i(l.$t("task.status.".concat(u.status))),1)]),_:2},1024)):h("",!0),u.status===1?(v(),g(w,{key:1,size:"small"},{default:a(()=>[p(i(l.$t("task.status.".concat(u.status))),1)]),_:2},1024)):h("",!0),u.status===2?(v(),g(w,{key:2,type:"danger",size:"small"},{default:a(()=>[p(i(l.$t("task.status.".concat(u.status))),1)]),_:2},1024)):h("",!0),u.status===3?(v(),g(w,{key:3,type:"warning",size:"small"},{default:a(()=>[p(i(l.$t("task.status.".concat(u.status))),1)]),_:2},1024)):h("",!0),u.status===4?(v(),g(w,{key:4,type:"success",size:"small"},{default:a(()=>[p(i(l.$t("task.status.".concat(u.status))),1)]),_:2},1024)):h("",!0)]),_:1},8,["label"]),e(k,{label:l.$t("table.action")},{default:a(({row:u})=>[e(_,{type:"primary",disabled:r(D)("task:show"),size:"small",link:"",onClick:()=>A(u.id)},{default:a(()=>[p(i(l.$t("detail")),1)]),_:2},1032,["disabled","onClick"]),e(I,{title:l.$t("confirmDelete"),onConfirm:()=>f([u.id])},{reference:a(()=>[e(_,{type:"primary",disabled:r(D)("task:delete"),size:"small",link:""},{default:a(()=>[p(i(l.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[O,P.value]]),e(j,{"current-page":d.value,"onUpdate:currentPage":o[3]||(o[3]=u=>d.value=u),"page-size":y.value,"onUpdate:pageSize":o[4]||(o[4]=u=>y.value=u),total:q.value,"page-sizes":r(ge),layout:r(ce),size:"small",background:"",class:"justify-end px-3 py-2",onSizeChange:o[5]||(o[5]=()=>U()),onCurrentChange:o[6]||(o[6]=()=>U())},null,8,["current-page","page-size","total","page-sizes","layout"])]),e(Ze,{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=u=>m.value=u),"bean-id":R.value,"bean-ids":Y.value,onFinished:U},null,8,["modelValue","bean-id","bean-ids"])])}}}),We={class:"p-3 app-block"},xe={class:"p-3 mt-3 app-block"},ea={class:"pb-2 border-b text-gray-primary"},aa={key:0,class:"p-3 mt-3 app-block"},la={class:"pb-2 border-b text-gray-primary"},ta={class:"p-3 mt-3 app-block"},sa={class:"text-gray-primary"},ba=Z({name:"GeneratorForm",__name:"GeneratorForm",setup(T){const{t}=se(),s=b(!1),n=b(),V=b(),d=b({}),y=b(!1),q=b(),S=b({}),C=b(!1),E=async()=>{y.value=!0;try{d.value=await Se()}finally{y.value=!1}},P=async()=>{if(K("config:grey:show")){C.value=!0;try{S.value=await Ce()}finally{C.value=!1}}};ne(async()=>{E(),P()});const m=async()=>{s.value=!0;try{await qe(),await n.value.fetchData(),F.success(t("success"))}finally{s.value=!1}},R=async()=>{s.value=!0;try{await Ie(),await n.value.fetchData(),F.success(t("success"))}finally{s.value=!1}},Y=async()=>{s.value=!0;try{await W(),await n.value.fetchData(),F.success(t("success"))}finally{s.value=!1}},U=async()=>{s.value=!0;try{await ze(),F.success(t("success"))}finally{s.value=!1}},G=async()=>{s.value=!0;try{await Fe(),await n.value.fetchData(),F.success(t("success"))}finally{s.value=!1}},M=async()=>{s.value=!0;try{await He(),await n.value.fetchData(),F.success(t("success"))}finally{s.value=!1}},N=()=>{V.value&&V.value.validate(async f=>{if(f){y.value=!0;try{await Ee(d.value),await W(),await n.value.fetchData(),F.success(t("success"))}finally{y.value=!1}}})},A=()=>{q.value&&q.value.validate(async f=>{if(f){C.value=!0;try{await Ue(S.value),await Pe(),F.success(t("success"))}finally{C.value=!1}}})};return(f,l)=>{const o=ue,_=ae,I=ke,k=De,w=ee,L=le,j=de,O=re,u=x,J=oe;return v(),B("div",null,[$("div",We,[e(I,{"label-width":"200px"},{default:a(()=>[e(_,null,{label:a(()=>[e(z,{message:"generator.fulltext",help:""})]),default:a(()=>[e(o,{disabled:r(D)("generator:fulltext:reindexAll"),loading:s.value,type:"primary",plain:"",onClick:H(m,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.fulltext.reindexAll")),1)]),_:1},8,["disabled","loading"]),r(_e)("generator:fulltext:reindexSite")?(v(),g(o,{key:0,disabled:r(D)("generator:fulltext:reindexSite"),loading:s.value,type:"primary",plain:"",onClick:H(R,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.fulltext.reindexSite")),1)]),_:1},8,["disabled","loading"])):h("",!0)]),_:1}),e(_,null,{label:a(()=>[e(z,{message:"generator.html",help:""})]),default:a(()=>[e(o,{disabled:r(D)("generator:html"),loading:s.value,type:"primary",plain:"",onClick:H(Y,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.html.all")),1)]),_:1},8,["disabled","loading"]),l[7]||(l[7]=$("span",{class:"mx-2"},"|",-1)),e(o,{disabled:r(D)("generator:html"),loading:s.value,type:"primary",plain:"",onClick:H(U,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.html.home")),1)]),_:1},8,["disabled","loading"]),e(o,{disabled:r(D)("generator:html"),loading:s.value,type:"primary",plain:"",onClick:H(G,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.html.channel")),1)]),_:1},8,["disabled","loading"]),e(o,{disabled:r(D)("generator:html"),loading:s.value,type:"primary",plain:"",onClick:H(M,["prevent"])},{default:a(()=>[p(i(f.$t("generator.op.html.article")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),$("div",xe,[$("div",ea,i(f.$t("site.settings.html")),1),Q((v(),g(I,{ref_key:"htmlForm",ref:V,class:"mt-3",model:d.value,disabled:r(D)("siteSettings:html:update"),"label-width":"200px"},{default:a(()=>[e(u,null,{default:a(()=>[e(w,{span:12},{default:a(()=>[e(_,{prop:"enabled",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"site.html.enabled",help:""})]),default:a(()=>[e(k,{modelValue:d.value.enabled,"onUpdate:modelValue":l[0]||(l[0]=c=>d.value.enabled=c)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(w,{span:12},{default:a(()=>[e(_,{prop:"auto",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"site.html.auto",help:""})]),default:a(()=>[e(k,{modelValue:d.value.auto,"onUpdate:modelValue":l[1]||(l[1]=c=>d.value.auto=c)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(w,{span:12},{default:a(()=>[e(_,{prop:"channel",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"site.html.channel",help:""})]),default:a(()=>[e(L,{modelValue:d.value.channel,"onUpdate:modelValue":l[2]||(l[2]=c=>d.value.channel=c),maxlength:"100"},{append:a(()=>l[8]||(l[8]=[p(".html")])),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(w,{span:12},{default:a(()=>[e(_,{prop:"article",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"site.html.article",help:""})]),default:a(()=>[e(L,{modelValue:d.value.article,"onUpdate:modelValue":l[3]||(l[3]=c=>d.value.article=c),maxlength:"100"},{append:a(()=>l[9]||(l[9]=[p(".html")])),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(w,{span:12},{default:a(()=>[e(_,{prop:"listPages",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"site.html.listPages",help:""})]),default:a(()=>[e(O,{modelValue:d.value.listPages,"onUpdate:modelValue":l[4]||(l[4]=c=>d.value.listPages=c),placeholder:"Select"},{default:a(()=>[(v(),B($e,null,he([{label:"1",value:1},{label:"3",value:3},{label:"10",value:10},{label:"100",value:100},{label:"1000",value:1e3},{label:"全部",value:2147483647}],c=>e(j,{key:c.value,label:c.label,value:c.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1})]),_:1}),$("div",null,[e(o,{disabled:r(D)("siteSettings:html:update"),type:"primary","native-type":"submit",onClick:H(N,["prevent"])},{default:a(()=>[p(i(f.$t("submit")),1)]),_:1},8,["disabled"])])]),_:1},8,["model","disabled"])),[[J,y.value]])]),r(K)("config:grey:show")&&r(Ve).epRank>=2?(v(),B("div",aa,[$("div",la,i(f.$t("config.settings.grey")),1),Q((v(),g(I,{ref_key:"greyForm",ref:q,class:"mt-3",model:S.value,disabled:r(D)("config:grey:update"),"label-width":"200px"},{default:a(()=>[e(u,null,{default:a(()=>[e(w,{span:24},{default:a(()=>[e(_,{prop:"enabled",rules:{required:!0,message:()=>f.$t("v.required")}},{label:a(()=>[e(z,{message:"config.grey.enabled"})]),default:a(()=>[e(k,{modelValue:S.value.enabled,"onUpdate:modelValue":l[5]||(l[5]=c=>S.value.enabled=c)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(w,{span:24},{default:a(()=>[e(_,{prop:"greyDates"},{label:a(()=>[e(z,{message:"config.grey.greyDates",help:""})]),default:a(()=>[e(L,{modelValue:S.value.greyDates,"onUpdate:modelValue":l[6]||(l[6]=c=>S.value.greyDates=c),maxlength:"1000"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),$("div",null,[e(o,{disabled:r(D)("config:grey:update"),type:"primary","native-type":"submit",onClick:H(A,["prevent"])},{default:a(()=>[p(i(f.$t("submit")),1)]),_:1},8,["disabled"])])]),_:1},8,["model","disabled"])),[[J,C.value]])])):h("",!0),$("div",ta,[$("div",sa,i(f.$t("generator.taskList")),1)]),e(Ke,{ref_key:"taskListRef",ref:n,class:"mt-3"},null,512)])}}});export{ba as default};
