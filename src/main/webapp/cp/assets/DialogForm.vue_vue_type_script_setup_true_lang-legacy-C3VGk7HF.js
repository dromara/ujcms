System.register(["./index-legacy-DywSgIaj.js"],(function(e,a){"use strict";var l,u,t,i,d,n,v,s,o,r,c,p,f,m,b,y,g,V,h,$,S,_,k,w,q,B,F;return{setters:[e=>{l=e.d,u=e.p,t=e.u,i=e.r,d=e.aa,n=e.aX,v=e.o,s=e.v,o=e.E,r=e.b,c=e.c,p=e.e,f=e.f,m=e.w,b=e.g,y=e.K,g=e.j,V=e.ae,h=e.aq,$=e.n,S=e.t,_=e.h,k=e.bb,w=e.i,q=e.ai,B=e.af,F=e.l}],execute:function(){const a={key:0},D={key:0},E={key:1},I={class:"space-x-2"},x={key:0},C="ujcms_continuous_settings";e("_",l({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},values:{type:Object,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(e,{expose:l,emit:O}){function j(){const e=localStorage.getItem(C);return e?JSON.parse(e):{}}function N(e,a){const l=j();l[e]=a,function(e){localStorage.setItem(C,JSON.stringify(e))}(l)}const J=e,P=O,{name:U,beanId:W,beanIds:z,focus:A,values:K,action:X,modelValue:G}=u(J),{t:H}=t(),L=i(!1),M=i(!1),Q=i((R=U.value,j()[R]??!1));var R;const T=i(),Y=i(J.initValues()),Z=i(),ee=i(),ae=i([]),le=d((()=>null!=ee.value&&"edit"===X.value)),ue=d((()=>!L.value&&!n.isEqual(Z.value,K.value))),te=d((()=>J.disableEdit?.(Y.value)??!1)),ie=d((()=>`${U.value} - ${le.value?`${H(te.value?"detail":"edit")} (ID: ${ee.value})`:`${H("add")}`}`)),de=async()=>{L.value=!0;try{Y.value=null!=ee.value?await J.queryBean(ee.value):J.initValues(K.value,le.value),Z.value=null!=ee.value?J.toValues(Y.value):Y.value,P("update:values",n.cloneDeep(Z.value)),P("beanChange",Y.value),T.value?.resetFields()}finally{L.value=!1}};v((()=>P("update:values",J.initValues()))),s(G,(()=>{G.value&&(ae.value=z.value,ee.value!==W.value?ee.value=W.value:de())})),s(ee,(()=>{de()})),s(Q,(()=>N(U.value,Q.value)));const ne=d((()=>ae.value.indexOf(ee.value))),ve=d((()=>ne.value>0)),se=d((()=>ne.value<ae.value.length-1)),oe=()=>{ve.value&&(ee.value=ae.value[ne.value-1])},re=()=>{se.value&&(ee.value=ae.value[ne.value+1])},ce=()=>{A.value?.focus?.(),ee.value=void 0},pe=()=>{P("update:modelValue",!1)},fe=async()=>{M.value=!0;try{await J.deleteBean([ee.value]),Q.value||P("update:modelValue",!1),se.value?(re(),ae.value.splice(ne.value-1,1)):ve.value?(oe(),ae.value.splice(ne.value+1,1)):P("update:modelValue",!1),o.success(H("success")),P("finished")}finally{M.value=!1}},me=()=>{Z.value=J.toValues(K.value)},be=async()=>{await(J.beforeValidate?.(K.value)),T.value.validate((async e=>{if(e){M.value=!0;try{if(await(J.preventSubmit?.(K.value)))return;P("beforeSubmit",K.value),le.value?(await J.updateBean(K.value),me()):(await J.createBean(K.value),A.value?.focus?.(),P("update:values",J.initValues(K.value,le.value)),T.value.resetFields()),o.success(H("success")),Q.value||P("update:modelValue",!1),P("finished",Y.value)}finally{M.value=!1}}}))};return l({form:T,submit:e=>{T.value.validate((async a=>{if(a){M.value=!0;try{if(await(J.preventSubmit?.(K.value)))return;P("beforeSubmit",K.value),await e(K.value,{isEdit:le.value,continuous:Q.value,form:T.value,props:J,focus:A.value,loadBean:de,resetOrigValues:me,emit:P}),Q.value||P("update:modelValue",!1),P("finished",Y.value)}finally{M.value=!1}}}))},remove:async e=>{M.value=!0;try{await e(K.value,{isEdit:le.value,continuous:Q.value,form:T.value,props:J,focus:A.value,loadBean:de,emit:P}),Q.value||P("update:modelValue",!1),se.value?(re(),ae.value.splice(ne.value-1,1)):ve.value?(oe(),ae.value.splice(ne.value+1,1)):P("update:modelValue",!1),o.success(H("success")),P("finished")}finally{M.value=!1}}}),(l,u)=>{const t=r("el-button"),i=r("el-popconfirm"),d=r("el-button-group"),n=r("el-switch"),v=r("el-tooltip"),s=r("el-tag"),o=r("el-form"),C=r("el-dialog"),O=c("loading");return p(),f(C,{title:ie.value,"close-on-click-modal":!ue.value,"model-value":e.modelValue,width:e.large?"98%":"768px",top:e.large?"16px":"8vh","onUpdate:modelValue":u[3]||(u[3]=e=>l.$emit("update:modelValue",e)),onOpened:u[4]||(u[4]=()=>!le.value&&g(A)?.focus())},{header:m((()=>[$(S(g(U))+" - ",1),le.value?(p(),y("span",a,[$(S(l.$t(te.value?"detail":"edit"))+" ",1),e.showId?(p(),y("span",D,"(ID: "+S(ee.value)+")",1)):_("",!0)])):(p(),y("span",E,S(l.$t("add")),1))])),default:m((()=>[b((p(),y("div",I,[le.value&&e.addable?(p(),f(t,{key:0,disabled:g(h)(`${e.perms}:create`),type:"primary",icon:g(V),onClick:ce},{default:m((()=>[$(S(l.$t("add")),1)])),_:1},8,["disabled","icon"])):_("",!0),k(l.$slots,"header-action",{bean:Y.value,isEdit:le.value,disabled:te.value,unsaved:ue.value,disableDelete:e.disableDelete,handleDelete:fe},(()=>[le.value?(p(),f(i,{key:0,title:l.$t("confirmDelete"),onConfirm:u[0]||(u[0]=()=>fe())},{reference:m((()=>[w(t,{disabled:e.disableDelete?.(Y.value)||g(h)(`${e.perms}:delete`),icon:g(q)},{default:m((()=>[$(S(l.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"])):_("",!0)])),le.value?(p(),f(d,{key:1},{default:m((()=>[w(t,{disabled:!ve.value,onClick:oe},{default:m((()=>[$(S(l.$t("form.prev")),1)])),_:1},8,["disabled"]),w(t,{disabled:!se.value,onClick:re},{default:m((()=>[$(S(l.$t("form.next")),1)])),_:1},8,["disabled"])])),_:1})):_("",!0),w(t,{type:"primary",onClick:pe},{default:m((()=>[$(S(l.$t("back")),1)])),_:1}),w(v,{content:l.$t("form.continuous"),placement:"top"},{default:m((()=>[w(n,{modelValue:Q.value,"onUpdate:modelValue":u[1]||(u[1]=e=>Q.value=e),size:"small"},null,8,["modelValue"])])),_:1},8,["content"]),ue.value?(p(),f(s,{key:2,type:"danger"},{default:m((()=>[$(S(l.$t("form.unsaved")),1)])),_:1})):_("",!0),k(l.$slots,"header-status",{bean:Y.value,isEdit:le.value,disabled:te.value})])),[[O,L.value||M.value]]),w(o,{ref_key:"form",ref:T,class:B(["mt-5","pr-5"]),model:g(K),disabled:te.value,"label-width":e.labelWidth,"label-position":e.labelPosition,"scroll-to-error":""},{default:m((()=>[k(l.$slots,"default",{bean:Y.value,isEdit:le.value,disabled:te.value}),te.value?_("",!0):b((p(),y("div",x,[k(l.$slots,"footer-action",{bean:Y.value,isEdit:le.value,disabled:te.value,handleSubmit:be},(()=>[w(t,{disabled:g(h)(le.value?`${e.perms}:update`:`${e.perms}:create`),type:"primary","native-type":"submit",onClick:u[2]||(u[2]=F((()=>be()),["prevent"]))},{default:m((()=>[$(S(l.$t("save")),1)])),_:1},8,["disabled"])]))])),[[O,M.value]])])),_:3},8,["model","disabled","label-width","label-position"])])),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}}))}}}));
