System.register(["./index-legacy-DSyHl_gO.js","./el-image-viewer-legacy-CIR5rpOy.js","./position-legacy-Bet9q91X.js"],(function(e,a){"use strict";var l,t,s,u,r,o,d,n,i,p,c,v,m,g,h,w,y,f,V,b,x,$,_,k,q,M,C,P,U,S,I,L,A,D,F,E,R,j,T,B,G,N,O,J,z,H,K,Q,W;return{setters:[e=>{l=e.d,t=e.u,s=e.a,u=e.r,r=e.o,o=e.q,d=e.b,n=e.c,i=e.w,p=e.e,c=e.E,v=e.f,m=e.g,g=e.h,h=e.i,w=e.j,y=e.k,f=e.l,V=e.m,b=e.n,x=e.s,$=e.p,_=e.t,k=e.v,q=e.x,M=e.y,C=e.z,P=e.A,U=e.B,S=e.C,I=e.D,L=e.F,A=e.G,D=e.H,F=e.I,E=e.J,R=e.K,j=e.L,T=e.M,B=e.N,G=e.O,N=e.P,O=e.Q,J=e.R,z=e.S,H=e.T,K=e.U,Q=e._},e=>{W=e.E},null],execute:function(){var a=document.createElement("style");a.textContent="[data-v-db47676c] .captcha .el-input-group__append{padding:0}\n/*$vite$:1*/",document.head.appendChild(a);const X=l({name:"ChangePassword",__name:"ChangePassword",props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null},setup(e,{emit:a}){const l=a,{t:P}=t(),U=s(),S=u({}),I=u(),L=u(),A=u(!1),D=u(!1),F=u(""),E=u();r((async()=>{A.value=!0;try{F.value=await o()}finally{A.value=!1}}));const R=()=>{I.value.validate((async e=>{if(e){D.value=!0;try{const e=x(S.value.password,F.value),a=x(S.value.newPassword,F.value),t=await $({...S.value,password:e,newPassword:a,passwordAgain:void 0});if(0!==t.status)return void(E.value=t.message);E.value=void 0,I.value.resetFields(),_.success(P("success")),l("update:modelValue",!1)}finally{D.value=!1}}}))};return(a,l)=>{const t=v,s=w,u=h,r=V,o=c,x=C,$=M;return d(),n(x,{title:a.$t("changePassword"),"model-value":e.modelValue,"onUpdate:modelValue":l[4]||(l[4]=e=>a.$emit("update:modelValue",e)),onOpened:l[5]||(l[5]=()=>{L.value?.focus(),I.value.resetFields()})},{default:i((()=>[p((d(),n(o,{ref_key:"form",ref:I,model:S.value,"label-width":"150px","label-position":"right"},{default:i((()=>[E.value?(d(),n(t,{key:0,title:E.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),g(u,{prop:"username",label:a.$t("user.username"),rules:[{required:!0,message:()=>a.$t("v.required")}]},{default:i((()=>[g(s,{ref_key:"focus",ref:L,modelValue:S.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value.username=e),maxlength:"30"},null,8,["modelValue"])])),_:1},8,["label","rules"]),g(u,{prop:"password",label:a.$t("user.origPassword"),rules:[{required:!0,message:()=>a.$t("v.required")}]},{default:i((()=>[g(s,{modelValue:S.value.password,"onUpdate:modelValue":l[1]||(l[1]=e=>S.value.password=e),maxlength:"50","show-password":""},null,8,["modelValue"])])),_:1},8,["label","rules"]),g(u,{prop:"newPassword",label:a.$t("user.newPassword"),rules:[{required:!0,message:()=>a.$t("v.required")},{min:y(U).security.passwordMinLength,max:y(U).security.passwordMaxLength,message:()=>a.$t("user.error.passwordLength",{min:y(U).security.passwordMinLength,max:y(U).security.passwordMaxLength})},{pattern:new RegExp(y(U).security.passwordPattern),message:()=>a.$t(`user.error.passwordPattern.${y(U).security.passwordStrength}`)}]},{default:i((()=>[g(s,{modelValue:S.value.newPassword,"onUpdate:modelValue":l[2]||(l[2]=e=>S.value.newPassword=e),maxlength:y(U).security.passwordMaxLength,"show-password":""},null,8,["modelValue","maxlength"])])),_:1},8,["label","rules"]),g(u,{prop:"passwordAgain",label:a.$t("user.passwordAgain"),rules:[{required:!0,message:()=>a.$t("v.required")},{validator:(e,l,t)=>{l===S.value.newPassword?t():t(a.$t("user.error.passwordNotMatch"))}}]},{default:i((()=>[g(s,{modelValue:S.value.passwordAgain,"onUpdate:modelValue":l[3]||(l[3]=e=>S.value.passwordAgain=e),maxlength:"50","show-password":""},null,8,["modelValue"])])),_:1},8,["label","rules"]),f("div",null,[g(r,{loading:D.value,type:"primary","native-type":"submit",onClick:b(R,["prevent"])},{default:i((()=>[k(q(a.$t("submit")),1)])),_:1},8,["loading"])])])),_:1},8,["model"])),[[$,A.value]])])),_:1},8,["title","model-value"])}}}),Y=l({name:"GetShortMessage",__name:"GetShortMessage",props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finish:null},setup(e,{emit:a}){const l=e,s=a,{modelValue:r}=P(l),{t:o}=t(),p=u(),x=u(),$=u({}),M=u(!1),F=u(),E=u(),R=u(),j=async()=>{const{token:e,image:a}=await S();E.value="data:image/png;base64,"+a,R.value=e};U(r,(()=>{r.value&&j()}));const T=()=>{p.value.validate((async e=>{if(e){M.value=!0;try{const e=await D(R.value??"",$.value.captcha,$.value.mobile,3);if(0!==e.status)return void(F.value=e.message);F.value=void 0,p.value.resetFields(),_.success(o("success")),s("finish",e.result.shortMessageId),s("update:modelValue",!1)}finally{M.value=!1}}}))};return(a,l)=>{const t=v,s=w,u=h,r=W,o=V,_=c,P=C;return d(),n(P,{title:a.$t("getShortMessage"),"model-value":e.modelValue,width:"576px","onUpdate:modelValue":l[3]||(l[3]=e=>a.$emit("update:modelValue",e)),onOpened:l[4]||(l[4]=()=>{x.value?.focus(),p.value.resetFields()})},{default:i((()=>[g(_,{ref_key:"form",ref:p,model:$.value,"label-width":"150px","label-position":"right"},{default:i((()=>[F.value?(d(),n(t,{key:0,title:F.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),g(u,{prop:"mobile",label:a.$t("mobile"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(e,l,t)=>{await y(I)(l)?t(a.$t("mobileNotExist")):t()},trigger:"blur"}]},{default:i((()=>[g(s,{ref_key:"focus",ref:x,modelValue:$.value.mobile,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value.mobile=e),maxlength:"30"},null,8,["modelValue"])])),_:1},8,["label","rules"]),g(u,{prop:"captcha",label:a.$t("captcha"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(e,l,t)=>{null!=R.value&&await y(L)(R.value,l)?t():t(a.$t("captchaIncorrect"))},trigger:"blur"}],class:"captcha"},{default:i((()=>[g(s,{modelValue:$.value.captcha,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value.captcha=e),name:"captcha",placeholder:a.$t("captcha"),"prefix-icon":y(A)},{append:i((()=>[g(r,{src:E.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:a.$t("clickToRetrieveCaptcha"),onClick:l[1]||(l[1]=()=>j())},null,8,["src","title"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["label","rules"]),f("div",null,[g(o,{loading:M.value,type:"primary","native-type":"submit",onClick:b(T,["prevent"])},{default:i((()=>[k(q(a.$t("submit")),1)])),_:1},8,["loading"])])])),_:1},8,["model"])])),_:1},8,["title","model-value"])}}}),Z={class:"h-full p-3 bg-gray-100"},ee={class:"py-5 text-3xl font-bold text-center text-primary"},ae={class:"mt-2 text-right"},le={key:0,class:"mt-5 text-sm text-center text-gray-secondary"};e("default",Q(l({__name:"LoginPage",setup(e){const{t:a}=t(),l=u(),s=u({}),p=u(),$=u(!1),_=u(!1),M=u(),C=u(),P=u(),U=u(),I=u(!1),D=u(),Q=F(),te=E(),se=u(!1),ue=u(!1),re=u(60),oe=u(a("getShortMessage"));R(),j();const de=async()=>{const{token:e,image:a}=await S();M.value="data:image/png;base64,"+a,C.value=e},ne=async()=>{$.value=await T(),$.value&&de()};r((async()=>{p.value.focus(),p.value.select(),ne(),(async()=>{_.value=await B()})()})),G((()=>{D.value=Q.query.redirect}));const ie=e=>{P.value=e,re.value-=1,oe.value=String(re.value);const l=setInterval((()=>{re.value-=1,oe.value=String(re.value),re.value<=0&&(oe.value=a("getShortMessage"),re.value=60,clearInterval(l))}),1e3)},pe=()=>{l.value.validate((async e=>{if(e){I.value=!0;try{const e=await o(),l=x(s.value.password,e),t=await H({...s.value,password:l,captchaToken:C.value,shortMessageId:P.value});if(0!==t.status)return ne(),void(U.value=t.message);null!=t.result.remainingDays&&K.alert(a("passwordRemaingDays",{remainingDays:t.result.remainingDays}),{type:"warning"}),D.value?te.push(D.value):location.reload()}finally{I.value=!1}}}))};return(e,a)=>{const t=v,u=w,r=h,o=V,x=W,P=c;return d(),N("div",Z,[f("h3",ee,q(y("UJCMS")),1),g(P,{ref_key:"form",ref:l,model:s.value,class:"mx-auto md:max-w-xs"},{default:i((()=>[U.value?(d(),n(t,{key:0,title:U.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),g(r,{prop:"username",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:i((()=>[g(u,{ref_key:"focus",ref:p,modelValue:s.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.username=e),name:"username",placeholder:e.$t("username"),"prefix-icon":y(O),autocomplete:"on"},null,8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"]),g(r,{prop:"password",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:i((()=>[g(u,{ref:"password",modelValue:s.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.password=e),type:"password",name:"password",placeholder:e.$t("password"),"prefix-icon":y(J),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"]),_.value?(d(),n(r,{key:1,prop:"shortMessageValue",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:i((()=>[g(u,{modelValue:s.value.shortMessageValue,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.shortMessageValue=e),name:"shortMessageValue",placeholder:e.$t("shortMessage"),"prefix-icon":y(z)},{append:i((()=>[g(o,{disabled:re.value<60,onClick:a[2]||(a[2]=()=>ue.value=!0)},{default:i((()=>[k(q(oe.value),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"])):m("",!0),$.value?(d(),n(r,{key:2,prop:"captcha",rules:[{required:!0,message:()=>e.$t("v.required")},{asyncValidator:async(a,l,t)=>{null!=C.value&&await y(L)(C.value,l)?t():t(e.$t("captchaIncorrect"))},trigger:"blur"}],class:"captcha"},{default:i((()=>[g(u,{modelValue:s.value.captcha,"onUpdate:modelValue":a[5]||(a[5]=e=>s.value.captcha=e),name:"captcha",placeholder:e.$t("captcha"),"prefix-icon":y(A)},{append:i((()=>[g(x,{src:M.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:e.$t("clickToRetrieveCaptcha"),onClick:a[4]||(a[4]=()=>de())},null,8,["src","title"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"])):m("",!0),f("div",null,[g(o,{type:"primary","native-type":"submit",class:"w-full",loading:I.value,onClick:b(pe,["prevent"])},{default:i((()=>[k(q(e.$t("login")),1)])),_:1},8,["loading"])]),f("div",ae,[g(o,{type:"primary",link:"",onClick:a[6]||(a[6]=()=>se.value=!0)},{default:i((()=>[k(q(e.$t("changePassword")),1)])),_:1})])])),_:1},8,["model"]),"staging"===y("production")?(d(),N("div",le,a[9]||(a[9]=[f("p",null,"为避免数据被删改，演示用户登录后只拥有浏览后台功能，操作数据会显示无权访问（403）",-1)]))):m("",!0),g(X,{modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=e=>se.value=e)},null,8,["modelValue"]),g(Y,{modelValue:ue.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ue.value=e),onFinish:ie},null,8,["modelValue"])])}}}),[["__scopeId","data-v-db47676c"]]))}}}));
