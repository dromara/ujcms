import{E as j,a as R,s as F}from"./el-select-CPBsiljt.js";import{E as I}from"./el-tree-CZELDHk3.js";import{ap as U,B as S,bt as x,ar as g,eH as M,A as B,af as E,d as w,cj as G,at as q,cG as J,eA as $,cl as D,eI as Q,eJ as W,bN as X,cf as Y,al as Z,r as p,cr as T,o as ee,bP as L,aI as te}from"./index-__TSAjOL.js";const le=(e,{attrs:n,emit:o},{select:r,tree:s,key:a})=>{const h=U("tree-select");return S(()=>e.data,()=>{e.filterable&&x(()=>{var t,v;(v=s.value)==null||v.filter((t=r.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...M(B(e),Object.keys(j.props)),...n,"onUpdate:modelValue":t=>o(E,t),valueKey:a,popperClass:g(()=>{const t=[h.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var v;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(v=s.value)==null||v.filter(t)}}},ce=w({extends:R,setup(e,n){const o=R.setup(e,n);delete o.selectOptionClick;const r=G().proxy;return x(()=>{o.select.states.cachedOptions.get(r.value)||o.select.onOptionCreate(r)}),S(()=>n.attrs.visible,s=>{o.states.visible=s},{immediate:!0}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function P(e){return e||e===0}function H(e){return q(e)&&e.length}function b(e){return q(e)?e:P(e)?[e]:[]}function O(e,n,o,r,s){for(let a=0;a<e.length;a++){const h=e[a];if(n(h,a,e,s))return r?r(h,a,e,s):h;{const C=o(h);if(H(C)){const t=O(C,n,o,r,h);if(t)return t}}}}function A(e,n,o,r){for(let s=0;s<e.length;s++){const a=e[s];n(a,s,e,r);const h=o(a);H(h)&&A(h,n,o,a)}}const ae=(e,{attrs:n,slots:o,emit:r},{select:s,tree:a,key:h})=>{S(()=>e.modelValue,()=>{e.showCheckbox&&x(()=>{const l=a.value;l&&!J(l.getCheckedKeys(),b(e.modelValue))&&l.setCheckedKeys(b(e.modelValue))})},{immediate:!0,deep:!0});const C=g(()=>({value:h.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var d;const u=C.value[l];return $(u)?u(c,(d=a.value)==null?void 0:d.getNode(t("value",c))):c[u]},v=b(e.modelValue).map(l=>O(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,d,u,f)=>f&&t("value",f))).filter(l=>P(l)),_=g(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return A(e.data.concat(e.cacheData),c=>{const d=t("value",c);l.push({value:d,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l}),K=()=>{var l;return(l=a.value)==null?void 0:l.getCheckedKeys().filter(c=>{var d;const u=(d=a.value)==null?void 0:d.getNode(c);return!D(u)&&Q(u.childNodes)})};return{...M(B(e),Object.keys(I.props)),...n,nodeKey:h,expandOnClickNode:g(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:g(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(l,{node:c,data:d,store:u})=>l(ce,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:d,store:u}):o.default?()=>o.default({node:c,data:d,store:u}):void 0),filterNodeMethod:(l,c,d)=>e.filterNodeMethod?e.filterNodeMethod(l,c,d):l?new RegExp(W(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,d)=>{var u,f,k,m;if((u=n.onNodeClick)==null||u.call(n,l,c,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(f=s.value)==null?void 0:f.states.options.get(t("value",l));(k=s.value)==null||k.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(m=s.value)==null||m.focus()}},onCheck:(l,c)=>{var d;if(!e.showCheckbox)return;const u=t("value",l),f={};A([a.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const k=c.checkedKeys,m=e.multiple?b(e.modelValue).filter(i=>!(i in f)&&!k.includes(i)):[],N=m.concat(k);if(e.checkStrictly)r(E,e.multiple?N:N.includes(u)?u:void 0);else if(e.multiple){const i=K();r(E,m.concat(i))}else{const i=O([l],y=>!H(t("children",y))&&!t("disabled",y),y=>t("children",y)),V=i?t("value",i):void 0,z=P(e.modelValue)&&!!O([l],y=>t("value",y)===e.modelValue,y=>t("children",y));r(E,V===e.modelValue||z?void 0:V)}x(()=>{var i;const V=b(e.modelValue);a.value.setCheckedKeys(V),(i=n.onCheck)==null||i.call(n,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=s.value)==null||d.focus()},onNodeExpand:(l,c,d)=>{var u;(u=n.onNodeExpand)==null||u.call(n,l,c,d),x(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&c.checked){const f={},k=a.value.getCheckedKeys();A([a.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const m=b(e.modelValue).filter(i=>!(i in f)&&!k.includes(i)),N=K();r(E,m.concat(N))}})},cacheOptions:_}};var ne=w({props:{data:{type:Array,default:()=>[]}},setup(e){const n=X(F);return S(()=>e.data,()=>{var o;e.data.forEach(s=>{n.states.cachedOptions.has(s.value)||n.states.cachedOptions.set(s.value,s)});const r=((o=n.selectRef)==null?void 0:o.querySelectorAll("input"))||[];Y&&!Array.from(r).includes(document.activeElement)&&n.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const se=w({name:"ElTreeSelect",inheritAttrs:!1,props:{...j.props,...I.props,cacheData:{type:Array,default:()=>[]}},setup(e,n){const{slots:o,expose:r}=n,s=p(),a=p(),h=g(()=>e.nodeKey||e.valueKey||"value"),C=le(e,n,{select:s,tree:a,key:h}),{cacheOptions:t,...v}=ae(e,n,{select:s,tree:a,key:h}),_=T({});return r(_),ee(()=>{Object.assign(_,{...M(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...M(s.value,["focus","blur"])})}),()=>L(j,T({...C,ref:K=>s.value=K}),{...o,default:()=>[L(ne,{data:t.value}),L(I,T({...v,ref:K=>a.value=K}))]})}});var de=Z(se,[["__file","tree-select.vue"]]);const re=te(de);export{re as E};
