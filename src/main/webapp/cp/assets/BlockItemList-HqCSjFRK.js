import{d as se,u as ne,r as n,ar as w,B as ie,bi as de,o as ce,t as D,aw as re,b as _,c as k,w as t,h as a,b8 as me,P as ue,aF as be,aG as pe,b9 as ve,l as U,k as s,m as fe,aW as _e,b5 as v,v as B,x as C,aZ as ke,e as ye,aP as ge,aQ as Ie,a3 as he,ay as we,bk as Be,g as Q,y as Ce,bs as Ee,_ as Ve}from"./index-__TSAjOL.js";import{E as $e,a as Se,b as Le}from"./el-main-CxOwtB5j.js";import{E as De}from"./el-switch-Cg-m0Y0i.js";import{E as Ue}from"./el-image-viewer-DHqUxZBa.js";import{E as Te}from"./el-popover-B2t_MYt0.js";import{S as Pe}from"./sortable.esm-DEaZq8gs.js";import{a as Fe}from"./config-BS48XX7b.js";import{U as Ne,V as qe,F as ze,W as Me}from"./content-BqI55UAh.js";import{_ as Oe,a as Qe,b as Re,c as xe}from"./QueryItem.vue_vue_type_script_setup_true_lang-CDNlcHM_.js";import{a as Ae}from"./BlockItemForm.vue_vue_type_script_setup_true_lang-DWTl79cF.js";import"./position-BrJTBGCI.js";import"./el-select-CPBsiljt.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";import"./FileListUpload.vue_vue_type_style_index_0_scoped_b3a09e2e_lang-BDXrjCRY.js";import"./BaseUpload.vue_vue_type_style_index_0_scoped_248c0508_lang-XLXSgCOW.js";import"./vuedraggable.umd-BWOm6k_s.js";import"./BaseUpload-DtBZbJkV.js";const We={class:"mb-3"},je={class:"mt-3 app-block"},Ge=se({name:"BlockItemList",__name:"BlockItemList",setup(Ze){const{t:E}=ne(),y=n({}),f=n(),T=n(),c=n([]),V=n([]),$=n(!1),g=n(!1),S=n(),R=w(()=>c.value.map(e=>e.id)),x=n(!1),I=n([]),b=n(),A=w(()=>I.value.find(e=>e.id===b.value)),W=w(()=>c.value.map(e=>e.image)),j=w(()=>c.value.map(e=>e.mobileImage)),P=n(!1),p=async()=>{$.value=!0;try{c.value=await Ne({...de(y.value),blockId:b.value,Q_OrderBy:f.value}),x.value=Object.values(y.value).filter(e=>e!==void 0&&e!=="").length>0||f.value!==void 0,P.value=f.value!==void 0}finally{$.value=!1}},G=async()=>{I.value=await Fe(),b.value=String(I.value[0].id)};let L;const Z=()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");L=Pe.create(e,{handle:".drag-handle",animation:200,chosenClass:"sortable-chosen",onEnd:async function(o){const{oldIndex:r,newIndex:m}=o;r!==m&&(await qe(c.value[r].id,c.value[m].id),c.value.splice(m,0,c.value.splice(r,1)[0]),D.success(E("success")))}})};ie(b,()=>p()),ce(async()=>{await G(),Z()}),re(()=>{L!==void 0&&L.destroy()});const H=({column:e,prop:o,order:r})=>{var m;o&&r?f.value=((m=e.sortBy)!=null?m:o)+(r==="descending"?"_desc":""):f.value=void 0,p()},J=()=>p(),K=()=>{T.value.clearSort(),Ee(y.value),f.value=void 0,p()},X=()=>{S.value=void 0,g.value=!0},F=e=>{S.value=e,g.value=!0},N=async e=>{await Me(e),p(),D.success(E("success"))},q=async e=>{await ze(e),p(),D.success(E("success"))};return(e,o)=>{const r=ve,m=me,Y=$e,h=fe,z=Te,d=Ie,ee=he,M=Ue,O=De,ae=ge,le=Se,te=Le,oe=Ce;return _(),k(te,null,{default:t(()=>[a(Y,{width:"180px",class:"pr-3"},{default:t(()=>[a(m,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=u=>b.value=u),"tab-position":"left",stretch:"",class:"bg-white"},{default:t(()=>[(_(!0),ue(be,null,pe(I.value,u=>(_(),k(r,{key:u.id,name:String(u.id),label:u.name},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(le,{class:"p-0"},{default:t(()=>{var u;return[U("div",We,[a(s(Oe),{params:y.value,onSearch:J,onReset:K},{default:t(()=>[a(s(Qe),{label:e.$t("blockItem.title"),name:"Q_Contains_title"},null,8,["label"])]),_:1},8,["params"])]),U("div",null,[a(h,{type:"primary",disabled:!((u=A.value)!=null&&u.enabled)||s(v)("blockItem:create"),icon:s(_e),onClick:o[1]||(o[1]=()=>X())},{default:t(()=>[B(C(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(z,{title:e.$t("confirmDelete"),onConfirm:o[2]||(o[2]=()=>q(V.value.map(l=>l.id)))},{reference:t(()=>[a(h,{disabled:V.value.length<=0||s(v)("blockItem:delete"),icon:s(ke)},{default:t(()=>[B(C(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(s(Re),{name:"blockItem",class:"ml-2"})]),U("div",je,[ye((_(),k(ae,{id:"dataTable",ref_key:"table",ref:T,"row-key":"id",data:c.value,onSelectionChange:o[3]||(o[3]=l=>V.value=l),onRowDblclick:o[4]||(o[4]=l=>F(l.id)),onSortChange:H},{default:t(()=>[a(s(xe),{name:"blockItem"},{default:t(()=>[a(d,{type:"selection",width:"38"}),a(d,{width:"42"},{default:t(()=>[a(ee,{class:we(["text-lg align-middle",P.value||s(v)("blockItem:update")?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]]),disalbed:""},{default:t(()=>[a(s(Be))]),_:1},8,["class"])]),_:1}),a(d,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(d,{property:"title",label:e.$t("blockItem.title"),sortable:"custom","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(d,{property:"subtitle",label:e.$t("blockItem.subtitle"),sortable:"custom",display:"none","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(d,{property:"image",label:e.$t("blockItem.image")},{default:t(({row:l,$index:i})=>[l.image?(_(),k(M,{key:0,src:l.image,fit:"contain","preview-src-list":W.value,"initial-index":i,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):Q("",!0)]),_:1},8,["label"]),a(d,{property:"mobileImage",label:e.$t("blockItem.mobileImage"),display:"none"},{default:t(({row:l,$index:i})=>[l.mobileImage?(_(),k(M,{key:0,src:l.mobileImage,fit:"contain","preview-src-list":j.value,"initial-index":i,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):Q("",!0)]),_:1},8,["label"]),a(d,{property:"targetBlank",label:e.$t("blockItem.targetBlank"),sortable:"custom",width:"120"},{default:t(({row:l})=>[a(O,{modelValue:l.targetBlank,"onUpdate:modelValue":i=>l.targetBlank=i,disabled:s(v)("blockItem:update"),onChange:i=>N({...l,targetBlank:i})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(d,{property:"enabled",label:e.$t("enable"),sortable:"custom",width:"100"},{default:t(({row:l})=>[a(O,{modelValue:l.enabled,"onUpdate:modelValue":i=>l.enabled=i,disabled:s(v)("blockItem:update"),onChange:i=>N({...l,enabled:i})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(d,{label:e.$t("table.action")},{default:t(({row:l})=>[a(h,{type:"primary",disabled:s(v)("blockItem:update"),size:"small",link:"",onClick:()=>F(l.id)},{default:t(()=>[B(C(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(z,{title:e.$t("confirmDelete"),onConfirm:()=>q([l.id])},{reference:t(()=>[a(h,{type:"primary",disabled:s(v)("blockItem:delete"),size:"small",link:""},{default:t(()=>[B(C(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[oe,$.value]])]),a(Ae,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=l=>g.value=l),"bean-id":S.value,"bean-ids":R.value,"block-id":b.value,onFinished:p},null,8,["modelValue","bean-id","bean-ids","block-id"])]}),_:1})]),_:1})}}}),ua=Ve(Ge,[["__scopeId","data-v-737e9d46"]]);export{ua as default};
