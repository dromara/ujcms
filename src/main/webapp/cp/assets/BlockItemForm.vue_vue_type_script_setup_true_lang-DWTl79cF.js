import{d as O,A as P,r as y,B as K,bH as Q,b as n,c as p,w as d,h as o,a6 as Z,P as w,aF as C,aG as X,a2 as x,l as j,ay as _,m as Y,v as S,x as J,z as ee,ar as le,o as ae,i as te,g as b,j as ue,k as f}from"./index-__TSAjOL.js";import{E as oe}from"./el-switch-Cg-m0Y0i.js";import{E as de,a as re}from"./el-select-CPBsiljt.js";import{a as ne}from"./config-BS48XX7b.js";import{F as ie,W as se,X as me,Y as pe}from"./content-BqI55UAh.js";import{_ as be}from"./DialogForm.vue_vue_type_script_setup_true_lang-CYMSRniG.js";import{a as G}from"./FileListUpload.vue_vue_type_style_index_0_scoped_b3a09e2e_lang-BDXrjCRY.js";import"./BaseUpload.vue_vue_type_style_index_0_scoped_248c0508_lang-XLXSgCOW.js";import"./vuedraggable.umd-BWOm6k_s.js";import{B as ve}from"./BaseUpload-DtBZbJkV.js";const ke=["onClick"],fe=["src"],ce=O({__name:"ImageExtractor",props:{modelValue:{type:Boolean,required:!0},urls:{type:Array,default:()=>[]},min:{type:Number,default:1},max:{type:Number,default:1},appendToBody:{type:Boolean}},emits:["update:modelValue","finished"],setup(i,{emit:h}){const c=i,g=h,{urls:B,max:l,modelValue:I}=P(c),u=y();K(I,()=>{I.value&&(u.value=Q.uniq(B.value).map(e=>({url:e,checked:!1})))});const $=e=>{if(e.checked){e.checked=!e.checked;return}let v=0;u.value.forEach(V=>{V.checked&&(v+=1),v>=l.value&&(V.checked=!1)}),e.checked=!0},t=()=>{g("finished",u.value.filter(e=>e.checked).map(e=>e.url)),g("update:modelValue",!1)};return(e,v)=>{const V=x,s=Z,k=Y,E=ee;return n(),p(E,{"model-value":i.modelValue,title:e.$t("article.extractImage"),width:768,"append-to-body":i.appendToBody,"onUpdate:modelValue":v[1]||(v[1]=m=>e.$emit("update:modelValue",m))},{footer:d(()=>[o(k,{type:"primary",disabled:u.value.filter(m=>m.checked).length<i.min,onClick:v[0]||(v[0]=()=>t())},{default:d(()=>[S(J(e.$t("ok")),1)]),_:1},8,["disabled"])]),default:d(()=>[o(s,{gutter:16},{default:d(()=>[(n(!0),w(C,null,X(u.value,m=>(n(),p(V,{key:m.url,src:m,span:8,class:"mt-2"},{default:d(()=>[j("div",{class:_(["p-1 border-2 rounded cursor-pointer text-center",{"border-primary":m.checked,"border-2":m.checked}]),onClick:()=>$(m)},[j("img",{src:m.url,class:"max-h-36 inline"},null,8,fe)],10,ke)]),_:2},1032,["src"]))),128))]),_:1})]),_:1},8,["model-value","title","append-to-body"])}}}),Ee=O({name:"BlockItemForm",__name:"BlockItemForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},blockId:{type:String,default:null},articleId:{type:String,default:null},title:{type:String,default:null},description:{type:String,default:null},video:{type:String,default:null},images:{type:Array,default:()=>[]}},emits:{"update:modelValue":null,finished:null},setup(i){const h=i,{blockId:c}=P(h),g=y(),B=y(),l=y({}),I=y([]),u=le(()=>I.value.find(t=>{var e;return t.id===((e=g.value)!=null?e:c==null?void 0:c.value)}));ae(async()=>{I.value=await ne()});const $=y(!1);return(t,e)=>{var R;const v=re,V=de,s=te,k=ue,E=Y,m=oe;return n(),w("div",null,[o(be,{values:l.value,"onUpdate:values":e[14]||(e[14]=r=>l.value=r),name:t.$t("menu.content.blockItem"),"query-bean":f(pe),"create-bean":f(me),"update-bean":f(se),"delete-bean":f(ie),"bean-id":i.beanId,"bean-ids":i.beanIds,focus:B.value,"init-values":()=>({blockId:f(c),articleId:i.articleId,title:i.title,description:i.description,video:i.video,enabled:!0}),"to-values":r=>{var q,U;return{...r,articleTitle:(q=r.article)==null?void 0:q.title,articleId:(U=r.article)==null?void 0:U.id}},addable:(R=u.value)==null?void 0:R.enabled,perms:"blockItem","model-value":i.modelValue,"onUpdate:modelValue":e[15]||(e[15]=r=>t.$emit("update:modelValue",r)),onFinished:e[16]||(e[16]=()=>t.$emit("finished")),onBeanChange:e[17]||(e[17]=r=>g.value=r.blockId)},{default:d(({isEdit:r})=>{var q,U,F,T,N,L,A,D,H,W,z,M;return[o(s,{prop:"blockId",label:t.$t("blockItem.block"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[o(V,{modelValue:l.value.blockId,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.blockId=a),class:"w-full",disabled:"",onChange:e[1]||(e[1]=a=>g.value=a)},{default:d(()=>[(n(!0),w(C,null,X(I.value,a=>(n(),w(C,{key:a.id},[r||a.enabled?(n(),p(v,{key:0,label:a.name,value:a.id,disabled:!a.enabled},null,8,["label","value","disabled"])):b("",!0)],64))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label","rules"]),r&&l.value.articleId!=null?(n(),p(s,{key:0,label:t.$t("blockItem.articleId")},{default:d(()=>[o(k,{modelValue:l.value.articleId,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.articleId=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):b("",!0),r&&l.value.articleTitle!=null?(n(),p(s,{key:1,label:t.$t("blockItem.articleTitle")},{default:d(()=>[o(k,{modelValue:l.value.articleTitle,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.articleTitle=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):b("",!0),o(s,{prop:"title",label:t.$t("blockItem.title"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[o(k,{ref_key:"focus",ref:B,modelValue:l.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.title=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l.value.articleId==null&&((q=u.value)!=null&&q.withLinkUrl)?(n(),p(s,{key:2,prop:"linkUrl",label:t.$t("blockItem.linkUrl"),rules:(U=u.value)!=null&&U.linkUrlRequired?[{required:!0,message:()=>t.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>t.$t("blockItem.error.linkUrl")}]:{pattern:/^(http|\/).*$/,message:()=>t.$t("blockItem.error.linkUrl")}},{default:d(()=>[o(k,{modelValue:l.value.linkUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.linkUrl=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label","rules"])):b("",!0),(F=u.value)!=null&&F.withSubtitle?(n(),p(s,{key:3,prop:"subtitle",label:t.$t("blockItem.subtitle"),rules:{required:(T=u.value)==null?void 0:T.subtitleRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(k,{modelValue:l.value.subtitle,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.subtitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"])):b("",!0),(N=u.value)!=null&&N.withDescription?(n(),p(s,{key:4,prop:"description",label:t.$t("blockItem.description"),rules:{required:(L=u.value)==null?void 0:L.descriptionRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(k,{modelValue:l.value.description,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.description=a),type:"textarea",rows:5,maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["label","rules"])):b("",!0),(A=u.value)!=null&&A.withImage?(n(),p(s,{key:5,prop:"image",label:t.$t("blockItem.image"),rules:{required:(D=u.value)==null?void 0:D.imageRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(f(G),{modelValue:l.value.image,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.image=a),width:u.value.imageWidth,height:u.value.imageHeight,mode:"manual"},null,8,["modelValue","width","height"]),i.images.length>0?(n(),p(E,{key:0,class:"self-start ml-2",onClick:e[9]||(e[9]=()=>$.value=!0)},{default:d(()=>[S(J(t.$t("article.extractImage")),1)]),_:1})):b("",!0)]),_:1},8,["label","rules"])):b("",!0),(H=u.value)!=null&&H.withMobileImage?(n(),p(s,{key:6,prop:"mobileImage",label:t.$t("blockItem.mobileImage"),rules:{required:(W=u.value)==null?void 0:W.mobileImageRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(f(G),{modelValue:l.value.mobileImage,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.mobileImage=a),width:u.value.mobileImageWidth,height:u.value.mobileImageHeight,mode:"manual"},null,8,["modelValue","width","height"])]),_:1},8,["label","rules"])):b("",!0),(z=u.value)!=null&&z.withVideo?(n(),p(s,{key:7,prop:"video",label:t.$t("blockItem.video"),rules:{required:(M=u.value)==null?void 0:M.videoRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(k,{modelValue:l.value.video,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.video=a),maxlength:"255"},{prepend:d(()=>e[20]||(e[20]=[S("URL")])),_:1},8,["modelValue"]),o(f(ve),{type:"video","on-success":a=>l.value.video=a.url},null,8,["on-success"])]),_:1},8,["label","rules"])):b("",!0),o(s,{prop:"targetBlank",label:t.$t("blockItem.targetBlank")},{default:d(()=>[o(m,{modelValue:l.value.targetBlank,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.targetBlank=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(s,{prop:"enabled",label:t.$t("blockItem.enabled")},{default:d(()=>[o(m,{modelValue:l.value.enabled,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.enabled=a)},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","addable","model-value"]),o(ce,{modelValue:$.value,"onUpdate:modelValue":e[18]||(e[18]=r=>$.value=r),urls:i.images,"append-to-body":!0,onFinished:e[19]||(e[19]=r=>l.value.image=r[0])},null,8,["modelValue","urls"])])}}});export{ce as _,Ee as a};
