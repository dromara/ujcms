import{d as Q,r as i,b as A,c as R,w as o,h as a,i as H,j as te,b3 as J,P as j,aF as W,aG as ne,k as p,A as ue,u as Z,ar as X,$ as ie,B as re,o as Y,l as h,aO as x,v as $,x as V,m as ee,t as le,E as de,b6 as me,g as pe,bi as ce,bs as ve,aW as fe,b5 as w,aZ as be,bI as ye,e as ge,y as _e,aQ as $e,aP as Ve}from"./index-DiyxZ9gY.js";import{E as ke}from"./el-popover-B-PHJYDd.js";import{F as ae,G as Pe,H as he,I as se,J as Ce,K as Ee,b as we,L as Ae}from"./user-C6ybep-G.js";import{E as Ge,a as M,_ as Se,b as Fe,c as Ue}from"./QueryItem.vue_vue_type_script_setup_true_lang-C8NUyNWU.js";import{_ as qe}from"./ListMove.vue_vue_type_script_setup_true_lang-CHagpDmg.js";import{E as De,a as Ie}from"./el-select-Fa4N2NlQ.js";import{E as oe}from"./el-switch-D_ifMf8o.js";import{_ as Be}from"./DialogForm.vue_vue_type_script_setup_true_lang-BWkTpKxX.js";import{E as Te}from"./el-tree-BDoQeytB.js";import{t as Le}from"./tree-CFBn_SXc.js";import{d as Ne}from"./content-wcwZylI0.js";import"./el-input-number-BwGcALb9.js";const ze=Q({name:"GroupForm",__name:"GroupForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(P){const C=i(),r=i({});return(d,t)=>{const g=te,y=H,k=oe,_=Ie,f=De;return A(),R(Be,{values:r.value,"onUpdate:values":t[4]||(t[4]=s=>r.value=s),name:d.$t("menu.user.group"),"query-bean":p(se),"create-bean":p(he),"update-bean":p(Pe),"delete-bean":p(ae),"bean-id":P.beanId,"bean-ids":P.beanIds,focus:C.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":s=>({...s}),"disable-delete":s=>s.id<=10,perms:"group","model-value":P.modelValue,"onUpdate:modelValue":t[5]||(t[5]=s=>d.$emit("update:modelValue",s)),onFinished:t[6]||(t[6]=()=>d.$emit("finished"))},{default:o(({})=>[a(y,{prop:"name",label:d.$t("group.name"),rules:{required:!0,message:()=>d.$t("v.required")}},{default:o(()=>[a(g,{ref_key:"focus",ref:C,modelValue:r.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(y,{prop:"description",label:d.$t("group.description")},{default:o(()=>[a(g,{modelValue:r.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.description=s),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),a(y,{prop:"allAccessPermission"},{label:o(()=>[a(J,{message:"group.allAccessPermission"})]),default:o(()=>[a(k,{modelValue:r.value.allAccessPermission,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.allAccessPermission=s)},null,8,["modelValue"])]),_:1}),a(y,{prop:"type",label:d.$t("group.type"),rules:{required:!0,message:()=>d.$t("v.required")}},{default:o(()=>[a(f,{modelValue:r.value.type,"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.type=s),disabled:r.value.type===1},{default:o(()=>[(A(),j(W,null,ne([1,2],s=>a(_,{key:s,disabled:s===1,label:d.$t("group.type.".concat(s)),value:s},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),Oe={class:"border-t"},Qe={class:"flex items-center justify-between"},Re=Q({name:"GroupPermissionForm",__name:"GroupPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null}},emits:{"update:modelValue":null,finished:null},setup(P,{emit:C}){const r=P,d=C,{beanId:t,modelValue:g}=ue(r),{t:y}=Z(),k=i(),_=i({}),f=i({}),s=i(!1),F=i(!0),G=i(!1),c=i(),E=i([]),U=X(()=>ie.rank>_.value.rank),T=async()=>{(t==null?void 0:t.value)!=null&&(_.value=await se(t.value),f.value={..._.value})},L=async()=>{E.value=Le(await Ne())},q=async()=>{var e;if((t==null?void 0:t.value)!=null){const l=await Ce(t.value);(e=c.value)==null||e.setCheckedKeys([]),l.forEach(u=>{var m;(m=c.value)==null||m.setChecked(u,!0,!1)})}};re(g,()=>{g.value&&(T(),q())}),Y(()=>{L()});const D=(e,l,u,m)=>{u.forEach(v=>{v.children&&(l.getNode(v[m]).expanded=e,D(e,l,v.children,m))})},S=(e,l,u,m)=>{l.setCheckedKeys(e?u.map(v=>v[m]):[])},I=()=>{k.value.validate(async e=>{if(e){s.value=!0;try{await Ee(f.value),d("finished"),d("update:modelValue",!1),le.success(y("success"))}finally{s.value=!1}}})},B=()=>{c.value!=null&&(f.value.accessPermissions=[...c.value.getCheckedNodes(),...c.value.getHalfCheckedNodes()].map(e=>e.id))};return(e,l)=>{const u=oe,m=H,v=me,N=Te,z=de,O=x,n=ee,K=Ge;return A(),R(K,{title:e.$t("permissionSettings"),"model-value":P.modelValue,size:414,"onUpdate:modelValue":l[8]||(l[8]=b=>e.$emit("update:modelValue",b))},{default:o(()=>[a(z,{ref_key:"form",ref:k,model:f.value,disabled:U.value,"label-width":"150px"},{default:o(()=>[a(m,{prop:"allAccessPermission"},{label:o(()=>[a(J,{message:"group.allAccessPermission",help:""})]),default:o(()=>[a(u,{modelValue:f.value.allAccessPermission,"onUpdate:modelValue":l[0]||(l[0]=b=>f.value.allAccessPermission=b)},null,8,["modelValue"])]),_:1}),f.value.allAccessPermission?pe("",!0):(A(),j(W,{key:0},[h("div",Oe,[a(v,{modelValue:F.value,"onUpdate:modelValue":l[1]||(l[1]=b=>F.value=b),label:e.$t("expand/collapse"),onChange:l[2]||(l[2]=b=>D(b,c.value,E.value,"id"))},null,8,["modelValue","label"]),a(v,{modelValue:G.value,"onUpdate:modelValue":l[3]||(l[3]=b=>G.value=b),label:e.$t("checkAll/uncheckAll"),onChange:l[4]||(l[4]=b=>{S(b,c.value,E.value,"id"),B()})},null,8,["modelValue","label"])]),a(N,{ref_key:"accessPermissionTree",ref:c,data:E.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:l[5]||(l[5]=()=>B())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:o(()=>[h("div",Qe,[h("div",null,[a(O,null,{default:o(()=>{var b;return[$(V((b=f.value)==null?void 0:b.name),1)]}),_:1})]),h("div",null,[a(n,{onClick:l[6]||(l[6]=()=>e.$emit("update:modelValue",!1))},{default:o(()=>[$(V(e.$t("cancel")),1)]),_:1}),a(n,{type:"primary",loading:s.value,disabled:U.value,onClick:l[7]||(l[7]=()=>I())},{default:o(()=>[$(V(e.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),je={class:"mb-3"},Ke={class:"mt-3 app-block"},ol=Q({name:"GroupList",__name:"GroupList",setup(P){const{t:C}=Z(),r=i({}),d=i(),t=i(),g=i([]),y=i([]),k=i(!1),_=i(!1),f=i(!1),s=i(),F=X(()=>g.value.map(e=>e.id)),G=i(!1),c=async()=>{k.value=!0;try{g.value=await we({...ce(r.value),Q_OrderBy:d.value}),G.value=Object.values(r.value).filter(e=>e!==void 0&&e!=="").length>0||d.value!==void 0}finally{k.value=!1}};Y(c);const E=({column:e,prop:l,order:u})=>{var m;l&&u?d.value=((m=e.sortBy)!=null?m:l)+(u==="descending"?"_desc":""):d.value=void 0,c()},U=()=>c(),T=()=>{t.value.clearSort(),ve(r.value),d.value=void 0,c()},L=()=>{s.value=void 0,_.value=!0},q=e=>{s.value=e,_.value=!0},D=e=>{s.value=e,f.value=!0},S=e=>Number(e)>10,I=async e=>{const l=e.filter(u=>S(u));l.length>0&&(await ae(l),c(),le.success(C("success")))},B=async(e,l)=>{const u=ye(e,g.value,l);await Ae(u.map(m=>m.id))};return(e,l)=>{const u=ee,m=ke,v=$e,N=x,z=Ve,O=_e;return A(),j("div",null,[h("div",je,[a(p(Se),{params:r.value,onSearch:U,onReset:T},{default:o(()=>[a(p(M),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),a(p(M),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),h("div",null,[a(u,{type:"primary",disabled:p(w)("group:create"),icon:p(fe),onClick:L},{default:o(()=>[$(V(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(m,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>I(y.value.map(n=>n.id)))},{reference:o(()=>[a(u,{disabled:y.value.filter(n=>S(n.id)).length<=0||p(w)("group:delete"),icon:p(be)},{default:o(()=>[$(V(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(qe,{class:"ml-2",disabled:y.value.length<=0||G.value||p(w)("org:update"),onMove:l[1]||(l[1]=n=>B(y.value,n))},null,8,["disabled"]),a(p(Fe),{name:"group",class:"ml-2"})]),h("div",Ke,[ge((A(),R(z,{ref_key:"table",ref:t,data:g.value,onSelectionChange:l[2]||(l[2]=n=>y.value=n),onRowDblclick:l[3]||(l[3]=n=>q(n.id)),onSortChange:E},{default:o(()=>[a(p(Ue),{name:"group"},{default:o(()=>[a(v,{type:"selection",width:"50"}),a(v,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(v,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(v,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:o(({row:n})=>[a(N,{type:n.allAccessPermission?"success":"info",size:"small"},{default:o(()=>[$(V(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(v,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t("group.type.".concat(n.type))},null,8,["label","formatter"]),a(v,{label:e.$t("table.action")},{default:o(({row:n})=>[a(u,{type:"primary",disabled:p(w)("group:update"),size:"small",link:"",onClick:K=>q(n.id)},{default:o(()=>[$(V(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(u,{type:"primary",disabled:p(w)("group:updatePermission"),size:"small",link:"",onClick:()=>D(n.id)},{default:o(()=>[$(V(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","onClick"]),a(m,{title:e.$t("confirmDelete"),onConfirm:()=>I([n.id])},{reference:o(()=>[a(u,{type:"primary",disabled:!S(n.id)||p(w)("group:delete"),size:"small",link:""},{default:o(()=>[$(V(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[O,k.value]])]),a(ze,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=n=>_.value=n),"bean-id":s.value,"bean-ids":F.value,onFinished:c},null,8,["modelValue","bean-id","bean-ids"]),a(Re,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=n=>f.value=n),"bean-id":s.value,onFinished:c},null,8,["modelValue","bean-id"])])}}});export{ol as default};
