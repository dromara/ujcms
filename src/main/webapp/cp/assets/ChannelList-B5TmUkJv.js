import{d as al,p as ol,r as f,ac as se,a3 as Z,v as qe,b as h,e as m,f as y,w as l,i as e,j as i,aq as N,l as K,t as L,h as $,I as D,a9 as S,aa as F,k as he,_ as sl,u as ul,o as rl,aC as dl,c as il,aL as ml,aM as He,g as Ge,W as pl,as as Y,ak as cl,ah as vl,aN as fl,aO as hl,ae as yl,aE as bl,E as Te,aK as gl,aP as wl,aJ as Vl}from"./index-CzkNR3jj.js";import{S as _l}from"./sortable.esm-BmjBFecF.js";import{c as $l,d as kl,t as Ce,f as Tl}from"./tree-VGRVvCJj.js";import{H as ql,I as Cl,J as Ml,K as Ul,L as nl,m as Me,M as Il,n as Dl,N as tl,O as Xe,P as Sl}from"./content-CrIhVRVS.js";import{e as Kl,f as Ll}from"./system-T0NwW3cp.js";import{_ as Pl,a as Ye,b as El,c as zl}from"./QueryItem.vue_vue_type_script_setup_true_lang-B0FAQoR4.js";import{b as Bl,q as Ze}from"./config-pdeD4ibS.js";import{a as xe,m as el,g as ll}from"./data-DgL-9oEF.js";import{_ as Nl}from"./FieldItem.vue_vue_type_script_setup_true_lang-KpOawIaB.js";import{_ as Fl}from"./DialogForm.vue_vue_type_script_setup_true_lang-CRgQtsrM.js";import{T as Rl}from"./Tinymce-BWev-cNO.js";import{T as Al}from"./TuiEditor-BP0fQtuj.js";import{a as Ol}from"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-C7TGEYTC.js";import"./vuedraggable.umd-Dy3bwtAy.js";/* empty css                                                                   */import"./BaseUpload-CzYqwlY_.js";import"./index-Uqvazc4q.js";const jl={class:"w-full"},Ql=al({name:"ChannelForm",__name:"ChannelForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parent:{type:Object,default:null}},emits:{"update:modelValue":null,finished:null},setup(ue,{emit:re}){const x=ue,A=re,{modelValue:de,parent:w}=ol(x),ee=f(),o=f({}),O=f([]),le=f([]),ae=f([]),P=f([]),j=f([]),ne=f([]),Q=f([]),J=f([]),M=f(),te=se(()=>P.value.find(n=>n.id===M.value)),r=se(()=>{var n;return xe(el(ll().channel.mains,(n=te.value)==null?void 0:n.mains,"channel"))}),k=se(()=>{var n;return xe(el(ll().channel.asides,(n=te.value)==null?void 0:n.asides,"channel"))}),U=se(()=>{var n;return JSON.parse(((n=te.value)==null?void 0:n.customs)||"[]")}),ie=se(()=>{const n=$l(ae.value,o.value.id);return Z.allChannelPermission?n:kl(n,ne.value)}),me=async()=>{ae.value=Ce(await Me())},W=async()=>{Z.epRank>0&&(O.value=await Kl({category:"sys_article",deployed:!0}))},H=async()=>{Z.epRank>=3&&(le.value=await Bl())},we=async()=>{await me(),A("finished")},ye=async()=>{P.value=await Ze({type:"channel"}),M.value==null&&P.value.length>0&&(M.value=P.value[0].id)},pe=async()=>{j.value=await Ze({type:"article"})},Ve=async()=>{Q.value=await Il()},_e=async()=>{J.value=await Dl()},$e=async()=>{ne.value=await tl()};qe(de,()=>{var n,t,C;de.value&&(M.value=(C=(n=w.value)==null?void 0:n.articleModelId)!=null?C:(t=P.value[0])==null?void 0:t.id,$e(),ye(),pe(),Ve(),_e(),W(),H())}),qe(U,()=>{ce(o.value.customs)});const ce=n=>(U.value.forEach(t=>{n[t.code]==null&&(n[t.code]=t.defaultValue,t.defaultValueKey!=null&&(n[t.code+"Key"]=t.defaultValueKey))}),n);return(n,t)=>{const C=h("el-input"),b=h("el-form-item"),V=h("el-col"),ke=h("el-checkbox"),E=h("el-option"),z=h("el-select"),ve=h("el-switch"),u=h("el-radio"),c=h("el-radio-group"),_=h("el-row"),T=h("el-tree-select"),oe=h("el-input-number"),B=h("el-tab-pane"),R=h("el-tabs");return m(),y(Fl,{values:o.value,"onUpdate:values":t[26]||(t[26]=d=>o.value=d),name:n.$t("menu.content.channel"),"query-bean":i(Cl),"create-bean":i(Ml),"update-bean":i(Ul),"delete-bean":i(nl),"bean-id":ue.beanId,"bean-ids":ue.beanIds,focus:ee.value,"init-values":d=>{var q,a,s,g,G,X,p,be,fe,v,I,ge,Ue,Ie,De,Se,Ke,Le,Pe,Ee,ze,Be,Ne,Fe,Re,Ae,Oe,je,Qe,Je,We;return{parentId:(a=d==null?void 0:d.parentId)!=null?a:(q=i(w))==null?void 0:q.id,type:1,channelModelId:(X=(g=d==null?void 0:d.channelModelId)!=null?g:(s=i(w))==null?void 0:s.channelModelId)!=null?X:(G=P.value[0])==null?void 0:G.id,articleModelId:(v=(be=d==null?void 0:d.articleModelId)!=null?be:(p=i(w))==null?void 0:p.articleModelId)!=null?v:(fe=j.value[0])==null?void 0:fe.id,nav:(Ue=(ge=d==null?void 0:d.nav)!=null?ge:(I=i(w))==null?void 0:I.nav)!=null?Ue:!0,channelTemplate:(Se=(De=d==null?void 0:d.channelTemplate)!=null?De:(Ie=i(w))==null?void 0:Ie.channelTemplate)!=null?Se:Q.value[0],articleTemplate:(Pe=(Le=d==null?void 0:d.articleTemplate)!=null?Le:(Ke=i(w))==null?void 0:Ke.articleTemplate)!=null?Pe:J.value[0],pageSize:20,allowComment:(Be=(ze=d==null?void 0:d.allowComment)!=null?ze:(Ee=i(w))==null?void 0:Ee.allowComment)!=null?Be:!0,allowContribute:(Re=(Fe=d==null?void 0:d.allowContribute)!=null?Fe:(Ne=i(w))==null?void 0:Ne.allowContribute)!=null?Re:!0,allowSearch:(je=(Oe=d==null?void 0:d.allowSearch)!=null?Oe:(Ae=i(w))==null?void 0:Ae.allowSearch)!=null?je:!0,orderDesc:(We=(Je=d==null?void 0:d.orderDesc)!=null?Je:(Qe=i(w))==null?void 0:Qe.orderDesc)!=null?We:!0,customs:{}}},"to-values":d=>({...d}),perms:"channel","model-value":ue.modelValue,"disable-edit":d=>!i(Z).allChannelPermission&&d.id!=null&&!ne.value.includes(d.id),"label-width":"120px",large:"","onUpdate:modelValue":t[27]||(t[27]=d=>n.$emit("update:modelValue",d)),onFinished:we,onBeanChange:t[28]||(t[28]=async d=>{var q,a,s,g;M.value=(g=(a=d==null?void 0:d.channelModelId)!=null?a:(q=i(w))==null?void 0:q.channelModelId)!=null?g:(s=j.value[0])==null?void 0:s.id,await me()})},{default:l(({bean:d,isEdit:q})=>[e(_,null,{default:l(()=>[e(V,{span:18},{default:l(()=>[e(_,null,{default:l(()=>[e(V,{span:r.value.name.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"name",label:(a=r.value.name.name)!=null?a:n.$t("channel.name"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(C,{ref_key:"focus",ref:ee,modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.name=s),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"]),e(V,{span:r.value.alias.double?12:24},{default:l(()=>[e(b,{prop:"alias",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^[\w-]*$/,message:()=>n.$t("channel.error.aliasPattern")},{asyncValidator:async(a,s,g)=>{if(s!==d.alias&&await i(ql)(s)){g(n.$t("channel.error.aliasExist"));return}g()}}]},{label:l(()=>{var a;return[e(N,{label:(a=r.value.alias.name)!=null?a:n.$t("channel.alias"),message:"channel.alias",help:""},null,8,["label"])]}),default:l(()=>[e(C,{modelValue:o.value.alias,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.alias=a),maxlength:"50"},null,8,["modelValue"])]),_:2},1032,["rules"])]),_:2},1032,["span"]),o.value.type===3?(m(),y(V,{key:0,span:r.value.linkUrl.double?12:24},{default:l(()=>[e(b,{prop:"linkUrl",rules:[{required:!0,message:()=>n.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>n.$t("channel.error.linkUrl")}]},{label:l(()=>{var a;return[e(N,{label:(a=r.value.linkUrl.name)!=null?a:n.$t("channel.linkUrl"),message:"channel.linkUrl",help:""},null,8,["label"])]}),default:l(()=>[e(C,{modelValue:o.value.linkUrl,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.linkUrl=a),maxlength:"255"},{append:l(()=>[e(ke,{modelValue:o.value.targetBlank,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.targetBlank=a)},{default:l(()=>[K(L(n.$t("channel.targetBlank")),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0),o.value.type<3?(m(),D(S,{key:1},[r.value.seoTitle.show?(m(),y(V,{key:0,span:r.value.seoTitle.double?12:24},{default:l(()=>[e(b,{prop:"seoTitle",rules:r.value.seoTitle.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(N,{label:(a=r.value.seoTitle.name)!=null?a:n.$t("channel.seoTitle"),message:"channel.seoTitle",help:""},null,8,["label"])]}),default:l(()=>[e(C,{modelValue:o.value.seoTitle,"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.seoTitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0),r.value.seoKeywords.show?(m(),y(V,{key:1,span:r.value.seoKeywords.double?12:24},{default:l(()=>[e(b,{prop:"seoKeywords",rules:r.value.seoKeywords.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(N,{label:(a=r.value.seoKeywords.name)!=null?a:n.$t("channel.seoKeywords"),message:"channel.seoKeywords",help:""},null,8,["label"])]}),default:l(()=>[e(C,{modelValue:o.value.seoKeywords,"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.seoKeywords=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0),r.value.seoDescription.show?(m(),y(V,{key:2,span:r.value.seoDescription.double?12:24},{default:l(()=>[e(b,{prop:"seoDescription",rules:r.value.seoDescription.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(N,{label:(a=r.value.seoDescription.name)!=null?a:n.$t("channel.seoDescription"),message:"channel.seoDescription",help:""},null,8,["label"])]}),default:l(()=>[e(C,{modelValue:o.value.seoDescription,"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.seoDescription=a),maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0)],64)):$("",!0),r.value.image.show?(m(),y(V,{key:2,span:r.value.image.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"image",label:(a=r.value.image.name)!=null?a:n.$t("channel.image"),rules:r.value.image.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(i(Ol),{modelValue:o.value.image,"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.image=s),height:r.value.image.imageHeight,width:r.value.image.imageWidth,mode:r.value.image.imageMode},null,8,["modelValue","height","width","mode"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0),r.value.channelModel.show?(m(),y(V,{key:3,span:r.value.channelModel.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"channelModelId",label:(a=r.value.channelModel.name)!=null?a:n.$t("channel.channelModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(z,{modelValue:o.value.channelModelId,"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.channelModelId=s),class:"w-full",onChange:t[9]||(t[9]=s=>{M.value=s})},{default:l(()=>[(m(!0),D(S,null,F(P.value,s=>(m(),y(E,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0),r.value.articleModel.show?(m(),y(V,{key:4,span:r.value.articleModel.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"articleModelId",label:(a=r.value.articleModel.name)!=null?a:n.$t("channel.articleModel"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(z,{modelValue:o.value.articleModelId,"onUpdate:modelValue":t[10]||(t[10]=s=>o.value.articleModelId=s),class:"w-full"},{default:l(()=>[(m(!0),D(S,null,F(j.value,s=>(m(),y(E,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0),[3,4,5].includes(o.value.type)?$("",!0):(m(),D(S,{key:5},[r.value.channelTemplate.show?(m(),y(V,{key:0,span:r.value.channelTemplate.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"channelTemplate",label:(a=r.value.channelTemplate.name)!=null?a:n.$t("channel.channelTemplate"),rules:r.value.channelTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(z,{modelValue:o.value.channelTemplate,"onUpdate:modelValue":t[11]||(t[11]=s=>o.value.channelTemplate=s),class:"w-full"},{default:l(()=>[(m(!0),D(S,null,F(Q.value,s=>(m(),y(E,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0),r.value.articleTemplate.show?(m(),y(V,{key:1,span:r.value.articleTemplate.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"articleTemplate",label:(a=r.value.articleTemplate.name)!=null?a:n.$t("channel.articleTemplate"),rules:r.value.articleTemplate.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(z,{modelValue:o.value.articleTemplate,"onUpdate:modelValue":t[12]||(t[12]=s=>o.value.articleTemplate=s),class:"w-full"},{default:l(()=>[(m(!0),D(S,null,F(J.value,s=>(m(),y(E,{key:s,label:s+".html",value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0)],64)),r.value.nav.show?(m(),y(V,{key:6,span:r.value.nav.double?12:24},{default:l(()=>[e(b,{prop:"nav",rules:r.value.nav.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(N,{label:(a=r.value.nav.name)!=null?a:n.$t("channel.nav"),message:"channel.nav",help:""},null,8,["label"])]}),default:l(()=>[e(ve,{modelValue:o.value.nav,"onUpdate:modelValue":t[13]||(t[13]=a=>o.value.nav=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0),r.value.allowSearch.show?(m(),y(V,{key:7,span:r.value.allowSearch.double?12:24},{default:l(()=>[e(b,{prop:"allowSearch",rules:r.value.allowSearch.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>{var a;return[e(N,{label:(a=r.value.allowSearch.name)!=null?a:n.$t("channel.allowSearch"),message:"channel.allowSearch",help:""},null,8,["label"])]}),default:l(()=>[e(ve,{modelValue:o.value.allowSearch,"onUpdate:modelValue":t[14]||(t[14]=a=>o.value.allowSearch=a)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["span"])):$("",!0),(m(!0),D(S,null,F(U.value,a=>(m(),y(V,{key:a.code,span:a.double?12:24},{default:l(()=>[e(b,{prop:"customs.".concat(a.code),rules:a.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{label:l(()=>[e(N,{label:a.name},null,8,["label"])]),default:l(()=>[e(Nl,{modelValue:o.value.customs[a.code],"onUpdate:modelValue":s=>o.value.customs[a.code]=s,"model-key":o.value.customs[a.code+"Key"],"onUpdate:modelKey":s=>o.value.customs[a.code+"Key"]=s,field:a},null,8,["modelValue","onUpdate:modelValue","model-key","onUpdate:modelKey","field"])]),_:2},1032,["prop","rules"])]),_:2},1032,["span"]))),128)),o.value.type===2?(m(),y(V,{key:8,span:r.value.text.double?12:24},{default:l(()=>{var a;return[e(b,{prop:"text",label:(a=r.value.text.name)!=null?a:n.$t("channel.text"),rules:r.value.text.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[he("div",jl,[r.value.text.editorSwitch?(m(),y(c,{key:0,modelValue:o.value.editorType,"onUpdate:modelValue":t[15]||(t[15]=s=>o.value.editorType=s),class:"mr-6",onChange:t[16]||(t[16]=()=>o.value.markdown="")},{default:l(()=>[(m(),D(S,null,F([1,2],s=>e(u,{key:s,value:s},{default:l(()=>[K(L(n.$t("model.field.editorType.".concat(s))),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])):$("",!0),o.value.editorType===2?(m(),y(i(Al),{key:1,modelValue:o.value.markdown,"onUpdate:modelValue":t[17]||(t[17]=s=>o.value.markdown=s),html:o.value.text,"onUpdate:html":t[18]||(t[18]=s=>o.value.text=s),class:"leading-6"},null,8,["modelValue","html"])):(m(),y(i(Rl),{key:2,ref:"tinyText",modelValue:o.value.text,"onUpdate:modelValue":t[19]||(t[19]=s=>o.value.text=s)},null,8,["modelValue"]))])]),_:1},8,["label","rules"])]}),_:1},8,["span"])):$("",!0)]),_:2},1024)]),_:2},1024),e(V,{span:6,class:"el-form--label-top label-top"},{default:l(()=>[e(R,{type:"border-card",class:"ml-5"},{default:l(()=>[e(B,{label:n.$t("channel.tabs.setting")},{default:l(()=>{var a,s,g,G,X;return[e(b,{prop:"parentId",label:(a=k.value.parent.name)!=null?a:n.$t("channel.parent")},{default:l(()=>[e(T,{modelValue:o.value.parentId,"onUpdate:modelValue":t[20]||(t[20]=p=>o.value.parentId=p),data:ie.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"render-after-expand":!1,disabled:q,placeholder:"","check-strictly":"",clearable:"",class:"w-full"},null,8,["modelValue","data","disabled"])]),_:2},1032,["label"]),e(b,{prop:"type",label:(s=k.value.type.name)!=null?s:n.$t("channel.type"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(z,{modelValue:o.value.type,"onUpdate:modelValue":t[21]||(t[21]=p=>o.value.type=p),class:"w-full"},{default:l(()=>[(m(),D(S,null,F([1,2,3,4],p=>e(E,{key:p,label:n.$t("channel.type.".concat(p)),value:p},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(b,{prop:"processKey",label:(g=k.value.processKey.name)!=null?g:n.$t("channel.processKey"),rules:k.value.processKey.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(z,{modelValue:o.value.processKey,"onUpdate:modelValue":t[22]||(t[22]=p=>o.value.processKey=p),clearable:"",class:"w-full"},{default:l(()=>[(m(!0),D(S,null,F(O.value,p=>(m(),y(E,{key:p.key,label:p.name,value:p.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),i(Z).epRank>=3&&k.value.performanceType.show?(m(),y(b,{key:0,prop:"performanceType",label:(G=k.value.performanceType.name)!=null?G:n.$t("channel.performanceType"),rules:k.value.performanceType.required?{required:!0,message:()=>n.$t("v.required")}:void 0},{default:l(()=>[e(z,{modelValue:o.value.performanceTypeId,"onUpdate:modelValue":t[23]||(t[23]=p=>o.value.performanceTypeId=p),clearable:"",class:"w-full"},{default:l(()=>[(m(!0),D(S,null,F(le.value,p=>(m(),y(E,{key:p.id,label:p.name,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])):$("",!0),e(b,{prop:"pageSize",label:(X=k.value.pageSize.name)!=null?X:n.$t("channel.pageSize"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:l(()=>[e(oe,{modelValue:o.value.pageSize,"onUpdate:modelValue":t[24]||(t[24]=p=>o.value.pageSize=p),min:1,max:200},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(b,{prop:"orderDesc",rules:{required:!0,message:()=>n.$t("v.required")}},{label:l(()=>{var p;return[e(N,{label:(p=k.value.orderDesc.name)!=null?p:n.$t("channel.orderDesc"),message:"channel.orderDesc",help:""},null,8,["label"])]}),default:l(()=>[e(ve,{modelValue:o.value.orderDesc,"onUpdate:modelValue":t[25]||(t[25]=p=>o.value.orderDesc=p)},null,8,["modelValue"])]),_:1},8,["rules"])]}),_:2},1032,["label"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","model-value","disable-edit"])}}}),Jl=sl(Ql,[["__scopeId","data-v-e8efd8e3"]]),Wl={class:"flex justify-between mx-2 mt-1"},Hl={class:"mb-3"},Gl={class:"mt-3 app-block"},ca=al({name:"ChannelList",__name:"ChannelList",setup(ue){const{t:re}=ul(),x=f({}),A=f(),de=f(),w=f([]),ee=f([]),o=f(!1),O=f(!1),le=f(),ae=f(),P=se(()=>Tl(w.value).map(u=>u.id)),j=f([]),ne=f([]),Q=f(!1),J=f(!1),M=f(),te=f([]),r=f(!1),k=f(),U=f(),ie=u=>Z.allChannelPermission||j.value.includes(u.id);qe(k,u=>{M.value.filter(u)});const me=async()=>{r.value=!0;try{te.value=Ce(await Me()),wl(()=>{var u;k.value!=null&&M.value.filter(k.value),M.value.setCurrentKey((u=U.value)==null?void 0:u.id)})}finally{r.value=!1}},W=async()=>{var u;o.value=!0;try{Q.value=A.value!==void 0;const c=Object.values(x.value).filter(_=>_!==void 0&&_!=="").length>0;w.value=await Me({...Vl(x.value),parentId:(u=U.value)==null?void 0:u.id,isIncludeSelf:!0,isIncludeChildren:c,Q_OrderBy:A.value}),!c&&!Q.value&&(w.value=Ce(w.value))}finally{o.value=!1}},H=()=>{me(),W()},we=async()=>{Z.epRank>0&&(ne.value=await Ll({category:"sys_article",latestVersion:!0}))},ye=async()=>{j.value=await tl()};let pe;const Ve=()=>{const u=document.querySelector("#dataTable .el-table__body-wrapper tbody");pe=_l.create(u,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(c){var oe;const{oldIndex:_,newIndex:T}=c;if(_!==T){let B=_,R=T,d=w.value;const q=(oe=d[0])==null?void 0:oe.children;(q==null?void 0:q.length)>0&&(d=q,B-=1,R-=1),await Xe(d[B].id,d[R].id,B>R?"before":"after"),me(),d.splice(R,0,d.splice(B,1)[0]),Te.success(re("success"))}}})};rl(()=>{H(),we(),ye(),Ve()}),dl(()=>{pe!==void 0&&pe.destroy()});const _e=({column:u,prop:c,order:_})=>{var T;c&&_?A.value=((T=u.sortBy)!=null?T:c)+(_==="descending"?"_desc":""):A.value=void 0,H()},$e=()=>{H(),ye()},ce=()=>W(),n=()=>{de.value.clearSort(),gl(x.value),A.value=void 0,W()},t=u=>{ae.value=void 0,le.value=u!=null?u:U.value,O.value=!0},C=u=>{ae.value=u,le.value=null,O.value=!0},b=async u=>{await nl(u),H(),Te.success(re("success"))},V=async(u,c,_)=>{_!=="none"&&(await Xe(u.data.id,c.data.id,_),W())},ke=async()=>{await Sl(),H(),Te.success(re("success"))},E=async u=>{J.value?(U.value!=u.parent&&(U.value=u.parent,await W()),C(u.id)):(U.value=u,ce())},z=(u,c)=>u?c.name.includes(u):!0,ve=()=>{M.value.setCurrentKey(null),U.value=void 0,ce()};return(u,c)=>{const _=h("el-input"),T=h("el-button"),oe=h("el-switch"),B=h("el-tooltip"),R=h("el-tree"),d=h("el-scrollbar"),q=h("el-aside"),a=h("el-popconfirm"),s=h("el-icon"),g=h("el-table-column"),G=h("el-tag"),X=h("el-table"),p=h("el-main"),be=h("el-container"),fe=il("loading");return m(),y(be,null,{default:l(()=>[e(q,{width:"220px",class:"pr-3"},{default:l(()=>[e(d,{class:"p-2 bg-white rounded-sm"},{default:l(()=>[e(_,{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=v=>k.value=v),"suffix-icon":i(ml),size:"small"},null,8,["modelValue","suffix-icon"]),he("div",Wl,[e(T,{type:U.value==null?"primary":void 0,link:"",onClick:ve},{default:l(()=>[K(L(u.$t("channel.root")),1)]),_:1},8,["type"]),e(B,{content:u.$t("editMode"),placement:"top"},{default:l(()=>[e(oe,{modelValue:J.value,"onUpdate:modelValue":c[1]||(c[1]=v=>J.value=v),"active-action-icon":i(He),"inactive-action-icon":i(He)},null,8,["modelValue","active-action-icon","inactive-action-icon"])]),_:1},8,["content"])]),Ge(e(R,{ref_key:"channelTree",ref:M,data:te.value,props:{label:"name"},"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:i(pl)("channel:update"),"filter-node-method":z,onNodeClick:E,onNodeDragEnd:V},null,8,["data","draggable"]),[[fe,r.value]])]),_:1})]),_:1}),e(p,{class:"p-0"},{default:l(()=>[he("div",Hl,[e(i(Pl),{params:x.value,onSearch:ce,onReset:n},{default:l(()=>[e(i(Ye),{label:u.$t("channel.name"),name:"Q_Contains_name"},null,8,["label"]),e(i(Ye),{label:u.$t("channel.alias"),name:"Q_Contains_alias"},null,8,["label"])]),_:1},8,["params"])]),he("div",null,[e(T,{type:"primary",disabled:i(Y)("channel:create"),icon:i(cl),onClick:c[2]||(c[2]=()=>t(void 0))},{default:l(()=>[K(L(u.$t("add")),1)]),_:1},8,["disabled","icon"]),e(a,{title:u.$t("confirmDelete"),onConfirm:c[3]||(c[3]=()=>b(ee.value.map(v=>v.id)))},{reference:l(()=>[e(T,{disabled:ee.value.length<=0||i(Y)("channel:delete"),icon:i(vl)},{default:l(()=>[K(L(u.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(T,{disabled:i(Y)("channel:tidyTree"),icon:i(fl),onClick:c[4]||(c[4]=()=>ke())},{default:l(()=>[K(L(u.$t("tidyTree")),1)]),_:1},8,["disabled","icon"]),e(B,{placement:"top",content:u.$t("tidyTree.tooltip")},{default:l(()=>[e(s,{class:"ml-1 text-base align-text-bottom"},{default:l(()=>[e(i(hl))]),_:1})]),_:1},8,["content"]),e(i(El),{name:"channel",class:"ml-2"})]),he("div",Gl,[Ge((m(),y(X,{id:"dataTable",ref_key:"table",ref:de,"row-key":"id","default-expand-all":"",data:w.value,"row-class-name":({row:v})=>{var I;return((I=v.children)==null?void 0:I.length)>0?void 0:"drag-draggable"},onSelectionChange:c[5]||(c[5]=v=>ee.value=v),onRowDblclick:c[6]||(c[6]=v=>C(v.id)),onSortChange:_e},{default:l(()=>[e(i(zl),{name:"channel"},{default:l(()=>[e(g,{type:"selection",selectable:ie,width:"45"}),e(g,{property:"name",label:u.$t("channel.name"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(g,{property:"alias",label:u.$t("channel.alias"),"min-width":"80",sortable:"custom"},null,8,["label"]),e(g,{property:"channelModel.name",label:u.$t("channel.channelModel"),"sort-by":"channelModel@model-name",display:"none",sortable:"custom","min-width":"60"},null,8,["label"]),e(g,{property:"articleModel.name",label:u.$t("channel.articleModel"),"sort-by":"articleModel@model-name",sortable:"custom","min-width":"60"},null,8,["label"]),e(g,{property:"processKey",label:u.$t("channel.processKey"),"min-width":"60",sortable:"custom","show-overflow-tooltip":""},{default:l(({row:v})=>{var I;return[K(L(v.processKey!=null?(I=ne.value.find(ge=>ge.key===v.processKey))==null?void 0:I.name:void 0),1)]}),_:1},8,["label"]),e(g,{property:"nav",label:u.$t("channel.nav"),"min-width":"50"},{default:l(({row:v})=>[e(G,{type:v.nav?"success":"info",size:"small"},{default:l(()=>[K(L(u.$t(v.nav?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(g,{property:"id",label:"ID",width:"170",sortable:"custom"}),e(g,{width:"42"},{default:l(({row:v})=>{var I;return[e(s,{class:yl(["text-lg align-middle",Q.value||i(Y)("channel:update")||((I=v.children)==null?void 0:I.length)>0?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:l(()=>[e(i(bl))]),_:2},1032,["class"])]}),_:1}),e(g,{label:u.$t("table.action")},{default:l(({row:v})=>[e(T,{type:"primary",disabled:i(Y)("channel:create")||!ie(v),size:"small",link:"",onClick:()=>t(v)},{default:l(()=>[K(L(u.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),e(T,{type:"primary",disabled:i(Y)("channel:update"),size:"small",link:"",onClick:()=>C(v.id)},{default:l(()=>[K(L(u.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),e(a,{title:u.$t("confirmDelete"),onConfirm:()=>b([v.id])},{reference:l(()=>[e(T,{type:"primary",disabled:i(Y)("channel:delete")||!ie(v),size:"small",link:""},{default:l(()=>[K(L(u.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data","row-class-name"])),[[fe,o.value]])]),e(Jl,{modelValue:O.value,"onUpdate:modelValue":c[7]||(c[7]=v=>O.value=v),"bean-id":ae.value,"bean-ids":P.value,parent:le.value,onFinished:$e},null,8,["modelValue","bean-id","bean-ids","parent"])]),_:1})]),_:1})}}});export{ca as default};
