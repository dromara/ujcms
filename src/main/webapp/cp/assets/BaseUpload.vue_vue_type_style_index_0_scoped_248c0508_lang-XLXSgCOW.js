import{ey as ke,au as Z,at as ue,cl as de,ag as q,ak as v,bX as X,aj as b,al as M,d as T,b_ as Ee,ap as A,ao as K,r as ce,ar as W,b as g,c as U,w as C,P as L,aF as Ce,aG as $e,aA as pe,k as t,ay as m,aC as E,g as h,l as N,n as D,h as w,a3 as B,a7 as Re,x as Q,aV as Fe,ax as Pe,a$ as we,ez as Le,b0 as Se,c8 as Ue,aZ as Te,b1 as _e,bN as Oe,Y,eA as Be,eB as x,cG as De,eC as je,eD as Ne,B as ee,ct as Ae,aw as qe,cu as Me,bC as Ke,aB as te,az as se,aI as ze}from"./index-__TSAjOL.js";var He=1,Ie=4;function ae(o){return ke(o,He|Ie)}const fe=Symbol("uploadContextKey"),Ge="ElUpload";class Ve extends Error{constructor(r,s,c,i){super(r),this.name="UploadAjaxError",this.status=s,this.method=c,this.url=i}}function oe(o,r,s){let c;return s.response?c="".concat(s.response.error||s.response):s.responseText?c="".concat(s.responseText):c="fail to ".concat(r.method," ").concat(o," ").concat(s.status),new Ve(c,s.status,r.method,o)}function Xe(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch(s){return r}}const We=o=>{typeof XMLHttpRequest>"u"&&Z(Ge,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=o.action;r.upload&&r.upload.addEventListener("progress",u=>{const p=u;p.percent=u.total>0?u.loaded/u.total*100:0,o.onProgress(p)});const c=new FormData;if(o.data)for(const[u,p]of Object.entries(o.data))ue(p)&&p.length?c.append(u,...p):c.append(u,p);c.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(s,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(s,o,r));o.onSuccess(Xe(r))}),r.open(o.method,s,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const i=o.headers||{};if(i instanceof Headers)i.forEach((u,p)=>r.setRequestHeader(p,u));else for(const[u,p]of Object.entries(i))de(p)||r.setRequestHeader(u,String(p));return r.send(c),r},ve=["text","picture","picture-card"];let Ye=1;const J=()=>Date.now()+Ye++,me=q({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:v([Object,Function,Promise]),default:()=>X({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:v(Array),default:()=>X([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:v(Function),default:We},disabled:Boolean,limit:Number}),Je=q({...me,beforeUpload:{type:v(Function),default:b},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:b},onChange:{type:v(Function),default:b},onPreview:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b},crossorigin:{type:v(String)}}),Ze=q({files:{type:v(Array),default:()=>X([])},disabled:{type:Boolean,default:!1},handlePreview:{type:v(Function),default:b},listType:{type:String,values:ve,default:"text"},crossorigin:{type:v(String)}}),Qe={remove:o=>!!o},xe=T({name:"ElUploadList"}),et=T({...xe,props:Ze,emits:Qe,setup(o,{emit:r}){const s=o,{t:c}=Ee(),i=A("upload"),u=A("icon"),p=A("list"),k=K(),y=ce(!1),R=W(()=>[i.b("list"),i.bm("list",s.listType),i.is("disabled",s.disabled)]),F=f=>{r("remove",f)};return(f,_)=>(g(),U(_e,{tag:"ul",class:m(t(R)),name:t(p).b()},{default:C(()=>[(g(!0),L(Ce,null,$e(f.files,(a,n)=>(g(),L("li",{key:a.uid||a.name,class:m([t(i).be("list","item"),t(i).is(a.status),{focusing:y.value}]),tabindex:"0",onKeydown:pe(e=>!t(k)&&F(a),["delete"]),onFocus:e=>y.value=!0,onBlur:e=>y.value=!1,onClick:e=>y.value=!1},[E(f.$slots,"default",{file:a,index:n},()=>[f.listType==="picture"||a.status!=="uploading"&&f.listType==="picture-card"?(g(),L("img",{key:0,class:m(t(i).be("list","item-thumbnail")),src:a.url,crossorigin:f.crossorigin,alt:""},null,10,["src","crossorigin"])):h("v-if",!0),a.status==="uploading"||f.listType!=="picture-card"?(g(),L("div",{key:1,class:m(t(i).be("list","item-info"))},[N("a",{class:m(t(i).be("list","item-name")),onClick:D(e=>f.handlePreview(a),["prevent"])},[w(t(B),{class:m(t(u).m("document"))},{default:C(()=>[w(t(Re))]),_:1},8,["class"]),N("span",{class:m(t(i).be("list","item-file-name")),title:a.name},Q(a.name),11,["title"])],10,["onClick"]),a.status==="uploading"?(g(),U(t(Fe),{key:0,type:f.listType==="picture-card"?"circle":"line","stroke-width":f.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:Pe(f.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),N("label",{class:m(t(i).be("list","item-status-label"))},[f.listType==="text"?(g(),U(t(B),{key:0,class:m([t(u).m("upload-success"),t(u).m("circle-check")])},{default:C(()=>[w(t(we))]),_:1},8,["class"])):["picture-card","picture"].includes(f.listType)?(g(),U(t(B),{key:1,class:m([t(u).m("upload-success"),t(u).m("check")])},{default:C(()=>[w(t(Le))]),_:1},8,["class"])):h("v-if",!0)],2),t(k)?h("v-if",!0):(g(),U(t(B),{key:2,class:m(t(u).m("close")),onClick:e=>F(a)},{default:C(()=>[w(t(Se))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),t(k)?h("v-if",!0):(g(),L("i",{key:3,class:m(t(u).m("close-tip"))},Q(t(c)("el.upload.deleteTip")),3)),f.listType==="picture-card"?(g(),L("span",{key:4,class:m(t(i).be("list","item-actions"))},[N("span",{class:m(t(i).be("list","item-preview")),onClick:e=>f.handlePreview(a)},[w(t(B),{class:m(t(u).m("zoom-in"))},{default:C(()=>[w(t(Ue))]),_:1},8,["class"])],10,["onClick"]),t(k)?h("v-if",!0):(g(),L("span",{key:0,class:m(t(i).be("list","item-delete")),onClick:e=>F(a)},[w(t(B),{class:m(t(u).m("delete"))},{default:C(()=>[w(t(Te))]),_:1},8,["class"])],10,["onClick"]))],2)):h("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),E(f.$slots,"append")]),_:3},8,["class","name"]))}});var ne=M(et,[["__file","upload-list.vue"]]);const tt=q({disabled:{type:Boolean,default:!1}}),st={file:o=>ue(o)},ye="ElUploadDrag",at=T({name:ye}),ot=T({...at,props:tt,emits:st,setup(o,{emit:r}){Oe(fe)||Z(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const c=A("upload"),i=ce(!1),u=K(),p=y=>{if(u.value)return;i.value=!1,y.stopPropagation();const R=Array.from(y.dataTransfer.files);r("file",R)},k=()=>{u.value||(i.value=!0)};return(y,R)=>(g(),L("div",{class:m([t(c).b("dragger"),t(c).is("dragover",i.value)]),onDrop:D(p,["prevent"]),onDragover:D(k,["prevent"]),onDragleave:D(F=>i.value=!1,["prevent"])},[E(y.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var nt=M(ot,[["__file","upload-dragger.vue"]]);const lt=q({...me,beforeUpload:{type:v(Function),default:b},onRemove:{type:v(Function),default:b},onStart:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b}}),rt=T({name:"ElUploadContent",inheritAttrs:!1}),it=T({...rt,props:lt,setup(o,{expose:r}){const s=o,c=A("upload"),i=K(),u=Y({}),p=Y(),k=e=>{if(e.length===0)return;const{autoUpload:d,limit:l,fileList:$,multiple:P,onStart:S,onExceed:z}=s;if(l&&$.length+e.length>l){z(e,$);return}P||(e=e.slice(0,1));for(const H of e){const j=H;j.uid=J(),S(j),d&&y(j)}},y=async e=>{if(p.value.value="",!s.beforeUpload)return F(e);let d,l={};try{const P=s.data,S=s.beforeUpload(e);l=x(s.data)?ae(s.data):s.data,d=await S,x(s.data)&&De(P,l)&&(l=ae(s.data))}catch(P){d=!1}if(d===!1){s.onRemove(e);return}let $=e;d instanceof Blob&&(d instanceof File?$=d:$=new File([d],e.name,{type:e.type})),F(Object.assign($,{uid:e.uid}),l)},R=async(e,d)=>Be(e)?e(d):e,F=async(e,d)=>{const{headers:l,data:$,method:P,withCredentials:S,name:z,action:H,onProgress:j,onSuccess:ge,onError:he,httpRequest:be}=s;try{d=await R(d!=null?d:$,e)}catch(O){s.onRemove(e);return}const{uid:I}=e,G={headers:l||{},withCredentials:S,file:e,data:d,method:P,filename:z,action:H,onProgress:O=>{j(O,e)},onSuccess:O=>{ge(O,e),delete u.value[I]},onError:O=>{he(O,e),delete u.value[I]}},V=be(G);u.value[I]=V,V instanceof Promise&&V.then(G.onSuccess,G.onError)},f=e=>{const d=e.target.files;d&&k(Array.from(d))},_=()=>{i.value||(p.value.value="",p.value.click())},a=()=>{_()};return r({abort:e=>{je(u.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,$])=>{$ instanceof XMLHttpRequest&&$.abort(),delete u.value[l]})},upload:y}),(e,d)=>(g(),L("div",{class:m([t(c).b(),t(c).m(e.listType),t(c).is("drag",e.drag),t(c).is("disabled",t(i))]),tabindex:t(i)?"-1":"0",onClick:_,onKeydown:pe(D(a,["self"]),["enter","space"])},[e.drag?(g(),U(nt,{key:0,disabled:t(i),onFile:k},{default:C(()=>[E(e.$slots,"default")]),_:3},8,["disabled"])):E(e.$slots,"default",{key:1}),N("input",{ref_key:"inputRef",ref:p,class:m(t(c).e("input")),name:e.name,disabled:t(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:f,onClick:D(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var le=M(it,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},ut=(o,r)=>{const s=Ne(o,"fileList",void 0,{passive:!0}),c=a=>s.value.find(n=>n.uid===a.uid);function i(a){var n;(n=r.value)==null||n.abort(a)}function u(a=["ready","uploading","success","fail"]){s.value=s.value.filter(n=>!a.includes(n.status))}function p(a){s.value=s.value.filter(n=>n!==a)}const k=(a,n)=>{const e=c(n);e&&(console.error(a),e.status="fail",p(e),o.onError(a,e,s.value),o.onChange(e,s.value))},y=(a,n)=>{const e=c(n);e&&(o.onProgress(a,e,s.value),e.status="uploading",e.percentage=Math.round(a.percent))},R=(a,n)=>{const e=c(n);e&&(e.status="success",e.response=a,o.onSuccess(a,e,s.value),o.onChange(e,s.value))},F=a=>{de(a.uid)&&(a.uid=J());const n={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(o.listType==="picture-card"||o.listType==="picture")try{n.url=URL.createObjectURL(a)}catch(e){Ae(re,e.message),o.onError(e,n,s.value)}s.value=[...s.value,n],o.onChange(n,s.value)},f=async a=>{const n=a instanceof File?c(a):a;n||Z(re,"file to be removed not found");const e=d=>{i(d),p(d),o.onRemove(d,s.value),ie(d)};o.beforeRemove?await o.beforeRemove(n,s.value)!==!1&&e(n):e(n)};function _(){s.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var n;return a&&((n=r.value)==null?void 0:n.upload(a))})}return ee(()=>o.listType,a=>{a!=="picture-card"&&a!=="picture"||(s.value=s.value.map(n=>{const{raw:e,url:d}=n;if(!d&&e)try{n.url=URL.createObjectURL(e)}catch(l){o.onError(l,n,s.value)}return n}))}),ee(s,a=>{for(const n of a)n.uid||(n.uid=J()),n.status||(n.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:i,clearFiles:u,handleError:k,handleProgress:y,handleStart:F,handleSuccess:R,handleRemove:f,submit:_,revokeFileObjectURL:ie}},dt=T({name:"ElUpload"}),ct=T({...dt,props:Je,setup(o,{expose:r}){const s=o,c=K(),i=Y(),{abort:u,submit:p,clearFiles:k,uploadFiles:y,handleStart:R,handleError:F,handleRemove:f,handleSuccess:_,handleProgress:a,revokeFileObjectURL:n}=ut(s,i),e=W(()=>s.listType==="picture-card"),d=W(()=>({...s,fileList:y.value,onStart:R,onProgress:a,onSuccess:_,onError:F,onRemove:f}));return qe(()=>{y.value.forEach(n)}),Me(fe,{accept:Ke(s,"accept")}),r({abort:u,submit:p,clearFiles:k,handleStart:R,handleRemove:f}),(l,$)=>(g(),L("div",null,[t(e)&&l.showFileList?(g(),U(ne,{key:0,disabled:t(c),"list-type":l.listType,files:t(y),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(f)},te({append:C(()=>[w(le,se({ref_key:"uploadRef",ref:i},t(d)),{default:C(()=>[l.$slots.trigger?E(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?E(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:C(({file:P,index:S})=>[E(l.$slots,"file",{file:P,index:S})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0),!t(e)||t(e)&&!l.showFileList?(g(),U(le,se({key:1,ref_key:"uploadRef",ref:i},t(d)),{default:C(()=>[l.$slots.trigger?E(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?E(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),l.$slots.trigger?E(l.$slots,"default",{key:2}):h("v-if",!0),E(l.$slots,"tip"),!t(e)&&l.showFileList?(g(),U(ne,{key:3,disabled:t(c),"list-type":l.listType,files:t(y),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(f)},te({_:2},[l.$slots.file?{name:"default",fn:C(({file:P,index:S})=>[E(l.$slots,"file",{file:P,index:S})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0)]))}});var pt=M(ct,[["__file","upload.vue"]]);const vt=ze(pt);export{vt as E};
