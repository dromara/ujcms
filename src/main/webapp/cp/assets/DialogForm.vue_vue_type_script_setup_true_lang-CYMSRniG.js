import{d as ye,A as pe,u as ge,r as $,ar as k,bH as ee,o as he,B as J,t as L,b as m,c as I,w as d,e as ae,P as N,m as Ve,k as E,aW as $e,b5 as R,v as p,x as r,g as F,aC as M,h as S,aZ as Ee,ba as Se,aH as we,aO as ke,y as Be,E as Ce,ay as Fe,n as qe,z as De}from"./index-__TSAjOL.js";import{E as Ie}from"./el-switch-Cg-m0Y0i.js";import{E as Ne}from"./el-popover-B2t_MYt0.js";const Oe={key:0},Pe={key:0},Te={key:1},Ue={class:"space-x-2"},je={key:0},le="ujcms_continuous_settings",Ge=ye({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},values:{type:Object,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(n,{expose:te,emit:ue}){function Z(){const e=localStorage.getItem(le);return e?JSON.parse(e):{}}function ne(e){localStorage.setItem(le,JSON.stringify(e))}function se(e){var u;return(u=Z()[e])!=null?u:!1}function ie(e,l){const u=Z();u[e]=l,ne(u)}const a=n,t=ue,{name:O,beanId:K,beanIds:oe,focus:q,values:i,action:de,modelValue:Q}=pe(a),{t:D}=ge(),P=$(!1),c=$(!1),f=$(se(O.value)),g=$(),v=$(a.initValues()),T=$(),o=$(),b=$([]),s=k(()=>o.value!=null&&de.value==="edit"),W=k(()=>!P.value&&!ee.isEqual(T.value,i.value)),h=k(()=>{var e,l;return(l=(e=a.disableEdit)==null?void 0:e.call(a,v.value))!=null?l:!1}),ve=k(()=>"".concat(O.value," - ").concat(s.value?"".concat(D(h.value?"detail":"edit")," (ID: ").concat(o.value,")"):"".concat(D("add")))),U=async()=>{var e;P.value=!0;try{v.value=o.value!=null?await a.queryBean(o.value):a.initValues(i.value,s.value),T.value=o.value!=null?a.toValues(v.value):v.value,t("update:values",ee.cloneDeep(T.value)),t("beanChange",v.value),(e=g.value)==null||e.resetFields()}finally{P.value=!1}};he(()=>t("update:values",a.initValues())),J(Q,()=>{Q.value&&(b.value=oe.value,o.value!==K.value?o.value=K.value:U())}),J(o,()=>{U()}),J(f,()=>ie(O.value,f.value));const V=k(()=>b.value.indexOf(o.value)),j=k(()=>V.value>0),z=k(()=>V.value<b.value.length-1),_=()=>{j.value&&(o.value=b.value[V.value-1])},G=()=>{z.value&&(o.value=b.value[V.value+1])},re=()=>{var e,l;(l=(e=q.value)==null?void 0:e.focus)==null||l.call(e),o.value=void 0},ce=()=>{t("update:modelValue",!1)},X=async()=>{c.value=!0;try{await a.deleteBean([o.value]),f.value||t("update:modelValue",!1),z.value?(G(),b.value.splice(V.value-1,1)):j.value?(_(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),L.success(D("success")),t("finished")}finally{c.value=!1}},Y=()=>{T.value=a.toValues(i.value)},H=async(e=!1)=>{var l;await((l=a.beforeValidate)==null?void 0:l.call(a,i.value)),g.value.validate(async u=>{var w,B,C,A;if(u){c.value=!0;try{if((B=await((w=a.preventSubmit)==null?void 0:w.call(a,i.value)))!=null&&B)return;t("beforeSubmit",i.value),s.value?(await a.updateBean(i.value),Y()):(await a.createBean(i.value),(A=(C=q.value)==null?void 0:C.focus)==null||A.call(C),t("update:values",a.initValues(i.value,s.value)),g.value.resetFields()),L.success(D("success")),!f.value&&!e&&t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})};return te({form:g,submit:e=>{g.value.validate(async l=>{var u,w;if(l){c.value=!0;try{if((w=await((u=a.preventSubmit)==null?void 0:u.call(a,i.value)))!=null&&w)return;t("beforeSubmit",i.value);const B=await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:q.value,loadBean:U,resetOrigValues:Y,emit:t});!f.value&&!B&&t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})},remove:async e=>{c.value=!0;try{await e(i.value,{isEdit:s.value,continuous:f.value,form:g.value,props:a,focus:q.value,loadBean:U,emit:t}),f.value||t("update:modelValue",!1),z.value?(G(),b.value.splice(V.value-1,1)):j.value?(_(),b.value.splice(V.value+1,1)):t("update:modelValue",!1),L.success(D("success")),t("finished")}finally{c.value=!1}},defaultSubmit:H}),(e,l)=>{const u=Ve,w=Ne,B=Se,C=Ie,A=we,fe=ke,me=Ce,be=De,x=Be;return m(),I(be,{title:ve.value,"close-on-click-modal":!W.value,"model-value":n.modelValue,width:n.large?"98%":"768px",top:n.large?"16px":"8vh","onUpdate:modelValue":l[3]||(l[3]=y=>e.$emit("update:modelValue",y)),onOpened:l[4]||(l[4]=()=>{var y;return!s.value&&((y=E(q))==null?void 0:y.focus())})},{header:d(()=>[p(r(E(O))+" - ",1),s.value?(m(),N("span",Oe,[p(r(e.$t(h.value?"detail":"edit"))+" ",1),n.showId?(m(),N("span",Pe,"(ID: "+r(o.value)+")",1)):F("",!0)])):(m(),N("span",Te,r(e.$t("add")),1))]),default:d(()=>[ae((m(),N("div",Ue,[s.value&&n.addable?(m(),I(u,{key:0,disabled:E(R)("".concat(n.perms,":create")),type:"primary",icon:E($e),onClick:re},{default:d(()=>[p(r(e.$t("add")),1)]),_:1},8,["disabled","icon"])):F("",!0),M(e.$slots,"header-action",{bean:v.value,isEdit:s.value,disabled:h.value,unsaved:W.value,disableDelete:n.disableDelete,handleDelete:X},()=>[s.value?(m(),I(w,{key:0,title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>X())},{reference:d(()=>{var y;return[S(u,{disabled:((y=n.disableDelete)==null?void 0:y.call(n,v.value))||E(R)("".concat(n.perms,":delete")),icon:E(Ee)},{default:d(()=>[p(r(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]}),_:1},8,["title"])):F("",!0)]),s.value?(m(),I(B,{key:1},{default:d(()=>[S(u,{disabled:!j.value,onClick:_},{default:d(()=>[p(r(e.$t("form.prev")),1)]),_:1},8,["disabled"]),S(u,{disabled:!z.value,onClick:G},{default:d(()=>[p(r(e.$t("form.next")),1)]),_:1},8,["disabled"])]),_:1})):F("",!0),S(u,{type:"primary",onClick:ce},{default:d(()=>[p(r(e.$t("back")),1)]),_:1}),S(A,{content:e.$t("form.continuous"),placement:"top"},{default:d(()=>[S(C,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=y=>f.value=y),size:"small"},null,8,["modelValue"])]),_:1},8,["content"]),W.value?(m(),I(fe,{key:2,type:"danger"},{default:d(()=>[p(r(e.$t("form.unsaved")),1)]),_:1})):F("",!0),M(e.$slots,"header-status",{bean:v.value,isEdit:s.value,disabled:h.value})])),[[x,P.value||c.value]]),S(me,{ref_key:"form",ref:g,class:Fe(["mt-5","pr-5"]),model:E(i),disabled:h.value,"label-width":n.labelWidth,"label-position":n.labelPosition,"scroll-to-error":""},{default:d(()=>[M(e.$slots,"default",{bean:v.value,isEdit:s.value,disabled:h.value}),h.value?F("",!0):ae((m(),N("div",je,[M(e.$slots,"footer-action",{bean:v.value,isEdit:s.value,disabled:h.value,handleSubmit:H},()=>[S(u,{disabled:E(R)(s.value?"".concat(n.perms,":update"):"".concat(n.perms,":create")),type:"primary","native-type":"submit",onClick:l[2]||(l[2]=qe(()=>H(),["prevent"]))},{default:d(()=>[p(r(e.$t("save")),1)]),_:1},8,["disabled"])])])),[[x,c.value]])]),_:3},8,["model","disabled","label-width","label-position"])]),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}});export{Ge as _};
