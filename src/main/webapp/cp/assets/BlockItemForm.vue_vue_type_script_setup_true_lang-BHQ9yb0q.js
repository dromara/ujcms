import{a as Q}from"./config-DiPdhBV1.js";import{F as Y,V as Z,W as x,X as _}from"./content-2hwtLvQa.js";import{_ as ee}from"./DialogForm.vue_vue_type_script_setup_true_lang-BCAZsuC3.js";import{a as z}from"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-DTCj5vvC.js";import"./vuedraggable.umd-BHO2ywuu.js";import{d as G,p as J,r as $,v as le,aX as ae,b as v,e as n,f as b,w as d,i as o,K as h,a7 as S,a8 as O,k as K,af as te,n as T,t as P,aa as ue,o as oe,h as p,j as c}from"./index-B6OoDg6B.js";import{B as de}from"./BaseUpload-B0NBMb5L.js";const re=["onClick"],ne=["src"],ie=G({__name:"ImageExtractor",props:{modelValue:{type:Boolean,required:!0},urls:{type:Array,default:()=>[]},min:{type:Number,default:1},max:{type:Number,default:1},appendToBody:{type:Boolean}},emits:["update:modelValue","finished"],setup(i,{emit:C}){const g=i,V=C,{urls:w,max:l,modelValue:I}=J(g),u=$();le(I,()=>{I.value&&(u.value=ae.uniq(w.value).map(e=>({url:e,checked:!1})))});const q=e=>{if(e.checked){e.checked=!e.checked;return}let k=0;u.value.forEach(y=>{y.checked&&(k+=1),k>=l.value&&(y.checked=!1)}),e.checked=!0},t=()=>{V("finished",u.value.filter(e=>e.checked).map(e=>e.url)),V("update:modelValue",!1)};return(e,k)=>{const y=v("el-col"),s=v("el-row"),f=v("el-button"),R=v("el-dialog");return n(),b(R,{"model-value":i.modelValue,title:e.$t("article.extractImage"),width:768,"append-to-body":i.appendToBody,"onUpdate:modelValue":k[1]||(k[1]=m=>e.$emit("update:modelValue",m))},{footer:d(()=>[o(f,{type:"primary",disabled:u.value.filter(m=>m.checked).length<i.min,onClick:k[0]||(k[0]=()=>t())},{default:d(()=>[T(P(e.$t("ok")),1)]),_:1},8,["disabled"])]),default:d(()=>[o(s,{gutter:16},{default:d(()=>[(n(!0),h(S,null,O(u.value,m=>(n(),b(y,{key:m.url,src:m,span:8,class:"mt-2"},{default:d(()=>[K("div",{class:te(["p-1 border-2 rounded cursor-pointer text-center",{"border-primary":m.checked,"border-2":m.checked}]),onClick:()=>q(m)},[K("img",{src:m.url,class:"max-h-36 inline"},null,8,ne)],10,re)]),_:2},1032,["src"]))),128))]),_:1})]),_:1},8,["model-value","title","append-to-body"])}}}),ce=G({name:"BlockItemForm",__name:"BlockItemForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},blockId:{type:String,default:null},articleId:{type:String,default:null},title:{type:String,default:null},description:{type:String,default:null},video:{type:String,default:null},images:{type:Array,default:()=>[]}},emits:{"update:modelValue":null,finished:null},setup(i){const C=i,{blockId:g}=J(C),V=$(),w=$(),l=$({}),I=$([]),u=ue(()=>I.value.find(t=>{var e;return t.id===((e=V.value)!=null?e:g==null?void 0:g.value)}));oe(async()=>{I.value=await Q()});const q=$(!1);return(t,e)=>{var F;const k=v("el-option"),y=v("el-select"),s=v("el-form-item"),f=v("el-input"),R=v("el-button"),m=v("el-switch");return n(),h("div",null,[o(ee,{values:l.value,"onUpdate:values":e[14]||(e[14]=r=>l.value=r),name:t.$t("menu.content.blockItem"),"query-bean":c(_),"create-bean":c(x),"update-bean":c(Z),"delete-bean":c(Y),"bean-id":i.beanId,"bean-ids":i.beanIds,focus:w.value,"init-values":()=>({blockId:c(g),articleId:i.articleId,title:i.title,description:i.description,video:i.video,enabled:!0}),"to-values":r=>{var U,B;return{...r,articleTitle:(U=r.article)==null?void 0:U.title,articleId:(B=r.article)==null?void 0:B.id}},addable:(F=u.value)==null?void 0:F.enabled,perms:"blockItem","model-value":i.modelValue,"onUpdate:modelValue":e[15]||(e[15]=r=>t.$emit("update:modelValue",r)),onFinished:e[16]||(e[16]=()=>t.$emit("finished")),onBeanChange:e[17]||(e[17]=r=>V.value=r.blockId)},{default:d(({isEdit:r})=>{var U,B,N,L,A,W,D,E,H,M,X,j;return[o(s,{prop:"blockId",label:t.$t("blockItem.block"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[o(y,{modelValue:l.value.blockId,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.blockId=a),class:"w-full",disabled:"",onChange:e[1]||(e[1]=a=>V.value=a)},{default:d(()=>[(n(!0),h(S,null,O(I.value,a=>(n(),h(S,{key:a.id},[r||a.enabled?(n(),b(k,{key:0,label:a.name,value:a.id,disabled:!a.enabled},null,8,["label","value","disabled"])):p("",!0)],64))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label","rules"]),r&&l.value.articleId!=null?(n(),b(s,{key:0,label:t.$t("blockItem.articleId")},{default:d(()=>[o(f,{modelValue:l.value.articleId,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.articleId=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):p("",!0),r&&l.value.articleTitle!=null?(n(),b(s,{key:1,label:t.$t("blockItem.articleTitle")},{default:d(()=>[o(f,{modelValue:l.value.articleTitle,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.articleTitle=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):p("",!0),o(s,{prop:"title",label:t.$t("blockItem.title"),rules:{required:!0,message:()=>t.$t("v.required")}},{default:d(()=>[o(f,{ref_key:"focus",ref:w,modelValue:l.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.title=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l.value.articleId==null&&((U=u.value)!=null&&U.withLinkUrl)?(n(),b(s,{key:2,prop:"linkUrl",label:t.$t("blockItem.linkUrl"),rules:(B=u.value)!=null&&B.linkUrlRequired?[{required:!0,message:()=>t.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>t.$t("blockItem.error.linkUrl")}]:{pattern:/^(http|\/).*$/,message:()=>t.$t("blockItem.error.linkUrl")}},{default:d(()=>[o(f,{modelValue:l.value.linkUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.linkUrl=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label","rules"])):p("",!0),(N=u.value)!=null&&N.withSubtitle?(n(),b(s,{key:3,prop:"subtitle",label:t.$t("blockItem.subtitle"),rules:{required:(L=u.value)==null?void 0:L.subtitleRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(f,{modelValue:l.value.subtitle,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.subtitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"])):p("",!0),(A=u.value)!=null&&A.withDescription?(n(),b(s,{key:4,prop:"description",label:t.$t("blockItem.description"),rules:{required:(W=u.value)==null?void 0:W.descriptionRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(f,{modelValue:l.value.description,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.description=a),type:"textarea",rows:5,maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["label","rules"])):p("",!0),(D=u.value)!=null&&D.withImage?(n(),b(s,{key:5,prop:"image",label:t.$t("blockItem.image"),rules:{required:(E=u.value)==null?void 0:E.imageRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(c(z),{modelValue:l.value.image,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.image=a),width:u.value.imageWidth,height:u.value.imageHeight,mode:"manual"},null,8,["modelValue","width","height"]),i.images.length>0?(n(),b(R,{key:0,class:"self-start ml-2",onClick:e[9]||(e[9]=()=>q.value=!0)},{default:d(()=>[T(P(t.$t("article.extractImage")),1)]),_:1})):p("",!0)]),_:1},8,["label","rules"])):p("",!0),(H=u.value)!=null&&H.withMobileImage?(n(),b(s,{key:6,prop:"mobileImage",label:t.$t("blockItem.mobileImage"),rules:{required:(M=u.value)==null?void 0:M.mobileImageRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(c(z),{modelValue:l.value.mobileImage,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.mobileImage=a),width:u.value.mobileImageWidth,height:u.value.mobileImageHeight,mode:"manual"},null,8,["modelValue","width","height"])]),_:1},8,["label","rules"])):p("",!0),(X=u.value)!=null&&X.withVideo?(n(),b(s,{key:7,prop:"video",label:t.$t("blockItem.video"),rules:{required:(j=u.value)==null?void 0:j.videoRequired,message:()=>t.$t("v.required")}},{default:d(()=>[o(f,{modelValue:l.value.video,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.video=a),maxlength:"255"},{prepend:d(()=>e[20]||(e[20]=[T("URL")])),_:1},8,["modelValue"]),o(c(de),{type:"video","on-success":a=>l.value.video=a.url},null,8,["on-success"])]),_:1},8,["label","rules"])):p("",!0),o(s,{prop:"targetBlank",label:t.$t("blockItem.targetBlank")},{default:d(()=>[o(m,{modelValue:l.value.targetBlank,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.targetBlank=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(s,{prop:"enabled",label:t.$t("blockItem.enabled")},{default:d(()=>[o(m,{modelValue:l.value.enabled,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.enabled=a)},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","addable","model-value"]),o(ie,{modelValue:q.value,"onUpdate:modelValue":e[18]||(e[18]=r=>q.value=r),urls:i.images,"append-to-body":!0,onFinished:e[19]||(e[19]=r=>l.value.image=r[0])},null,8,["modelValue","urls"])])}}});export{ie as _,ce as a};
