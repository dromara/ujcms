import{d as se,u as ie,r as s,aa as B,v as de,aA as ce,o as re,E,aB as ue,b as i,c as me,e as k,f as g,w as t,i as a,K as be,a7 as pe,a8 as ve,k as T,j as n,ae as fe,aq as f,n as V,t as C,ai as _e,g as ke,af as ge,aD as ye,h as A,aI as Ie,_ as he}from"./index-B6OoDg6B.js";import{S as we}from"./sortable.esm-DEaZq8gs.js";import{a as Be}from"./config-DiPdhBV1.js";import{T as Ve,U as Ce,F as $e,V as Se}from"./content-2hwtLvQa.js";import{_ as De,a as Le,b as Ue,c as Ee}from"./QueryItem.vue_vue_type_script_setup_true_lang-Tf1Ym-Zs.js";import{a as Te}from"./BlockItemForm.vue_vue_type_script_setup_true_lang-BHQ9yb0q.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-BCAZsuC3.js";import"./FileListUpload.vue_vue_type_style_index_0_scoped_8f839ee5_lang-DTCj5vvC.js";import"./vuedraggable.umd-BHO2ywuu.js";import"./BaseUpload-B0NBMb5L.js";/* empty css                                                                   */const qe={class:"mb-3"},Ne={class:"mt-3 app-block"},ze=se({name:"BlockItemList",__name:"BlockItemList",setup(Fe){const{t:$}=ie(),y=s({}),_=s(),q=s(),r=s([]),S=s([]),D=s(!1),I=s(!1),L=s(),M=B(()=>r.value.map(e=>e.id)),Q=s(!1),h=s([]),p=s(),x=B(()=>h.value.find(e=>e.id===p.value)),K=B(()=>r.value.map(e=>e.image)),G=B(()=>r.value.map(e=>e.mobileImage)),N=s(!1),v=async()=>{D.value=!0;try{r.value=await Ve({...ce(y.value),blockId:p.value,Q_OrderBy:_.value}),Q.value=Object.values(y.value).filter(e=>e!==void 0&&e!=="").length>0||_.value!==void 0,N.value=_.value!==void 0}finally{D.value=!1}},H=async()=>{h.value=await Be(),p.value=String(h.value[0].id)};let U;const J=()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");U=we.create(e,{handle:".drag-handle",animation:200,chosenClass:"sortable-chosen",onEnd:async function(o){const{oldIndex:u,newIndex:m}=o;u!==m&&(await Ce(r.value[u].id,r.value[m].id),r.value.splice(m,0,r.value.splice(u,1)[0]),E.success($("success")))}})};de(p,()=>v()),re(async()=>{await H(),J()}),ue(()=>{U!==void 0&&U.destroy()});const W=({column:e,prop:o,order:u})=>{var m;o&&u?_.value=((m=e.sortBy)!=null?m:o)+(u==="descending"?"_desc":""):_.value=void 0,v()},X=()=>v(),Y=()=>{q.value.clearSort(),Ie(y.value),_.value=void 0,v()},Z=()=>{L.value=void 0,I.value=!0},z=e=>{L.value=e,I.value=!0},F=async e=>{await Se(e),v(),E.success($("success"))},O=async e=>{await $e(e),v(),E.success($("success"))};return(e,o)=>{const u=i("el-tab-pane"),m=i("el-tabs"),ee=i("el-aside"),w=i("el-button"),P=i("el-popconfirm"),c=i("el-table-column"),ae=i("el-icon"),R=i("el-image"),j=i("el-switch"),le=i("el-table"),te=i("el-main"),oe=i("el-container"),ne=me("loading");return k(),g(oe,null,{default:t(()=>[a(ee,{width:"180px",class:"pr-3"},{default:t(()=>[a(m,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),"tab-position":"left",stretch:"",class:"bg-white"},{default:t(()=>[(k(!0),be(pe,null,ve(h.value,b=>(k(),g(u,{key:b.id,name:String(b.id),label:b.name},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(te,{class:"p-0"},{default:t(()=>{var b;return[T("div",qe,[a(n(De),{params:y.value,onSearch:X,onReset:Y},{default:t(()=>[a(n(Le),{label:e.$t("blockItem.title"),name:"Q_Contains_title"},null,8,["label"])]),_:1},8,["params"])]),T("div",null,[a(w,{type:"primary",disabled:!((b=x.value)!=null&&b.enabled)||n(f)("blockItem:create"),icon:n(fe),onClick:o[1]||(o[1]=()=>Z())},{default:t(()=>[V(C(e.$t("add")),1)]),_:1},8,["disabled","icon"]),a(P,{title:e.$t("confirmDelete"),onConfirm:o[2]||(o[2]=()=>O(S.value.map(l=>l.id)))},{reference:t(()=>[a(w,{disabled:S.value.length<=0||n(f)("blockItem:delete"),icon:n(_e)},{default:t(()=>[V(C(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(n(Ue),{name:"blockItem",class:"ml-2"})]),T("div",Ne,[ke((k(),g(le,{id:"dataTable",ref_key:"table",ref:q,"row-key":"id",data:r.value,onSelectionChange:o[3]||(o[3]=l=>S.value=l),onRowDblclick:o[4]||(o[4]=l=>z(l.id)),onSortChange:W},{default:t(()=>[a(n(Ee),{name:"blockItem"},{default:t(()=>[a(c,{type:"selection",width:"38"}),a(c,{width:"42"},{default:t(()=>[a(ae,{class:ge(["text-lg align-middle",N.value||n(f)("blockItem:update")?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]]),disalbed:""},{default:t(()=>[a(n(ye))]),_:1},8,["class"])]),_:1}),a(c,{property:"id",label:"ID",width:"170",sortable:"custom"}),a(c,{property:"title",label:e.$t("blockItem.title"),sortable:"custom","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(c,{property:"subtitle",label:e.$t("blockItem.subtitle"),sortable:"custom",display:"none","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(c,{property:"image",label:e.$t("blockItem.image")},{default:t(({row:l,$index:d})=>[l.image?(k(),g(R,{key:0,src:l.image,fit:"contain","preview-src-list":K.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):A("",!0)]),_:1},8,["label"]),a(c,{property:"mobileImage",label:e.$t("blockItem.mobileImage"),display:"none"},{default:t(({row:l,$index:d})=>[l.mobileImage?(k(),g(R,{key:0,src:l.mobileImage,fit:"contain","preview-src-list":G.value,"initial-index":d,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):A("",!0)]),_:1},8,["label"]),a(c,{property:"targetBlank",label:e.$t("blockItem.targetBlank"),sortable:"custom",width:"120"},{default:t(({row:l})=>[a(j,{modelValue:l.targetBlank,"onUpdate:modelValue":d=>l.targetBlank=d,disabled:n(f)("blockItem:update"),onChange:d=>F({...l,targetBlank:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(c,{property:"enabled",label:e.$t("enable"),sortable:"custom",width:"100"},{default:t(({row:l})=>[a(j,{modelValue:l.enabled,"onUpdate:modelValue":d=>l.enabled=d,disabled:n(f)("blockItem:update"),onChange:d=>F({...l,enabled:d})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),a(c,{label:e.$t("table.action")},{default:t(({row:l})=>[a(w,{type:"primary",disabled:n(f)("blockItem:update"),size:"small",link:"",onClick:()=>z(l.id)},{default:t(()=>[V(C(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a(P,{title:e.$t("confirmDelete"),onConfirm:()=>O([l.id])},{reference:t(()=>[a(w,{type:"primary",disabled:n(f)("blockItem:delete"),size:"small",link:""},{default:t(()=>[V(C(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[ne,D.value]])]),a(Te,{modelValue:I.value,"onUpdate:modelValue":o[5]||(o[5]=l=>I.value=l),"bean-id":L.value,"bean-ids":M.value,"block-id":p.value,onFinished:v},null,8,["modelValue","bean-id","bean-ids","block-id"])]}),_:1})]),_:1})}}}),Je=he(ze,[["__scopeId","data-v-a7f52f2a"]]);export{Je as default};
