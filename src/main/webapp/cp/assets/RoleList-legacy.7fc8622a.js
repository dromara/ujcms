System.register(["./vendor-legacy.5297913d.js","./index-legacy.1357978d.js","./user-legacy.e6975b76.js","./QueryItem-legacy.917c604a.js","./ListMove-legacy.f9cfc0df.js","./data-legacy.2993444c.js","./DialogForm-legacy.4fd4a6bc.js"],(function(e){"use strict";var l,a,t,n,o,d,u,i,r,s,c,m,v,p,f,b,y,_,h,g,V,k,$,w,C,I,j,B,x,q,D,U,S,Q,F,z,K;return{setters:[function(e){l=e.g,a=e.D,t=e.m,n=e.o,o=e.j,d=e.w,u=e.n,i=e.k,r=e.u,s=e.i,c=e.L,m=e.q,v=e.x,p=e.ac,f=e.aj,b=e.K,y=e.ai,_=e.J,h=e.y,g=e.ab},function(e){V=e.p,k=e.d,$=e.r,w=e.o},function(e){C=e.i,I=e.j,j=e.k,B=e.l,x=e.b,q=e.n},function(e){D=e._,U=e.b,S=e.a,Q=e.c},function(e){F=e._},function(e){z=e.b},function(e){K=e._}],execute:function(){const L=l({props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e){const l=a(),r=a(),s=a(),c=z();return(a,m)=>{const v=t("el-input"),p=t("el-form-item"),f=t("el-tree");return n(),o(K,{ref_key:"form",ref:s,name:a.$t("menu.user.role"),queryBean:i(C),createBean:i(I),updateBean:i(j),deleteBean:i(B),beanId:e.beanId,beanIds:e.beanIds,focus:l.value,initValues:()=>({}),toValues:e=>({...e}),disableDelete:e=>e.id<=1,perms:"role","model-value":e.modelValue,"onUpdate:modelValue":m[1]||(m[1]=e=>a.$emit("update:modelValue",e)),onFinished:m[2]||(m[2]=e=>a.$emit("finished")),onBeanChange:m[3]||(m[3]=e=>{var l,a,t;return null===(l=r.value)||void 0===l?void 0:l.setCheckedKeys(null!==(a=null===(t=e.permission)||void 0===t?void 0:t.split(","))&&void 0!==a?a:[])}),onBeforeSubmit:m[4]||(m[4]=e=>e.permission=[...r.value.getHalfCheckedNodes(),...r.value.getCheckedNodes()].filter((e=>e.perms)).map((e=>{var l;return null===(l=e.perms)||void 0===l?void 0:l.join(",")})).join(","))},{default:d((({values:e})=>[u(p,{prop:"name",label:a.$t("role.name"),rules:{required:!0,message:()=>a.$t("v.required")}},{default:d((()=>[u(v,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,ref_key:"focus",ref:l,maxlength:"50"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","rules"]),u(p,{prop:"description",label:a.$t("role.description")},{default:d((()=>[u(v,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,maxlength:"255"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"]),u(p,{prop:"permission",label:a.$t("role.permission")},{default:d((()=>[u(f,{ref_key:"tree",ref:r,data:i(c),"node-key":"key",onCheck:m[0]||(m[0]=e=>s.value.setUnsaved(!0)),"show-checkbox":"","default-expand-all":"","check-on-click-node":""},null,8,["data"])])),_:1},8,["label"])])),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","model-value"])}}}),M={class:"mb-3"};e("default",l({setup(e){const{t:l}=r(),C=a({}),I=a(),j=a(),z=a([]),K=a([]),N=a(!1),O=a(!1),R=a(),A=s((()=>z.value.map((e=>e.id)))),H=a(!1),J=async()=>{N.value=!0;try{z.value=await x({...k(C.value),Q_OrderBy:I.value}),H.value=Object.values(C.value).filter((e=>void 0!==e&&""!==e)).length>0||void 0!==I.value}finally{N.value=!1}};c(J);const E=({column:e,prop:l,order:a})=>{var t;I.value=l?(null!==(t=e.sortBy)&&void 0!==t?t:l)+("descending"===a?"_desc":""):void 0,J()},G=()=>J(),P=()=>{j.value.clearSort(),$(C.value),I.value=void 0,J()},T=()=>{R.value=void 0,O.value=!0},W=e=>{R.value=e,O.value=!0},X=async e=>{await B(e),J(),b.success(l("success"))};return(e,l)=>{const a=t("el-button"),r=t("el-popconfirm"),s=t("el-table-column"),c=t("el-table"),b=y("loading");return n(),m("div",null,[v("div",M,[u(i(D),{params:C.value,onSearch:G,onReset:P},{default:d((()=>[u(i(S),{label:e.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),u(i(S),{label:e.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])])),_:1},8,["params"])]),v("div",null,[u(a,{type:"primary",icon:i(p),onClick:T},{default:d((()=>[_(h(e.$t("add")),1)])),_:1},8,["icon"]),u(r,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=e=>X(K.value.map((e=>e.id))))},{reference:d((()=>[u(a,{disabled:K.value.length<=0,icon:i(g)},{default:d((()=>[_(h(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),u(F,{class:"ml-2",disabled:K.value.length<=0||H.value||i(V)("role:update"),onMove:l[1]||(l[1]=e=>(async(e,l)=>{const a=w(e,z.value,l);await q(a.map((e=>e.id)))})(K.value,e))},null,8,["disabled"]),u(i(U),{name:"role",class:"ml-2"})]),f((n(),o(c,{ref_key:"table",ref:j,data:z.value,onSelectionChange:l[2]||(l[2]=e=>K.value=e),onRowDblclick:l[3]||(l[3]=e=>W(e.id)),onSortChange:E,class:"mt-3 shadow bg-white"},{default:d((()=>[u(i(Q),{name:"role"},{default:d((()=>[u(s,{type:"selection",width:"50"}),u(s,{property:"id",label:"ID",width:"64",sortable:"custom"}),u(s,{property:"name",label:e.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),u(s,{property:"description",label:e.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),u(s,{label:e.$t("table.action")},{default:d((({row:l})=>[u(a,{type:"text",onClick:e=>W(l.id),size:"small"},{default:d((()=>[_(h(e.$t("edit")),1)])),_:2},1032,["onClick"]),u(r,{title:e.$t("confirmDelete"),onConfirm:e=>X([l.id])},{reference:d((()=>[u(a,{type:"text",size:"small"},{default:d((()=>[_(h(e.$t("delete")),1)])),_:1})])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data"])),[[b,N.value]]),u(L,{modelValue:O.value,"onUpdate:modelValue":l[4]||(l[4]=e=>O.value=e),beanId:R.value,beanIds:i(A),onFinished:J},null,8,["modelValue","beanId","beanIds"])])}}}))}}}));
