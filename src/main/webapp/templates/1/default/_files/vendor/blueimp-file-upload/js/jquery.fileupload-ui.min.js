(e=>{"function"==typeof define&&define.amd?define(["jquery","blueimp-tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-tmpl"),require("./jquery.fileupload-image"),require("./jquery.fileupload-audio"),require("./jquery.fileupload-video"),require("./jquery.fileupload-validate")):e(window.jQuery,window.tmpl)})(function(d,t){d.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{autoUpload:!1,showElementClass:"in",uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(e){return e.result&&d.isArray(e.result.files)?e.result.files:[]},add:function(e,t){if(e.isDefaultPrevented())return!1;var i=d(this),n=i.data("blueimp-fileupload")||i.data("fileupload"),r=n.options;t.context=n._renderUpload(t.files).data("data",t).addClass("processing"),r.filesContainer[r.prependFiles?"prepend":"append"](t.context),n._forceReflow(t.context),n._transition(t.context),t.process(function(){return i.fileupload("process",t)}).always(function(){t.context.each(function(e){d(this).find(".size").text(n._formatFileSize(t.files[e].size))}).removeClass("processing"),n._renderPreviews(t)}).done(function(){t.context.find(".edit,.start").prop("disabled",!1),!1!==n._trigger("added",e,t)&&(r.autoUpload||t.autoUpload)&&!1!==t.autoUpload&&t.submit()}).fail(function(){t.files.error&&t.context.each(function(e){e=t.files[e].error;e&&d(this).find(".error").text(e)})})},send:function(e,t){var i;return!e.isDefaultPrevented()&&(i=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),i._trigger("sent",e,t))},done:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),s=(n.getFilesFromResponse||a.options.getFilesFromResponse)(n);n.context?n.context.each(function(e){var t=s[e]||{error:"Empty file upload result"};o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){var e=d(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=d(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()})})}):(r=a._renderDownload(s)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer),a._forceReflow(r),o=a._addFinishedDeferreds(),a._transition(r).done(function(){n.context=d(this),a._trigger("completed",i,n),a._trigger("finished",i,n),o.resolve()}))},fail:function(i,n){if(i.isDefaultPrevented())return!1;var r,o,a=d(this).data("blueimp-fileupload")||d(this).data("fileupload");n.context?n.context.each(function(e){var t;"abort"!==n.errorThrown?((t=n.files[e]).error=t.error||n.errorThrown||n.i18n("unknownError"),o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){var e=d(this);r=a._renderDownload([t]).replaceAll(e),a._forceReflow(r),a._transition(r).done(function(){n.context=d(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})})):(o=a._addFinishedDeferreds(),a._transition(d(this)).done(function(){d(this).remove(),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()}))}):"abort"!==n.errorThrown?(n.context=a._renderUpload(n.files)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer).data("data",n),a._forceReflow(n.context),o=a._addFinishedDeferreds(),a._transition(n.context).done(function(){n.context=d(this),a._trigger("failed",i,n),a._trigger("finished",i,n),o.resolve()})):(a._trigger("failed",i,n),a._trigger("finished",i,n),a._addFinishedDeferreds().resolve())},progress:function(e,t){if(e.isDefaultPrevented())return!1;var i=Math.floor(t.loaded/t.total*100);t.context&&t.context.each(function(){d(this).find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%")})},progressall:function(e,t){if(e.isDefaultPrevented())return!1;var e=d(this),i=Math.floor(t.loaded/t.total*100),n=e.find(".fileupload-progress"),r=n.find(".progress-extended");r.length&&r.html((e.data("blueimp-fileupload")||e.data("fileupload"))._renderExtendedProgress(t)),n.find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%")},start:function(e){if(e.isDefaultPrevented())return!1;var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(d(this).find(".fileupload-progress")).done(function(){t._trigger("started",e)})},stop:function(e){if(e.isDefaultPrevented())return!1;var t=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),i=t._addFinishedDeferreds();d.when.apply(d,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",e)}),t._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),d(this).find(".progress-extended").html("&nbsp;"),i.resolve()})},processstart:function(e){if(e.isDefaultPrevented())return!1;d(this).addClass("fileupload-processing")},processstop:function(e){if(e.isDefaultPrevented())return!1;d(this).removeClass("fileupload-processing")},destroy:function(e,t){if(e.isDefaultPrevented())return!1;function i(){n._transition(t.context).done(function(){d(this).remove(),n._trigger("destroyed",e,t)})}var n=d(this).data("blueimp-fileupload")||d(this).data("fileupload");t.url?(t.dataType=t.dataType||n.options.dataType,d.ajax(t).done(i).fail(function(){n._trigger("destroyfailed",e,t)})):i()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){e=e||d.Deferred();return this._finishedUploads.push(e),e},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var e=d(this),t=e.prop("href"),i=e.prop("download");e.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",i,t].join(":"))}catch(e){}})},_formatFileSize:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" GB":1e6<=e?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":1e9<=e?(e/1e9).toFixed(2)+" Gbit/s":1e6<=e?(e/1e6).toFixed(2)+" Mbit/s":1e3<=e?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),e=Math.floor(e/86400);return(e?e+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(e,t){return e?(e=e({files:t,formatFileSize:this._formatFileSize,options:this.options}))instanceof d?e:d(this.options.templatesContainer).html(e).children():d()},_renderPreviews:function(i){i.context.find(".preview").each(function(e,t){d(t).empty().append(i.files[e].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_editHandler:function(e){var t,i,n,r;e.preventDefault(),this.options.edit&&(t=this,e=d(e.currentTarget),i=e.closest(".template-upload"),n=i.data("data"),r=e.data().index,this.options.edit(n.files[r]).then(function(e){e&&(n.files[r]=e,n.context.addClass("processing"),i.find(".edit,.start").prop("disabled",!0),d(t.element).fileupload("process",n).always(function(){i.find(".size").text(t._formatFileSize(n.files[r].size)),n.context.removeClass("processing"),t._renderPreviews(n)}).done(function(){i.find(".edit,.start").prop("disabled",!1)}).fail(function(){i.find(".edit").prop("disabled",!1);var e=n.files[r].error;e&&i.find(".error").text(e)}))}))},_startHandler:function(e){e.preventDefault();var e=d(e.currentTarget),t=e.closest(".template-upload").data("data");e.prop("disabled",!0),t&&t.submit&&t.submit()},_cancelHandler:function(e){e.preventDefault();var t=d(e.currentTarget).closest(".template-upload,.template-download"),i=t.data("data")||{};i.context=i.context||t,i.abort?i.abort():(i.errorThrown="abort",this._trigger("fail",e,i))},_deleteHandler:function(e){e.preventDefault();var t=d(e.currentTarget);this._trigger("destroy",e,d.extend({context:t.closest(".template-download"),type:"DELETE"},t.data()))},_forceReflow:function(e){return d.support.transition&&e.length&&e[0].offsetWidth},_transition:function(t){var i,n=d.Deferred();return d.support.transition&&t.hasClass("fade")&&t.is(":visible")?(i=function(e){e.target===t[0]&&(t.off(d.support.transition.end,i),n.resolveWith(t))},t.on(d.support.transition.end,i).toggleClass(this.options.showElementClass)):(t.toggleClass(this.options.showElementClass),n.resolveWith(t)),n},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start").trigger("click")}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel").trigger("click")}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").trigger("click"),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(e){i.find(".toggle").prop("checked",d(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .edit":this._editHandler,"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId)&&(e.downloadTemplate=t(e.downloadTemplateId))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof d||(e.filesContainer=d(e.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),d.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});