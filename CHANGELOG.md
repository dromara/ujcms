# UJCMS 发版说明

## ujcms-9.8.2

* 新增采集功能
* 新增文章独立静态化路径
* 新增栏目独立静态化路径
* 全文检索可将发布日期纳入评分权重
* 栏目管理新增是否文章栏目功能
* 栏目管理新增是否书籍根目录功能
* 文章正文编辑器增加 ctrl + s 保存快捷键 
* 修复：LeaderBoard 的 id 从 Integer 改为 Long 

## ujcms-9.7.5

* 修复栏目列表无法获取自定义字段的问题
* 修复部分后台功能列表操作列宽度不足的问题
* 修复自定义字段设计器无法拖动新增字段的问题
* 修复工作流的耗时总是几秒的问题
* 栏目管理增加前台浏览链接
* 文章新增时，发布时间默认给当前时间
* 正文编辑器过滤规则需允许音频标签

## ujcms-9.7.3

* 文章管理的列表增加顶、踩列
* 修复第三方登录时，`mobile not found`错误
* 修复留言`Reply_user_id_`大小写问题
* 修复`NodeJS 22`版本下，前端`tailwind.config.js`文件出现`ReferenceError: require is not defined`错误
* 修复postgresql下，后台栏目管理，修改是否导航时报错的问题
* 修复postgresql下，后台留言管理，点击留言状态时报错的问题
* 修复postgresql下，后台表单管理，点击表单状态时报错的问题
* 修复因ElementPlus按需加载，ElMessage ElMessageBox无样式的问题

## ujcms-9.7.1

* 修复文章上一条、下一条标签报错问题

## ujcms-9.7.0

* 使用pnpm代替npm
* 新增栏目是否导航快速修改功能
* 新增栏目合并功能
* 新增栏目批量移动功能
* 修复模型中文本自定义字段最大长度功能无效问题
* 修复栏目管理中点击不同栏目再点新建栏目，新增页面的上级栏目未变化问题
* 修复首页投票功能无效问题

## ujcms-9.6.3

* 修复已知bug

## ujcms-9.6.2

* 新增邮件短信、手机短信发送时的错误提示
* 新增关闭站点功能
* 新增一键置灰功能
* 新增我的留言功能
* 新增区块管理列表副标题字段
* 新增 CSRF 参数接口
* 访问日志请求每次都获取 CSRF 校验码，防止 CSRF 错误
* 修复前台手机端首页栏目下拉无效
* 修复 openGauss 部分不支持的语法
* 去除公安备案图标
* 调整部分演示数据

## ujcms-9.6.1

* 新增栏目管理、组织管理、站点管理树形结构拖拽功能
* 修复后台首页新、老访客百分比显示错误的问题
* 修复后台新老访客、地域分布、访客环境百分比显示错误的问题
* 修复文章自动上下线功能逻辑问题
* 文章自动上下线定时任务为每小时一次改为每10分钟一次

## ujcms-9.6.0

* 新增数据迁移功能
* 修复自定义的模型在保存文件时，后台报 Integer 超出范围
* 修复开启留言需登录功能后，前台页面点击留言时报错
* 增加留言类型演示数据
* 修复下载页面的赞、踩问题
* 增加全文检索排序功能
* 增加全文检索高级搜索功能
* 增加对MariaDB数据库的支持
* 文章审核页面的数据按创建审核任务时间倒序排序

## ujcms-9.5.1

* 修复模型新增报错问题
* 新增自定义表单演示数据

## ujcms-9.5.0

* 主键改用雪花算法
* 新增高级工作流设计器
* 新增审核退回功能
* 新增审核代理功能
* 新增审核委托功能
* 新增组织权限功能
* 新增自定义表单功能

### 升级指南

* **注意**：更新程序并启动成功后，在数据库中执行`upgrade/mysql/mysql_upgrade_90to95_after.sql`脚本。

## ujcms-9.1.4

* 修复jar包需要解压才可运行的问题
* 修复上传视频时无法自动获取视频图片问题
* 修复用户等级问题

## ujcms-9.1.1

* 全文检索增加单字检索
* 修复栏目模型的绩效类型是否显示无效的问题
* 修复文章管理持续操作打开情况下，切换栏目新增文章后，模型没有复原的问题

## ujcms-9.1.0

* 在当前线程中直接生成当前文章的静态页，以免文章出现文章页面找不到（404）的错误
* 修复拖拽排序不正确的问题
* 修复ujcms.ep-display: false，会关闭站点管理功能的问题
* 修复无文章、留言功能权限的用户登录首页会提示无权限的问题
* 修复国际化中敏感词提示为"{name}"没有被替换的问题
* 修复删除用户时，更新文章的修改人为匿名用户
* 修复前台修改账号信息页面报错问题
* 修复文章上线时间无效问题
* 修复部分页面排序不正确问题
* 修复文章增加新字段后，模型中系统字段没有更新的问题
* OrgTreeMapper.xml中listByAncestorId的resultType由map修正为int

## ujcms-9.0.5

* 修复前台全文搜索没有结果
* web.xml session过期时间从30分钟改成25分钟，部分漏洞扫描软件会将session过期时间大于等于30分钟判定为漏洞
* 修复文章管理一级栏目无法添加文章

## ujcms-9.0.3 (2024-01-03)

* 许可协议改为Apache-2.0
* 新增webp图片格式支持
* 新增一键排版功能
* 新增重复标题检测
* 新增文章排序功能
* 新增数据库备份
* 新增上传备份
* 新增上传增量备份
* 新增模板备份功能
* 新增文章工作量统计
* 新增角色所有状态权限
* 新增绩效统计功能
* 新增留言类型管理功能
* 新增待办事宜功能
* 新增文章定时上下线功能
* 新增文章指定过期时间
* 新增限制储存点file:开头的目录的功能
* 新增留言板和文章排行榜API
* 新增站点列表API及标签
* 优化大数据量下栏目的性能
* 优化pdf.js性能

### 升级指南

* **注意**：留言表的留言类别从字典表迁移到独立的`ujcms_message_board_type`表中。如未使用到留言功能，可忽略该项。否则升级前请先导出留言表`ujcms_message_board`及字典表`ujcms_dict`的留言类型(`type_id_`为`10`)，并将`ujcms_message_board`表中数据删除，否则升级可能失败。升级后将数据导回相应表中。
* **注意**：`ujcms_article_buffer`表并入`ujcms_article_ext`，`ujcms_channel_buffer`表并入`ujcms_channel`，`ujcms_site_buffer`表并入`ujcms_site`，模板中标签`orderBy='@articleBuffer-weekViews_desc'`需改为`orderBy='@articleExt-weekViews_desc'`。其它有用到和表相关的标签查询参数，也需将`@articleBuffer`改为`@articleExt`。
* **注意**：栏目列表标签（或接口）取消子栏目列表`children`属性和父栏目`parent`属性；只有单独查询栏目时，才提供这两个属性。
* **注意**：`ArticleNext`和`ArticlePrev`标签的`publishDate`参数更改为`order`，需要将`publishDate=article.publishDate`改为`order=article.order`。

## ujcms-8.0.2 (2023-08-30)

* 新增栏目、组织、用户发文排行榜功能
* 优化栏目、组织级联关系
* 修复修改文章会清空流程记录的问题
* 修复文章选择模板后，无法置空所选模板问题

## ujcms-8.0.1 (2023-08-15)

* 增加二次开发示例代码
* 增加Java代码生成器
* 组织管理界面使用树形结构
* 增加在线人数功能
* 增加当日访问量、昨日访问量、总访问量的模板演示 
* 修复当日访问量、昨日访问量统计不正确问题

## ujcms-8.0.0 (2023-08-11)

* 新增敏感词功能
* 新增易错词功能
* 新增投票功能
* 新增调查问卷功能
* 栏目正文增加markdown编辑器
* 顶踩增加是否参与判断
* 其它已知BUG

## ujcms-7.0.5 (2023-07-06)

* ArticleList增加q参数，用于查询文章标题or正文内容
* 修复文章审核、流程实例、历史流程分页错误问题

## ujcms-7.0.4 (2023-06-26)

* 改进访问统计。间隔4小时后，重新计算访问时长
* 修复文章管理栏目报错问题
* 修复流程实例、历史流程分页无效问题
* 修复全文检索标签的栏目属性无效问题

## ujcms-7.0.3 (2023-06-14)

* 修复MySQL8下，统计sql报错问题

### 升级指南

从7.0.0~7.0.2升级到7.0.3版本，需要先执行一下sql语句，再升级。

```
update DATABASECHANGELOG set MD5SUM = '8:41b14b415cc70a528d98b73d943d8b60' where ID = '1682691725814-4';
update DATABASECHANGELOG set MD5SUM = '8:32a87d88754436b8a792928be2b193cd' where ID = '1682691725814-5';
```

## ujcms-7.0.2 (2023-06-13)

* 修复文章点击数不增长问题

## ujcms-7.0.1 (2023-06-12)

* 新增栏目的图片字段
* 栏目对象的子栏目的json加上图片字段
* 上一篇、下一篇文章只显示正常和归档文章
* 修复首页点击加载更多，展示的内容有误
* 修复点赞报csrf错误
* 修复全局设置功能显示没有权限的问题
* 修复自定义字段多行文本、单行文本无法清空字段值的问题

## ujcms-7.0.0 (2023-06-07)

* 新增访问趋势统计
* 新增受访页面统计
* 新增入口页面统计
* 新增访问来源统计
* 新增新老访客统计
* 新增地域分布统计
* 新增访客环境统计
* 新增系统监控功能
* 后台首页增加统计信息，美化界面
* 修复文件管理相关BUG
* 修复customs自定义字段查询报错问题
* 修复字典无法删除问题
* ${article.id} 改为 ${article.id?c}，防止数字加上逗号

## ujcms-6.0.2 (2023-04-05)

* 新增模板、上传、HTML文件管理功能
* 新增Tag功能
* 新增站群推送功能
* 新增站内推送功能
* 修复已知BUG

## ujcms-5.5.2 (2023-01-18)

* 修复图片裁剪页面无样式问题
* 修复markdown编辑器无样式问题
* 修复关闭左边栏后页面空白问题
* 修复流程设计器因标识为数值而无法使用问题
* 修复角色赋权报错问题
* 修复用户组授权错误问题
* 修复归档文章无法提交问题

## ujcms-5.5.1 (2023-01-09)

* 修复文章管理、栏目管理的外部链接字段xss漏洞

## ujcms-5.5.0 (2023-01-06)

* 新增留言板功能
* 新增登录、注册、找回密码功能
* 新增会员中心、修改基本信息、修改头像功能
* 新增第三方登录功能
* 新增从正文提取图片功能
* 新增文章置顶功能
* 新增操作日志功能
* 新增浏览权限、栏目权限功能
* 安全框架从Shiro改为Spring Security
* 已知BUG修复

### 升级指南

* **注意**：下载地址`${dy}/download/...`变更为`${dy}/download-file/...`。由于`download`地址比较常用，换成不易冲突的地址。
* **注意**：BlockItemList标签的参数`blockAlias`参数改为`block`。
* **注意**：密码加密方式改为Spring Security的方式加密，密码和salt放到了同一个字段里。这将导致原密码无法登录，需要到数据库重置密码，将`ujcms_user`表的`password_`
  字段修改为`{pbkdf2}0Knzbc+J3Fkl5/mlJBrwLFOUwOvoBANcrfCgVvrjCSIBjnazXupYVw==`，密码将被重置为`password`。
* **注意**：执行`upgrade/mysql/mysql_upgrade_40to55.sql`升级数据库（先启动程序，升级表结构后，再执行该脚本）。

## ujcms-4.1.2 (2022-07-21)

* 升级shiro至1.9.1版本
* 修复角色权限设置在切换角色时，功能权限、文章权限无法正常赋值
* 补传ProcessTaskList.vue文件

## ujcms-4.1.1 (2022-07-18)

* Flowable工作流
* 流程可视化设计
* 流程部署
* 流程实例
* 历史流程
* 文章审核
* 文章驳回及理由
* 文章状态（草稿、下线、归档、删除）
* 文章审核过程
* 文章数据权限
* 增加音频字段
* 自动获取视频、音频时长
* 自动获取视频截图
* SiteMap功能
* 密码复杂度
* 密码过期
* 强制历史密码
* 用户登录错误超过次数锁定登录
* IP登录错误超过次数锁定登录
* 登录验证码
* 双因子验证
* 短信服务（阿里短信、腾讯短信）
* 拖拽上传
* 登录日志
* 短信日志
* 自定义字段保存数据类型
* 自定义字段字典数据同时保存字典KEY和字典NAME
* 自定义字段中上传字段可设置的文件类型和大小限制

### 升级指南

* **注意**：自定义字段中如涉及下拉选择、单选框、复选框等字典数据，会因自定义字段保存数据的方式改为同时保存字典KEY和字典NAME（之前只保存字典NAME），并以字典KEY作为判断标准，从而使得后台管理时相关自定义字段数据丢失。
* **注意**：本次升级重做了liquibase的changelog。无法通过程序自动升级数据库表结构，需手动执行`upgrade/mysql/mysql_upgrade_3to4_whole.sql`
  进行升级。如果之前是2.0版本的，需要先升级到3.0（使用3.0的程序，并启动，让程序自动把数据库升级到3.0），再执行`mysql_upgrade_3to4_whole.sql`将数据库升级到4.0。

## ujcms-3.1.0 (2022-06-17)

* 新增：sitemap功能

## ujcms-3.0.1 (2022-06-15)

* 修复：下载链接失效问题
* 修复：上传文件后缀限制区分大小写问题
* 修复：管理员后台权限菜单显示空菜单问题
* 修复：图片上传都默认生成了缩略图
* 修复：删除栏目静态页只删除第一页问题
* 修复：栏目静态页只生成前几页的情况下，后几页地址还是静态页地址，导致404错误

## ujcms-3.0.0 (2022-06-12)

* 新增：系统信息功能
* 新增：密码使用国密PBKDF2WithHmacSM3加密
* 新增：登录时密码传输使用国密SM2非对称加密
* 新增：JWT使用国密HmacSM3加密
* 新增：JWT token使用国密SM4加密
* 新增：随机密钥生成功能
* 新增：前台模板使用escape标签处理XSS和空值问题
* 新增：后台管理界面多页签功能
* 新增：后台管理界面session失效后，自动显示登录框，登录后保留在原页面，防止页面数据丢失
* 新增：区块项新增功能
* 新增：DOC导入功能
* 新增：文库转换功能
* 新增：文库封面自动截图
* 新增：文章管理增加Markdown编辑器
* 新增：附件、HTML静态页、模板支持对象存储（MinIO、阿里云对象存储、腾讯云对象存储、七牛云对象存储）
* 优化：富文本编辑器的字体从16px改为14px
* 优化：富文本编辑器即时校验功能
* 优化：增加上传功能的错误提示
* 优化：application.properties改为application.yaml，避免注释的中文无法在普通编辑器中显示
* 修复：文章管理图片集上传框未对齐
* 修复：删除有图片集的文章报错
* 修复：视频无法上传

### 升级指南

* 使用escape标签处理XSS和空值。所有freemarker页面使用`[#escape x as (x)!?html]`开头和`[/#escape]`结尾；使用`[#noescape]...[/#noescape]`
  功能替换原有的`?no_esc`
* 密码需用新算法重置

## ujcms-2.0.2 (2022-03-21)

* 修复：文章管理中没有编辑器的页面无法提交

## ujcms-2.0.1 (2022-03-19)

* 许可协议由 AGPL-3 改为 GPL-2
* 开放组织管理功能
* 增加全局设置中栏目URL和文章URL自定义地址的合法校验
* 增加站点设置中域名的合法校验
* 修复：前台搜索报错（ChannelInnerBase不能转换为Anchor）
* 升级owasp-java-html-sanitizer组件版本至20211018.2
* 升级guava组件版本至30.1-jre

## ujcms-2.0.0 (2022-03-08)

* 新增静态页生成功能
* 新增静态页设置功能
* 新增任务管理功能
* 新增防盗链下载功能
* 新增下载文件名可为中文
* 数据库表结构自动创建及自动升级功能
* 首次运行数据自动初始化
* 支持国产数据库
* 使用vite2代替webpack
* 升级到element-plus-2.0正式版
* 修复新窗口打开选项无效的问题
* 修复api/auth/jwt/login登录接口不加Authorization的header会出现403的问题

## ujcms-1.0.0 (2022-01-09)

1. 内容

* 文章管理
* 栏目管理
* 区块管理
* 附件管理
* 生成管理

2. 配置

* 全局设置
* 站点设置
* 模型管理
* 区块设置
* 字典类型
* 字典数据

3. 用户

* 用户管理
* 角色管理
* 用户组管理
* 组织管理

4. 系统

* 站点管理
* 储存点管理
